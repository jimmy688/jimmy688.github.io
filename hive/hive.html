<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CentOS 7安装MySQL5.7版本 | 个人博客 | JiiiiG</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="自是年少，韶华倾负">
    
    <link rel="preload" href="/assets/css/0.styles.420b7c1f.css" as="style"><link rel="preload" href="/assets/js/app.fdd7a502.js" as="script"><link rel="preload" href="/assets/js/16.375b747e.js" as="script"><link rel="preload" href="/assets/js/14.1f257a58.js" as="script"><link rel="prefetch" href="/assets/js/10.bbd38b9e.js"><link rel="prefetch" href="/assets/js/11.f49fc7d3.js"><link rel="prefetch" href="/assets/js/12.c5d97aa1.js"><link rel="prefetch" href="/assets/js/13.426d0224.js"><link rel="prefetch" href="/assets/js/15.be29bb6a.js"><link rel="prefetch" href="/assets/js/17.d02cdd8b.js"><link rel="prefetch" href="/assets/js/18.5d2371a4.js"><link rel="prefetch" href="/assets/js/19.038919a3.js"><link rel="prefetch" href="/assets/js/2.d6257727.js"><link rel="prefetch" href="/assets/js/20.b3582e09.js"><link rel="prefetch" href="/assets/js/21.0c1e826b.js"><link rel="prefetch" href="/assets/js/22.91bff1a5.js"><link rel="prefetch" href="/assets/js/23.faacea60.js"><link rel="prefetch" href="/assets/js/24.69816497.js"><link rel="prefetch" href="/assets/js/25.c9fcaa62.js"><link rel="prefetch" href="/assets/js/26.d28c3abe.js"><link rel="prefetch" href="/assets/js/27.1518da7d.js"><link rel="prefetch" href="/assets/js/28.748a5581.js"><link rel="prefetch" href="/assets/js/29.775019f1.js"><link rel="prefetch" href="/assets/js/3.141002a4.js"><link rel="prefetch" href="/assets/js/30.74e7c570.js"><link rel="prefetch" href="/assets/js/31.190b11f2.js"><link rel="prefetch" href="/assets/js/32.d8f4f116.js"><link rel="prefetch" href="/assets/js/33.c489bc81.js"><link rel="prefetch" href="/assets/js/34.db609d51.js"><link rel="prefetch" href="/assets/js/35.ad3402e6.js"><link rel="prefetch" href="/assets/js/36.45f11923.js"><link rel="prefetch" href="/assets/js/37.b47e0576.js"><link rel="prefetch" href="/assets/js/38.58b934a2.js"><link rel="prefetch" href="/assets/js/39.e4d6bcdf.js"><link rel="prefetch" href="/assets/js/4.e9b44388.js"><link rel="prefetch" href="/assets/js/40.555106bc.js"><link rel="prefetch" href="/assets/js/41.4387ceb1.js"><link rel="prefetch" href="/assets/js/42.9bd4aea0.js"><link rel="prefetch" href="/assets/js/43.587e7966.js"><link rel="prefetch" href="/assets/js/44.80285763.js"><link rel="prefetch" href="/assets/js/45.f978da77.js"><link rel="prefetch" href="/assets/js/46.d93e3f2e.js"><link rel="prefetch" href="/assets/js/47.c15bd2aa.js"><link rel="prefetch" href="/assets/js/48.cb55fa72.js"><link rel="prefetch" href="/assets/js/49.d0f4e454.js"><link rel="prefetch" href="/assets/js/5.b90b80cb.js"><link rel="prefetch" href="/assets/js/50.112e8260.js"><link rel="prefetch" href="/assets/js/51.a66bcd03.js"><link rel="prefetch" href="/assets/js/52.0c7cbfb1.js"><link rel="prefetch" href="/assets/js/53.67ef240b.js"><link rel="prefetch" href="/assets/js/54.2c2d082d.js"><link rel="prefetch" href="/assets/js/55.88f19a20.js"><link rel="prefetch" href="/assets/js/56.c726e920.js"><link rel="prefetch" href="/assets/js/57.eaee47c5.js"><link rel="prefetch" href="/assets/js/58.ac15a3ac.js"><link rel="prefetch" href="/assets/js/59.64bdc849.js"><link rel="prefetch" href="/assets/js/6.7eea74ff.js"><link rel="prefetch" href="/assets/js/7.a1370e98.js"><link rel="prefetch" href="/assets/js/8.2e898240.js"><link rel="prefetch" href="/assets/js/9.a2439994.js">
    <link rel="stylesheet" href="/assets/css/0.styles.420b7c1f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人博客 | JiiiiG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/linux/linux常用命令/01linux常用命令01.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hadoop/01hadoop环境搭建/01搭建hadoop集群.html" class="nav-link">
  hadoop
</a></li><li class="dropdown-item"><!----> <a href="/hbase/hbase.html" class="nav-link">
  hbase
</a></li><li class="dropdown-item"><!----> <a href="/flink/flink.html" class="nav-link">
  flink
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hive/.html" class="nav-link">
  java
</a></li></ul></div></div> <a href="https://github.com/MaLunan/press" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/linux/linux常用命令/01linux常用命令01.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hadoop/01hadoop环境搭建/01搭建hadoop集群.html" class="nav-link">
  hadoop
</a></li><li class="dropdown-item"><!----> <a href="/hbase/hbase.html" class="nav-link">
  hbase
</a></li><li class="dropdown-item"><!----> <a href="/flink/flink.html" class="nav-link">
  flink
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hive/.html" class="nav-link">
  java
</a></li></ul></div></div> <a href="https://github.com/MaLunan/press" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="centos-7安装mysql5-7版本"><a href="#centos-7安装mysql5-7版本" class="header-anchor">#</a> CentOS 7安装MySQL5.7版本</h2> <h5 id="安装mysql"><a href="#安装mysql" class="header-anchor">#</a> 安装mysql</h5> <h6 id="下载并安装mysql官方的yum源"><a href="#下载并安装mysql官方的yum源" class="header-anchor">#</a> 下载并安装mysql官方的yum源</h6> <p>若是在学完Hadoop、ZooKeeper课程后，接着要学习Hive课程时，需要先安装mysql，安装到第三个节点node03上。在CentOS 7中默认安装有MariaDB，这个是MySQL的分支；但还是要安装MySQL，而且安装完成之后会直接覆盖掉MariaDB。</p> <ul><li>使用root用户</li> <li>进入/kkb/soft目录，并安装wget软件</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token function">su</span> root
<span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## cd /kkb/soft/</span>
<span class="token punctuation">[</span>root@node03 soft<span class="token punctuation">]</span><span class="token comment">## yum -y install wget</span>
</code></pre></div><blockquote><p>出现<code>Installed</code>!字样，表示成功安装</p></blockquote> <ul><li>使用<code>wget</code>命令下载<code>mysql</code>的<code>rpm</code>包</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 soft<span class="token punctuation">]</span><span class="token comment">## wget -i -c http://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm</span>
</code></pre></div><blockquote><p>-i 指定输入文件</p> <p>-c 表示断点续传</p></blockquote> <h6 id="安装mysql-2"><a href="#安装mysql-2" class="header-anchor">#</a> 安装mysql</h6> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>root@node03 soft<span class="token punctuation">]</span><span class="token comment">## yum -y install mysql57-community-release-el7-10.noarch.rpm</span>
</code></pre></div><p><img src="/assets/img/Image201910301549.d885bd17.png" alt=""></p> <ul><li><p>安装mysql server</p> <p>这步可能会花些时间，需要在线下载，视网速而定；然后再安装；安装完成后就会覆盖掉之前的mariadb</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 soft<span class="token punctuation">]</span><span class="token comment">## yum -y install mysql-community-server</span>
</code></pre></div><p><img src="/assets/img/Image201910301601.b3f577e0.png" alt=""></p> <h5 id="设置mysql"><a href="#设置mysql" class="header-anchor">#</a> 设置mysql</h5> <h6 id="启动mysql服务"><a href="#启动mysql服务" class="header-anchor">#</a> 启动mysql服务</h6> <ul><li>首先启动MySQL服务</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 soft<span class="token punctuation">]</span><span class="token comment">## systemctl start mysqld.service</span>
</code></pre></div><ul><li>查看mysql启动状态</li></ul> <div class="language- extra-class"><pre class="language-text"><code>[root@node03 soft]## systemctl status mysqld.service
</code></pre></div><p>下图active（running）表示mysql服务已启动</p> <p><img src="/assets/img/Image201910301608.7a4b9839.png" alt=""></p> <h6 id="修改密码"><a href="#修改密码" class="header-anchor">#</a> 修改密码</h6> <ul><li><p>此时MySQL已经开始正常运行，不过要登陆MySQL，还得先找出此时mysql的root用户的临时密码</p> <p>如下命令可以在日志文件中找出临时密码</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## grep &quot;password&quot; /var/log/mysqld.log</span>
</code></pre></div><ul><li>注意：==不同人的临时密码不一样，根据自己的实际情况而定==，可以查看到我的临时密码为</li></ul> <div class="language- extra-class"><pre class="language-text"><code>fHy3Su:&amp;REkh
</code></pre></div><p><img src="/assets/img/Image201910301623.742cda7c.png" alt=""></p> <ul><li>使用临时密码，登陆<code>mysql</code>客户端</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token punctuation">[</span>root<span class="token variable">@node03</span> hadoop<span class="token punctuation">]</span><span class="token comment">## mysql -uroot -p</span>
</code></pre></div><ul><li>设置密码策略为LOW，此策略只检查密码的长度</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token keyword">global</span> validate_password_policy<span class="token operator">=</span>LOW<span class="token punctuation">;</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt=""></p> <blockquote><p>关键字“<code>Query OK</code>”表示，<code>sql</code>语句执行成功</p></blockquote> <ul><li>设置密码最小长度</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token keyword">global</span> validate_password_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt=""></p> <ul><li>修改<code>mysql</code>的<code>root</code>用户，本地登陆的密码为<code>123456</code></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'root'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>开启<code>mysql</code>的远程连接权限</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span>  <span class="token keyword">on</span>  <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'root'</span><span class="token variable">@'%'</span> identified <span class="token keyword">by</span> <span class="token string">'123456'</span> <span class="token keyword">with</span> <span class="token keyword">grant</span> <span class="token keyword">option</span><span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>若不再需要使用<code>mysql</code>命令行，可以退出</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">exit</span>
</code></pre></div><h5 id="mysql的卸载"><a href="#mysql的卸载" class="header-anchor">#</a> mysql的卸载</h5> <p>==注意：mysql安装有问题的，才做此步骤==</p> <ul><li>上面我们在CentOS 7当中已经安装好了5.7版本的mysql服务；</li> <li>如果以后我们不需要mysql了，或者mysql安装失败了需要重新安装，那么我们需要将mysql卸载掉</li> <li>==使用root用户==</li></ul> <h6 id="_4-1-停止mysql服务"><a href="#_4-1-停止mysql服务" class="header-anchor">#</a> 4.1 停止mysql服务</h6> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## systemctl stop mysqld.service</span>
</code></pre></div><h6 id="_4-2-列出已安装的mysql相关的包"><a href="#_4-2-列出已安装的mysql相关的包" class="header-anchor">#</a> 4.2 列出已安装的mysql相关的包</h6> <ul><li><p>有两种方式，都可以，任选其一</p> <p>方式一</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## yum list installed mysql*</span>
</code></pre></div><p><img src="/assets/img/Image201910311059.49e8547b.png" alt=""></p> <p>​		方式二</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## rpm -qa | grep -i mysql</span>
</code></pre></div><p><img src="/assets/img/Image201910311055.1230e1b6.png" alt=""></p> <h6 id="_4-3-卸载mysql包"><a href="#_4-3-卸载mysql包" class="header-anchor">#</a> 4.3 卸载mysql包</h6> <ul><li><p>卸载rpm包，使用rpm -e --nodeps方式卸载，后边依次加入上图的①~⑥的包名，包名之间有空格</p> <blockquote><p>注意：==根据自己的实际情况，指定包名进行卸载==</p></blockquote></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## rpm -e --nodeps mysql57-community-release-el7-10.noarch mysql-community-common-5.7.28-1.el7.x86_64 mysql-community-client-5.7.28-1.el7.x86_64 mysql-community-libs-compat-5.7.28-1.el7.x86_64 mysql-community-libs-5.7.28-1.el7.x86_64 mysql-community-server-5.7.28-1.el7.x86_64</span>
</code></pre></div><ul><li><p>卸载完后，用两个命令再次确认，mysql相关的包已经被卸载</p> <blockquote><p>注意：确保mysql卸载干净，再继续往下操作</p></blockquote></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## rpm -qa | grep -i mysql</span>
<span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## yum list installed mysql*</span>
</code></pre></div><p><img src="/assets/img/Image201910311128.5a54645c.png" alt=""></p> <h6 id="_4-4-删除mysql残留文件"><a href="#_4-4-删除mysql残留文件" class="header-anchor">#</a> 4.4 删除mysql残留文件</h6> <ul><li>查看mysql相关目录</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## find / -name mysql</span>
</code></pre></div><blockquote><p>根据自己的实际情况，删除find出来的目录</p></blockquote> <p><img src="/assets/img/Image201910311202.ac82ac77.png" alt=""></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## rm -rf /var/lib/mysql/</span>
<span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## rm -rf /usr/share/mysql/</span>
<span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## rm -rf /etc/selinux/targeted/active/modules/100/mysql</span>
</code></pre></div><ul><li>另外删除文件：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## rm -rf /root/.mysql_history</span>
<span class="token punctuation">[</span>root@node03 hadoop<span class="token punctuation">]</span><span class="token comment">## rm -f /var/log/mysqld.log</span>
</code></pre></div><h2 id="hive安装部署"><a href="#hive安装部署" class="header-anchor">#</a> Hive安装部署</h2> <h3 id="安装前准备"><a href="#安装前准备" class="header-anchor">#</a> 安装前准备</h3> <ol><li>安装好对应版本的<code>hadoop</code>集群（三节点），并启动<code>hadoop</code>的<code>HDFS</code>以及<code>YARN</code>服务</li> <li><code>Node03</code>安装了<code>MySQL</code>服务，并启动<code>MySQL</code>的服务</li></ol> <h3 id="安装注意事项"><a href="#安装注意事项" class="header-anchor">#</a> 安装注意事项</h3> <p>注意<code>hive</code>就是==一个构建数据仓库的工具==，只需要在==一台服务器上==安装就可以了，不需要在多台服务器上安装。 此处以安装到<code>node03</code>为例；</p> <p>使用==hadoop普通用户==操作</p> <h3 id="安装步骤"><a href="#安装步骤" class="header-anchor">#</a> 安装步骤</h3> <h5 id="准备安装包"><a href="#准备安装包" class="header-anchor">#</a> 准备安装包</h5> <ul><li><p>通过浏览器下载<code>hive</code>的安装包</p> <ul><li>http://archive.cloudera.com/cdh5/cdh/5/hive-1.1.0-cdh5.14.2.tar.gz</li></ul></li> <li><p>上传安装包到<code>node03</code>服务器中的<code>/kkb/soft</code>路径下</p></li></ul> <h5 id="解压安装包"><a href="#解压安装包" class="header-anchor">#</a> 解压安装包</h5> <ul><li><p>解压安装包到指定的规划目录<code>/kkb/install</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /kkb/soft/
<span class="token punctuation">[</span>hadoop@node03 soft<span class="token punctuation">]</span>$ <span class="token function">tar</span> -xzvf hive-1.1.0-cdh5.14.2.tar.gz -C /kkb/install/
</code></pre></div></li></ul> <h5 id="修改配置文件"><a href="#修改配置文件" class="header-anchor">#</a> 修改配置文件</h5> <h6 id="修改-配置文件hive-env-sh"><a href="#修改-配置文件hive-env-sh" class="header-anchor">#</a> 修改==配置文件hive-env.sh==</h6> <ul><li>进入到<code>Hive</code>的安装目录下的<code>conf</code>文件夹中</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 soft<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /kkb/install/hive-1.1.0-cdh5.14.2/conf/
</code></pre></div><ul><li>重命名<code>hive-env.sh.template</code></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 conf<span class="token punctuation">]</span>$ <span class="token function">mv</span> hive-env.sh.template hive-env.sh
</code></pre></div><ul><li>修改<code>hive-env.sh</code></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> hive-env.sh 
</code></pre></div><ul><li>如下，修改此文件中<code>HADOOP_HOME</code>、<code>HIVE_CONF_DIR</code>的值（根据自己机器的实际情况配置）</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#配置HADOOP_HOME路径</span>
<span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/kkb/install/hadoop-2.6.0-cdh5.14.2/

<span class="token comment">#配置HIVE_CONF_DIR路径</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HIVE_CONF_DIR</span><span class="token operator">=</span>/kkb/install/hive-1.1.0-cdh5.14.2/conf
</code></pre></div><p><img src="/assets/img/Image201911011509.20576d1f.png" alt=""></p> <h6 id="修改-配置文件hive-site-xml"><a href="#修改-配置文件hive-site-xml" class="header-anchor">#</a> 修改==配置文件hive-site.xml==</h6> <ul><li><code>conf</code>目录下默认没有此文件，<code>vim</code>创建即可</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> hive-site.xml
</code></pre></div><ul><li>文件内容如下</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    	<span class="token comment">&lt;!--指定元数据存储在mysql的哪个数据库里--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionURL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>jdbc:mysql://node03:3306/hive?createDatabaseIfNotExist=true<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=latin1<span class="token entity named-entity" title="&amp;">&amp;amp;</span>useSSL=false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionDriverName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>com.mysql.jdbc.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionUserName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionPassword<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.cli.print.current.db<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.cli.print.header<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.server2.thrift.bind.host<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>node03<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h6 id="修改日志配置文件hive-log4j-properties"><a href="#修改日志配置文件hive-log4j-properties" class="header-anchor">#</a> 修改日志配置文件hive-log4j.properties</h6> <p>创建<code>hive</code>日志存储目录</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 conf<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> -p /kkb/install/hive-1.1.0-cdh5.14.2/logs/
</code></pre></div><p>重命名生成文件<code>hive-log4j.properties</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 conf<span class="token punctuation">]</span>$ <span class="token builtin class-name">pwd</span>
/kkb/install/hive-1.1.0-cdh5.14.2/conf
<span class="token punctuation">[</span>hadoop@node03 conf<span class="token punctuation">]</span>$ <span class="token function">mv</span> hive-log4j.properties.template hive-log4j.properties
<span class="token punctuation">[</span>hadoop@node03 conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> hive-log4j.properties <span class="token comment">## 修改文件</span>
</code></pre></div><p>修改此文件的<code>hive.log.dir</code>属性的值</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#更改以下内容，设置我们的hive的日志文件存放的路径，便于排查问题</span>
hive.log.dir<span class="token operator">=</span>/kkb/install/hive-1.1.0-cdh5.14.2/logs/
</code></pre></div><p><img src="/assets/img/Image201911011631.7ae0716d.png" alt=""></p> <h5 id="拷贝mysql驱动包"><a href="#拷贝mysql驱动包" class="header-anchor">#</a> 拷贝mysql驱动包</h5> <ul><li><p>上传<code>mysql</code>驱动包，如<code>mysql-connector-java-5.1.38.jar</code>到<code>/kkb/soft</code>目录中</p></li> <li><p>由于运行<code>hive</code>时，需要向<code>mysql</code>数据库中读写元数据，所以==需要将mysql的驱动包上传到hive的lib目录下==</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /kkb/soft/
<span class="token punctuation">[</span>hadoop@node03 soft<span class="token punctuation">]</span>$ <span class="token function">cp</span> mysql-connector-java-5.1.38.jar /kkb/install/hive-1.1.0-cdh5.14.2/lib/
</code></pre></div><h5 id="配置hive环境变量"><a href="#配置hive环境变量" class="header-anchor">#</a> 配置Hive环境变量</h5> <ul><li>切换到<code>root</code>用户下</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 soft<span class="token punctuation">]</span>$ <span class="token function">su</span> root
Password:
</code></pre></div><ul><li>打开<code>/etc/profile</code>文件</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 soft<span class="token punctuation">]</span><span class="token comment">## vim /etc/profile</span>
</code></pre></div><ul><li>末尾添加如下内容</li></ul> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">export</span> <span class="token attr-value">HIVE_HOME=/kkb/install/hive-1.1.0-cdh5.14.2</span>
<span class="token attr-name">export</span> <span class="token attr-value">PATH=$PATH:$HIVE_HOME/bin</span>
</code></pre></div><ul><li>切换回hadoop用户，并source</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node03 soft<span class="token punctuation">]</span><span class="token comment">## su - hadoop</span>
<span class="token punctuation">[</span>hadoop@node03 soft<span class="token punctuation">]</span>$ <span class="token builtin class-name">source</span> /etc/profile
</code></pre></div><h5 id="验证安装"><a href="#验证安装" class="header-anchor">#</a> 验证安装</h5> <ul><li>==hadoop集群已启动==</li> <li>==mysql服务已启动==</li> <li>在<code>node03</code>上任意目录启动<code>hive cli</code>命令行客户端</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hive
</code></pre></div><ul><li>查看有哪些数据库</li></ul> <div class="language- extra-class"><pre class="language-text"><code>show databases;
</code></pre></div><p><img src="data:image/png;base64,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" alt=""></p> <ul><li>说明<code>hive</code>安装成功</li> <li>退出<code>cli</code></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>quit<span class="token punctuation">;</span>
</code></pre></div><h2 id="hive学习前的准备"><a href="#hive学习前的准备" class="header-anchor">#</a> Hive学习前的准备</h2> <ol><li>安装好对应版本的<code>hadoop</code>集群（3节点），并启动<code>hadoop</code>的<code>HDFS</code>以及<code>YARN</code>服务</li> <li><code>MySQL</code>安装部署及讲解视频。</li> <li><code>Hive</code>安装部署及讲解视频。</li> <li><code>Hive</code>的<code>DDL</code>操作预习及讲解视频。</li></ol> <h2 id="数据仓库"><a href="#数据仓库" class="header-anchor">#</a> 数据仓库</h2> <h5 id="数据仓库的基本概念"><a href="#数据仓库的基本概念" class="header-anchor">#</a> 数据仓库的基本概念</h5> <ul><li><p>数据仓库的英文名称为<code>Data Warehouse</code>，可简写为<code>DW</code>或<code>DWH</code>。</p></li> <li><p>数据仓库的目的是构建<strong>面向分析</strong>的集成化数据环境，为企业提供决策支持（<code>Decision Support</code>）。它出于分析性报告和决策支持的目的而创建。</p></li> <li><p>数据仓库本身并不“生产”任何数据，同时自身也不需要“消费”任何的数据，数据来源于外部，并且开放给外部应用，这也是为什么叫“仓库”，而不叫“工厂”的原因。</p></li></ul> <h5 id="数据仓库的主要特征"><a href="#数据仓库的主要特征" class="header-anchor">#</a> 数据仓库的主要特征</h5> <ul><li>数据仓库是面向主题的（<code>Subject-Oriented</code>）、集成的（<code>Integrated</code>）、非易失的（<code>Non-Volatile</code>）和时变的（<code>Time-Variant</code> ）数据集合，用以支持管理决策。
<ul><li>面向主题：数仓构建时，主要看我们所要分析的业务，然后将相关业务（主题）的数据汇聚到数仓里。</li> <li>集成性：将所有数据源中于主题相关的数据，汇聚在一起。</li> <li>非易失性：数据一旦进入数仓，基本不会做修改。</li> <li>时变性：数仓中数据分析的手段（工具）会变</li></ul></li></ul> <h5 id="数据仓库与数据库区别"><a href="#数据仓库与数据库区别" class="header-anchor">#</a> 数据仓库与数据库区别</h5> <ul><li><p>数据库与数据仓库的区别实际讲的是<code>OLTP</code> 与 <code>OLAP</code> 的区别。</p></li> <li><p>操作型处理，叫联机事务处理 <code>OLTP</code>（<code>On-Line Transaction Processing</code>），也可以称面向交易的处理系统，它是针对具体业务在数据库联机的日常操作，通常对少数记录进行查询、修改。用户较为关心操作的响应时间、数据的安全性、完整性和并发支持的用户数等问题。传统的数据库系统作为数据管理的主要手段，主要用于操作型处理<code>OLTP</code>。</p></li> <li><p>分析型处理，叫联机分析处理 <code>OLAP</code>（<code>On-Line Analytical Processing</code>），一般针对某些主题的历史数据进行分析，支持管理决策。</p></li> <li><p>首先要明白，数据仓库的出现，并不是要取代数据库，数仓也不是大型的数据库。</p> <ul><li><p>数据库是面向事务的设计，数据仓库是面向主题设计的。</p></li> <li><p>数据库一般存储业务数据，数据仓库存储的一般是历史数据。</p></li> <li><p><strong>数据库</strong>设计是尽量避免冗余，一般针对某一业务应用进行设计；比如一张简单的<code>User</code>表，记录用户名、密码等简单数据即可，符合业务应用，但是不符合分析；<strong>数据仓库</strong>在设计是有意引入冗余，依照分析需求，分析维度、分析指标进行设计。</p></li> <li><p>数据库是为捕获数据而设计，数据仓库是为分析数据而设计。</p> <ul><li><p>以银行业务为例。数据库是事务系统的数据平台，客户在银行做的每笔交易都会写入数据库，被记录下来，这里，可以简单地理解为用数据库记账。数据仓库是分析系统的数据平台，它从事务系统获取数据，并做汇总、加工，为决策者提供决策的依据。比如，某银行某分行一个月发生多少交易，该分行当前存款余额是多少。如果存款又多，消费交易又多，那么该地区就有必要设立ATM了。</p></li> <li><p>显然，银行的交易量是巨大的，通常以百万甚至千万次来计算。事务系统是实时的，这就要求时效性，客户存一笔钱需要几十秒是无法忍受的，这就要求数据库只能存储很短一段时间的数据。而分析系统是事后的，它要提供<strong>关注时间段内</strong>所有的有效数据。这些数据是海量的，汇总计算起来也要慢一些，但是，只要能够提供有效的分析数据就达到目的了。</p></li></ul></li> <li><p>数据仓库，是在数据库已经大量存在的情况下，为了进一步挖掘数据资源、为了决策需要而产生的，它决不是所谓的“大型数据库”。</p></li></ul></li></ul> <h5 id="数据仓库分层架构"><a href="#数据仓库分层架构" class="header-anchor">#</a> 数据仓库分层架构</h5> <ul><li><p>按照数据流入流出的过程，数据仓库架构可分为三层——<strong>源数据层</strong>、<strong>数据仓库层</strong>、<strong>数据应用层。</strong></p></li> <li><p>数据仓库的数据来源于不同的源数据，并提供多样的数据应用，数据自下而上流入数据仓库后向上层开放应用，而数据仓库只是中间集成化数据管理的一个平台。</p></li> <li><p><strong>源数据层（贴源层）（ODS）</strong>：此层数据无任何更改，直接沿用外围系统数据结构和数据，不对外开放；为临时存储层，是接口数据的临时存储区域，为后一步的数据处理做准备。</p></li> <li><p><strong>数据仓库层（<code>DW</code>）</strong>：也称为细节层，DW层的数据应该是一致的、准确的、干净的数据，即对源系统数据进行了清洗（去除了杂质）后的数据。</p></li> <li><p><strong>数据应用层（数据展示层）（<code>DA</code>或<code>APP</code>）</strong>：前端应用直接读取的数据源；根据报表、专题分析需求而计算生成的数据。</p></li> <li><p>数据仓库从各数据源获取数据及在数据仓库内的数据转换和流动都可以认为是<code>ETL</code>（抽取<code>Extra</code>, 转化<code>Transfer</code>, 装载<code>Load</code>）的过程，<code>ETL</code>是数据仓库的流水线，也可以认为是数据仓库的血液，它维系着数据仓库中数据的新陈代谢，而数据仓库日常的管理和维护工作的大部分精力就是保持ETL的正常和稳定。</p></li> <li><p>为什么要对数据仓库分层？</p> <ul><li>用空间换时间，通过大量的预处理来提升应用系统的用户体验（效率），因此数据仓库会存在大量冗余的数据；不分层的话，如果源业务系统的业务规则发生变化将会影响整个数据清洗过程，工作量巨大。</li></ul></li> <li><p>通过数据分层管理可以简化数据清洗的过程，因为把原来一步的工作分到了多个步骤去完成，相当于把一个复杂的工作拆成了多个简单的工作，把一个大的黑盒变成了一个白盒，每一层的处理逻辑都相对简单和容易理解，这样我们比较容易保证每一个步骤的正确性，当数据发生错误的时候，往往我们只需要局部调整某个步骤即可。</p></li></ul> <blockquote><p><strong>通俗理解：</strong></p> <ul><li>贴源层（<code>ODS</code>）:用于保管原始数据</li> <li>数据仓库层（<code>DW</code>）: 主要用于数据分析，主要工作都在这一层，主要写<code>hql（hive quere language)</code></li> <li>数据展示层 (<code>app</code>)：将上边分析的结构在此层展示。</li></ul></blockquote> <h2 id="hive的概念"><a href="#hive的概念" class="header-anchor">#</a> Hive的概念</h2> <p>Hive是基于<code>Hadoop</code>的一个数据仓库工具</p> <ul><li><p>==可以将结构化的数据文件映射为一张数据库中的表==，并提供类<code>SQL</code>查询功能。</p></li> <li><p>其本质是将<code>SQL</code>转换为<code>MapReduce</code>的任务进行运算，底层由HDFS来提供数据的存储支持，说白了<code>hive</code>可以理解为一个将<code>SQL</code>转换为<code>MapReduce</code>任务的工具，甚至更进一步可以说hive就是一个MapReduce的客户端。</p></li></ul> <p><img src="/assets/img/Snipaste_2019-07-10_23-23-31.8b716378.png" alt=""></p> <p><img src="/assets/img/image-20200222030244998.7e6ed691.png" alt="image-20200222030244998"></p> <h2 id="hive与数据库的区别"><a href="#hive与数据库的区别" class="header-anchor">#</a> Hive与数据库的区别</h2> <p><img src="/assets/img/2018040319335283.2a2e1a35.png" alt=""></p> <ul><li><p>Hive 具有 SQL 数据库的外表，但应用场景完全不同。</p></li> <li><p>==Hive 只适合用来做海量离线数据统计分析，也就是数据仓库==。</p></li></ul> <h2 id="hive的优缺点"><a href="#hive的优缺点" class="header-anchor">#</a> Hive的优缺点</h2> <ul><li><p>==优点==</p> <ul><li><p><strong>操作接口采用类SQL语法</strong>，提供快速开发的能力（简单、容易上手）。</p></li> <li><p><strong>避免了去写MapReduce</strong>，减少开发人员的学习成本。</p></li> <li><p><strong>Hive支持用户自定义函数</strong>，用户可以根据自己的需求来实现自己的函数。</p></li></ul></li> <li><p>==缺点==</p> <ul><li><p><strong>Hive 的查询延迟很严重</strong></p></li> <li><p><strong>Hive 不支持事务</strong></p></li></ul></li></ul> <h2 id="hive架构原理"><a href="#hive架构原理" class="header-anchor">#</a> Hive架构原理<img src="/assets/img/2019-07-11_11-08-35.4066f9d3.png" alt=""></h2> <ul><li><p>1、用户接口：<code>Client</code></p> <ul><li><p><code>CLI（hive shell）</code></p></li> <li><p><code>JDBC/ODBC</code>(<code>java</code>访问<code>hive</code>)--》启动<code>hiveserver2</code>，通过<code>jdbc</code>协议访问<code>hive</code>，<code>hiveserver2</code>支持高并发。</p></li> <li><p><code>WEBUI</code>（浏览器访问<code>hive</code>）</p></li></ul></li> <li><p>2、元数据：<code>Metastore</code></p> <ul><li><p>元数据包括：表名、表所属的数据库（默认是<code>default</code>）、表的拥有者、列/分区字段、表的类型（是否是外部表）、表的数据所在目录等；</p></li> <li><p>元数据默认存储在自带的<code>derby</code>数据库中，==推荐使用MySQL存储Metastore==。</p></li> <li><p>我们安装<code>hive</code>时，在配置文件里设置了元数据保存在<code>node03</code>的<code>mysql</code>的某个数据库里。如下：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionURL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span>
    <span class="token attr-name">&lt;value</span><span class="token punctuation">&gt;</span></span>jdbc:mysql://node03:3306/hive?createDatabaseIfNotExist=true<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=latin1<span class="token entity named-entity" title="&amp;">&amp;amp;</span>useSSL=false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="data:image/png;base64,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" alt="image-20200222032619327"></p></li></ul></li> <li><p>3、<code>Hadoop</code>集群</p> <ul><li>使用<code>HDFS</code>进行存储，使用<code>MapReduce</code>进行计算。</li></ul></li> <li><p>4、<code>Driver</code>：驱动器</p> <ul><li><p>解析器（<code>SQL Parser</code>）</p> <ul><li><p>将<code>SQL</code>字符串转换成抽象语法树<code>AST</code></p></li> <li><p>对<code>AST</code>进行语法分析，比如表是否存在、字段是否存在、<code>SQL</code>语义是否有误</p></li></ul></li> <li><p>编译器（<code>Physical Plan</code>）：将<code>AST</code>编译生成逻辑执行计划</p></li> <li><p>优化器（<code>Query Optimizer</code>）：对逻辑执行计划进行优化</p></li> <li><p>执行器（<code>Execution</code>）：把逻辑执行计划转换成可以运行的物理计划。对于<code>Hive</code>来说默认就是<code>mapreduce</code>任务</p></li></ul></li></ul> <p><img src="/assets/img/hive1.08f6c4d9.png" alt="hive1"></p> <h2 id="hive的交互方式"><a href="#hive的交互方式" class="header-anchor">#</a> Hive的交互方式</h2> <ul><li><p>Hive的交互方式主要有三种</p></li> <li><p>使用<code>Hive</code>之前：</p> <ul><li><p>==先启动hadoop集群==：因为<code>hql</code>语句会被编译成<code>MR</code>任务提交到集群运行；<code>hive</code>表数据一般存储在<code>HDFS</code>上</p></li> <li><p>==mysql服务==：因为对<code>hive</code>操作过程中，需要访问<code>mysql</code>中存储元数据的库及表</p></li></ul></li></ul> <h4 id="hive交互shell-过时了"><a href="#hive交互shell-过时了" class="header-anchor">#</a> Hive交互shell（过时了）</h4> <ul><li>在任意路径运行<code>hive</code></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hive
</code></pre></div><p><img src="/assets/img/Image201912101741.0bafe6b2.png" alt=""></p> <h4 id="hive-jdbc服务-企业中使用"><a href="#hive-jdbc服务-企业中使用" class="header-anchor">#</a> Hive JDBC服务（企业中使用）</h4> <h5 id="第一步-启动hiveserver2服务"><a href="#第一步-启动hiveserver2服务" class="header-anchor">#</a> 第一步：启动hiveserver2服务</h5> <p><code>Hive</code>的<code>hiveserver2</code>服务本质上是实现了<code>JDBC</code>的接口，所以我们可以以各种方式使用<code>JDBC</code>连接它，在终端可以使用<code>beeline</code>，连接<code>Hive</code>的<code>server</code>，用法和<code>hive shell</code>一致。</p> <p>有两种方式启动<code>hiveserver2</code>服务：前台启动与后台启动方式二选一，前台启动会有输出到控制台，后台启动不会有输出到控制台。</p> <ul><li>前台启动</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hive --service hiveserver2 
</code></pre></div><ul><li>后台启动（推荐使用）</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token function">nohup</span> hive --service hiveserver2 <span class="token operator">&amp;</span>
<span class="token comment">#或者</span>
<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token function">nohup</span> hive --service hiveserver2 <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre></div><p><img src="/assets/img/Image201912101745.277a6e6a.png" alt=""></p> <h5 id="第二步-beeline连接hiveserver2服务"><a href="#第二步-beeline连接hiveserver2服务" class="header-anchor">#</a> 第二步：beeline连接hiveserver2服务</h5> <p>若是前台启动<code>hiveserver2</code>，请再开启一个新会话窗口，然后使用<code>beeline</code>连接<code>hiveserver2</code>。<code>hiveserver2</code>的服务端口默认是<code>10000</code></p> <div class="language- extra-class"><pre class="language-text"><code>[hadoop@node03 ~]$ beeline
beeline&gt; !connect jdbc:hive2://node03:10000
</code></pre></div><p><code>hive</code>用户名写<code>hadoop</code>即可，关键是这个用户要有对<code>hdfs</code>操作的权限，密码为空即可。</p> <p><img src="/assets/img/Image201912101749.f5818bed.png" alt=""></p> <h5 id="查看帮助信息"><a href="#查看帮助信息" class="header-anchor">#</a> 查看帮助信息</h5> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">0</span>: jdbc:hive2://node03:1000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token builtin class-name">help</span>
</code></pre></div><p><img src="/assets/img/Image201912101754.cef79434.png" alt=""></p> <h5 id="退出"><a href="#退出" class="header-anchor">#</a> 退出</h5> <p>使用<code>!quit</code>进行退出。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">0</span>: jdbc:hive2://node03:1000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token operator">!</span>quit
Closing: <span class="token number">0</span>: jdbc:hive2://node03:10000
<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$
</code></pre></div><h5 id="关闭hiveserver2"><a href="#关闭hiveserver2" class="header-anchor">#</a> 关闭hiveserver2</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">## jps查看hiveserver2进程号</span>
<span class="token keyword">kill</span> <span class="token operator">-</span><span class="token number">9</span> 进程号
</code></pre></div><h4 id="hive的命令-不需要进入hive-shell"><a href="#hive的命令-不需要进入hive-shell" class="header-anchor">#</a> Hive的命令（不需要进入hive shell)</h4> <h5 id="第一种方式-hive-e-hql语句"><a href="#第一种方式-hive-e-hql语句" class="header-anchor">#</a> 第一种方式：hive  -e hql语句</h5> <p>使用 <code>–e</code> 参数来直接执行<code>hql</code>语句</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hive -e <span class="token string">&quot;show databases&quot;</span>
</code></pre></div><h5 id="第二种方式-hive-f-sql文件"><a href="#第二种方式-hive-f-sql文件" class="header-anchor">#</a> 第二种方式：hive  -f  sql文件</h5> <p>使用 <code>–f</code>参数执行包含<code>hql</code>语句的文件</p> <p><code>node03</code>执行以下命令准备<code>hive</code>执行脚本</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token function">vim</span> hive.sql
</code></pre></div><p>文件内容如下</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> myhive<span class="token punctuation">;</span>
</code></pre></div><p>通过以下命令来执行我们的<code>hive</code>脚本</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hive -f hive.sql
</code></pre></div><p>查看效果，成功执行<code>hql</code>语句，创建<code>myhive</code>数据库</p> <p><img src="/assets/img/image-20200222041116597.0e49bbc7.png" alt="image-20200222041116597"></p> <h4 id="查看创建的数据库存放到hdfs的位置"><a href="#查看创建的数据库存放到hdfs的位置" class="header-anchor">#</a> 查看创建的数据库存放到hdfs的位置</h4> <p>登录到<code>node03</code>的<code>mysql</code>，查看元数据，从而获知我们创建的数据库放到<code>hdfs</code>哪里了。</p> <blockquote><p>登录<code>mysql</code>的时候使用<code>root</code>用户，密码为<code>123456</code>。</p> <p>为什么使用<code>root</code>用户？因为我们安装<code>hive</code>的时候，在配置文件里面已经指定是<code>root</code>用户了。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionUserName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionPassword<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果没有<code>root</code>用户的权限怎么办？能不能换个<code>mysql</code>用户登录？</p> <p>答案是可以的，解决方法如下，首先使用<code>mysql</code>的<code>root</code>用户登录<code>mysql</code>，然后添加一个普通用户，比如说，用户名为<code>jimmy</code>，密码为<code>123456</code>，最后修改<code>hive</code>的配置文件内容：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionUserName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>jimmy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionPassword<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>最后，还要给普通用户<code>jimmy</code>配置一些权限：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span>  <span class="token keyword">on</span>  hive<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'jimmy'</span><span class="token variable">@'%'</span> identified <span class="token keyword">by</span> <span class="token string">'123456'</span> <span class="token keyword">with</span> <span class="token keyword">grant</span> <span class="token keyword">option</span><span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p><strong>查看元数据方式：</strong></p> <ol><li>选择使用里面的<code>hive</code>数据库：<code>use hive;</code></li> <li>查看<code>hive</code>数据库里面的<code>DBS</code>表：<code>select　* from DBS;</code></li> <li>查看元数据信息，可看到：<code>hdfs://node01:8020/user/hive/warehouse/myhive.db</code>就是我们创建的数据库在<code>hdfs</code>中的位置，而且创建用户显示是<code>hadoop</code>。</li> <li>数据库在<code>HDFS</code>上的默认存储路径是==/user/hive/warehouse/数据库名.db==</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span> <span class="token keyword">Database</span>           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> hive               <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
<span class="token operator">|</span> sys                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> hive
Reading <span class="token keyword">table</span> information <span class="token keyword">for</span> completion <span class="token keyword">of</span> <span class="token keyword">table</span> <span class="token operator">and</span> <span class="token keyword">column</span> names
You can turn <span class="token keyword">off</span> this feature <span class="token keyword">to</span> get a quicker startup <span class="token keyword">with</span> <span class="token operator">-</span>A

<span class="token keyword">Database</span> changed
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------+</span>
<span class="token operator">|</span> Tables_in_hive            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+</span>
<span class="token operator">|</span> BUCKETING_COLS            <span class="token operator">|</span>
<span class="token operator">|</span> CDS                       <span class="token operator">|</span>
<span class="token operator">|</span> COLUMNS_V2                <span class="token operator">|</span>
<span class="token operator">|</span> DATABASE_PARAMS           <span class="token operator">|</span>
<span class="token operator">|</span> DBS                       <span class="token operator">|</span>
<span class="token operator">|</span> FUNCS                     <span class="token operator">|</span>
<span class="token operator">|</span> FUNC_RU                   <span class="token operator">|</span>
<span class="token operator">|</span> GLOBAL_PRIVS              <span class="token operator">|</span>
<span class="token operator">|</span> PARTITIONS                <span class="token operator">|</span>
<span class="token operator">|</span> PARTITION_KEYS            <span class="token operator">|</span>
<span class="token operator">|</span> PARTITION_KEY_VALS        <span class="token operator">|</span>
<span class="token operator">|</span> PARTITION_PARAMS          <span class="token operator">|</span>
<span class="token operator">|</span> PART_COL_STATS            <span class="token operator">|</span>
<span class="token operator">|</span> ROLES                     <span class="token operator">|</span>
<span class="token operator">|</span> SDS                       <span class="token operator">|</span>
<span class="token operator">|</span> SD_PARAMS                 <span class="token operator">|</span>
<span class="token operator">|</span> SEQUENCE_TABLE            <span class="token operator">|</span>
<span class="token operator">|</span> SERDES                    <span class="token operator">|</span>
<span class="token operator">|</span> SERDE_PARAMS              <span class="token operator">|</span>
<span class="token operator">|</span> SKEWED_COL_NAMES          <span class="token operator">|</span>
<span class="token operator">|</span> SKEWED_COL_VALUE_LOC_MAP  <span class="token operator">|</span>
<span class="token operator">|</span> SKEWED_STRING_LIST        <span class="token operator">|</span>
<span class="token operator">|</span> SKEWED_STRING_LIST_VALUES <span class="token operator">|</span>
<span class="token operator">|</span> SKEWED_VALUES             <span class="token operator">|</span>
<span class="token operator">|</span> SORT_COLS                 <span class="token operator">|</span>
<span class="token operator">|</span> TABLE_PARAMS              <span class="token operator">|</span>
<span class="token operator">|</span> TAB_COL_STATS             <span class="token operator">|</span>
<span class="token operator">|</span> TBLS                      <span class="token operator">|</span>
<span class="token operator">|</span> VERSION                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+</span>
<span class="token number">29</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> DBS<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-----------------------+--------------------------------------------------+---------+------------+------------+</span>
<span class="token operator">|</span> DB_ID <span class="token operator">|</span> <span class="token keyword">DESC</span>                  <span class="token operator">|</span> DB_LOCATION_URI                                  <span class="token operator">|</span> NAME    <span class="token operator">|</span> OWNER_NAME <span class="token operator">|</span> OWNER_TYPE <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-----------------------+--------------------------------------------------+---------+------------+------------+</span>
<span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Default</span> Hive <span class="token keyword">database</span> <span class="token operator">|</span> hdfs:<span class="token comment">//node01:8020/user/hive/warehouse           | default | public     | ROLE       |</span>
<span class="token operator">|</span>     <span class="token number">6</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>                  <span class="token operator">|</span> hdfs:<span class="token comment">//node01:8020/user/hive/warehouse/myhive.db | myhive  | hadoop     | USER       |</span>
<span class="token operator">+</span><span class="token comment">-------+-----------------------+--------------------------------------------------+---------+------------+------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node01 ~<span class="token punctuation">]</span>$ hdfs dfs -ls /user/hive/warehouse/
Found <span class="token number">1</span> items
drwxr-xr-x   - hadoop supergroup <span class="token number">0</span> <span class="token number">2020</span>-02-22 <span class="token number">11</span>:56 /user/hive/warehouse/myhive.db
</code></pre></div><h2 id="hive客户端jdbc操作"><a href="#hive客户端jdbc操作" class="header-anchor">#</a> Hive客户端JDBC操作</h2> <h4 id="启动hiveserver2"><a href="#启动hiveserver2" class="header-anchor">#</a> 启动hiveserver2</h4> <p><code>node03</code>执行以下命令启动<code>hiveserver2</code>的服务端</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hive-1.1.0-cdh5.14.2/
<span class="token function">nohup</span> bin/hive --service hiveserver2 <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><h4 id="引入依赖"><a href="#引入依赖" class="header-anchor">#</a> 引入依赖</h4> <ul><li>创建<code>maven</code>工程，引入依赖</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cloudera<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hive-exec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hive-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hive-cli<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!--    &lt;verbal&gt;true&lt;/verbal&gt;--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="代码开发"><a href="#代码开发" class="header-anchor">#</a> 代码开发</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HiveJDBC</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> url<span class="token operator">=</span><span class="token string">&quot;jdbc:hive2://192.168.52.120:10000/myhive&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;org.apache.hive.jdbc.HiveDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取数据库连接</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">&quot;hadoop&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//定义查询的sql语句</span>
        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;select * from stu&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">PreparedStatement</span> ps <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//获取id字段值</span>
                <span class="token keyword">int</span> id <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//获取deptid字段</span>
                <span class="token class-name">String</span> name <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="hive的数据类型"><a href="#hive的数据类型" class="header-anchor">#</a> Hive的数据类型</h2> <h4 id="基本数据类型"><a href="#基本数据类型" class="header-anchor">#</a> 基本数据类型</h4> <table><thead><tr><th style="text-align:center;">类型名称</th> <th style="text-align:center;">描述</th> <th style="text-align:center;">举例</th></tr></thead> <tbody><tr><td style="text-align:center;">boolean</td> <td style="text-align:center;">true/false</td> <td style="text-align:center;">true</td></tr> <tr><td style="text-align:center;">tinyint</td> <td style="text-align:center;">1字节的有符号整数</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">smallint</td> <td style="text-align:center;">2字节的有符号整数</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">==<strong>int</strong>==</td> <td style="text-align:center;">4字节的有符号整数</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;"><strong>==bigint==</strong></td> <td style="text-align:center;">8字节的有符号整数</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">float</td> <td style="text-align:center;">4字节单精度浮点数</td> <td style="text-align:center;">1.0</td></tr> <tr><td style="text-align:center;"><strong>==double==</strong></td> <td style="text-align:center;">8字节单精度浮点数</td> <td style="text-align:center;">1.0</td></tr> <tr><td style="text-align:center;"><strong>==string==</strong></td> <td style="text-align:center;">字符串(不设长度)</td> <td style="text-align:center;">“abc”</td></tr> <tr><td style="text-align:center;">varchar</td> <td style="text-align:center;">字符串（1-65355长度，超长截断）</td> <td style="text-align:center;">“abc”</td></tr> <tr><td style="text-align:center;">timestamp</td> <td style="text-align:center;">时间戳</td> <td style="text-align:center;">1563157873</td></tr> <tr><td style="text-align:center;">date</td> <td style="text-align:center;">日期</td> <td style="text-align:center;">20190715</td></tr></tbody></table> <h4 id="复合数据类型"><a href="#复合数据类型" class="header-anchor">#</a> 复合数据类型</h4> <table><thead><tr><th style="text-align:center;">类型名称</th> <th style="text-align:center;">描述</th> <th style="text-align:center;">举例</th></tr></thead> <tbody><tr><td style="text-align:center;"><code>array</code></td> <td style="text-align:center;">一组<strong>有序</strong>的字段，<strong>字段类型必须相同</strong> array(元素1，元素2)</td> <td style="text-align:center;"><code>Array（1,2,3）</code></td></tr> <tr><td style="text-align:center;"><code>map</code></td> <td style="text-align:center;">一组<strong>无序</strong>的<strong>键值对</strong> <code>map(k1,v1,k2,v2)</code></td> <td style="text-align:center;"><code>Map(‘a’,1,'b',2)</code></td></tr> <tr><td style="text-align:center;"><code>struct</code></td> <td style="text-align:center;">一组命名的字段，<strong>字段类型可以不同</strong> <code>struct(元素1，元素2)</code></td> <td style="text-align:center;"><code>Struct('a',1,2,0)</code></td></tr></tbody></table> <ul><li><p><code>array</code>类型的字段的元素访问方式</p> <ul><li>通过下标获取元素，下标从<code>0</code>开始</li> <li>如获取第一个元素
<ul><li><code>array[0]</code></li></ul></li></ul></li> <li><p><code>map</code>类型字段的元素访问方式</p> <ul><li>通过键获取值</li> <li>如获取<code>a</code>这个<code>key</code>对应的<code>value</code> <ul><li><code>map['a']</code></li></ul></li></ul></li> <li><p><code>struct</code>类型字段的元素获取方式</p> <ul><li>定义一个字段<code>c</code>的类型为<code>struct{a int, b string}</code></li> <li>获取<code>a</code>和<code>b</code>的值
<ul><li>使用<code>c.a</code> 和<code>c.b</code> 获取其中的元素值</li></ul></li> <li>这里可以把这种类型看成是一个对象</li></ul></li> <li><p>示例：创建一张表，包含了<code>array、map、struct</code>类型的字段</p></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> complex<span class="token punctuation">(</span>
         col1 array<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
         col2 map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
         col3 struct<span class="token operator">&lt;</span>a:string<span class="token punctuation">,</span>b:<span class="token keyword">int</span><span class="token punctuation">,</span>c:<span class="token keyword">double</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre></div><h2 id="hive官网-学会查找帮助"><a href="#hive官网-学会查找帮助" class="header-anchor">#</a> Hive官网（学会查找帮助）</h2> <p>平时工作中，要多查看<a href="https://cwiki.apache.org/confluence/display/Hive/Home" target="_blank" rel="noopener noreferrer">Hive官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>hive</code>官网：https://hive.apache.org/</p> <p><code>Hql</code>使用帮助：https://cwiki.apache.org/confluence/display/Hive/LanguageManual</p> <h2 id="hive的ddl操作-数据库"><a href="#hive的ddl操作-数据库" class="header-anchor">#</a> Hive的DDL操作--数据库</h2> <p>下列的所有操作默认使用<code>beeline</code>方式。</p> <h5 id="创建数据库"><a href="#创建数据库" class="header-anchor">#</a> 创建数据库</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> db1<span class="token punctuation">;</span>
<span class="token comment">## 或者</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> db1<span class="token punctuation">;</span>
</code></pre></div><h5 id="显示所有数据库"><a href="#显示所有数据库" class="header-anchor">#</a> 显示所有数据库</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; show databases;</span>
<span class="token operator">+</span><span class="token comment">----------------+--+</span>
<span class="token operator">|</span> database_name  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--+</span>
<span class="token operator">|</span> db1            <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">default</span>        <span class="token operator">|</span>
<span class="token operator">|</span> myhive         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--+</span>
</code></pre></div><h5 id="查询数据库"><a href="#查询数据库" class="header-anchor">#</a> 查询数据库</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; show databases like 'db*';</span>
<span class="token operator">+</span><span class="token comment">----------------+--+</span>
<span class="token operator">|</span> database_name  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--+</span>
<span class="token operator">|</span> db1            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">0.064</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h5 id="查看数据库详情"><a href="#查看数据库详情" class="header-anchor">#</a> 查看数据库详情</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; desc db1;</span>
Error: Error <span class="token keyword">while</span> compiling statement: FAILED: SemanticException <span class="token punctuation">[</span>Error <span class="token number">10001</span><span class="token punctuation">]</span>: <span class="token keyword">Table</span> <span class="token operator">not</span> found db1 <span class="token punctuation">(</span>state<span class="token operator">=</span><span class="token number">42</span>S02<span class="token punctuation">,</span>code<span class="token operator">=</span><span class="token number">10001</span><span class="token punctuation">)</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; desc database db1;</span>
<span class="token operator">+</span><span class="token comment">----------+----------+------------------------------------------------+-------------+-------------+-------------+--+</span>
<span class="token operator">|</span> db_name  <span class="token operator">|</span> <span class="token keyword">comment</span>  <span class="token operator">|</span>                    location                    <span class="token operator">|</span> owner_name  <span class="token operator">|</span> owner_type  <span class="token operator">|</span> parameters  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+----------+------------------------------------------------+-------------+-------------+-------------+--+</span>
<span class="token operator">|</span> db1      <span class="token operator">|</span>          <span class="token operator">|</span> hdfs:<span class="token comment">//node01:8020/user/hive/warehouse/db1.db  | hadoop      | USER        |             |</span>
<span class="token operator">+</span><span class="token comment">----------+----------+------------------------------------------------+-------------+-------------+-------------+--+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">0.048</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h5 id="显示数据库更详细信息"><a href="#显示数据库更详细信息" class="header-anchor">#</a> 显示数据库更详细信息</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">desc</span> <span class="token keyword">database</span> <span class="token keyword">extended</span> db1<span class="token punctuation">;</span>
</code></pre></div><h5 id="切换当前数据库"><a href="#切换当前数据库" class="header-anchor">#</a> 切换当前数据库</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">use</span> db_hive<span class="token punctuation">;</span>
</code></pre></div><h5 id="删除数据库"><a href="#删除数据库" class="header-anchor">#</a> 删除数据库</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#删除为空的数据库</span>
<span class="token keyword">drop</span> <span class="token keyword">database</span> db_hive<span class="token punctuation">;</span>

<span class="token comment">#如果删除的数据库不存在，最好采用if exists 判断数据库是否存在</span>
<span class="token keyword">drop</span> <span class="token keyword">database</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> db_hive<span class="token punctuation">;</span>

<span class="token comment">#如果数据库中有表存在，这里需要使用cascade强制删除数据库</span>
<span class="token keyword">drop</span> <span class="token keyword">database</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> db_hive <span class="token keyword">cascade</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="hive的ddl操作-表"><a href="#hive的ddl操作-表" class="header-anchor">#</a> Hive的DDL操作--表</h2> <p>使用帮助的官网地址：https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL</p> <h4 id="建表语法介绍"><a href="#建表语法介绍" class="header-anchor">#</a> 建表语法介绍</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token punctuation">[</span>EXTERNAL<span class="token punctuation">]</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> table_name 
<span class="token punctuation">[</span><span class="token punctuation">(</span>col_name data_type <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> col_comment<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span><span class="token keyword">COMMENT</span> table_comment<span class="token punctuation">]</span> 
<span class="token punctuation">[</span>PARTITIONED <span class="token keyword">BY</span> <span class="token punctuation">(</span>col_name data_type <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> col_comment<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span> 分区
<span class="token punctuation">[</span><span class="token keyword">CLUSTERED</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>col_name<span class="token punctuation">,</span> col_name<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> 分桶
<span class="token punctuation">[</span>SORTED <span class="token keyword">BY</span> <span class="token punctuation">(</span>col_name <span class="token punctuation">[</span><span class="token keyword">ASC</span><span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">INTO</span> num_buckets BUCKETS<span class="token punctuation">]</span> 
<span class="token punctuation">[</span><span class="token keyword">ROW</span> FORMAT row_format<span class="token punctuation">]</span>  <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> “分隔符”
<span class="token punctuation">[</span>STORED <span class="token keyword">AS</span> file_format<span class="token punctuation">]</span> 
<span class="token punctuation">[</span>LOCATION hdfs_path<span class="token punctuation">]</span>
</code></pre></div><p>字段解释说明</p> <ul><li><code>CREATE TABLE</code>	创建一个指定名字的表</li> <li><code>EXTERNAL</code>       创建一个外部表，在建表的同时指定一个指向实际数据的路径（<code>LOCATION</code>），指定表的数据保存在哪里。</li> <li><code>COMMENT</code>       为表和列添加注释</li> <li><code>PARTITIONED BY</code>    创建分区表</li> <li><code>CLUSTERED BY</code>    创建分桶表</li> <li><code>SORTED BY</code>    按照字段排序（一般不常用）</li> <li><code>ROW FORMAT</code>    指定每一行中字段的分隔符，<code>hive</code>默认使用<code>'\001'</code>非打印字符作为分隔符
<ul><li>r<code>ow format delimited fields terminated by ‘\t’</code></li></ul></li> <li><code>STORED AS</code>    指定存储文件类型
<ul><li>常用的存储文件类型：<code>SEQUENCEFILE</code>（二进制序列文件）、<code>TEXTFILE</code>（文本）、<code>ORCFILE</code>（列式存储格式文件）</li> <li>如果文件数据是纯文本，可以使用<code>STORED AS TEXTFILE</code>。如果数据需要压缩，使用 <code>STORED AS SEQUENCEFILE</code></li></ul></li> <li><code>LOCATION</code>    指定表在<code>HDFS上</code>的存储位置。</li></ul> <p>示例：创建内部表并指定字段之间的分隔符，指定文件的存储格式。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">use</span> db1<span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> t1<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span> name string<span class="token punctuation">)</span>
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span> 
stored <span class="token keyword">as</span> textfile<span class="token punctuation">;</span>
</code></pre></div><h4 id="创建内部表"><a href="#创建内部表" class="header-anchor">#</a> 创建内部表</h4> <h5 id="第一种方法"><a href="#第一种方法" class="header-anchor">#</a> 第一种方法</h5> <p>使用<strong>标准的建表语句</strong>直接建表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">use</span> myhive<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> stu<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span> name string<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#可以通过insert into向hive表当中插入数据，但是不建议工作当中这么做；因为每个insert语句转换成mr后会生成一个文件</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> stu<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from stu;</span>
<span class="token operator">+</span><span class="token comment">---------+-----------+--+</span>
<span class="token operator">|</span> stu<span class="token punctuation">.</span>id  <span class="token operator">|</span> stu<span class="token punctuation">.</span>name  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>       <span class="token operator">|</span> zhangsan  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------+--+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">0.224</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h5 id="第二种方法"><a href="#第二种方法" class="header-anchor">#</a> 第二种方法</h5> <p><strong>查询建表法</strong>：通过<code>AS</code> 查询语句完成建表，将子查询的结果存入新表里</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> myhive<span class="token punctuation">.</span>stu1 <span class="token keyword">as</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span> name <span class="token keyword">from</span> stu<span class="token punctuation">;</span>
<span class="token comment">#将select id, name from stu的结果存入到myhive.stu1表了</span>

<span class="token comment">#表中有数据</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from	 stu2;</span>
<span class="token operator">+</span><span class="token comment">----------+------------+--+</span>
<span class="token operator">|</span> stu2<span class="token punctuation">.</span>id  <span class="token operator">|</span> stu2<span class="token punctuation">.</span>name  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>        <span class="token operator">|</span> zhangsan   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+--+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">0.117</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h5 id="第三种方法"><a href="#第三种方法" class="header-anchor">#</a> 第三种方法</h5> <p><strong><code>like</code>建表法</strong>：根据存在的表的结构来创建表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> myhive<span class="token punctuation">.</span>stu2 <span class="token operator">like</span> stu<span class="token punctuation">;</span>

<span class="token comment">#表中没有数据</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * fro	m stu3;</span>
<span class="token operator">+</span><span class="token comment">----------+------------+--+</span>
<span class="token operator">|</span> stu3<span class="token punctuation">.</span>id  <span class="token operator">|</span> stu3<span class="token punctuation">.</span>name  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+--+</span>
<span class="token operator">+</span><span class="token comment">----------+------------+--+</span>
<span class="token keyword">No</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.113</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h4 id="查看表的结构"><a href="#查看表的结构" class="header-anchor">#</a> 查看表的结构</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; desc stu;</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+----------+--+</span>
<span class="token operator">|</span> col_name  <span class="token operator">|</span> data_type  <span class="token operator">|</span> <span class="token keyword">comment</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+----------+--+</span>
<span class="token operator">|</span> id        <span class="token operator">|</span> <span class="token keyword">int</span>        <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> string     <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+----------+--+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.113</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h4 id="查询表的详情"><a href="#查询表的详情" class="header-anchor">#</a> 查询表的详情</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; desc formatted stu;</span>
<span class="token operator">+</span><span class="token comment">-------------------------------+----------------------------------------------------+</span>
<span class="token operator">|</span>           col_name            <span class="token operator">|</span>                     data_type                      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------------+----------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token comment">## col_name                    | data_type                                          |</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> <span class="token boolean">NULL</span>                                               <span class="token operator">|</span>
<span class="token operator">|</span> id                            <span class="token operator">|</span> <span class="token keyword">int</span>                                                <span class="token operator">|</span>
<span class="token operator">|</span> name                          <span class="token operator">|</span> string                                             <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> <span class="token boolean">NULL</span>                                               <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token comment">## Detailed Table Information  | NULL                                               |</span>
<span class="token operator">|</span> <span class="token keyword">Database</span>:                     <span class="token operator">|</span> myhive                                             <span class="token operator">|</span>
<span class="token operator">|</span> Owner:                        <span class="token operator">|</span> hadoop                                             <span class="token operator">|</span>
<span class="token operator">|</span> CreateTime:                   <span class="token operator">|</span> Sat Feb <span class="token number">22</span> <span class="token number">14</span>:<span class="token number">05</span>:<span class="token number">26</span> CST <span class="token number">2020</span>                       <span class="token operator">|</span>
<span class="token operator">|</span> LastAccessTime:               <span class="token operator">|</span> UNKNOWN                                            <span class="token operator">|</span>
<span class="token operator">|</span> Protect <span class="token keyword">Mode</span>:                 <span class="token operator">|</span> None                                               <span class="token operator">|</span>
<span class="token operator">|</span> Retention:                    <span class="token operator">|</span> <span class="token number">0</span>                                                  <span class="token operator">|</span>
<span class="token operator">|</span> Location:                     <span class="token operator">|</span> hdfs:<span class="token comment">//node01:8020/user/hive/warehouse/myhive.db/stu</span>
<span class="token operator">|</span> <span class="token keyword">Table</span> <span class="token keyword">Type</span>:                   <span class="token operator">|</span> MANAGED_TABLE                                      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">Table</span> Parameters:             <span class="token operator">|</span> <span class="token boolean">NULL</span>                                               <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> COLUMN_STATS_ACCURATE                              <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> numFiles                                           <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> numRows                                            <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> rawDataSize                                        <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> totalSize                                          <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> transient_lastDdlTime                              <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> <span class="token boolean">NULL</span>                                               <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token comment">## Storage Information         | NULL                                               |</span>
<span class="token operator">|</span> SerDe Library:                <span class="token operator">|</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>serde2<span class="token punctuation">.</span>lazy<span class="token punctuation">.</span>LazySimpleSerDe <span class="token operator">|</span>
<span class="token operator">|</span> InputFormat:                  <span class="token operator">|</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapred<span class="token punctuation">.</span>TextInputFormat           <span class="token operator">|</span>
<span class="token operator">|</span> OutputFormat:                 <span class="token operator">|</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>ql<span class="token punctuation">.</span>io<span class="token punctuation">.</span>HiveIgnoreKeyTextOutput
<span class="token operator">|</span> Compressed:                   <span class="token operator">|</span> <span class="token keyword">No</span>                                                 <span class="token operator">|</span>
<span class="token operator">|</span> Num Buckets:                  <span class="token operator">|</span> <span class="token operator">-</span><span class="token number">1</span>                                                 <span class="token operator">|</span>
<span class="token operator">|</span> Bucket <span class="token keyword">Columns</span>:               <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                                 <span class="token operator">|</span>
<span class="token operator">|</span> Sort <span class="token keyword">Columns</span>:                 <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                                 <span class="token operator">|</span>
<span class="token operator">|</span> Storage <span class="token keyword">Desc</span> Params:          <span class="token operator">|</span> <span class="token boolean">NULL</span>                                               <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> serialization<span class="token punctuation">.</span>format                               <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------------+----------------------------------------------------+</span>

<span class="token comment">#我们可以看到一行：Table Type: | MANAGED_TABLE ，表明该表是内部表，内部表又叫管理表。</span>
</code></pre></div><h4 id="创建外部表"><a href="#创建外部表" class="header-anchor">#</a> 创建外部表</h4> <p><strong>外部表：</strong></p> <ul><li>外部表因为是指定其他的<code>hdfs</code>路径的数据加载到表当中来</li> <li>所以<code>hive</code>表会认为自己不完全独占这份数据，所以删除<code>hive</code>表的时候，数据仍然存放在<code>hdfs</code>当中，不会删掉。</li> <li>为什么使用？因为，有时候这份数据不仅仅你的团队在用，有可能其它团队也要用，因此为了防止数据被删除，要使用外部表。</li> <li>一般情况下：<code>ods</code>层是贴源层，建的表一般使用外部表，而<code>dw</code>层，表是属于自己的，可以使用内部表。</li></ul> <p><strong>创建外部表：</strong></p> <ul><li>创建外部表的时候需要加上**==external==** 关键字</li> <li><code>location</code>字段可以指定，也可以不指定
<ul><li>指定就是数据存放的具体目录</li> <li>不指定就是使用默认目录 ==/user/hive/warehouse==</li></ul></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> external <span class="token keyword">table</span> t_teacher <span class="token punctuation">(</span>t_id string<span class="token punctuation">,</span> t_name string<span class="token punctuation">)</span> 
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;\t&quot;</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; desc formatted t_teacher;</span>
<span class="token operator">+</span><span class="token comment">-------------------------------+----------------------------------------------------+</span>
<span class="token operator">|</span>           col_name            <span class="token operator">|</span>                     data_type                      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------------+----------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token comment">## col_name                    | data_type                                          |</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> <span class="token boolean">NULL</span>                                               <span class="token operator">|</span>
<span class="token operator">|</span> t_id                          <span class="token operator">|</span> string                                             <span class="token operator">|</span>
<span class="token operator">|</span> t_name                        <span class="token operator">|</span> string                                             <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> <span class="token boolean">NULL</span>                                               <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token comment">## Detailed Table Information  | NULL                                               |</span>
<span class="token operator">|</span> <span class="token keyword">Database</span>:                     <span class="token operator">|</span> db1                                                <span class="token operator">|</span>
<span class="token operator">|</span> Owner:                        <span class="token operator">|</span> hadoop                                             <span class="token operator">|</span>
<span class="token operator">|</span> CreateTime:                   <span class="token operator">|</span> Sat Feb <span class="token number">22</span> <span class="token number">17</span>:<span class="token number">56</span>:<span class="token number">08</span> CST <span class="token number">2020</span>                       <span class="token operator">|</span>
<span class="token operator">|</span> LastAccessTime:               <span class="token operator">|</span> UNKNOWN                                            <span class="token operator">|</span>
<span class="token operator">|</span> Protect <span class="token keyword">Mode</span>:                 <span class="token operator">|</span> None                                               <span class="token operator">|</span>
<span class="token operator">|</span> Retention:                    <span class="token operator">|</span> <span class="token number">0</span>                                                  <span class="token operator">|</span>
<span class="token operator">|</span> Location:                     <span class="token operator">|</span> hdfs:<span class="token comment">//node01:8020/user/hive/warehouse/db1.db/t_teac</span>
<span class="token operator">|</span> <span class="token keyword">Table</span> <span class="token keyword">Type</span>:                   <span class="token operator">|</span> EXTERNAL_TABLE                                     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">Table</span> Parameters:             <span class="token operator">|</span> <span class="token boolean">NULL</span>                                               <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> EXTERNAL                                           <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> transient_lastDdlTime                              <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> <span class="token boolean">NULL</span>                                               <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token comment">## Storage Information         | NULL                                               |</span>
<span class="token operator">|</span> SerDe Library:                <span class="token operator">|</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>serde2<span class="token punctuation">.</span>lazy<span class="token punctuation">.</span>LazySimpleSerDe <span class="token operator">|</span>
<span class="token operator">|</span> InputFormat:                  <span class="token operator">|</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapred<span class="token punctuation">.</span>TextInputFormat           <span class="token operator">|</span>
<span class="token operator">|</span> OutputFormat:                 <span class="token operator">|</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>ql<span class="token punctuation">.</span>io<span class="token punctuation">.</span>HiveIgnoreKeyTextOutput
<span class="token operator">|</span> Compressed:                   <span class="token operator">|</span> <span class="token keyword">No</span>                                                 <span class="token operator">|</span>
<span class="token operator">|</span> Num Buckets:                  <span class="token operator">|</span> <span class="token operator">-</span><span class="token number">1</span>                                                 <span class="token operator">|</span>
<span class="token operator">|</span> Bucket <span class="token keyword">Columns</span>:               <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                                 <span class="token operator">|</span>
<span class="token operator">|</span> Sort <span class="token keyword">Columns</span>:                 <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                                 <span class="token operator">|</span>
<span class="token operator">|</span> Storage <span class="token keyword">Desc</span> Params:          <span class="token operator">|</span> <span class="token boolean">NULL</span>                                               <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> field<span class="token punctuation">.</span>delim                                        <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span> serialization<span class="token punctuation">.</span>format                               <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------------+----------------------------------------------------+</span>
<span class="token number">29</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.084</span> seconds<span class="token punctuation">)</span>

<span class="token comment">#Table Type:                   | EXTERNAL_TABLE   </span>
</code></pre></div><h4 id="外部表加载数据"><a href="#外部表加载数据" class="header-anchor">#</a> 外部表加载数据</h4> <p>我们前面已经看到过通过<code>insert</code>的方式向内部表当中插入数据，外部表也可以通过<code>insert</code>的方式进行插入数据，<strong>只不过<code>insert</code>的方式，我们一般都不推荐</strong></p> <p>==实际工作当中我们都是使用<code>load</code>的方式来加载数据到内部表或者外部表==</p> <p><code>load</code>数据可以从本地文件系统加载或者也可以从<code>hdfs</code>上面的数据进行加载</p> <h6 id="第一种方式-从本地文件系统加载到外部表中去"><a href="#第一种方式-从本地文件系统加载到外部表中去" class="header-anchor">#</a> 第一种方式：从本地文件系统加载到外部表中去</h6> <p>从本地文件系统加载数据到<code>teacher</code>表当中去</p> <ul><li>将我们附件当汇总的数据资料都上传到<code>node03</code>服务器的<code>/kkb/install/hivedatas</code>路径下面去</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> -p /kkb/install/hivedatas
</code></pre></div><ul><li>将数据都上传到<code>/kkb/install/hivedatas</code>路径下</li> <li>然后在<code>hive</code>客户端下执行以下操作</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>load data <span class="token builtin class-name">local</span> inpath <span class="token string">'/kkb/install/hivedatas/teacher.csv'</span> into table myhive.teacher<span class="token punctuation">;</span>
</code></pre></div><h6 id="第二种方式-从hdfs文件系统加载到外部表中去"><a href="#第二种方式-从hdfs文件系统加载到外部表中去" class="header-anchor">#</a> 第二种方式：从hdfs文件系统加载到外部表中去</h6> <p>从<code>hdfs</code>上面加载文件到<code>teacher</code>表里面去。</p> <p>将<code>teacher.csv</code>文件上传到<code>hdfs</code>的<code>/kkb/hdfsload/hivedatas</code>路径下，注意，这种方式是将<code>hdfs</code>文件的数据剪切到表中，源文件会被删除。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hivedatas
hdfs dfs -mkdir -p /kkb/hdfsload/hivedatas
hdfs dfs -put teacher.csv /kkb/hdfsload/hivedatas
<span class="token comment">## 在hive的客户端当中执行</span>
load data inpath <span class="token string">'/kkb/hdfsload/hivedatas'</span> overwrite into table myhive.teacher<span class="token punctuation">;</span>
<span class="token comment">#加上overrite关键字，会把原数据覆盖掉</span>
</code></pre></div><h4 id="内部表与外部表的互相转换"><a href="#内部表与外部表的互相转换" class="header-anchor">#</a> 内部表与外部表的互相转换</h4> <ul><li>1、内部表转换为外部表</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#将stu内部表改为外部表</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> stu <span class="token keyword">set</span> tblproperties<span class="token punctuation">(</span><span class="token string">'EXTERNAL'</span><span class="token operator">=</span><span class="token string">'TRUE'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>2、外部表转换为内部表</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#把teacher外部表改为内部表</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> teacher <span class="token keyword">set</span> tblproperties<span class="token punctuation">(</span><span class="token string">'EXTERNAL'</span><span class="token operator">=</span><span class="token string">'FALSE'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="内部表与外部表的区别"><a href="#内部表与外部表的区别" class="header-anchor">#</a> 内部表与外部表的区别</h4> <ul><li><p>1、建表语法的区别</p> <ul><li>外部表在创建的时候需要加上==external==关键字</li></ul></li> <li><p>2、删除表之后的区别</p> <ul><li>内部表删除后，表的元数据和真实数据都被删除了</li> <li>外部表删除后，仅仅只是把该表的元数据删除了，真实数据还在，后期还是可以恢复出来</li></ul></li></ul> <h6 id="内部表与外部表的使用时机"><a href="#内部表与外部表的使用时机" class="header-anchor">#</a> 内部表与外部表的使用时机</h6> <ul><li><p>内部表由于删除表的时候会同步删除<code>HDFS</code>的数据文件，所以确定如果一个表仅仅是你独占使用，其他人不使用的时候就可以创建内部表，如果一个表的文件数据，其他人也要使用，那么就创建外部表</p></li> <li><p>一般外部表都是用在数据仓库的<code>ODS</code>层</p></li> <li><p>内部表都是用在数据仓库的<code>DW</code>层</p></li></ul> <h2 id="hive的分区表"><a href="#hive的分区表" class="header-anchor">#</a> hive的分区表</h2> <h6 id="分区表的理解"><a href="#分区表的理解" class="header-anchor">#</a> 分区表的理解</h6> <ul><li>如果<code>hive</code>当中所有的数据都存入到一个文件夹下面，那么在使用<code>MR</code>计算程序的时候，读取一整个目录下面的所有文件来进行计算（全表扫描），就会变得特别慢，因为数据量太大了</li> <li>实际工作当中一般都是计算前一天的数据，所以我们只需要将前一天的数据挑出来放到一个文件夹下面即可，专门去计算前一天的数据。</li> <li>这样就可以使用<code>hive</code>当中的分区表，通过分文件夹的形式，将每一天的数据都分成为一个文件夹，然后我们计算数据的时候，通过指定前一天的文件夹即可只计算前一天的数据。</li> <li>在大数据中，最常用的一种思想就是分治，我们可以把大的文件切割划分成一个个的小的文件，这样每次操作一个小的文件就会很容易了，同样的道理，在<code>hive</code>当中也是支持这种思想的，就是我们可以把大的数据，按照每天，或者每小时进行切分成一个个的小的文件，这样去操作小的文件就会容易得多了。</li> <li>在文件系统上建立文件夹，把表的数据放在不同文件夹下面，加快查询速度。<strong>示意图如下：</strong></li></ul> <p><img src="/assets/img/image-20200223014153794.6c1ab681.png" alt="image-20200223014153794"></p> <h6 id="创建分区表语法"><a href="#创建分区表语法" class="header-anchor">#</a> 创建分区表语法</h6> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> score<span class="token punctuation">(</span>s_id string<span class="token punctuation">,</span> c_id string<span class="token punctuation">,</span> s_score <span class="token keyword">int</span><span class="token punctuation">)</span> partitioned <span class="token keyword">by</span> <span class="token punctuation">(</span><span class="token keyword">month</span> string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="创建一个表带多个分区"><a href="#创建一个表带多个分区" class="header-anchor">#</a> 创建一个表带多个分区</h6> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> score2 <span class="token punctuation">(</span>s_id string<span class="token punctuation">,</span>c_id string<span class="token punctuation">,</span> s_score <span class="token keyword">int</span><span class="token punctuation">)</span> partitioned <span class="token keyword">by</span> <span class="token punctuation">(</span><span class="token keyword">year</span> string<span class="token punctuation">,</span> <span class="token keyword">month</span> string<span class="token punctuation">,</span> <span class="token keyword">day</span> string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="加载数据到分区表特定的分区当中去"><a href="#加载数据到分区表特定的分区当中去" class="header-anchor">#</a> 加载数据到分区表特定的分区当中去</h6> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/score.csv'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> score <span class="token keyword">partition</span> <span class="token punctuation">(</span><span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'201806'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>score.csv</code>文件内容如下。</p> <div class="language- extra-class"><pre class="language-text"><code>01	01	80
01	02	90
01	03	99
02	01	70
02	02	60
02	03	80
03	01	80
03	02	80
03	03	80
04	01	50
04	02	30
04	03	20
05	01	76
05	02	87
06	01	31
06	03	34
07	02	89
07	03	98
</code></pre></div><h6 id="加载数据到多分区表当中去"><a href="#加载数据到多分区表当中去" class="header-anchor">#</a> 加载数据到多分区表当中去</h6> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/score.csv'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> score2 <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">year</span><span class="token operator">=</span><span class="token string">'2018'</span><span class="token punctuation">,</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'06'</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token operator">=</span><span class="token string">'01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="查看表的分区"><a href="#查看表的分区" class="header-anchor">#</a> 查看表的分区</h6> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; show partitions score;</span>
<span class="token operator">+</span><span class="token comment">---------------+--+</span>
<span class="token operator">|</span>   <span class="token keyword">partition</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+--+</span>
<span class="token operator">|</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token number">201806</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+--+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">0.096</span> seconds<span class="token punctuation">)</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; show partitions score2;</span>
<span class="token operator">+</span><span class="token comment">----------------------------+--+</span>
<span class="token operator">|</span>         <span class="token keyword">partition</span>          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------+--+</span>
<span class="token operator">|</span> <span class="token keyword">year</span><span class="token operator">=</span><span class="token number">2018</span><span class="token operator">/</span><span class="token keyword">month</span><span class="token operator">=</span><span class="token number">06</span><span class="token operator">/</span><span class="token keyword">day</span><span class="token operator">=</span><span class="token number">01</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------+--+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">0.074</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h6 id="添加一个分区"><a href="#添加一个分区" class="header-anchor">#</a> 添加一个分区</h6> <p>使用add partition(xxx='xxx')关键字添加分区</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; alter table score add partition (month='201805');</span>
<span class="token keyword">No</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.123</span> seconds<span class="token punctuation">)</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; show partitions score;</span>
<span class="token operator">+</span><span class="token comment">---------------+--+</span>
<span class="token operator">|</span>   <span class="token keyword">partition</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+--+</span>
<span class="token operator">|</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token number">201805</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token number">201806</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+--+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.084</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h6 id="同时添加多个分区"><a href="#同时添加多个分区" class="header-anchor">#</a> 同时添加多个分区</h6> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> score <span class="token keyword">add</span> <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'201804'</span><span class="token punctuation">)</span> <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'201803'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意：添加分区之后就可以在<code>hdfs</code>文件系统当中看到表下面多了一个文件夹</p> <p><img src="/assets/img/image-20200223015740174.3d191b56.png" alt="image-20200223015740174"></p> <p><img src="/assets/img/image-20200223020152320.039a930b.png" alt="image-20200223020152320"></p> <h6 id="删除分区"><a href="#删除分区" class="header-anchor">#</a> 删除分区</h6> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> score <span class="token keyword">drop</span> <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'201806'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="外部分区表综合练习"><a href="#外部分区表综合练习" class="header-anchor">#</a> 外部分区表综合练习</h2> <h6 id="需求描述"><a href="#需求描述" class="header-anchor">#</a> <strong>需求描述：</strong></h6> <ul><li>现在有一个文件<code>score.csv</code>文件，里面有三个字段，分别是<code>s_id string, c_id string, s_score int</code></li> <li>字段都是使用 <code>\t</code>进行分割</li> <li>存放在<code>hdfs</code>集群的这个目录下<code>/scoredatas/day=20180607</code>，这个文件每天都会生成，存放到对应的日期文件夹下面去</li> <li>文件别人也需要公用，不能移动</li> <li>请创建<code>hive</code>对应的表，并将数据加载到表中，进行数据统计分析，且删除表之后，数据不能删除</li></ul> <h6 id="需求实现"><a href="#需求实现" class="header-anchor">#</a> <strong>需求实现:</strong></h6> <ul><li><p><code>node03</code>执行以下命令，将数据上传到<code>hdfs</code>上面去</p> <p>将我们的<code>score.csv</code>上传到<code>node03</code>服务器的<code>/kkb/install/hivedatas</code>目录下，然后将<code>score.csv</code>文件上传到<code>HDFS</code>的<code>/scoredatas/day=20180607</code>目录上</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hivedatas/
hdfs dfs -mkdir -p /scoredatas/day<span class="token operator">=</span><span class="token number">20180607</span>
hdfs dfs -put score.csv /scoredatas/day<span class="token operator">=</span><span class="token number">20180607</span>/
<span class="token comment">## 这里切记切记！！！！！！！，不要写成/scoredatas/20180607，否则表的修复那一步会出错</span>
<span class="token comment">## 因为下面建立外部分区表的时候，指定通过day string 来进行分区</span>
</code></pre></div><ul><li>创建外部分区表，并指定文件数据存放目录</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> external <span class="token keyword">table</span> score5<span class="token punctuation">(</span>s_id string<span class="token punctuation">,</span> c_id string<span class="token punctuation">,</span> s_score <span class="token keyword">int</span><span class="token punctuation">)</span> partitioned <span class="token keyword">by</span> <span class="token punctuation">(</span><span class="token keyword">day</span> string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span> location <span class="token string">'/scoredatas'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>进行表的修复，说白了就是建立我们表与我们数据文件之间的一个关系映射，之前因为是用<code>load</code>来加载数据的，所有没有这一步。修复成功之后即可看到数据已经全部加载到表当中去了。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; msck repair table score5;</span>
<span class="token keyword">No</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.11</span> seconds<span class="token punctuation">)</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from score5;</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+-----------------+-------------+--+</span>
<span class="token operator">|</span> score5<span class="token punctuation">.</span>s_id  <span class="token operator">|</span> score5<span class="token punctuation">.</span>c_id  <span class="token operator">|</span> score5<span class="token punctuation">.</span>s_score  <span class="token operator">|</span> score5<span class="token punctuation">.</span><span class="token keyword">day</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+-----------------+-------------+--+</span>
<span class="token operator">|</span> <span class="token number">01</span>           <span class="token operator">|</span> <span class="token number">01</span>           <span class="token operator">|</span> <span class="token number">80</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">01</span>           <span class="token operator">|</span> <span class="token number">02</span>           <span class="token operator">|</span> <span class="token number">90</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">01</span>           <span class="token operator">|</span> <span class="token number">03</span>           <span class="token operator">|</span> <span class="token number">99</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>           <span class="token operator">|</span> <span class="token number">01</span>           <span class="token operator">|</span> <span class="token number">70</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>           <span class="token operator">|</span> <span class="token number">02</span>           <span class="token operator">|</span> <span class="token number">60</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>           <span class="token operator">|</span> <span class="token number">03</span>           <span class="token operator">|</span> <span class="token number">80</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>           <span class="token operator">|</span> <span class="token number">01</span>           <span class="token operator">|</span> <span class="token number">80</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>           <span class="token operator">|</span> <span class="token number">02</span>           <span class="token operator">|</span> <span class="token number">80</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>           <span class="token operator">|</span> <span class="token number">03</span>           <span class="token operator">|</span> <span class="token number">80</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>           <span class="token operator">|</span> <span class="token number">01</span>           <span class="token operator">|</span> <span class="token number">50</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>           <span class="token operator">|</span> <span class="token number">02</span>           <span class="token operator">|</span> <span class="token number">30</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>           <span class="token operator">|</span> <span class="token number">03</span>           <span class="token operator">|</span> <span class="token number">20</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">05</span>           <span class="token operator">|</span> <span class="token number">01</span>           <span class="token operator">|</span> <span class="token number">76</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">05</span>           <span class="token operator">|</span> <span class="token number">02</span>           <span class="token operator">|</span> <span class="token number">87</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">06</span>           <span class="token operator">|</span> <span class="token number">01</span>           <span class="token operator">|</span> <span class="token number">31</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">06</span>           <span class="token operator">|</span> <span class="token number">03</span>           <span class="token operator">|</span> <span class="token number">34</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">07</span>           <span class="token operator">|</span> <span class="token number">02</span>           <span class="token operator">|</span> <span class="token number">89</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">07</span>           <span class="token operator">|</span> <span class="token number">03</span>           <span class="token operator">|</span> <span class="token number">98</span>              <span class="token operator">|</span> <span class="token number">20180607</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+-----------------+-------------+--+</span>
<span class="token number">18</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.165</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h2 id="hive的复合类型使用说明和实战"><a href="#hive的复合类型使用说明和实战" class="header-anchor">#</a> hive的复合类型使用说明和实战</h2> <h5 id="_1、参数说明"><a href="#_1、参数说明" class="header-anchor">#</a> 1、参数说明</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#创建表的时候可以指定每行数据的格式,如果使用的是复合数据类型，还需要指定复合数据类型中的元素分割符</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED 
	<span class="token punctuation">[</span><span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span> <span class="token punctuation">[</span><span class="token keyword">ESCAPED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span><span class="token punctuation">]</span><span class="token punctuation">]</span> 
	<span class="token punctuation">[</span>COLLECTION ITEMS <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span><span class="token punctuation">]</span>
	<span class="token punctuation">[</span>MAP <span class="token keyword">KEYS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span><span class="token punctuation">]</span> 
	<span class="token punctuation">[</span><span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span><span class="token punctuation">]</span>
		
<span class="token comment">#其中这里 </span>
<span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span> 	         <span class="token comment">#指定每一行记录中字段的分割符</span>
COLLECTION ITEMS <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span>  <span class="token comment">#指定复合类型中多元素的分割符</span>
MAP <span class="token keyword">KEYS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span>         <span class="token comment">#指定map集合类型中每一个key/value之间的分隔符</span>
<span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span>            <span class="token comment">#指定每行记录的换行符，一般有默认 就是\n </span>
</code></pre></div><h5 id="_2、array类型"><a href="#_2、array类型" class="header-anchor">#</a> 2、Array类型</h5> <p>array中的数据为相同类型，例如，假如array A中元素['a','b','c']，则A[1]的值为'b'</p> <p>准备数据文件</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">vi</span> /tmp/t_array.txt  <span class="token punctuation">(</span>字段空格分割<span class="token punctuation">)</span>

<span class="token number">1</span> zhangsan beijing,shanghai
<span class="token number">2</span> lisi shanghai,tianjin
</code></pre></div><p>建表语法</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_array<span class="token punctuation">(</span>
id string<span class="token punctuation">,</span>
name string<span class="token punctuation">,</span>
locations array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">' '</span> collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span><span class="token punctuation">;</span>
</code></pre></div><p>加载数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/tmp/t_array.txt'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> t_array<span class="token punctuation">;</span>
</code></pre></div><p>查询数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>locations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>locations<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">from</span> t_array<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+-----------+-----------+--+</span>
<span class="token operator">|</span> id  <span class="token operator">|</span>   name    <span class="token operator">|</span>    _c2    <span class="token operator">|</span>    _c3    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+-----------+-----------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>   <span class="token operator">|</span> zhangsan  <span class="token operator">|</span> beijing   <span class="token operator">|</span> shanghai  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>   <span class="token operator">|</span> lisi      <span class="token operator">|</span> shanghai  <span class="token operator">|</span> tianjin   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+-----------+-----------+--+</span>
</code></pre></div><h5 id="_3、map类型"><a href="#_3、map类型" class="header-anchor">#</a> 3、Map类型</h5> <p>map类型中存储key/value类型的数据，后期可以通过[&quot;指定key名称&quot;]访问</p> <p>准备数据文件</p> <div class="language- extra-class"><pre class="language-text"><code>vi /tmp/t_map.txt  (字段空格分割)

1 name:zhangsan#age:30
2 name:lisi#age:40
</code></pre></div><p>建表语法</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_map<span class="token punctuation">(</span>
id string<span class="token punctuation">,</span>
info map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span>string<span class="token operator">&gt;</span>
<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">' '</span> collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'#'</span> map <span class="token keyword">keys</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">':'</span><span class="token punctuation">;</span>
</code></pre></div><p>加载数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/tmp/t_map.txt'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> t_map<span class="token punctuation">;</span>
</code></pre></div><p>查询数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span> info<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> info<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span> <span class="token keyword">from</span> t_map<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+------+--+</span>
<span class="token operator">|</span> id  <span class="token operator">|</span>    _c1    <span class="token operator">|</span> _c2  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>   <span class="token operator">|</span> zhangsan  <span class="token operator">|</span> <span class="token number">30</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>   <span class="token operator">|</span> lisi      <span class="token operator">|</span> <span class="token number">40</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+------+--+</span>
</code></pre></div><h5 id="_4、struct类型"><a href="#_4、struct类型" class="header-anchor">#</a> 4、Struct类型</h5> <p>Struct可以存储不同类型的数据，例如c的类型为struct{a INT; b INT}，我们可以通过c.a来访问域a</p> <p>准备数据文件</p> <div class="language- extra-class"><pre class="language-text"><code>vi /tmp/t_struct.txt  (字段空格分割)

1 zhangsan:30:beijing
2 lisi:40:shanghai
</code></pre></div><p>建表语法</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_struct<span class="token punctuation">(</span>
id string<span class="token punctuation">,</span>
info struct<span class="token operator">&lt;</span>name:string<span class="token punctuation">,</span> age:<span class="token keyword">int</span><span class="token punctuation">,</span>address:String<span class="token operator">&gt;</span>
<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">' '</span> collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">':'</span> <span class="token punctuation">;</span>
</code></pre></div><p>加载数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/tmp/t_struct.txt'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> t_struct<span class="token punctuation">;</span>
</code></pre></div><p>查询数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span>info<span class="token punctuation">.</span>name<span class="token punctuation">,</span>info<span class="token punctuation">.</span>age<span class="token punctuation">,</span>info<span class="token punctuation">.</span>address <span class="token keyword">from</span> t_struct<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+------+-----------+--+</span>
<span class="token operator">|</span> id  <span class="token operator">|</span>   name    <span class="token operator">|</span> age  <span class="token operator">|</span>  address  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+------+-----------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>   <span class="token operator">|</span> zhangsan  <span class="token operator">|</span> <span class="token number">30</span>   <span class="token operator">|</span> beijing   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>   <span class="token operator">|</span> lisi      <span class="token operator">|</span> <span class="token number">40</span>   <span class="token operator">|</span> shanghai  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+------+-----------+--+</span>
</code></pre></div><h2 id="hive拓展点1"><a href="#hive拓展点1" class="header-anchor">#</a> hive拓展点1</h2> <ul><li><p><code>hive cli</code>命令窗口查看本地文件系统</p> <ul><li><p>与操作本地文件系统类似，这里需要使用 ! (感叹号)，并且最后需要加上 ;(分号)</p></li> <li><p>例如</p> <div class="language- extra-class"><pre class="language-text"><code>!ls /home;
</code></pre></div><p><img src="/assets/img/Image201912111127.6b2fd13d.png" alt=""></p></li></ul></li> <li><p><code>hive cli</code>命令窗口查看<code>HDFS</code>文件系统</p> <ul><li>与查看<code>HDFS</code>文件系统类似</li></ul> <div class="language- extra-class"><pre class="language-text"><code>  dfs -ls /user;
</code></pre></div><p><img src="/assets/img/Image201912111128.8c1f0266.png" alt=""></p></li> <li><p><code>hive</code>的底层执行引擎有3种</p> <ul><li><code>mapreduce</code>(默认)</li> <li><code>tez</code>（支持<code>DAG</code>作业的计算框架）<code>mr1--&gt;mr2 --&gt;mr3</code></li> <li><code>spark</code>（基于内存的分布式计算框架）</li></ul></li></ul> <h2 id="hive的分桶表"><a href="#hive的分桶表" class="header-anchor">#</a> Hive的分桶表</h2> <h5 id="分桶表介绍"><a href="#分桶表介绍" class="header-anchor">#</a> 分桶表介绍</h5> <p>分区表是为了减少扫描量，提高效率，那分桶表是干嘛的？分桶表的作用也是一样，只不过会进一步会细化而已。</p> <p>分桶将整个数据内容按照某列属性值去<code>hash</code>值进行区分，具有相同的<code>hash</code>值的结果的数据进入到同一个文件中。</p> <p><strong>形象比喻：</strong></p> <ul><li><code>select * from t1 where id % 4 =0;</code></li> <li><code>select * from t1 where id % 4 =1;</code></li> <li><code>select * from t1 where id % 4 =2;</code></li> <li><code>select * from t1 where id % 4 =3;</code></li></ul> <p><img src="/assets/img/image-20200223031549369.da690c73.png" alt="image-20200223031549369"></p> <h5 id="分桶表原理"><a href="#分桶表原理" class="header-anchor">#</a> 分桶表原理</h5> <ul><li><p>分桶是相对分区进行<strong>更细粒</strong>度的划分</p> <ul><li><p><code>Hive</code>表或分区表可进一步的分桶</p></li> <li><p>分桶将整个数据内容按照某列取<code>hash</code>值，对桶的个数取模的方式决定该条记录（行）存放在哪个桶当中；具有相同<code>hash</code>值的数据进入到同一个文件中。</p></li> <li><p>比如按照<code>name</code>属性分为<code>3</code>个桶，就是对<code>name</code>属性值的<code>hash</code>值对<code>3</code>取摸，按照取模结果对数据分桶。</p> <ul><li>取模结果为 <strong>0</strong> 的数据记录存放到一个文件</li> <li>取模结果为 <strong>1</strong> 的数据记录存放到一个文件</li> <li>取模结果为 <strong>2</strong> 的数据记录存放到一个文件</li></ul></li></ul></li> <li><p>如果一个表既分区又分桶，则必须先分区再分桶。如下：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> user_info_bucketed<span class="token punctuation">(</span>user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span> firstname STRING<span class="token punctuation">,</span> lastname STRING<span class="token punctuation">)</span>
<span class="token keyword">COMMENT</span> <span class="token string">'A bucketed copy of user_info'</span>  
PARTITIONED <span class="token keyword">BY</span><span class="token punctuation">(</span>ds STRING<span class="token punctuation">)</span>
<span class="token keyword">CLUSTERED</span> <span class="token keyword">BY</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token keyword">INTO</span> <span class="token number">256</span> BUCKETS<span class="token punctuation">;</span>

</code></pre></div></li></ul> <p>#COMMENT是注释的意思，对表的注释</p> <div class="language-sql extra-class"><pre class="language-sql"><code>


<span class="token comment">##### 分桶表作用</span>

<span class="token operator">-</span> <span class="token number">1</span>、取样<span class="token punctuation">`</span>sampling<span class="token punctuation">`</span>更高效。没有分区的话需要扫描整个数据集。

<span class="token operator">-</span> <span class="token number">2</span>、提升某些查询操作效率，例如<span class="token punctuation">`</span>map side <span class="token keyword">join</span><span class="token punctuation">`</span>



<span class="token comment">## 案例演示：创建分桶表</span>

<span class="token operator">-</span> 在创建分桶表之前要执行的命令
<span class="token operator">-</span> <span class="token punctuation">`</span><span class="token keyword">set</span> hive<span class="token punctuation">.</span>enforce<span class="token punctuation">.</span>bucketing<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">`</span> 开启对分桶表的支持
<span class="token operator">-</span> <span class="token punctuation">`</span><span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>job<span class="token punctuation">.</span>reduces<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span> <span class="token punctuation">`</span>    设置与桶相同的<span class="token punctuation">`</span>reduce<span class="token punctuation">`</span>个数（默认只有一个<span class="token punctuation">`</span>reduce<span class="token punctuation">`</span>）

<span class="token operator">-</span> 进入<span class="token punctuation">`</span>hive<span class="token punctuation">`</span>客户端然后执行以下命令

​<span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token keyword">sql</span>
<span class="token keyword">use</span> db1<span class="token punctuation">;</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span>enforce<span class="token punctuation">.</span>bucketing<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">#千万不要写成set db1.enforce.bucketing=true;</span>
<span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>job<span class="token punctuation">.</span>reduces<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>  

<span class="token comment">-- 创建分桶表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> user_buckets_demo3<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span> name string<span class="token punctuation">)</span>
<span class="token keyword">clustered</span> <span class="token keyword">by</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">into</span> <span class="token number">4</span> buckets 
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建普通表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> user_demo<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span> name string<span class="token punctuation">)</span>
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>准备数据文件 <code>buckets.txt</code></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#在linux当中执行以下命令</span>
<span class="token builtin class-name">cd</span> /kkb/install/hivedatas/
<span class="token function">vim</span> user_bucket.txt

<span class="token number">1</span>	anzhulababy1
<span class="token number">2</span>	anzhulababy2
<span class="token number">3</span>	anzhulababy3
<span class="token number">4</span>	anzhulababy4
<span class="token number">5</span>	anzhulababy5
<span class="token number">6</span>	anzhulababy6
<span class="token number">7</span>	anzhulababy7
<span class="token number">8</span>	anzhulababy8
<span class="token number">9</span>	anzhulababy9
<span class="token number">10</span>	anzhulababy10
</code></pre></div><ul><li>加载数据到普通表 user_demo 中</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/user_bucket.txt'</span>  overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> user_demo<span class="token punctuation">;</span> 
</code></pre></div><ul><li>加载数据到桶表user_buckets_demo中。==无法通过load将数据加载到分桶表里==。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span> user_buckets_demo <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_demo<span class="token punctuation">;</span>
<span class="token comment">--或者：</span>
<span class="token keyword">insert</span> overwrite <span class="token keyword">table</span> user_buckets_demo <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_demo<span class="token punctuation">;</span>
</code></pre></div><ul><li>hdfs上查看表的数据目录</li></ul> <p><img src="/assets/img/image-20200223050913526.11dfb491.png" alt="image-20200223050913526"></p> <ul><li>下载表的数据文件，查看分桶情况：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#经查看，表的数据文件的内容如下：</span>

<span class="token comment">#000000_0文件内容：即第1个桶的内容</span>
<span class="token number">8</span>	anzhulababy8
<span class="token number">4</span>	anzhulababy4

<span class="token comment">#000000_1文件内容：即第2个桶的内容</span>
<span class="token number">9</span>	anzhulababy9
<span class="token number">5</span>	anzhulababy5
<span class="token number">1</span>	anzhulababy1

<span class="token comment">#000000_2文件内容：即第3个桶的内容</span>
<span class="token number">10</span>	anzhulababy10
<span class="token number">6</span>	anzhulababy6
<span class="token number">2</span>	anzhulababy2

<span class="token comment">#000000_3文件内容：即第4个桶的内容</span>
<span class="token number">7</span>	anzhulababy7
<span class="token number">3</span>	anzhulabab
</code></pre></div><ul><li><p>抽样查询分桶表的数据</p> <p>tablesample抽样语句语法：tablesample(bucket  x  out  of  y)</p> <ul><li>x表示从第几个桶开始取数据(1,2,3,4....)</li> <li>y与进行采样的桶数的个数、每个采样桶的采样比例有关；</li> <li>比如说表的总共记录数 (行数) 有<code>10</code>个，<code>x=2,y=5</code>，那么要抽取的桶数为总记录数为<code>10*(2/5)=4</code>，并且先从第二个桶（x=2）开始抽取。</li></ul></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- tablesample(bucket 1 out of 2);</span>
<span class="token comment">-- 需要采样的记录数为10*(1/2)=5</span>
<span class="token comment">-- 先从第1个桶中取出数据</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from user_buckets_demo3 tablesample(bucket 1 out of 2);</span>
<span class="token operator">+</span><span class="token comment">------------------------+--------------------------+--+</span>
<span class="token operator">|</span> user_buckets_demo3<span class="token punctuation">.</span>id  <span class="token operator">|</span> user_buckets_demo3<span class="token punctuation">.</span>name  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+--------------------------+--+</span>
<span class="token operator">|</span> <span class="token number">8</span>                      <span class="token operator">|</span> anzhulababy8             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">4</span>                      <span class="token operator">|</span> anzhulababy4             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">10</span>                     <span class="token operator">|</span> anzhulababy10            <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">6</span>                      <span class="token operator">|</span> anzhulababy6             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>                      <span class="token operator">|</span> anzhulababy2             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+--------------------------+--+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.059</span> seconds<span class="token punctuation">)</span>


<span class="token comment">-- tablesample(bucket 1 out of 3);</span>
<span class="token comment">-- 需要采样的记录数为10*(1/3)=3.3=3</span>
<span class="token comment">-- 先从第1个桶中取出数据</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from user_buckets_demo3 tablesample(bucket 1 out of 3);</span>
<span class="token operator">+</span><span class="token comment">------------------------+--------------------------+--+</span>
<span class="token operator">|</span> user_buckets_demo3<span class="token punctuation">.</span>id  <span class="token operator">|</span> user_buckets_demo3<span class="token punctuation">.</span>name  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+--------------------------+--+</span>
<span class="token operator">|</span> <span class="token number">9</span>                      <span class="token operator">|</span> anzhulababy9             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">6</span>                      <span class="token operator">|</span> anzhulababy6             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>                      <span class="token operator">|</span> anzhulababy3             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+--------------------------+--+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.1</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h2 id="hive数据导入"><a href="#hive数据导入" class="header-anchor">#</a> Hive数据导入</h2> <h5 id="_1、直接向表中插入数据-强烈不推荐使用"><a href="#_1、直接向表中插入数据-强烈不推荐使用" class="header-anchor">#</a> 1、直接向表中插入数据（强烈不推荐使用）</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span> score3 <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span><span class="token string">'201807'</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'001'</span><span class="token punctuation">,</span><span class="token string">'002'</span><span class="token punctuation">,</span><span class="token string">'100'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_2、通过load加载数据-必须掌握"><a href="#_2、通过load加载数据-必须掌握" class="header-anchor">#</a> 2、通过load加载数据（必须掌握）</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token punctuation">[</span><span class="token keyword">local</span><span class="token punctuation">]</span> inpath <span class="token string">'dataPath'</span> overwrite <span class="token operator">|</span> <span class="token keyword">into</span> <span class="token keyword">table</span> student <span class="token punctuation">[</span><span class="token keyword">partition</span> <span class="token punctuation">(</span>partcol1<span class="token operator">=</span>val1<span class="token punctuation">,</span>…<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/score.csv'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> score3 <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'201806'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_3、通过查询加载数据-必须掌握"><a href="#_3、通过查询加载数据-必须掌握" class="header-anchor">#</a> 3、通过查询加载数据（必须掌握）</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> score5 <span class="token operator">like</span> score<span class="token punctuation">;</span>
<span class="token keyword">insert</span> overwrite <span class="token keyword">table</span> score5 <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'201806'</span><span class="token punctuation">)</span> <span class="token keyword">select</span> s_id<span class="token punctuation">,</span>c_id<span class="token punctuation">,</span>s_score <span class="token keyword">from</span> score<span class="token punctuation">;</span>
</code></pre></div><h5 id="_4、查询语句中创建表并加载数据-as-select"><a href="#_4、查询语句中创建表并加载数据-as-select" class="header-anchor">#</a> 4、查询语句中创建表并加载数据（as select）</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> score6 <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score<span class="token punctuation">;</span>
</code></pre></div><h5 id="_5、创建表时指定location"><a href="#_5、创建表时指定location" class="header-anchor">#</a> 5、创建表时指定location</h5> <p>使用这种方式导入数据时，如果表是分区表，则必须在最后一步进行表的修复（映射）<code>msck repair table ...</code>。</p> <ul><li>创建表，并指定在<code>hdfs</code>上的位置</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> external <span class="token keyword">table</span> score7 <span class="token punctuation">(</span>s_id string<span class="token punctuation">,</span>c_id string<span class="token punctuation">,</span>s_score <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span> location <span class="token string">'/myscore7'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>上传数据到<code>hdfs</code>上，可以直接在<code>hive</code>客户端下面通过<code>dfs</code>命令来进行操作<code>hdfs</code>的数据</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">0</span>: jdbc:hive2://node03:1000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> dfs -mkdir -p /myscore7<span class="token punctuation">;</span>
<span class="token number">0</span>: jdbc:hive2://node03:1000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> dfs -put /kkb/install/hivedatas/score.csv /myscore7<span class="token punctuation">;</span>
</code></pre></div><ul><li>查询数据</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score7<span class="token punctuation">;</span>
</code></pre></div><h5 id="_6、export导出与import-导入-hive表数据-内部表操作"><a href="#_6、export导出与import-导入-hive表数据-内部表操作" class="header-anchor">#</a> 6、export导出与import 导入 hive表数据（内部表操作）</h5> <div class="language-sql extra-class"><pre class="language-sql"><code>hive <span class="token punctuation">(</span>myhive<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> teacher2 <span class="token operator">like</span> teacher<span class="token punctuation">;</span>
hive <span class="token punctuation">(</span>myhive<span class="token punctuation">)</span><span class="token operator">&gt;</span> export <span class="token keyword">table</span> teacher <span class="token keyword">to</span>  <span class="token string">'/kkb/teacher'</span><span class="token punctuation">;</span>
hive <span class="token punctuation">(</span>myhive<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> <span class="token keyword">table</span> teacher2 <span class="token keyword">from</span> <span class="token string">'/kkb/teacher'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="hive数据导出"><a href="#hive数据导出" class="header-anchor">#</a> Hive数据导出</h2> <h5 id="_1-insert-导出"><a href="#_1-insert-导出" class="header-anchor">#</a> 1 insert 导出</h5> <ul><li>将查询的结果导出到本地</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> overwrite <span class="token keyword">local</span> directory <span class="token string">'/kkb/install/hivedatas/stu'</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu<span class="token punctuation">;</span>
</code></pre></div><ul><li>将查询的结果<strong>格式化</strong>导出到本地</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> overwrite <span class="token keyword">local</span> directory <span class="token string">'/kkb/install/hivedatas/stu2'</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu<span class="token punctuation">;</span>
</code></pre></div><ul><li>将查询的结果导出到<code>HDFS</code>上==(没有local)==</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> overwrite directory <span class="token string">'/kkb/hivedatas/stu'</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span>  <span class="token string">','</span>  <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu<span class="token punctuation">;</span>
</code></pre></div><h5 id="_2-hive-shell-命令导出"><a href="#_2-hive-shell-命令导出" class="header-anchor">#</a> 2  Hive Shell 命令导出</h5> <ul><li><p>基本语法：</p> <ul><li><code>hive -e &quot;sql语句&quot;</code> &gt;   <code>file</code></li> <li><code>hive -f sql文件</code>   &gt;    <code>file</code></li></ul></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">## 输出重定向：</span>
hive -e <span class="token string">'select * from myhive.stu;'</span> <span class="token operator">&gt;</span> /kkb/install/hivedatas/student1.txt
</code></pre></div><h5 id="_3-export导出到hdfs上"><a href="#_3-export导出到hdfs上" class="header-anchor">#</a> 3 export导出到HDFS上</h5> <div class="language-sql extra-class"><pre class="language-sql"><code>export <span class="token keyword">table</span>  myhive<span class="token punctuation">.</span>stu <span class="token keyword">to</span> <span class="token string">'/kkb/install/hivedatas/stuexport'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="hive静态分区"><a href="#hive静态分区" class="header-anchor">#</a> Hive静态分区</h2> <ul><li><p>表的分区字段的值需要开发人员手动给定</p></li> <li><p>创建分区表</p></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">use</span> db1<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> order_partition<span class="token punctuation">(</span>
order_number string<span class="token punctuation">,</span>
order_price  <span class="token keyword">double</span><span class="token punctuation">,</span>
order_time string
<span class="token punctuation">)</span>
partitioned <span class="token keyword">BY</span><span class="token punctuation">(</span><span class="token keyword">month</span> string<span class="token punctuation">)</span>  <span class="token comment">--特别注意这里，partitioned by的参数是我们自己定义的</span>
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>准备数据</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hivedatas
<span class="token function">vim</span> order.txt 

<span class="token number">10001</span>	<span class="token number">100</span>	<span class="token number">2019</span>-03-02
<span class="token number">10002</span>	<span class="token number">200</span>	<span class="token number">2019</span>-03-02
<span class="token number">10003</span>	<span class="token number">300</span>	<span class="token number">2019</span>-03-02
<span class="token number">10004</span>	<span class="token number">400</span>	<span class="token number">2019</span>-03-03
<span class="token number">10005</span>	<span class="token number">500</span>	<span class="token number">2019</span>-03-03
<span class="token number">10006</span>	<span class="token number">600</span>	<span class="token number">2019</span>-03-03
<span class="token number">10007</span>	<span class="token number">700</span>	<span class="token number">2019</span>-03-04
<span class="token number">10008</span>	<span class="token number">800</span>	<span class="token number">2019</span>-03-04
<span class="token number">10009</span>	<span class="token number">900</span>	<span class="token number">2019</span>-03-04
</code></pre></div><ul><li>加载数据到分区表</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/order.txt'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> order_partition <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'2019-03'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>查询结果数据，可以看到，查询<code>2019-3</code>的数据，会将所有数据都查出来，不符合我们的需求</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> order_partition <span class="token keyword">where</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'2019-03'</span><span class="token punctuation">;</span>
<span class="token comment">#结果为：</span>
<span class="token operator">+</span><span class="token comment">-----+-------+--------------+----------+ </span>
<span class="token number">10001</span>   <span class="token number">100.0</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">02</span>      <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span>
<span class="token number">10002</span>   <span class="token number">200.0</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">02</span>      <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span>
<span class="token number">10003</span>   <span class="token number">300.0</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">02</span>      <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span>
<span class="token number">10004</span>   <span class="token number">400.0</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">03</span>      <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span>
<span class="token number">10005</span>   <span class="token number">500.0</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">03</span>      <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span>
<span class="token number">10006</span>   <span class="token number">600.0</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">03</span>      <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span>
<span class="token number">10007</span>   <span class="token number">700.0</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">04</span>      <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span>
<span class="token number">10008</span>   <span class="token number">800.0</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">04</span>      <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span>
<span class="token number">10009</span>   <span class="token number">900.0</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">04</span>      <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span>
<span class="token operator">+</span><span class="token comment">-----+-------+--------------+----------+ </span>
</code></pre></div><h2 id="hive动态分区"><a href="#hive动态分区" class="header-anchor">#</a> Hive动态分区</h2> <p>动态分区：按照需求实现把数据自动导入到表的不同分区中，==不需要手动指定==</p> <p><strong>需求：根据分区字段不同的值，自动将数据导入到分区表不同的分区中</strong></p> <ul><li>创建表</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建普通表/临时表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> t_order<span class="token punctuation">(</span>
    order_number string<span class="token punctuation">,</span>
    order_price  <span class="token keyword">double</span><span class="token punctuation">,</span> 
    order_time   string
<span class="token punctuation">)</span><span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token comment">--创建目标分区表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> order_dynamic_partition<span class="token punctuation">(</span>
    order_number string<span class="token punctuation">,</span>
    order_price  <span class="token keyword">double</span>    
<span class="token punctuation">)</span>partitioned <span class="token keyword">BY</span><span class="token punctuation">(</span>order_time string<span class="token punctuation">)</span> <span class="token comment">--特别注意这里，partitioned by的参数是临时表中的某一个字段</span>
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>准备数据</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hivedatas
<span class="token function">vim</span> order_partition.txt

<span class="token number">10001</span>	<span class="token number">100</span>	<span class="token number">2019</span>-03-02 
<span class="token number">10002</span>	<span class="token number">200</span>	<span class="token number">2019</span>-03-02
<span class="token number">10003</span>	<span class="token number">300</span>	<span class="token number">2019</span>-03-02
<span class="token number">10004</span>	<span class="token number">400</span>	<span class="token number">2019</span>-03-03
<span class="token number">10005</span>	<span class="token number">500</span>	<span class="token number">2019</span>-03-03
<span class="token number">10006</span>	<span class="token number">600</span>	<span class="token number">2019</span>-03-03
<span class="token number">10007</span>	<span class="token number">700</span>	<span class="token number">2019</span>-03-04
<span class="token number">10008</span>	<span class="token number">800</span>	<span class="token number">2019</span>-03-04
<span class="token number">10009</span>	<span class="token number">900</span>	<span class="token number">2019</span>-03-04
</code></pre></div><ul><li>向普通表<code>t_order</code>加载数据</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/order_partition.txt'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> t_order<span class="token punctuation">;</span>
</code></pre></div><ul><li>动态加载数据到分区表中</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 要想进行动态分区，需要设置参数</span>
<span class="token comment">-- 开启动态分区功能</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>dynamic<span class="token punctuation">.</span><span class="token keyword">partition</span><span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span> 
<span class="token comment">-- 设置hive为非严格模式</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>dynamic<span class="token punctuation">.</span><span class="token keyword">partition</span><span class="token punctuation">.</span><span class="token keyword">mode</span><span class="token operator">=</span>nonstrict<span class="token punctuation">;</span> 
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span> order_dynamic_partition <span class="token keyword">partition</span><span class="token punctuation">(</span>order_time<span class="token punctuation">)</span> <span class="token keyword">select</span> order_number<span class="token punctuation">,</span> order_price<span class="token punctuation">,</span> order_time <span class="token keyword">from</span> t_order<span class="token punctuation">;</span>
</code></pre></div><ul><li>查看分区</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> partitions order_dynamic_partition<span class="token punctuation">;</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt="1569313506031"></p> <p>总结，动态加载数据的步骤：</p> <ol><li>创建一个普通表/临时表</li> <li>创建一个目标表，==目标表根据普通表的某个字段来分区==</li> <li>将数据load到临时表中去</li> <li>通过查询临时表将数据加载到目标表中去，特别注意：insert into table order_dynamic_partition <strong>partition(order_time)</strong> select order_number, order_price, order_time from t_order;</li></ol> <h2 id="hive修改表结构"><a href="#hive修改表结构" class="header-anchor">#</a> Hive修改表结构</h2> <h5 id="修改表的名称"><a href="#修改表的名称" class="header-anchor">#</a> 修改表的名称</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 修改表名称语法:</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span>  old_table_name  <span class="token keyword">rename</span> <span class="token keyword">to</span>  new_table_name<span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> stu3 <span class="token keyword">rename</span> <span class="token keyword">to</span> stu4<span class="token punctuation">;</span>
</code></pre></div><h5 id="增加-修改-替换列"><a href="#增加-修改-替换列" class="header-anchor">#</a> 增加/修改/替换列</h5> <ul><li>查看表结构</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">desc</span> stu4<span class="token punctuation">;</span>
<span class="token keyword">desc</span> formatted stu4<span class="token punctuation">;</span>
</code></pre></div><ul><li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-AlterColumn" target="_blank" rel="noopener noreferrer">官网文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>增加列</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> stu4 <span class="token keyword">add</span> <span class="token keyword">columns</span><span class="token punctuation">(</span>address string<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>修改列</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> stu4 change <span class="token keyword">column</span> address address_id <span class="token keyword">int</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="hive查询语法-基本查询"><a href="#hive查询语法-基本查询" class="header-anchor">#</a> Hive查询语法---基本查询</h2> <ul><li>注意
<ul><li>SQL 语言==大小写不敏感==</li> <li>SQL 可以写在一行或者多行</li> <li>==关键字不能被缩写也不能分行==</li> <li>各子句一般要分行写</li> <li>使用缩进提高语句的可读性</li></ul></li></ul> <h6 id="_5-1-1-查询全表和特定列"><a href="#_5-1-1-查询全表和特定列" class="header-anchor">#</a> 5.1.1 查询全表和特定列</h6> <ul><li>全表查询</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu<span class="token punctuation">;</span>
</code></pre></div><ul><li>选择特定列查询</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span>name <span class="token keyword">from</span> stu<span class="token punctuation">;</span>
</code></pre></div><h6 id="_5-1-2-列起别名"><a href="#_5-1-2-列起别名" class="header-anchor">#</a> 5.1.2 列起别名</h6> <ul><li><p>重命名一个列</p> <ul><li>紧跟列名，也可以在列名和别名之间加入关键字 ‘as’</li></ul></li> <li><p>案例实操</p></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span>name <span class="token keyword">as</span> stuName <span class="token keyword">from</span> stu<span class="token punctuation">;</span>
</code></pre></div><h6 id="_5-1-3-常用函数"><a href="#_5-1-3-常用函数" class="header-anchor">#</a> 5.1.3 常用函数</h6> <ul><li>求总行数（count）</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> cnt <span class="token keyword">from</span> score<span class="token punctuation">;</span>
 
 <span class="token comment">--count(*)是对行数目进行计数，不论是否包含NULL值</span>
 <span class="token comment">--count(column_name)是对列中不为空的行进行计数</span>
 <span class="token comment">--使用groupby与count函数时，要注意，使用方式如下</span>
 	<span class="token comment">--SELECT species, COUNT(*) FROM pet GROUP BY species;正确的</span>
 	<span class="token comment">--SELECT owner, COUNT(*) FROM pet;错误的</span>
 <span class="token comment">--使用COUNT( )，你不必检索整个表，如下面的sql语句：</span>
 	<span class="token keyword">SELECT</span> species<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> pet
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">WHERE</span> species <span class="token operator">=</span> <span class="token string">'dog'</span> <span class="token operator">OR</span> species <span class="token operator">=</span> <span class="token string">'cat'</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> species<span class="token punctuation">,</span> sex<span class="token punctuation">;</span>
 <span class="token comment">--count(1)与count(*)的作用的相同的</span>
</code></pre></div><ul><li>求分数的最大值（max）</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>s_score<span class="token punctuation">)</span> <span class="token keyword">from</span> score<span class="token punctuation">;</span>
</code></pre></div><ul><li>求分数的最小值（min）</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>s_score<span class="token punctuation">)</span> <span class="token keyword">from</span> score<span class="token punctuation">;</span>
</code></pre></div><ul><li>求分数的总和（sum）</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>s_score<span class="token punctuation">)</span> <span class="token keyword">from</span> score<span class="token punctuation">;</span>
</code></pre></div><ul><li>求分数的平均值（avg）</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>s_score<span class="token punctuation">)</span> <span class="token keyword">from</span> score<span class="token punctuation">;</span>
</code></pre></div><h6 id="_5-1-4-limit-语句"><a href="#_5-1-4-limit-语句" class="header-anchor">#</a> 5.1.4 limit 语句</h6> <ul><li><code>imit</code>子句用于限制返回的行数。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code> <span class="token keyword">select</span>  <span class="token operator">*</span> <span class="token keyword">from</span> score <span class="token keyword">limit</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="_5-1-5-where-语句"><a href="#_5-1-5-where-语句" class="header-anchor">#</a> 5.1.5 where 语句</h6> <ul><li>使用 where 子句，将不满足条件的行过滤掉</li> <li>==where 子句紧随from子句==</li> <li>案例实操</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score <span class="token keyword">where</span> s_score <span class="token operator">&gt;</span> <span class="token number">60</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="_5-1-6-算术运算符"><a href="#_5-1-6-算术运算符" class="header-anchor">#</a> 5.1.6 算术运算符</h6> <table><thead><tr><th>运算符</th> <th>描述</th></tr></thead> <tbody><tr><td>A+B</td> <td>A和B 相加</td></tr> <tr><td>A-B</td> <td>A减去B</td></tr> <tr><td>A*B</td> <td>A和B 相乘</td></tr> <tr><td>A/B</td> <td>A除以B</td></tr> <tr><td>A%B</td> <td>A对B取余</td></tr> <tr><td>A&amp;B</td> <td>A和B按位取与</td></tr> <tr><td>A|B</td> <td>A和B按位取或</td></tr> <tr><td>A^B</td> <td>A和B按位取异或</td></tr> <tr><td>~A</td> <td>A按位取反</td></tr></tbody></table> <h6 id="_5-1-7-比较运算符"><a href="#_5-1-7-比较运算符" class="header-anchor">#</a> 5.1.7 比较运算符</h6> <table><thead><tr><th style="text-align:center;">操作符</th> <th style="text-align:center;">支持的数据类型</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">A=B</td> <td style="text-align:center;">基本数据类型</td> <td style="text-align:center;">如果A等于B则返回true，反之返回false</td></tr> <tr><td style="text-align:center;"><code>A&lt;=&gt;B</code></td> <td style="text-align:center;">基本数据类型</td> <td style="text-align:center;">如果A和B都为NULL，则返回true，其他的和等号（=）操作符的结果一致，如果任一为NULL则结果为NULL</td></tr> <tr><td style="text-align:center;"><code>A&lt;&gt;B</code>, A!=B</td> <td style="text-align:center;">基本数据类型</td> <td style="text-align:center;">A或者B为NULL则返回NULL；如果A不等于B，则返回true，反之返回false</td></tr> <tr><td style="text-align:center;">A&lt;B</td> <td style="text-align:center;">基本数据类型</td> <td style="text-align:center;">A或者B为NULL，则返回NULL；如果A小于B，则返回true，反之返回false</td></tr> <tr><td style="text-align:center;">A&lt;=B</td> <td style="text-align:center;">基本数据类型</td> <td style="text-align:center;">A或者B为NULL，则返回NULL；如果A小于等于B，则返回true，反之返回false</td></tr> <tr><td style="text-align:center;">A&gt;B</td> <td style="text-align:center;">基本数据类型</td> <td style="text-align:center;">A或者B为NULL，则返回NULL；如果A大于B，则返回true，反之返回false</td></tr> <tr><td style="text-align:center;">A&gt;=B</td> <td style="text-align:center;">基本数据类型</td> <td style="text-align:center;">A或者B为NULL，则返回NULL；如果A大于等于B，则返回true，反之返回false</td></tr> <tr><td style="text-align:center;">A [NOT] BETWEEN B AND C</td> <td style="text-align:center;">基本数据类型</td> <td style="text-align:center;">如果A，B或者C任一为NULL，则结果为NULL。如果A的值大于等于B而且小于或等于C，则结果为true，反之为false。如果使用NOT关键字则可达到相反的效果。</td></tr> <tr><td style="text-align:center;">A IS NULL</td> <td style="text-align:center;">所有数据类型</td> <td style="text-align:center;">如果A等于NULL，则返回true，反之返回false</td></tr> <tr><td style="text-align:center;">A IS NOT NULL</td> <td style="text-align:center;">所有数据类型</td> <td style="text-align:center;">如果A不等于NULL，则返回true，反之返回false</td></tr> <tr><td style="text-align:center;">IN(数值1, 数值2)</td> <td style="text-align:center;">所有数据类型</td> <td style="text-align:center;">使用 IN运算显示列表中的值</td></tr> <tr><td style="text-align:center;">A [NOT] LIKE B</td> <td style="text-align:center;">STRING 类型</td> <td style="text-align:center;">B是一个SQL下的简单正则表达式，如果A与其匹配的话，则返回true；反之返回false。B的表达式说明如下：‘x%’表示A必须以字母‘x’开头，‘%x’表示A必须以字母’x’结尾，而‘%x%’表示A包含有字母’x’,可以位于开头，结尾或者字符串中间。如果使用NOT关键字则可达到相反的效果。like不是正则，而是通配符</td></tr> <tr><td style="text-align:center;">A RLIKE B, A REGEXP B</td> <td style="text-align:center;">STRING 类型</td> <td style="text-align:center;">B是一个正则表达式，如果A与其匹配，则返回true；反之返回false。匹配使用的是JDK中的正则表达式接口实现的，因为正则也依据其中的规则。例如，正则表达式必须和整个字符串A相匹配，而不是只需与其字符串匹配。</td></tr></tbody></table> <h6 id="_5-1-8-逻辑运算符"><a href="#_5-1-8-逻辑运算符" class="header-anchor">#</a> 5.1.8 逻辑运算符</h6> <table><thead><tr><th style="text-align:center;">操作符</th> <th style="text-align:center;">操作</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">A AND  B</td> <td style="text-align:center;">逻辑并</td> <td style="text-align:center;">如果A和B都是true则为true，否则false</td></tr> <tr><td style="text-align:center;">A  OR  B</td> <td style="text-align:center;">逻辑或</td> <td style="text-align:center;">如果A或B或两者都是true则为true，否则false</td></tr> <tr><td style="text-align:center;">NOT  A</td> <td style="text-align:center;">逻辑否</td> <td style="text-align:center;">如果A为false则为true,否则false</td></tr></tbody></table> <h2 id="hive查询语法-分组查询"><a href="#hive查询语法-分组查询" class="header-anchor">#</a> Hive查询语法---分组查询</h2> <h6 id="_5-2-1-group-by-语句"><a href="#_5-2-1-group-by-语句" class="header-anchor">#</a> 5.2.1 Group By 语句</h6> <ul><li><p>Group By语句通常会和==聚合函数==一起使用，按照一个或者多个列对结果进行分组，然后对每个组执行聚合操作。</p></li> <li><p>案例实操：</p> <ul><li>计算每个学生的平均分数</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> s_id<span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>s_score<span class="token punctuation">)</span> <span class="token keyword">from</span> score <span class="token keyword">group</span> <span class="token keyword">by</span> s_id<span class="token punctuation">;</span>
</code></pre></div><ul><li>计算每个学生最高的分数</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> s_id<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>s_score<span class="token punctuation">)</span> <span class="token keyword">from</span> score <span class="token keyword">group</span> <span class="token keyword">by</span> s_id<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h6 id="_5-2-2-having语句"><a href="#_5-2-2-having语句" class="header-anchor">#</a> 5.2.2 Having语句</h6> <p>==having是group by后用来进一步过滤数据的。==</p> <ul><li><p>having 与 where 不同点</p> <ul><li>where针对==表中的列发挥作用==，查询数据；==having针对查询结果中的列==发挥作用，筛选数据</li> <li>where后面==不能写分组函数==，而having后面可以==使用分组函数==</li> <li>having只用于group by分组统计语句</li></ul></li> <li><p>案例实操</p> <ul><li>求每个学生的平均分数</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> s_id<span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>s_score<span class="token punctuation">)</span> <span class="token keyword">from</span> score <span class="token keyword">group</span> <span class="token keyword">by</span> s_id<span class="token punctuation">;</span>
</code></pre></div><ul><li>求每个学生平均分数大于60的人</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> s_id<span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>s_score<span class="token punctuation">)</span> <span class="token keyword">as</span> avgScore <span class="token keyword">from</span> score <span class="token keyword">group</span> <span class="token keyword">by</span> s_id <span class="token keyword">having</span> avgScore <span class="token operator">&gt;</span> <span class="token number">60</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="hive查询语法-连接查询-跨表"><a href="#hive查询语法-连接查询-跨表" class="header-anchor">#</a> Hive查询语法---连接查询（跨表）</h2> <h4 id="等值-join"><a href="#等值-join" class="header-anchor">#</a> 等值 join</h4> <ul><li><p>Hive支持通常的SQL JOIN语句，但是只支持等值连接，==不支持非等值连接==。</p></li> <li><p>案例实操</p> <ul><li>根据学生和成绩表，查询学生姓名对应的成绩</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu <span class="token keyword">left</span> <span class="token keyword">join</span> score <span class="token keyword">on</span> stu<span class="token punctuation">.</span>id <span class="token operator">=</span> score<span class="token punctuation">.</span>s_id
</code></pre></div></li></ul> <h4 id="表的别名"><a href="#表的别名" class="header-anchor">#</a> 表的别名</h4> <ul><li><p>好处</p> <ul><li>使用别名可以简化查询。</li> <li>使用表名前缀可以提高执行效率。</li></ul></li> <li><p>案例实操：合并老师与课程表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- hive当中创建course表并加载数据</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> course <span class="token punctuation">(</span>c_id string<span class="token punctuation">,</span> c_name string<span class="token punctuation">,</span> t_id string<span class="token punctuation">)</span> 
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/course.csv'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> course<span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> teacher t <span class="token keyword">join</span> course c <span class="token keyword">on</span> t<span class="token punctuation">.</span>t_id <span class="token operator">=</span> c<span class="token punctuation">.</span>t_id<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="内连接-inner-join"><a href="#内连接-inner-join" class="header-anchor">#</a> 内连接 inner join</h4> <ul><li><p>内连接：只有进行连接的两个表中都存在与连接条件相匹配的数据才会被保留下来。</p> <ul><li>join默认是inner  join</li></ul></li> <li><p>案例实操</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> teacher t <span class="token keyword">inner</span> <span class="token keyword">join</span> course c  <span class="token keyword">on</span> t<span class="token punctuation">.</span>t_id <span class="token operator">=</span> c<span class="token punctuation">.</span>t_id<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="左外连接-left-outer-join"><a href="#左外连接-left-outer-join" class="header-anchor">#</a> 左外连接 left outer join</h4> <ul><li><p>左外连接：</p> <ul><li>join操作符==左边表中==符合where子句的所有记录将会被返回。</li> <li>右边表的指定字段没有符合条件的值的话，那么就使用null值替代。</li></ul></li> <li><p>案例实操：查询老师对应的课程</p> <div class="language-sql extra-class"><pre class="language-sql"><code> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> teacher t <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> course c <span class="token keyword">on</span> t<span class="token punctuation">.</span>t_id <span class="token operator">=</span> c<span class="token punctuation">.</span>t_id<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="右外连接-right-outer-join"><a href="#右外连接-right-outer-join" class="header-anchor">#</a> 右外连接 right outer join</h4> <ul><li><p>右外连接：</p> <ul><li>join操作符==右边表中==符合where子句的所有记录将会被返回。</li> <li>左边表的指定字段没有符合条件的值的话，那么就使用null值替代。</li></ul></li> <li><p>案例实操</p> <div class="language-sql extra-class"><pre class="language-sql"><code> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> teacher t <span class="token keyword">right</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> course c <span class="token keyword">on</span> t<span class="token punctuation">.</span>t_id <span class="token operator">=</span> c<span class="token punctuation">.</span>t_id<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="满外连接-full-outer-join"><a href="#满外连接-full-outer-join" class="header-anchor">#</a> 满外连接 full outer join</h4> <ul><li><p>满外连接：</p> <ul><li>将会返回==所有表中==符合where语句条件的所有记录。</li> <li>如果任一表的指定字段没有符合条件的值的话，那么就使用null值替代。</li></ul></li> <li><p>案例实操</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> teacher t <span class="token keyword">full</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> course c <span class="token keyword">on</span> t<span class="token punctuation">.</span>t_id <span class="token operator">=</span> c<span class="token punctuation">.</span>t_id<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="多表连接"><a href="#多表连接" class="header-anchor">#</a> 多表连接</h4> <ul><li><p><strong>多个表使用join进行连接</strong></p></li> <li><p>==注意：==连接 <code>n</code>个表，至少需要<code>n-1</code>个连接条件。例如：连接三个表，至少需要两个连接条件。</p></li> <li><p>案例实操</p> <ul><li>多表连接查询，查询老师对应的课程，以及对应的分数，对应的学生</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> teacher t 
<span class="token keyword">left</span> <span class="token keyword">join</span> course c <span class="token keyword">on</span> t<span class="token punctuation">.</span>t_id <span class="token operator">=</span> c<span class="token punctuation">.</span>t_id 
<span class="token keyword">left</span> <span class="token keyword">join</span> score s <span class="token keyword">on</span> c<span class="token punctuation">.</span>c_id <span class="token operator">=</span> s<span class="token punctuation">.</span>c_id 
<span class="token keyword">left</span> <span class="token keyword">join</span> stu <span class="token keyword">on</span> s<span class="token punctuation">.</span>s_id <span class="token operator">=</span> stu<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="理解示意图"><a href="#理解示意图" class="header-anchor">#</a> 理解示意图</h4> <p><img src="/assets/img/image-20200223073048191.7601ec62.png" alt="image-20200223073048191"></p> <h2 id="hive查询语法-排序"><a href="#hive查询语法-排序" class="header-anchor">#</a> Hive查询语法---排序</h2> <h4 id="order-by-全局排序"><a href="#order-by-全局排序" class="header-anchor">#</a> order by 全局排序</h4> <ul><li><p>全局排序，只有一个reduce</p></li> <li><p>使用 ORDER BY 子句排序</p> <ul><li>asc ( ascend) 升序 (默认)</li> <li>desc (descend) 降序</li></ul></li> <li><p>order by 子句在select语句的结尾</p></li> <li><p>案例实操</p> <ul><li>查询学生的成绩，并按照分数降序排列</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score s <span class="token keyword">order</span> <span class="token keyword">by</span> s_score <span class="token keyword">desc</span> <span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="按照别名排序"><a href="#按照别名排序" class="header-anchor">#</a> 按照别名排序</h4> <ul><li><p>按照学生分数的平均值排序</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> s_id<span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>s_score<span class="token punctuation">)</span> avgscore <span class="token keyword">from</span> score <span class="token keyword">group</span> <span class="token keyword">by</span> s_id <span class="token keyword">order</span> <span class="token keyword">by</span> avgscore <span class="token keyword">desc</span><span class="token punctuation">;</span> 
</code></pre></div></li></ul> <h4 id="每个mapreduce内部排序-sort-by-局部排序"><a href="#每个mapreduce内部排序-sort-by-局部排序" class="header-anchor">#</a> 每个MapReduce内部排序（Sort By）局部排序</h4> <ul><li><code>sort by</code>：每个<code>reducer</code>内部进行排序，对全局结果集来说不是排序。</li></ul> <p><img src="/assets/img/image-20200223074225295.b662357a.png" alt="image-20200223074225295"></p> <ul><li><p>设置<code>reduce</code>个数</p> <div class="language- extra-class"><pre class="language-text"><code>set mapreduce.job.reduces=3;
</code></pre></div></li> <li><p>查看<code>reduce</code>的个数</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>job<span class="token punctuation">.</span>reduces<span class="token punctuation">;</span>
</code></pre></div></li> <li><p>查询成绩按照成绩降序排列</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score s sort <span class="token keyword">by</span> s<span class="token punctuation">.</span>s_score<span class="token punctuation">;</span>
</code></pre></div></li> <li><p>将查询结果导入到文件中（按照成绩降序排列）</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> overwrite <span class="token keyword">local</span> directory <span class="token string">'/kkb/install/hivedatas/sort'</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score s sort <span class="token keyword">by</span> s<span class="token punctuation">.</span>s_score<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="distribute-by-分区排序"><a href="#distribute-by-分区排序" class="header-anchor">#</a> distribute by 分区排序</h4> <ul><li><p><code>distribute by</code>：</p> <ul><li>类似<code>MR</code>中<code>partition</code>，==采集<code>hash</code>算法，在map端将查询的结果中<code>hash</code>值相同的结果分发到对应的reduce文件中==。</li> <li>结合<code>sort by</code>使用。</li></ul></li> <li><p>注意</p> <ul><li><code>Hive</code>要求 <strong>distribute by</strong> 语句要写在 <strong>sort by</strong> 语句之前。</li></ul></li> <li><p>案例实操</p> <ul><li><p>先按照学生 <code>sid</code> 进行分区，再按照学生成绩进行排序</p></li> <li><p>设置<code>reduce</code>的个数</p></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>job<span class="token punctuation">.</span>reduces<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>通过<code>distribute by</code>  进行数据的分区,，将不同的<code>sid</code> 划分到对应的<code>reduce</code>当中去</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> overwrite <span class="token keyword">local</span> directory <span class="token string">'/kkb/install/hivedatas/distribute'</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score distribute <span class="token keyword">by</span> s_id sort <span class="token keyword">by</span> s_score<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="cluster-by"><a href="#cluster-by" class="header-anchor">#</a> cluster by</h4> <ul><li><p>当<code>distribute by</code>和<code>sort by</code>字段相同时，可以使用<code>cluster by</code>方式代替</p></li> <li><p>除了<code>distribute by</code> 的功能外，还会对该字段进行排序，所以<code>cluster by = distribute by + sort by</code></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--以下两种写法等价</span>
<span class="token keyword">insert</span> overwrite <span class="token keyword">local</span> directory <span class="token string">'/kkb/install/hivedatas/distribute_sort'</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score distribute <span class="token keyword">by</span> s_score sort <span class="token keyword">by</span> s_score<span class="token punctuation">;</span>

<span class="token keyword">insert</span> overwrite <span class="token keyword">local</span> directory <span class="token string">'/kkb/install/hivedatas/cluster'</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score  cluster <span class="token keyword">by</span> s_score<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="hive总结1"><a href="#hive总结1" class="header-anchor">#</a> Hive总结1</h2> <p><img src="/assets/img/hive基础入门.4fa277ed.png" alt=""></p> <p><img src="/assets/img/hive表的DDL和DML操作.6af93dc9.png" alt=""></p> <h2 id="作业"><a href="#作业" class="header-anchor">#</a> 作业</h2> <ul><li>1、创建一张<code>hive</code>的表，加载数据，最后把查询的结果数据导入到本地文件中</li> <li>2、创建一张hive外部分区表，实现从一个已知的表中查询数据，动态插入到指定的分区中</li></ul> <h2 id="hive可视化工具dbeaver"><a href="#hive可视化工具dbeaver" class="header-anchor">#</a> Hive可视化工具dbeaver</h2> <h5 id="dbeaver基本介绍"><a href="#dbeaver基本介绍" class="header-anchor">#</a> dbeaver基本介绍</h5> <ul><li><code>dbeaver</code>是一个图形化的界面工具，专门用于与各种数据库的集成，通过<code>dbeaver</code>我们可以与各种数据库进行集成</li> <li>通过图形化界面的方式来操作我们的数据库与数据库表，类似于我们的<code>sqlyog</code>或者<code>navicat</code>。</li></ul> <h5 id="下载dbeaver"><a href="#下载dbeaver" class="header-anchor">#</a> 下载dbeaver</h5> <ul><li>我们可以直接从<code>github</code>上面下载我们需要的对应的安装包即可</li></ul> <p>​		https://github.com/dbeaver/dbeaver/releases</p> <h5 id="安装dbeaver"><a href="#安装dbeaver" class="header-anchor">#</a> 安装dbeaver</h5> <ul><li>这里我们使用的版本是<code>6.15</code>这个版本，下载<code>zip</code>的压缩包，直接解压就可以使用</li> <li>然后双击目录<code>dbeaver-ce-6.1.5-win32.win32.x86_64\dbeaver</code>中的<code>dbeaver.exe</code>即可启动</li> <li>双击<code>dbeaver.exe</code></li></ul> <h5 id="启动dbeaver"><a href="#启动dbeaver" class="header-anchor">#</a> 启动<code>dbeaver</code></h5> <p>启动的图形化界面如下，进行如图操作：</p> <img src="hive.assets/1569407489837.png" alt="1569407489837" style="zoom:80%;border:2px solid black;"> <h5 id="配置我们的主机名与端口号"><a href="#配置我们的主机名与端口号" class="header-anchor">#</a> 配置我们的主机名与端口号</h5> <img src="hive.assets/20181113110722636.png" alt="20181113110722636" style="zoom:80%;border:2px solid black;"> <img src="hive.assets/1569407697691.png" alt="1569407697691" style="zoom:140%;border:2px solid black;"> <p><img src="/assets/img/Image201912151603.45670ee4.png" alt=""></p> <ul><li>编辑<code>sql</code>语句</li></ul> <p><img src="/assets/img/Image201912151606.f58a9ecc.png" alt=""></p> <ul><li>运行<code>sql</code>语句，查看结果</li></ul> <p><img src="/assets/img/image-20200223141845607.201c7445.png" alt="image-20200223141845607"></p> <h2 id="hive的参数传递"><a href="#hive的参数传递" class="header-anchor">#</a> Hive的参数传递</h2> <h4 id="查看hive的命令的参数"><a href="#查看hive的命令的参数" class="header-anchor">#</a> 查看hive的命令的参数</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hive -help
usage: hive
 -d,--define <span class="token operator">&lt;</span>key<span class="token operator">=</span>value<span class="token operator">&gt;</span>          Variable subsitution to apply to hive
                                  commands. e.g. -d <span class="token assign-left variable">A</span><span class="token operator">=</span>B or --define <span class="token assign-left variable">A</span><span class="token operator">=</span>B
    --database <span class="token operator">&lt;</span>databasename<span class="token operator">&gt;</span>     Specify the database to use
 -e <span class="token operator">&lt;</span>quoted-query-string<span class="token operator">&gt;</span>         SQL from <span class="token builtin class-name">command</span> line
 -f <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span>                    SQL from files
 -H,--help                        Print <span class="token builtin class-name">help</span> information
    --hiveconf <span class="token operator">&lt;</span>property<span class="token operator">=</span>value<span class="token operator">&gt;</span>   Use value <span class="token keyword">for</span> given property
    --hivevar <span class="token operator">&lt;</span>key<span class="token operator">=</span>value<span class="token operator">&gt;</span>         Variable subsitution to apply to hive
                                  commands. e.g. --hivevar <span class="token assign-left variable">A</span><span class="token operator">=</span>B
 -i <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span>                    Initialization SQL <span class="token function">file</span>
 -S,--silent                      Silent mode <span class="token keyword">in</span> interactive shell
 -v,--verbose                     Verbose mode <span class="token punctuation">(</span>echo executed SQL to the
                                  console<span class="token punctuation">)</span>
</code></pre></div><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAMAAAAMCGV4AAAAAXNSR0IArs4c6QAAAMxQTFRF//fYwMDA/9AT/9Qn/9g7/99iAAAAUlH/eHj/jIv/n57/xcX///Cw//PEBQT/LCv///TE//jY/++w//PF/+iJ//Cx/9ra/7+//7Gx/6Oj/4eH/3l5/9c7/+Bi/8/P/7Oz/6am/5iX/8TE/6in/5qa/4yM/3Fw/2Ji/62t/5GS/4SD/3V2/1pa/0xM/6Ki/4aG/3h3/2pq/05O/0FA/5aW/3p6/21t/15f/9AUn5//xsX/eXf/i4v//+iK/+eJeXj/eHf/UlL/LCr/Kyv/WLUWNgAAAAxjbVBQSkNtcDA3MTICAQEGiroUzgAAAAJ0Uk5T/wDltzBKAAAAgklEQVQYlV3PPQuCAAAEUB/UmGPg0tDUFA1GRj8/ISpwa2pqiHALBJUkaSj7uu3BDXcEP9G533xMlAvVhacXe1GeZDqDJOu5fjlstdd3n7BWCMSwj+SLQ1MITMFRRXy3MQGnOLXcUhqDS5yC0gjnr71DUMzXkp3Z5rV/oFrdZMr/Pw/btSokYKUFFgAAAABJRU5ErkJggg==" alt="*">  语法结构</p> <ul><li><p><code>hive [-hiveconf x=y]* [&lt;-i filename&gt;]* [&lt;-f filename&gt;|&lt;-e query-string&gt;] [-S]</code></p></li> <li><p>说明：</p> <ul><li><code>-i</code> 从文件初始化<code>HQL</code>。</li> <li><code>-e</code>从命令行执行指定的<code>HQL</code></li> <li><code>-f</code> 执行<code>HQL</code>脚本</li> <li><code>-v</code> 输出执行的<code>HQL</code>语句到控制台</li> <li>-p <code>&lt;port&gt;</code> <code>connect to Hive Server on port number</code></li> <li><code>-hiveconf x=y Use this to set hive/hadoop configuration variables.</code>  设置<code>hive</code>运行时候的参数配置</li></ul></li></ul> <h4 id="hive参数配置方式"><a href="#hive参数配置方式" class="header-anchor">#</a> Hive参数配置方式</h4> <p><code>Hive</code>参数大全：<a href="https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties" target="_blank" rel="noopener noreferrer">官网地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>开发<code>Hive</code>应用时，不可避免地需要设定<code>Hive</code>的参数。设定<code>Hive</code>的参数可以调优<code>HQL</code>代码的执行效率，或帮助定位问题。然而实践中经常遇到的一个问题是，为什么设定的参数没有起作用？这通常是错误的设定方式导致的。</p> <h5 id="第一种方式-配置文件"><a href="#第一种方式-配置文件" class="header-anchor">#</a> 第一种方式：配置文件</h5> <p><code>Hive</code>的配置文件包括</p> <ul><li><p>用户自定义配置文件：<code>$HIVE_CONF_DIR/hive-site.xml</code></p></li> <li><p>默认配置文件：<code>$HIVE_CONF_DIR/hive-default.xml</code></p></li> <li><p>用户自定义配置会覆盖默认配置。</p></li> <li><p>另外，<code>Hive</code>也会读入<code>Hadoop</code>的配置，因为<code>Hive</code>是作为<code>Hadoop</code>的客户端启动的，<code>Hive</code>的配置会覆盖<code>Hadoop</code>的配置。配置文件的设定对本机启动的所有<code>Hive</code>进程都有效。</p></li></ul> <h5 id="第二种方式-命令行参数"><a href="#第二种方式-命令行参数" class="header-anchor">#</a> 第二种方式：命令行参数</h5> <p>启动<code>Hive</code>（启动<code>hive shell</code>客户端或<code>hiveServer</code>方式）时，可以在命令行添加<code>-hiveconf param=value</code>来设定参数，例如：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">## 启动hive客户端方式 传递参数:</span>
<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hive --hiveconf javax.jdo.option.ConnectionUserName<span class="token operator">=</span>root
<span class="token comment">## 这一设定只对本次启动的Session有效!!!</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">## 启动hiveserver2方式 传递参数:</span>
<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token function">nohup</span> hive --service hiveserver2 <span class="token operator">&amp;</span> --hiveconf javax.jdo.option.ConnectionUserName<span class="token operator">=</span>root
<span class="token comment">## 对于这种Server方式的启动，对所有请求的Sessions都有效</span>
</code></pre></div><p>通过<code>beeline</code>连接<code>hiveserver2</code>时也可以传递参数：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ beeline --hiveconf javax.jdo.option.ConnectionUserName<span class="token operator">=</span>root
</code></pre></div><h5 id="第三种方式-参数声明"><a href="#第三种方式-参数声明" class="header-anchor">#</a> 第三种方式：参数声明</h5> <p>进入<code>hive shell</code>客户端后，或者通过<code>beeline</code>连接<code>hiveserver2</code>后，可以在<code>HQL</code>中使用<code>SET</code>关键字设定参数，这种方式设置的参数都是<code>hiveconf</code>类型，例如：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">## 进入hive shell后配置参数</span>
hive <span class="token punctuation">(</span>default<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> javax.jdo.option.ConnectionUserName<span class="token operator">=</span>root<span class="token punctuation">;</span>
<span class="token comment">## 这一设定的作用域是session级的。只对当前session有效</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">## beeline连接hiveserver2后，配置参数，设置mr中reduce个数</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; set mapreduce.job.reduces=100;</span>
<span class="token comment">## 这一设定的作用域是session级的。只对当前session有效</span>
</code></pre></div><h5 id="参数配置的优先级"><a href="#参数配置的优先级" class="header-anchor">#</a> 参数配置的优先级</h5> <p>上述三种设定方式的优先级依次递增。</p> <ul><li>即参数声明覆盖命令行参数，命令行参数覆盖配置文件设定。</li> <li>注意某些系统级的参数，例如<code>log4j</code>相关的设定，必须用前两种方式设定，因为那些参数的读取在<code>Session</code>建立以前已经完成了。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>参数声明  &gt;   命令行参数   &gt;  配置文件参数（hive）
</code></pre></div><h5 id="第四种方式-使用变量传递参数"><a href="#第四种方式-使用变量传递参数" class="header-anchor">#</a> 第四种方式：使用变量传递参数</h5> <ul><li><p>实际工作当中，我们一般都是将<code>hive</code>的<code>hql</code>语法开发完成之后，就写入到一个脚本里面去，然后定时的通过命令 <code>hive -f</code>  去执行<code>hive</code>的语法即可</p></li> <li><p>然后通过定义变量来传递参数到<code>hive</code>的脚本当中去，那么我们接下来就来看看如何使用<code>hive</code>来传递参数。</p></li> <li><p><code>hive0.9</code>以及之前的版本是不支持传参</p></li> <li><p><code>hive1.0</code>版本之后支持传参，语法格式是：  <code>hive -f</code> 传递参数</p></li> <li><p>在<code>hive</code>当中我们一般可以使用<code>hivevar</code>或者<code>hiveconf</code>来进行参数的传递</p></li></ul> <h4 id="案例1-hiveconf"><a href="#案例1-hiveconf" class="header-anchor">#</a> 案例1：hiveconf</h4> <p><code>hiveconf</code>用于定义<code>HIVE</code><strong>执行上下文的属性</strong>(配置参数)，可覆盖覆盖<code>hive-site.xml（hive-default.xml）</code>中的参数值，如用户执行目录、日志打印级别、执行队列等。例如我们可以使用<code>hiveconf</code>来覆盖我们的<code>hive</code>属性配置。<code>hiveconf</code>配置的属性一般是<code>hive-default.xml</code>配置文件里有的。</p> <p>获取<code>hiveconf</code>变量的值必须要使用<code>hiveconf</code>作为前缀参数，具体格式如下:</p> <div class="language-sql extra-class"><pre class="language-sql"><code>${hiveconf:<span class="token keyword">key</span>} 
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; set my=80;  #仅对当前session有效，一旦!quit退出，my就会失效</span>
<span class="token keyword">No</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.015</span> seconds<span class="token punctuation">)</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; set my;</span>
<span class="token operator">+</span><span class="token comment">--------+--+</span>
<span class="token operator">|</span>  <span class="token keyword">set</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+--+</span>
<span class="token operator">|</span> my<span class="token operator">=</span><span class="token number">80</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+--+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">0.017</span> seconds<span class="token punctuation">)</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; use db1;</span>
<span class="token keyword">No</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.048</span> seconds<span class="token punctuation">)</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from score7_1;</span>
<span class="token operator">+</span><span class="token comment">----------------+----------------+-------------------+-----------------+--+</span>
<span class="token operator">|</span> score7_1<span class="token punctuation">.</span>s_id  <span class="token operator">|</span> score7_1<span class="token punctuation">.</span>c_id  <span class="token operator">|</span> score7_1<span class="token punctuation">.</span>s_score  <span class="token operator">|</span> score7_1<span class="token punctuation">.</span><span class="token keyword">month</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+----------------+-------------------+-----------------+--+</span>
<span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">90</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">99</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">70</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">60</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>             <span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">50</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>             <span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">30</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>             <span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">20</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">05</span>             <span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">76</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">05</span>             <span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">87</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">06</span>             <span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">31</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">06</span>             <span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">34</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">07</span>             <span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">89</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">07</span>             <span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">98</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+----------------+-------------------+-----------------+--+</span>
<span class="token number">18</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.102</span> seconds<span class="token punctuation">)</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from score7_1 where s_score=${hiveconf:my};</span>
<span class="token operator">+</span><span class="token comment">----------------+----------------+-------------------+-----------------+--+</span>
<span class="token operator">|</span> score7_1<span class="token punctuation">.</span>s_id  <span class="token operator">|</span> score7_1<span class="token punctuation">.</span>c_id  <span class="token operator">|</span> score7_1<span class="token punctuation">.</span>s_score  <span class="token operator">|</span> score7_1<span class="token punctuation">.</span><span class="token keyword">month</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+----------------+-------------------+-----------------+--+</span>
<span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+----------------+-------------------+-----------------+--+</span>

</code></pre></div><h4 id="案例2-hivevar"><a href="#案例2-hivevar" class="header-anchor">#</a> 案例2：hivevar</h4> <p><code>hivevar</code>用于定义<code>HIVE</code><strong>运行时的变量</strong>替换，类似于<code>JAVA</code>中的<code>“PreparedStatement”</code>，与<code>${key}</code>配合使用或者与 <code>${hivevar:key}</code></p> <p>获取<code>hivevar</code>变量的值可以不使用前缀<code>hivevar</code>，具体格式如下：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 使用前缀:</span>
 ${hivevar:<span class="token keyword">key</span>}
<span class="token comment">-- 不使用前缀:</span>
 ${<span class="token keyword">key</span>}
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token punctuation">[</span>hadoop<span class="token variable">@node03</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ beeline <span class="token comment">--hivevar myscore=80;  #myscore仅对当前session有效</span>

beeline<span class="token operator">&gt;</span> <span class="token operator">!</span><span class="token keyword">connect</span> jdbc:hive2:<span class="token comment">//node03:10000</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; use db1;</span>
<span class="token keyword">No</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.105</span> seconds<span class="token punctuation">)</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from score7_1 where s_score=${myscore};</span>
<span class="token operator">+</span><span class="token comment">----------------+----------------+-------------------+-----------------+--+</span>
<span class="token operator">|</span> score7_1<span class="token punctuation">.</span>s_id  <span class="token operator">|</span> score7_1<span class="token punctuation">.</span>c_id  <span class="token operator">|</span> score7_1<span class="token punctuation">.</span>s_score  <span class="token operator">|</span> score7_1<span class="token punctuation">.</span><span class="token keyword">month</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+----------------+-------------------+-----------------+--+</span>
<span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">01</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">02</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">03</span>             <span class="token operator">|</span> <span class="token number">80</span>                <span class="token operator">|</span> <span class="token number">201805</span>          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+----------------+-------------------+-----------------+--+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.247</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h4 id="案例3-define"><a href="#案例3-define" class="header-anchor">#</a> 案例3：define</h4> <p><code>define</code>与<code>hivevar</code>用途完全一样，可以简写成“<code>-d</code></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token punctuation">[</span>hadoop<span class="token variable">@node03</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ hive <span class="token operator">-</span>d myscore<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">;</span>  <span class="token comment">#myscore仅对当前session有效</span>

hive <span class="token punctuation">(</span>db1<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score7_1 <span class="token keyword">where</span> s_score<span class="token operator">&gt;</span>${myscore}<span class="token punctuation">;</span>
OK
score7_1<span class="token punctuation">.</span>s_id   score7_1<span class="token punctuation">.</span>c_id   score7_1<span class="token punctuation">.</span>s_score        score7_1<span class="token punctuation">.</span><span class="token keyword">month</span>
<span class="token number">01</span>      <span class="token number">03</span>      <span class="token number">99</span>      <span class="token number">201805</span>
<span class="token number">07</span>      <span class="token number">03</span>      <span class="token number">98</span>      <span class="token number">201805</span>
<span class="token keyword">Time</span> taken: <span class="token number">0.879</span> seconds<span class="token punctuation">,</span> Fetched: <span class="token number">2</span> <span class="token keyword">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
</code></pre></div><h4 id="案例4-hive脚本实战"><a href="#案例4-hive脚本实战" class="header-anchor">#</a> 案例4：hive脚本实战</h4> <p>####### 第一步：创建表并加载数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> external <span class="token keyword">table</span> score<span class="token punctuation">(</span>s_id string<span class="token punctuation">,</span>c_id string<span class="token punctuation">,</span>s_score <span class="token keyword">int</span><span class="token punctuation">)</span> 
partitioned <span class="token keyword">by</span><span class="token punctuation">(</span><span class="token keyword">month</span> string<span class="token punctuation">)</span> 
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/score.csv'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> score <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'201805'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> external <span class="token keyword">table</span> student<span class="token punctuation">(</span>s_id string<span class="token punctuation">,</span> s_name string<span class="token punctuation">,</span> s_birth string<span class="token punctuation">,</span> s_sex string<span class="token punctuation">)</span> 
<span class="token keyword">row</span> format delimitedfields <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/student.csv'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> student<span class="token punctuation">;</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from student;</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------------+------------------+----------------+--+</span>
<span class="token operator">|</span> student<span class="token punctuation">.</span>s_id  <span class="token operator">|</span> student<span class="token punctuation">.</span>s_name  <span class="token operator">|</span> student<span class="token punctuation">.</span>s_birth  <span class="token operator">|</span> student<span class="token punctuation">.</span>s_sex  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------------+------------------+----------------+--+</span>
<span class="token operator">|</span> <span class="token number">01</span>            <span class="token operator">|</span> 赵雷              <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>       <span class="token operator">|</span> 男              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>            <span class="token operator">|</span> 钱电              <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">21</span>       <span class="token operator">|</span> 男              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>            <span class="token operator">|</span> 孙风              <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">20</span>       <span class="token operator">|</span> 男              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>            <span class="token operator">|</span> 李云              <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">06</span>       <span class="token operator">|</span> 男              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">05</span>            <span class="token operator">|</span> 周梅              <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span>       <span class="token operator">|</span> 女              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">06</span>            <span class="token operator">|</span> 吴兰              <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span>       <span class="token operator">|</span> 女              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">07</span>            <span class="token operator">|</span> 郑竹              <span class="token operator">|</span> <span class="token number">1989</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">01</span>       <span class="token operator">|</span> 女              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">08</span>            <span class="token operator">|</span> 王菊              <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">20</span>       <span class="token operator">|</span> 女              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------------+------------------+----------------+--+</span>
<span class="token number">8</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.093</span> seconds<span class="token punctuation">)</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from score;</span>
<span class="token operator">+</span><span class="token comment">-------------+-------------+----------------+--------------+--+</span>
<span class="token operator">|</span> score<span class="token punctuation">.</span>s_id  <span class="token operator">|</span> score<span class="token punctuation">.</span>c_id  <span class="token operator">|</span> score<span class="token punctuation">.</span>s_score  <span class="token operator">|</span> score<span class="token punctuation">.</span><span class="token keyword">month</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+-------------+----------------+--------------+--+</span>
<span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">80</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">90</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">99</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">70</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">60</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">80</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">80</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">80</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">80</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>          <span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">50</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>          <span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">30</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>          <span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">20</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">05</span>          <span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">76</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">05</span>          <span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">87</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">06</span>          <span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">31</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">06</span>          <span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">34</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">07</span>          <span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">89</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">07</span>          <span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">98</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+-------------+----------------+--------------+--+</span>
<span class="token number">18</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.136</span> seconds<span class="token punctuation">)</span>
</code></pre></div><p>####### 第二步：定义hive脚本</p> <ul><li><p>开发<code>hql</code>脚本，并使用<code>hiveconf</code>和<code>hivevar</code>进行参数传入</p></li> <li><p><code>node03</code>执行以下命令定义<code>hql</code>脚本</p></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>cd <span class="token operator">/</span>kkb<span class="token operator">/</span>instal<span class="token operator">/</span>hivedatas

vim hivevariable<span class="token punctuation">.</span>hql

<span class="token comment">#使用脚本1：</span>
<span class="token keyword">use</span> db1<span class="token punctuation">;</span>  <span class="token comment">## 脚本一定要加上这一行，否则会找不到表</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">left</span> <span class="token keyword">join</span> score <span class="token keyword">on</span> student<span class="token punctuation">.</span>s_id <span class="token operator">=</span> score<span class="token punctuation">.</span>s_id <span class="token keyword">where</span> score<span class="token punctuation">.</span><span class="token keyword">month</span> <span class="token operator">=</span> ${hiveconf:<span class="token keyword">month</span>} <span class="token operator">and</span> score<span class="token punctuation">.</span>s_score <span class="token operator">&gt;</span> ${hivevar:s_score} <span class="token operator">and</span> score<span class="token punctuation">.</span>c_id <span class="token operator">=</span> ${c_id}<span class="token punctuation">;</span> 

<span class="token comment">#或者使用脚本2：</span>
<span class="token keyword">use</span> db1<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student st <span class="token keyword">left</span> <span class="token keyword">join</span> score sc <span class="token keyword">on</span> st<span class="token punctuation">.</span>s_id <span class="token operator">=</span> sc<span class="token punctuation">.</span>s_id <span class="token keyword">where</span> sc<span class="token punctuation">.</span><span class="token keyword">month</span> <span class="token operator">=</span> ${hiveconf:<span class="token keyword">month</span>} <span class="token operator">and</span> sc<span class="token punctuation">.</span>s_score <span class="token operator">&gt;</span> ${hivevar:s_score} <span class="token operator">and</span> sc<span class="token punctuation">.</span>c_id <span class="token operator">=</span> ${c_id}<span class="token punctuation">;</span>
</code></pre></div><p>####### 第三步：调用hive脚本并传递参数</p> <ul><li><code>node03</code>执行以下命令，调用脚本2：</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hive --hiveconf <span class="token assign-left variable">month</span><span class="token operator">=</span><span class="token number">201905</span> --hivevar <span class="token assign-left variable">s_score</span><span class="token operator">=</span><span class="token number">80</span> --hivevar <span class="token assign-left variable">c_id</span><span class="token operator">=</span>03  -f /kkb/install/hivedatas/hivevariable.hql

st.s_id st.s_name  st.s_birth  st.s_sex   sc.s_id sc.c_id sc.s_score    sc.month
01      赵雷        <span class="token number">1990</span>-01-01      男      01         <span class="token number">3</span>       <span class="token number">99</span>         <span class="token number">201805</span>
07      郑竹        <span class="token number">1989</span>-07-01      女      07         <span class="token number">3</span>       <span class="token number">98</span>         <span class="token number">201805</span>
Time taken: <span class="token number">18.187</span> seconds, Fetched: <span class="token number">2</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
</code></pre></div><h2 id="hive的常用函数"><a href="#hive的常用函数" class="header-anchor">#</a> Hive的常用函数</h2> <h4 id="系统内置函数"><a href="#系统内置函数" class="header-anchor">#</a> 系统内置函数</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#1．查看系统自带的函数</span>
<span class="token keyword">show</span> functions<span class="token punctuation">;</span>
<span class="token comment">#2．显示自带的函数的用法</span>
<span class="token keyword">desc</span> <span class="token keyword">function</span> upper<span class="token punctuation">;</span>
<span class="token comment">#3．详细显示自带的函数的用法</span>
<span class="token keyword">desc</span> <span class="token keyword">function</span> <span class="token keyword">extended</span> upper<span class="token punctuation">;</span>
</code></pre></div><h4 id="取整函数"><a href="#取整函数" class="header-anchor">#</a> 取整函数</h4> <h6 id="四舍五入round函数"><a href="#四舍五入round函数" class="header-anchor">#</a> 四舍五入round函数</h6> <ul><li><strong>语法</strong>: <code>round(double a)</code></li> <li><strong>返回值</strong>: <code>BIGINT</code></li> <li><strong>说明</strong>: 返回<code>double</code>类型的整数值部分 （遵循四舍五入）</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">3</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">4</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> tableName <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">9542.158</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
</code></pre></div><h6 id="指定精度取整函数-round"><a href="#指定精度取整函数-round" class="header-anchor">#</a> 指定精度取整函数: round</h6> <ul><li><strong>语法</strong>: <code>round(double a, int d)</code></li> <li><strong>返回值</strong>: <code>DOUBLE</code></li> <li><strong>说明</strong>: 返回指定精度<code>d</code>的<code>double</code>类型</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">3.1416</span>
</code></pre></div><h6 id="向下取整函数-floor"><a href="#向下取整函数-floor" class="header-anchor">#</a> 向下取整函数: floor</h6> <ul><li><strong>语法</strong>: <code>floor(double a)</code></li> <li><strong>返回值</strong>: <code>BIGINT</code></li> <li><strong>说明</strong>: 返回等于或者小于该<code>double</code>变量的最大的整数</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> floor<span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">3</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> floor<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">25</span>
</code></pre></div><h6 id="向上取整函数-ceil"><a href="#向上取整函数-ceil" class="header-anchor">#</a> 向上取整函数: ceil</h6> <ul><li><strong>语法</strong>: <code>ceil(double a)</code></li> <li><strong>返回值</strong>: <code>BIGINT</code></li> <li><strong>说明</strong>: 返回等于或者大于该double变量的最小的整数</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> ceil<span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">4</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> ceil<span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">46</span>
</code></pre></div><h6 id="向上取整函数-ceiling"><a href="#向上取整函数-ceiling" class="header-anchor">#</a> 向上取整函数: ceiling</h6> <ul><li><strong>语法</strong>: <code>ceiling(double a)</code></li> <li><strong>返回值</strong>: <code>BIGINT</code></li> <li><strong>说明</strong>: <code>与ceil</code>功能相同</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> ceiling<span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">4</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> ceiling<span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">46</span>
</code></pre></div><h5 id="取随机数函数-rand"><a href="#取随机数函数-rand" class="header-anchor">#</a> 取随机数函数: rand</h5> <ul><li><strong>语法</strong>: <code>rand(), rand(int seed)</code></li> <li><strong>返回值</strong>: <code>double</code></li> <li><strong>说明</strong>: 返回一个0到1范围内的随机数。如果指定种子seed，则会等到一个稳定的随机数序列</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">0.5577432776034763</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">0.6638336467363424</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">0.7220096548596434</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">0.7220096548596434</span>
</code></pre></div><h4 id="日期函数"><a href="#日期函数" class="header-anchor">#</a> 日期函数</h4> <h6 id="_1、unix时间戳转日期函数-from-unixtime"><a href="#_1、unix时间戳转日期函数-from-unixtime" class="header-anchor">#</a> 1、UNIX时间戳转日期函数: from_unixtime</h6> <ul><li><strong>语法</strong>: <code>from_unixtime(bigint unixtime[, string format])</code></li> <li><strong>返回值</strong>: <code>string</code></li> <li><strong>说明</strong>: 转化<code>UNIX</code>时间戳（从<code>1970-01-01 00:00:00 UTC</code>到指定时间的秒数）到当前时区的时间格式</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> from_unixtime<span class="token punctuation">(</span><span class="token number">1323308943</span><span class="token punctuation">,</span> <span class="token string">'yyyyMMdd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">20111208</span>
</code></pre></div><h6 id="_2、获取当前unix时间戳函数-unix-timestamp"><a href="#_2、获取当前unix时间戳函数-unix-timestamp" class="header-anchor">#</a> 2、获取当前UNIX时间戳函数: unix_timestamp</h6> <ul><li><strong>语法</strong>: <code>unix_timestamp()</code></li> <li><strong>返回值</strong>: <code>bigint</code></li> <li><strong>说明</strong>: 获得当前时区的<code>UNIX</code>时间戳</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> unix_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">1323309615</span>
</code></pre></div><h6 id="_3、日期转unix时间戳函数-unix-timestamp"><a href="#_3、日期转unix时间戳函数-unix-timestamp" class="header-anchor">#</a> 3、日期转UNIX时间戳函数: unix_timestamp</h6> <ul><li><strong>语法</strong>: unix_timestamp(string date)</li> <li><strong>返回值</strong>: <code>bigint</code></li> <li><strong>说明</strong>: 转换格式为&quot;yyyy-MM-dd HH:mm:ss&quot;的日期到<code>UNIX</code>时间戳。如果转化失败，则返回<code>0</code>。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> unix_timestamp<span class="token punctuation">(</span><span class="token string">'2011-12-07 13:01:03'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">1323234063</span>
</code></pre></div><h6 id="_4、指定格式日期转unix时间戳函数-unix-timestamp"><a href="#_4、指定格式日期转unix时间戳函数-unix-timestamp" class="header-anchor">#</a> 4、指定格式日期转UNIX时间戳函数: unix_timestamp</h6> <ul><li><strong>语法</strong>: unix_timestamp(string date, string pattern)</li> <li><strong>返回值</strong>: <code>bigint</code></li> <li><strong>说明</strong>: 转换<code>pattern</code>格式的日期到<code>UNIX</code>时间戳。如果转化失败，则返回<code>0</code>。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> unix_timestamp<span class="token punctuation">(</span><span class="token string">'20111207 13:01:03'</span><span class="token punctuation">,</span><span class="token string">'yyyyMMdd HH:mm:ss'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">1323234063</span>
</code></pre></div><h6 id="_5、日期时间转日期函数-to-date"><a href="#_5、日期时间转日期函数-to-date" class="header-anchor">#</a> 5、日期时间转日期函数: to_date</h6> <ul><li><strong>语法</strong>: to_date(string datetime)</li> <li><strong>返回值</strong>: <code>string</code></li> <li><strong>说明</strong>: 返回日期时间字段中的日期部分。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> to_date<span class="token punctuation">(</span><span class="token string">'2011-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">2011</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">08</span>
</code></pre></div><h6 id="_6、日期转年函数-year"><a href="#_6、日期转年函数-year" class="header-anchor">#</a> 6、日期转年函数: year</h6> <ul><li><strong>语法</strong>: year(string date)</li> <li><strong>返回值</strong>: <code>int</code></li> <li><strong>说明</strong>: 返回日期中的年。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">year</span><span class="token punctuation">(</span><span class="token string">'2011-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">2011</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">year</span><span class="token punctuation">(</span><span class="token string">'2012-12-08'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">2012</span>
</code></pre></div><h6 id="_7、日期转月函数-month"><a href="#_7、日期转月函数-month" class="header-anchor">#</a> 7、日期转月函数: month</h6> <ul><li><strong>语法</strong>: month (string date)</li> <li><strong>返回值</strong>: <code>int</code></li> <li><strong>说明</strong>: 返回<code>date</code>或<code>datetime</code>中的月份。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">month</span><span class="token punctuation">(</span><span class="token string">'2011-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">12</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">month</span><span class="token punctuation">(</span><span class="token string">'2011-08-08'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">8</span>
</code></pre></div><h6 id="_8、日期转天函数-day"><a href="#_8、日期转天函数-day" class="header-anchor">#</a> 8、日期转天函数: day</h6> <ul><li><strong>语法</strong>: day (string date)</li> <li><strong>返回值</strong>: <code>int</code></li> <li><strong>说明</strong>: 返回日期中的天。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">day</span><span class="token punctuation">(</span><span class="token string">'2011-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">8</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">day</span><span class="token punctuation">(</span><span class="token string">'2011-12-24'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">24</span>
</code></pre></div><h6 id="_9、日期转小时函数-hour"><a href="#_9、日期转小时函数-hour" class="header-anchor">#</a> 9、日期转小时函数: hour</h6> <ul><li><strong>语法</strong>: hour (string date)</li> <li><strong>返回值</strong>: <code>int</code></li> <li><strong>说明</strong>: 返回日期中的小时。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">hour</span><span class="token punctuation">(</span><span class="token string">'2011-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">10</span>
</code></pre></div><h6 id="_10、日期转分钟函数-minute"><a href="#_10、日期转分钟函数-minute" class="header-anchor">#</a> 10、日期转分钟函数: minute</h6> <ul><li><strong>语法</strong>: minute (string date)</li> <li><strong>返回值</strong>: <code>int</code></li> <li><strong>说明</strong>: 返回日期中的分钟。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">minute</span><span class="token punctuation">(</span><span class="token string">'2011-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">3</span>

<span class="token comment">-- second 返回秒</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">second</span><span class="token punctuation">(</span><span class="token string">'2011-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre></div><h6 id="_12、日期转周函数-weekofyear"><a href="#_12、日期转周函数-weekofyear" class="header-anchor">#</a> 12、日期转周函数: weekofyear</h6> <ul><li><strong>语法</strong>: weekofyear (string date)</li> <li><strong>返回值</strong>: <code>int</code></li> <li><strong>说明</strong>: 返回日期在当前的周数。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> weekofyear<span class="token punctuation">(</span><span class="token string">'2011-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">49</span>
</code></pre></div><h6 id="_13、日期比较函数-datediff"><a href="#_13、日期比较函数-datediff" class="header-anchor">#</a> 13、日期比较函数: datediff</h6> <ul><li><strong>语法</strong>: datediff(string enddate, string startdate)</li> <li><strong>返回值</strong>: <code>int</code></li> <li><strong>说明</strong>: 返回结束日期减去开始日期的天数。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> datediff<span class="token punctuation">(</span><span class="token string">'2012-12-08'</span><span class="token punctuation">,</span><span class="token string">'2012-05-09'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">213</span>
</code></pre></div><h6 id="_14、日期增加函数-date-add"><a href="#_14、日期增加函数-date-add" class="header-anchor">#</a> 14、日期增加函数: date_add</h6> <ul><li><strong>语法</strong>: date_add(string startdate, int days)</li> <li><strong>返回值</strong>: <code>string</code></li> <li><strong>说明</strong>: 返回开始日期startdate增加days天后的日期。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> date_add<span class="token punctuation">(</span><span class="token string">'2012-12-08'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">2012</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">18</span>
</code></pre></div><h6 id="_15、日期减少函数-date-sub"><a href="#_15、日期减少函数-date-sub" class="header-anchor">#</a> 15、日期减少函数: date_sub</h6> <ul><li><strong>语法</strong>: date_sub (string startdate, int days)</li> <li><strong>返回值</strong>: <code>string</code></li> <li><strong>说明</strong>: 返回开始日期<code>startdate</code>减少<code>days</code>天后的日期。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> date_sub<span class="token punctuation">(</span><span class="token string">'2012-12-08'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">2012</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">28</span>
</code></pre></div><h4 id="条件函数-重点"><a href="#条件函数-重点" class="header-anchor">#</a> 条件函数（重点）</h4> <h6 id="_1、if函数-if"><a href="#_1、if函数-if" class="header-anchor">#</a> 1、If函数: if</h6> <ul><li><strong>语法</strong>: if(boolean testCondition, T valueTrue, T valueFalseOrNull)</li> <li><strong>返回值</strong>: <code>T</code></li> <li><strong>说明</strong>: 当条件<code>testCondition</code>为<code>TRUE</code>时，返回<code>valueTrue</code>；否则返回<code>valueFalseOrNull</code></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">200</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">100</span>
</code></pre></div><h6 id="_2、非空查找函数-coalesce"><a href="#_2、非空查找函数-coalesce" class="header-anchor">#</a> 2、非空查找函数: COALESCE</h6> <ul><li><strong>语法</strong>: COALESCE(T v1, T v2, …)</li> <li><strong>返回值</strong>: T</li> <li><strong>说明</strong>: 返回参数中的第一个非空值；如果所有值都为<code>NULL</code>，那么返回<code>NULL</code></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">'100'</span><span class="token punctuation">,</span><span class="token string">'50'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">100</span>
</code></pre></div><h6 id="_3、条件判断函数-case"><a href="#_3、条件判断函数-case" class="header-anchor">#</a> 3、条件判断函数：CASE</h6> <ul><li><strong>语法</strong>: CASE a WHEN b THEN c [WHEN d THEN e]* [ELSE f] END</li> <li><strong>返回值</strong>: T</li> <li><strong>说明</strong>：如果a等于b，那么返回c；如果a等于d，那么返回e；否则返回f</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">case</span> <span class="token number">100</span> <span class="token keyword">when</span> <span class="token number">50</span> <span class="token keyword">then</span> <span class="token string">'tom'</span> <span class="token keyword">when</span> <span class="token number">100</span> <span class="token keyword">then</span> <span class="token string">'mary'</span> <span class="token keyword">else</span> <span class="token string">'tim'</span> <span class="token keyword">end</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
mary
hive<span class="token operator">&gt;</span> <span class="token keyword">Select</span> <span class="token keyword">case</span> <span class="token number">200</span> <span class="token keyword">when</span> <span class="token number">50</span> <span class="token keyword">then</span> <span class="token string">'tom'</span> <span class="token keyword">when</span> <span class="token number">100</span> <span class="token keyword">then</span> <span class="token string">'mary'</span> <span class="token keyword">else</span> <span class="token string">'tim'</span> <span class="token keyword">end</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
tim
</code></pre></div><h6 id="_4、条件判断函数-case"><a href="#_4、条件判断函数-case" class="header-anchor">#</a> 4、条件判断函数：CASE</h6> <ul><li><strong>语法</strong>: CASE WHEN a THEN b [WHEN c THEN d]* [ELSE e] END</li> <li><strong>返回值</strong>: T</li> <li><strong>说明</strong>：如果a为TRUE,则返回b；如果c为TRUE，则返回d；否则返回e</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">then</span> <span class="token string">'tom'</span> <span class="token keyword">when</span> <span class="token number">2</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">then</span> <span class="token string">'mary'</span> <span class="token keyword">else</span> <span class="token string">'tim'</span> <span class="token keyword">end</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
mary
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">then</span> <span class="token string">'tom'</span> <span class="token keyword">when</span> <span class="token number">2</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">then</span> <span class="token string">'mary'</span> <span class="token keyword">else</span> <span class="token string">'tim'</span> <span class="token keyword">end</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
tom
</code></pre></div><h4 id="字符串函数"><a href="#字符串函数" class="header-anchor">#</a> 字符串函数</h4> <h6 id="_1、字符串长度函数-length"><a href="#_1、字符串长度函数-length" class="header-anchor">#</a> 1、字符串长度函数：length</h6> <ul><li><strong>语法</strong>: length(string A)</li> <li><strong>返回值</strong>: <code>int</code></li> <li><strong>说明</strong>：返回字符串A的长度</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> length<span class="token punctuation">(</span><span class="token string">'abcedfg'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
</code></pre></div><h6 id="_2、字符串反转函数-reverse"><a href="#_2、字符串反转函数-reverse" class="header-anchor">#</a> 2、字符串反转函数：reverse</h6> <ul><li><strong>语法</strong>: reverse(string A)</li> <li><strong>返回值</strong>: <code>string</code></li> <li><strong>说明</strong>：返回字符串A的反转结果</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> reverse<span class="token punctuation">(</span><span class="token string">'abcedfg'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
gfdecba
</code></pre></div><h6 id="_3、字符串连接函数-concat"><a href="#_3、字符串连接函数-concat" class="header-anchor">#</a> 3、字符串连接函数：concat</h6> <ul><li><strong>语法</strong>: concat(string A, string B…)</li> <li><strong>返回值</strong>: <code>string</code></li> <li><strong>说明</strong>：返回输入字符串连接后的结果，支持任意个输入字符串</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> concat<span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span><span class="token string">'def'</span><span class="token punctuation">,</span><span class="token string">'gh'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
abcdefgh
</code></pre></div><h6 id="_4、字符串连接并指定字符串分隔符-concat-ws"><a href="#_4、字符串连接并指定字符串分隔符-concat-ws" class="header-anchor">#</a> 4、字符串连接并指定字符串分隔符：concat_ws</h6> <ul><li><strong>语法</strong>: concat_ws(string SEP, string A, string B…)</li> <li><strong>返回值</strong>: <code>string</code></li> <li><strong>说明</strong>：返回输入字符串连接后的结果，SEP表示各个字符串间的分隔符</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> concat_ws<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token string">'abc'</span><span class="token punctuation">,</span><span class="token string">'def'</span><span class="token punctuation">,</span><span class="token string">'gh'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
abc<span class="token punctuation">,</span>def<span class="token punctuation">,</span>gh
</code></pre></div><h6 id="_5、字符串截取函数-substr"><a href="#_5、字符串截取函数-substr" class="header-anchor">#</a> 5、字符串截取函数：substr</h6> <ul><li><strong>语法</strong>: substr(string A, int start), substring(string A, int start)</li> <li><strong>返回值</strong>: <code>string</code></li> <li><strong>说明</strong>：返回字符串A从start位置到结尾的字符串,位置索引从1开始。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> substr<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
cde
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> substring<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
cde
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> substr<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>  （和ORACLE相同）
e
</code></pre></div><h6 id="_6、字符串截取函数-substr-substring"><a href="#_6、字符串截取函数-substr-substring" class="header-anchor">#</a> 6、字符串截取函数：substr, substring</h6> <ul><li><strong>语法</strong>: substr(string A, int start, int len),substring(string A, int start, int len)</li> <li><strong>返回值</strong>: string</li> <li><strong>说明</strong>：返回字符串<code>A</code>从<code>start</code>位置开始，长度为<code>len</code>的字符串</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> substr<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
cd
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> substring<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
cd
hive<span class="token operator">&gt;</span><span class="token keyword">select</span> substring<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
cd
</code></pre></div><h6 id="_7、字符串转大写函数-upper-ucase"><a href="#_7、字符串转大写函数-upper-ucase" class="header-anchor">#</a> 7、字符串转大写函数：upper, ucase</h6> <ul><li><strong>语法</strong>: <code>upper(string A) ucase(string A)</code></li> <li><strong>返回值</strong>: <code>string</code></li> <li><strong>说明</strong>：返回字符串<code>A</code>的大写格式</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> upper<span class="token punctuation">(</span><span class="token string">'abSEd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
ABSED
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">ucase</span><span class="token punctuation">(</span><span class="token string">'abSEd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
ABSED
</code></pre></div><h6 id="_8、字符串转小写函数-lower-lcase"><a href="#_8、字符串转小写函数-lower-lcase" class="header-anchor">#</a> 8、字符串转小写函数：lower, lcase</h6> <ul><li><strong>语法</strong>: lower(string A) lcase(string A)</li> <li><strong>返回值</strong>: string</li> <li><strong>说明</strong>：返回字符串<code>A</code>的小写格式</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> lower<span class="token punctuation">(</span><span class="token string">'abSEd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
absed
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">lcase</span><span class="token punctuation">(</span><span class="token string">'abSEd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
absed
</code></pre></div><h6 id="_9、去空格函数-trim"><a href="#_9、去空格函数-trim" class="header-anchor">#</a> 9、去空格函数：trim</h6> <ul><li><strong>语法</strong>: trim(string A)</li> <li><strong>返回值</strong>: string</li> <li><strong>说明</strong>：去除字符串两边的空格</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> trim<span class="token punctuation">(</span><span class="token string">' ab c '</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
ab c
</code></pre></div><h6 id="_10、url解析函数-parse-url"><a href="#_10、url解析函数-parse-url" class="header-anchor">#</a> 10、url解析函数 parse_url</h6> <ul><li><strong>语法</strong>:
parse_url(string urlString, string partToExtract [, string keyToExtract])</li> <li><strong>返回值</strong>: <code>string</code></li> <li><strong>说明</strong>：返回<code>URL</code>中指定的部分。partToExtract的有效值为：HOST, PATH,<code></code>QUERY, REF, PROTOCOL, AUTHORITY, FILE, and USERINFO.</li> <li>HOST:主机
<ul><li>PATH:服务器上某资源的位置,通常有目录/子目录/文件名这样结构组成</li></ul></li> <li>QUERY:查询，用于给动态网页传递参数，可有多个参数，用&quot;&amp;&quot;符号隔开，每个参数的名和值用&quot;=&quot;符号隔开</li> <li>PROTOCOL:URL 的协议部分,返回https或http</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> parse_url<span class="token punctuation">(</span><span class="token string">'https://www.tableName.com/path1/p.php?k1=v1&amp;k2=v2#Ref1'</span><span class="token punctuation">,</span> <span class="token string">'HOST'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> t1<span class="token punctuation">;</span>   <span class="token comment">#HOST必须使用大写</span>
www<span class="token punctuation">.</span>tableName<span class="token punctuation">.</span>com 

<span class="token keyword">select</span> parse_url<span class="token punctuation">(</span><span class="token string">'https://www.tableName.com/path1/p.php?k1=v1&amp;k2=v2#Ref1'</span><span class="token punctuation">,</span> <span class="token string">'QUERY'</span><span class="token punctuation">,</span> <span class="token string">'k1'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> t1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+--+</span>
<span class="token operator">|</span> _c0  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+--+</span>
<span class="token operator">|</span> v1   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+--+</span>

<span class="token keyword">select</span> parse_url<span class="token punctuation">(</span><span class="token string">'https://www.tableName.com/path1/p.php?k1=v1&amp;k2=v2#Ref1'</span><span class="token punctuation">,</span><span class="token string">'REF'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> t1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--+</span>
<span class="token operator">|</span>  _c0  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--+</span>
<span class="token operator">|</span> Ref1  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--+</span>

<span class="token keyword">select</span> parse_url<span class="token punctuation">(</span><span class="token string">'https://www.tableName.com/path1/p.php?k1=v1&amp;k2=v2#Ref1'</span><span class="token punctuation">,</span><span class="token string">'PROTOCOL'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> t1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+--+</span>
<span class="token operator">|</span>  _c0   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+--+</span>
<span class="token operator">|</span> https  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+--+</span>

<span class="token keyword">select</span> parse_url<span class="token punctuation">(</span><span class="token string">'https://www.tableName.com/path1/p.php?k1=v1&amp;k2=v2#Ref1'</span><span class="token punctuation">,</span><span class="token string">'FILE'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> t1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------+--+</span>
<span class="token operator">|</span>            _c0            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+--+</span>
<span class="token operator">|</span> <span class="token operator">/</span>path1<span class="token operator">/</span>p<span class="token punctuation">.</span>php?k1<span class="token operator">=</span>v1<span class="token operator">&amp;</span>k2<span class="token operator">=</span>v2  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+--+</span>
</code></pre></div><h6 id="_11、json解析-get-json-object"><a href="#_11、json解析-get-json-object" class="header-anchor">#</a> 11、json解析  get_json_object</h6> <ul><li><strong>语法</strong>: <code>get_json_object(string json_string, string path)</code></li> <li><strong>返回值</strong>: <code>string</code></li> <li><strong>说明</strong>：解析<code>json</code>的字符串<code>json_string</code>,返回<code>path</code>指定的内容。如果输入的<code>json</code>字符串无效，那么返回<code>NULL</code>。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span>  get_json_object<span class="token punctuation">(</span><span class="token string">'{&quot;store&quot;:{&quot;fruit&quot;:\[{&quot;weight&quot;:8,&quot;type&quot;:&quot;apple&quot;},{&quot;weight&quot;:9,&quot;type&quot;:&quot;pear&quot;}], &quot;bicycle&quot;:{&quot;price&quot;:19.95,&quot;color&quot;:&quot;red&quot;} },&quot;email&quot;:&quot;amy@only_for_json_udf_test.net&quot;,&quot;owner&quot;:&quot;amy&quot;}'</span><span class="token punctuation">,</span><span class="token string">'$.owner'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> t1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+--+</span>
<span class="token operator">|</span> _c0  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+--+</span>
<span class="token operator">|</span> amy  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+--+</span>
</code></pre></div><p><img src="/assets/img/Image201912171428.4d79be81.png" alt=""></p> <h6 id="_12、重复字符串函数-repeat"><a href="#_12、重复字符串函数-repeat" class="header-anchor">#</a> 12、重复字符串函数：repeat</h6> <ul><li><strong>语法</strong>: <code>repeat(string str, int n)</code></li> <li><strong>返回值</strong>: <code>string</code></li> <li><strong>说明</strong>：返回重复<code>n</code>次后的<code>str</code>字符串</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">repeat</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
abcabcabcabcabc
</code></pre></div><h6 id="_13、分割字符串函数-split"><a href="#_13、分割字符串函数-split" class="header-anchor">#</a> 13、分割字符串函数: split</h6> <ul><li><strong>语法</strong>: <code>split(string str, string pat)</code></li> <li><strong>返回值</strong>: <code>array</code></li> <li><strong>说明</strong>: 按照<code>pat</code>字符串分割<code>str</code>，会返回分割后的字符串数组</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> split<span class="token punctuation">(</span><span class="token string">'abtcdtef'</span><span class="token punctuation">,</span><span class="token string">'t'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">&quot;ab&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;cd&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ef&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h4 id="集合统计函数"><a href="#集合统计函数" class="header-anchor">#</a> 集合统计函数</h4> <h6 id="_1、个数统计函数-count"><a href="#_1、个数统计函数-count" class="header-anchor">#</a> 1、个数统计函数: count</h6> <ul><li><strong>语法</strong>: count(*), count(expr), count(DISTINCT expr[, expr_.])</li> <li><strong>返回值</strong>：<code>Int</code></li> <li><strong>说明</strong>: count(*)统计检索出的行的个数，包括NULL值的行；count(expr)返回指定字段的非空值的个数；count(DISTINCT expr[, expr_.])返回指定字段的不同的非空值的个数</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">20</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> t<span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">10</span>
</code></pre></div><h6 id="_2、总和统计函数-sum"><a href="#_2、总和统计函数-sum" class="header-anchor">#</a> 2、总和统计函数: sum</h6> <ul><li><strong>语法</strong>: <code>sum(col), sum(DISTINCT col)</code></li> <li><strong>返回值</strong>: <code>double</code></li> <li><strong>说明</strong>: <code>sum(col)</code>统计结果集中<code>col</code>的相加的结果；<code>sum(DISTINCT col)</code>统计结果中col不同值相加的结果</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">100</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> t<span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">70</span>
</code></pre></div><h6 id="_3、平均值统计函数-avg"><a href="#_3、平均值统计函数-avg" class="header-anchor">#</a> 3、平均值统计函数: avg</h6> <ul><li><strong>语法</strong>: <code>avg(col), avg(DISTINCT col)</code></li> <li><strong>返回值</strong>: <code>double</code></li> <li><strong>说明</strong>: <code>avg(col)</code>统计结果集中<code>col</code>的平均值；<code>avg(DISTINCT col)</code>统计结果中<code>col</code>不同值相加的平均值</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">50</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">avg</span> <span class="token punctuation">(</span><span class="token keyword">distinct</span> t<span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">30</span>
</code></pre></div><h6 id="_4、最小值统计函数-min"><a href="#_4、最小值统计函数-min" class="header-anchor">#</a> 4、最小值统计函数: min</h6> <ul><li><strong>语法</strong>: <code>min(col)</code></li> <li><strong>返回值</strong>: <code>double</code></li> <li><strong>说明</strong>: 统计结果集中<code>col</code>字段的最小值</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">20</span>
</code></pre></div><h6 id="_5、最大值统计函数-max"><a href="#_5、最大值统计函数-max" class="header-anchor">#</a> 5、最大值统计函数: max</h6> <ul><li><strong>语法</strong>: <code>max(col)</code></li> <li><strong>返回值</strong>: <code>double</code></li> <li><strong>说明</strong>: 统计结果集中<code>col</code>字段的最大值</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">120</span>
</code></pre></div><h4 id="复合类型构建函数"><a href="#复合类型构建函数" class="header-anchor">#</a> 复合类型构建函数</h4> <h6 id="_1、map类型构建-map"><a href="#_1、map类型构建-map" class="header-anchor">#</a> 1、Map类型构建: map</h6> <ul><li><strong>语法</strong>: map (key1, value1, key2, value2, …)</li> <li><strong>说明</strong>：根据输入的<code>key</code>和<code>value</code>对构建map类型</li> <li>collection items terminated by ',' 表示键值对与键值对之间使用','进行分隔。</li> <li>map keys terminated by ':' 表示key与value间使用':'进行分隔。</li> <li>构建map数据类型的语法：字段名 <code>map&lt;string, int&gt;</code></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 建表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> score_map<span class="token punctuation">(</span>name string<span class="token punctuation">,</span> score map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span> 
collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span> 
map <span class="token keyword">keys</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">':'</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建数据内容如下并加载数据</span>
cd <span class="token operator">/</span>kkb<span class="token operator">/</span>install<span class="token operator">/</span>hivedatas<span class="token operator">/</span>
vim score_map<span class="token punctuation">.</span>txt

zhangsan	数学:<span class="token number">80</span><span class="token punctuation">,</span>语文:<span class="token number">89</span><span class="token punctuation">,</span>英语:<span class="token number">95</span>
lisi	语文:<span class="token number">60</span><span class="token punctuation">,</span>数学:<span class="token number">80</span><span class="token punctuation">,</span>英语:<span class="token number">99</span>

<span class="token comment">-- 加载数据到hive表当中去</span>
<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/score_map.txt'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> score_map<span class="token punctuation">;</span>

<span class="token comment">-- map结构数据访问：</span>
<span class="token comment">-- 获取所有的value：</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>map_values<span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">from</span> score_map<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------+--+</span>
<span class="token operator">|</span>   name    <span class="token operator">|</span>     _c1     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------+--+</span>
<span class="token operator">|</span> zhangsan  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">89</span><span class="token punctuation">,</span><span class="token number">95</span><span class="token punctuation">]</span>  <span class="token operator">|</span>
<span class="token operator">|</span> lisi      <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">]</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------+--+</span>

<span class="token comment">-- 获取所有的key：</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>map_keys<span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">from</span> score_map<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------------+--+</span>
<span class="token operator">|</span>   name    <span class="token operator">|</span>        _c1        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------------+--+</span>
<span class="token operator">|</span> zhangsan  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;数学&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;语文&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;英语&quot;</span><span class="token punctuation">]</span>  <span class="token operator">|</span>
<span class="token operator">|</span> lisi      <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;语文&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;数学&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;英语&quot;</span><span class="token punctuation">]</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------------+--+</span>

<span class="token comment">-- 按照key来进行获取value值</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>score<span class="token punctuation">[</span><span class="token string">&quot;数学&quot;</span><span class="token punctuation">]</span>  <span class="token keyword">from</span> score_map<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+------+--+</span>
<span class="token operator">|</span>   name    <span class="token operator">|</span> _c1  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------+--+</span>
<span class="token operator">|</span> zhangsan  <span class="token operator">|</span> <span class="token number">80</span>   <span class="token operator">|</span>
<span class="token operator">|</span> lisi      <span class="token operator">|</span> <span class="token number">80</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------+--+</span>

<span class="token comment">-- 查看map元素个数（键值对个数）</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>size<span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">from</span> score_map<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+------+--+</span>
<span class="token operator">|</span>   name    <span class="token operator">|</span> _c1  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------+--+</span>
<span class="token operator">|</span> zhangsan  <span class="token operator">|</span> <span class="token number">3</span>    <span class="token operator">|</span>
<span class="token operator">|</span> lisi      <span class="token operator">|</span> <span class="token number">3</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------+--+</span>

<span class="token comment">-- 构建一个map</span>
<span class="token keyword">select</span> map<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'zs'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'lisi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+--+</span>
<span class="token operator">|</span>        _c0         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+--+</span>
<span class="token operator">|</span> {<span class="token number">1</span>:<span class="token string">&quot;zs&quot;</span><span class="token punctuation">,</span><span class="token number">2</span>:<span class="token string">&quot;lisi&quot;</span>}  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+--+</span>
</code></pre></div><h6 id="_2、struct类型构建-struct"><a href="#_2、struct类型构建-struct" class="header-anchor">#</a> 2、Struct类型构建: struct</h6> <ul><li><strong>语法</strong>: struct(val1, val2, val3, …)</li> <li><strong>说明</strong>：根据输入的参数构建结构体struct类型，似于C语言中的结构体，内部数据通过X.X来获取，假设我</li> <li>数据格式是这样的，电影ABC，有1254人评价过，打分为7.4分</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 创建struct表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> movie_score<span class="token punctuation">(</span>name string<span class="token punctuation">,</span> info struct<span class="token operator">&lt;</span>number:<span class="token keyword">int</span><span class="token punctuation">,</span>score:<span class="token keyword">float</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;\t&quot;</span>  
collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">;</span> 

<span class="token comment">-- 加载数据</span>
cd <span class="token operator">/</span>kkb<span class="token operator">/</span>install<span class="token operator">/</span>hivedatas<span class="token operator">/</span>
vim struct<span class="token punctuation">.</span>txt

<span class="token comment">-- 电影ABC，有1254人评价过，打分为7.4分</span>
ABC	<span class="token number">1254</span>:<span class="token number">7.4</span>  
DEF	<span class="token number">256</span>:<span class="token number">4.9</span>  
XYZ	<span class="token number">456</span>:<span class="token number">5.4</span>

<span class="token comment">-- 加载数据</span>
<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/struct.txt'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> movie_score<span class="token punctuation">;</span>

<span class="token comment">-- hive当中查询数据</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> movie_score<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------------+------------------------------+--+</span>
<span class="token operator">|</span> movie_score<span class="token punctuation">.</span>name  <span class="token operator">|</span>       movie_score<span class="token punctuation">.</span>info       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+------------------------------+--+</span>
<span class="token operator">|</span> ABC               <span class="token operator">|</span> {<span class="token string">&quot;number&quot;</span>:<span class="token number">1254</span><span class="token punctuation">,</span><span class="token string">&quot;score&quot;</span>:<span class="token number">7.4</span>}  <span class="token operator">|</span>
<span class="token operator">|</span> DEF               <span class="token operator">|</span> {<span class="token string">&quot;number&quot;</span>:<span class="token number">256</span><span class="token punctuation">,</span><span class="token string">&quot;score&quot;</span>:<span class="token number">4.9</span>}   <span class="token operator">|</span>
<span class="token operator">|</span> XYZ               <span class="token operator">|</span> {<span class="token string">&quot;number&quot;</span>:<span class="token number">456</span><span class="token punctuation">,</span><span class="token string">&quot;score&quot;</span>:<span class="token number">5.4</span>}   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+------------------------------+--+</span>


<span class="token keyword">select</span> info<span class="token punctuation">.</span>number<span class="token punctuation">,</span><span class="token function">round</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>score<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> movie_score<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+--------------------+--+</span>
<span class="token operator">|</span> number  <span class="token operator">|</span>        _c1         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+--------------------+--+</span>
<span class="token operator">|</span> <span class="token number">1254</span>    <span class="token operator">|</span> <span class="token number">7.400000095367432</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">256</span>     <span class="token operator">|</span> <span class="token number">4.900000095367432</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">456</span>     <span class="token operator">|</span> <span class="token number">5.400000095367432</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+--------------------+--+</span>

<span class="token comment">-- 构建一个struct</span>
<span class="token keyword">select</span> struct<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'anzhulababy'</span><span class="token punctuation">,</span> <span class="token string">'moon'</span><span class="token punctuation">,</span> <span class="token number">1.68</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+--+</span>
<span class="token operator">|</span>                        _c0                         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+--+</span>
<span class="token operator">|</span> {<span class="token string">&quot;col1&quot;</span>:<span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;col2&quot;</span>:<span class="token string">&quot;anzhulababy&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;col3&quot;</span>:<span class="token string">&quot;moon&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;col4&quot;</span>:<span class="token number">1.68</span>} <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+--+</span>
</code></pre></div><h6 id="_3、-构建-array"><a href="#_3、-构建-array" class="header-anchor">#</a> 3、```构建: array</h6> <ul><li><strong>语法</strong>: array(val1, val2, …)</li> <li><strong>说明</strong>：根据输入的参数构建array数组类型</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> person<span class="token punctuation">(</span>name string<span class="token punctuation">,</span> work_locations array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\t'</span>
COLLECTION ITEMS <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span><span class="token punctuation">;</span>

<span class="token comment">-- 加载数据到person表当中去</span>
cd <span class="token operator">/</span>kkb<span class="token operator">/</span>install<span class="token operator">/</span>hivedatas<span class="token operator">/</span>
vim person<span class="token punctuation">.</span>txt

<span class="token comment">-- 数据内容格式如下</span>
biansutao	beijing<span class="token punctuation">,</span>shanghai<span class="token punctuation">,</span>tianjin<span class="token punctuation">,</span>hangzhou
linan	changchun<span class="token punctuation">,</span>chengdu<span class="token punctuation">,</span>wuhan

<span class="token comment">-- 加载数据</span>
hive <span class="token operator">&gt;</span> <span class="token keyword">load</span>  <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/person.txt'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> person<span class="token punctuation">;</span>

<span class="token comment">-- 查询所有数据数据</span>
hive <span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> person<span class="token punctuation">;</span>

<span class="token comment">-- 按照下表索引进行查询</span>
hive <span class="token operator">&gt;</span> <span class="token keyword">select</span> work_locations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">from</span> person<span class="token punctuation">;</span>

<span class="token comment">-- 查询所有集合数据</span>
hive  <span class="token operator">&gt;</span> <span class="token keyword">select</span> work_locations <span class="token keyword">from</span> person<span class="token punctuation">;</span> 

<span class="token comment">-- 查询元素个数</span>
hive <span class="token operator">&gt;</span>  <span class="token keyword">select</span> size<span class="token punctuation">(</span>work_locations<span class="token punctuation">)</span> <span class="token keyword">from</span> person<span class="token punctuation">;</span>   

<span class="token comment">-- 构建array</span>
<span class="token keyword">select</span> array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="复合类型长度统计函数"><a href="#复合类型长度统计函数" class="header-anchor">#</a> 复合类型长度统计函数</h4> <h6 id="_1、map类型长度函数-size-map-k-v"><a href="#_1、map类型长度函数-size-map-k-v" class="header-anchor">#</a> 1、Map类型长度函数: <code>size(Map&lt;k .V&gt;)</code></h6> <ul><li><strong>语法</strong>: <code>size(Map&lt;k .V&gt;)</code></li> <li><strong>返回值</strong>: int</li> <li><strong>说明</strong>: 返回map类型的长度</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> size<span class="token punctuation">(</span>map<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'zs'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'anzhulababy'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">2</span>
</code></pre></div><h6 id="_2、-长度函数-size-array-t"><a href="#_2、-长度函数-size-array-t" class="header-anchor">#</a> 2、```长度函数: <code>size(Array&lt;T&gt;)</code></h6> <ul><li><strong>语法</strong>: <code>size(Array&lt;T&gt;)</code></li> <li><strong>返回值</strong>: int</li> <li><strong>说明</strong>: 返回```的长度</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> size<span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">from</span> arr_table2<span class="token punctuation">;</span>
<span class="token number">4</span>
</code></pre></div><h6 id="_3、类型转换函数"><a href="#_3、类型转换函数" class="header-anchor">#</a> 3、类型转换函数</h6> <ul><li><strong>类型转换函数</strong>: cast</li> <li><strong>语法</strong>: <code>cast(expr as &lt;type&gt;)</code></li> <li><strong>返回值</strong>: Expected &quot;=&quot; to follow &quot;type&quot;</li> <li><strong>说明</strong>: 返回转换后的数据类型</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> cast<span class="token punctuation">(</span><span class="token string">'1'</span> <span class="token keyword">as</span> <span class="token keyword">bigint</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre></div><h4 id="行转列案例"><a href="#行转列案例" class="header-anchor">#</a> 行转列案例</h4> <p>行转列：一行的某些字段进行组合等，形成了新的列。</p> <h6 id="_1、相关函数说明"><a href="#_1、相关函数说明" class="header-anchor">#</a> 1、相关函数说明</h6> <ul><li><p>CONCAT(string A/col, string B/col…)：返回输入字符串连接后的结果，支持任意个输入字符串;</p></li> <li><p>CONCAT_WS(separator, str1, str2,...)：它是一个特殊形式的 CONCAT()。</p> <ul><li>第一个参数剩余参数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是 NULL，返回值也将为 NULL。</li> <li>这个函数会跳过分隔符参数后的任何 NULL 和空字符串。分隔符将被加到被连接的字符串之间;</li></ul></li> <li><p>COLLECT_SET(col)：函数只接受基本数据类型，它的主要作用是将某字段的值进行去重汇总，产生<strong>array</strong>类型字段。</p></li></ul> <h6 id="_2、数据准备"><a href="#_2、数据准备" class="header-anchor">#</a> 2、数据准备</h6> <ul><li>数据准备</li></ul> <table><thead><tr><th>name</th> <th>constellation</th> <th>blood_type</th></tr></thead> <tbody><tr><td>孙悟空</td> <td>白羊座</td> <td>A</td></tr> <tr><td>老王</td> <td>射手座</td> <td>A</td></tr> <tr><td>宋宋</td> <td>白羊座</td> <td>B</td></tr> <tr><td>猪八戒</td> <td>白羊座</td> <td>A</td></tr> <tr><td>按住啦baby</td> <td>射手座</td> <td>A</td></tr></tbody></table> <h6 id="_3、需求"><a href="#_3、需求" class="header-anchor">#</a> 3、需求</h6> <p>把星座和血型一样的人归类到一起。结果如下：</p> <div class="language- extra-class"><pre class="language-text"><code>射手座,A            老王|凤姐
白羊座,A            孙悟空|猪八戒
白羊座,B            宋宋
</code></pre></div><h6 id="_4、创建表数据文件"><a href="#_4、创建表数据文件" class="header-anchor">#</a> 4、创建表数据文件</h6> <p>node03服务器执行以下命令创建文件，注意数据使用\t进行分割</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hivedatas
<span class="token function">vim</span> constellation.txt
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>孙悟空	白羊座	A
老王	射手座	A
宋宋	白羊座	B       
猪八戒	白羊座	A
凤姐	射手座	A
</code></pre></div><h6 id="_5、创建hive表并导入数据"><a href="#_5、创建hive表并导入数据" class="header-anchor">#</a> 5、创建hive表并导入数据</h6> <ul><li>创建hive表并加载数据</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> person_info<span class="token punctuation">(</span>name string<span class="token punctuation">,</span> constellation string<span class="token punctuation">,</span>  blood_type string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;\t&quot;</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>加载数据</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/constellation.txt'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> person_info<span class="token punctuation">;</span>
</code></pre></div><h6 id="_6、按需求查询数据"><a href="#_6、按需求查询数据" class="header-anchor">#</a> 6、按需求查询数据</h6> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#查询的需求如下：</span>
射手座<span class="token punctuation">,</span>A            老王<span class="token operator">|</span>凤姐
白羊座<span class="token punctuation">,</span>A            孙悟空<span class="token operator">|</span>猪八戒
白羊座<span class="token punctuation">,</span>B            宋宋


<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> person_info<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------------+----------------------------+-------------------------+--+</span>
<span class="token operator">|</span> person_info<span class="token punctuation">.</span>name  <span class="token operator">|</span> person_info<span class="token punctuation">.</span>constellation  <span class="token operator">|</span> person_info<span class="token punctuation">.</span>blood_type  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+----------------------------+-------------------------+--+</span>
<span class="token operator">|</span> 孙悟空               <span class="token operator">|</span> 白羊座                        <span class="token operator">|</span> A                       <span class="token operator">|</span>
<span class="token operator">|</span> 老王                <span class="token operator">|</span> 射手座                        <span class="token operator">|</span> A                       <span class="token operator">|</span>
<span class="token operator">|</span> 宋宋                <span class="token operator">|</span> 白羊座                        <span class="token operator">|</span> B                       <span class="token operator">|</span>
<span class="token operator">|</span> 猪八戒               <span class="token operator">|</span> 白羊座                        <span class="token operator">|</span> A                       <span class="token operator">|</span>
<span class="token operator">|</span> 凤姐                <span class="token operator">|</span> 射手座                        <span class="token operator">|</span> A                       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+----------------------------+-------------------------+--+</span>

<span class="token keyword">select</span> p<span class="token punctuation">.</span>name<span class="token punctuation">,</span>concat<span class="token punctuation">(</span>p<span class="token punctuation">.</span>constellation<span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">,</span>p<span class="token punctuation">.</span>blood_type<span class="token punctuation">)</span> c2 <span class="token keyword">from</span> person_info p<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+---------------+--+</span>
<span class="token operator">|</span> p<span class="token punctuation">.</span>name  <span class="token operator">|</span>      c2       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+---------------+--+</span>
<span class="token operator">|</span> 孙悟空     <span class="token operator">|</span> 白羊座<span class="token punctuation">,</span>A         <span class="token operator">|</span>
<span class="token operator">|</span> 老王      <span class="token operator">|</span> 射手座<span class="token punctuation">,</span>A         <span class="token operator">|</span>
<span class="token operator">|</span> 宋宋      <span class="token operator">|</span> 白羊座<span class="token punctuation">,</span>B         <span class="token operator">|</span>
<span class="token operator">|</span> 猪八戒     <span class="token operator">|</span> 白羊座<span class="token punctuation">,</span>A         <span class="token operator">|</span>
<span class="token operator">|</span> 凤姐      <span class="token operator">|</span> 射手座<span class="token punctuation">,</span>A         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+---------------+--+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.154</span> seconds<span class="token punctuation">)</span>
<span class="token comment">## 将上面的查询语句作为子查询的语句</span>

<span class="token keyword">select</span> p<span class="token punctuation">.</span>c2<span class="token punctuation">,</span>concat_ws<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span>collect_set<span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> names <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> name<span class="token punctuation">,</span>concat<span class="token punctuation">(</span>constellation<span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">,</span>blood_type<span class="token punctuation">)</span> c2 <span class="token keyword">from</span> person_info<span class="token punctuation">)</span> p 
<span class="token keyword">group</span> <span class="token keyword">by</span> p<span class="token punctuation">.</span>c2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+----------+--+</span>
<span class="token operator">|</span>     p<span class="token punctuation">.</span>c2      <span class="token operator">|</span>  names   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+----------+--+</span>
<span class="token operator">|</span> 射手座<span class="token punctuation">,</span>A         <span class="token operator">|</span> 老王<span class="token operator">|</span>凤姐    <span class="token operator">|</span>
<span class="token operator">|</span> 白羊座<span class="token punctuation">,</span>A         <span class="token operator">|</span> 孙悟空<span class="token operator">|</span>猪八戒  <span class="token operator">|</span>
<span class="token operator">|</span> 白羊座<span class="token punctuation">,</span>B         <span class="token operator">|</span> 宋宋       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+----------+--+</span>

<span class="token comment">#一定一定一定不要写成以下这样!!!!!</span>
<span class="token comment">#select p.c2,concat_ws('|',collect_set(p.name)) names from (select p.name,concat(p.constellation,',',p.blood_type) c2 from person_info) p group by p.c2;</span>

<span class="token comment">#是错误的语法： select p.name,concat(p.constellation,',',p.blood_type) c2 from person_info</span>

<span class="token comment">#子查询要用括号()括起来！！！！！</span>

</code></pre></div><h4 id="explode函数"><a href="#explode函数" class="header-anchor">#</a> explode函数</h4> <h5 id="案例1-使用explode拆分map和array字段数据"><a href="#案例1-使用explode拆分map和array字段数据" class="header-anchor">#</a> 案例1：使用explode拆分Map和Array字段数据</h5> <p>explode可以用于将hive一列中复杂的array或者map结构拆分成多行</p> <p>####### 案例需求</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">## 现在有数据格式如下,字段之间使用\t分割</span>
zhangsan	child1,child2,child3,child4	k1:v1,k2:v2
lisi	child5,child6,child7,child8	 k3:v3,k4:v4
</code></pre></div><p>需求如下：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 将所有的child进行拆开成为一列</span>
<span class="token operator">+</span><span class="token comment">----------+--+</span>
<span class="token operator">|</span> mychild  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--+</span>
<span class="token operator">|</span> child1   <span class="token operator">|</span>
<span class="token operator">|</span> child2   <span class="token operator">|</span>
<span class="token operator">|</span> child3   <span class="token operator">|</span>
<span class="token operator">|</span> child4   <span class="token operator">|</span>
<span class="token operator">|</span> child5   <span class="token operator">|</span>
<span class="token operator">|</span> child6   <span class="token operator">|</span>
<span class="token operator">|</span> child7   <span class="token operator">|</span>
<span class="token operator">|</span> child8   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--+</span>

<span class="token comment">-- 将map的key和value也进行拆开，成为如下结果</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------+--+</span>
<span class="token operator">|</span> mymapkey  <span class="token operator">|</span> mymapvalue  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------+--+</span>
<span class="token operator">|</span> k1        <span class="token operator">|</span> v1          <span class="token operator">|</span>
<span class="token operator">|</span> k2        <span class="token operator">|</span> v2          <span class="token operator">|</span>
<span class="token operator">|</span> k3        <span class="token operator">|</span> v3          <span class="token operator">|</span>
<span class="token operator">|</span> k4        <span class="token operator">|</span> v4          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------+--+</span>
</code></pre></div><p>####### 第一步：创建hive表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> explode_t1<span class="token punctuation">(</span>name string<span class="token punctuation">,</span> children array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span> address Map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> string<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span> collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span>  map <span class="token keyword">keys</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">':'</span> stored <span class="token keyword">as</span> textFile<span class="token punctuation">;</span>
</code></pre></div><p>####### 第二步：加载数据</p> <ul><li>node03执行以下命令创建表数据文件</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>cd  <span class="token operator">/</span>kkb<span class="token operator">/</span>install<span class="token operator">/</span>hivedatas<span class="token operator">/</span>

vim maparray

<span class="token comment">-- 数据内容格式如下</span>
zhangsan	child1<span class="token punctuation">,</span>child2<span class="token punctuation">,</span>child3<span class="token punctuation">,</span>child4	k1:v1<span class="token punctuation">,</span>k2:v2
lisi	child5<span class="token punctuation">,</span>child6<span class="token punctuation">,</span>child7<span class="token punctuation">,</span>child8	k3:v3<span class="token punctuation">,</span>k4:v4
</code></pre></div><ul><li>hive表当中加载数据</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/maparray'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> explode_t1<span class="token punctuation">;</span>
</code></pre></div><p>####### 第三步：使用explode将hive当中数据拆开</p> <ul><li>将array当中的数据拆分开</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> explode<span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token keyword">as</span> myChild <span class="token keyword">from</span> explode_t1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+--+</span>
<span class="token operator">|</span> mychild  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--+</span>
<span class="token operator">|</span> child1   <span class="token operator">|</span>
<span class="token operator">|</span> child2   <span class="token operator">|</span>
<span class="token operator">|</span> child3   <span class="token operator">|</span>
<span class="token operator">|</span> child4   <span class="token operator">|</span>
<span class="token operator">|</span> child5   <span class="token operator">|</span>
<span class="token operator">|</span> child6   <span class="token operator">|</span>
<span class="token operator">|</span> child7   <span class="token operator">|</span>
<span class="token operator">|</span> child8   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--+</span>
</code></pre></div><ul><li>将map当中的数据拆分开</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> explode<span class="token punctuation">(</span>address<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>myMapKey<span class="token punctuation">,</span> myMapValue<span class="token punctuation">)</span> <span class="token keyword">from</span> explode_t1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------+--+</span>
<span class="token operator">|</span> mymapkey  <span class="token operator">|</span> mymapvalue  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------+--+</span>
<span class="token operator">|</span> k1        <span class="token operator">|</span> v1          <span class="token operator">|</span>
<span class="token operator">|</span> k2        <span class="token operator">|</span> v2          <span class="token operator">|</span>
<span class="token operator">|</span> k3        <span class="token operator">|</span> v3          <span class="token operator">|</span>
<span class="token operator">|</span> k4        <span class="token operator">|</span> v4          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------+--+</span>
</code></pre></div><h5 id="案例2-使用explode拆分json字符串"><a href="#案例2-使用explode拆分json字符串" class="header-anchor">#</a> 案例2：使用explode拆分json字符串</h5> <ul><li>需求：现在有一些数据格式如下：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>a:shandong,b:beijing,c:hebei|1,2,3,4,5,6,7,8,9|[{&quot;source&quot;:&quot;7fresh&quot;,&quot;monthSales&quot;:4900,&quot;userCount&quot;:1900,&quot;score&quot;:&quot;9.9&quot;},{&quot;source&quot;:&quot;jd&quot;,&quot;monthSales&quot;:2090,&quot;userCount&quot;:78981,&quot;score&quot;:&quot;9.8&quot;},{&quot;source&quot;:&quot;jdmart&quot;,&quot;monthSales&quot;:6987,&quot;userCount&quot;:1600,&quot;score&quot;:&quot;9.0&quot;}]
</code></pre></div><ul><li><p>其中字段与字段之间的分隔符是 |</p></li> <li><p>我们要解析得到所有的monthSales对应的值为以下这一列（行转列）</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>4900
2090
6987
</code></pre></div><p>####### 第一步：创建hive表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> explode2<span class="token punctuation">(</span>area string<span class="token punctuation">,</span> goods_id string<span class="token punctuation">,</span> sale_info string<span class="token punctuation">)</span> <span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'|'</span> STORED <span class="token keyword">AS</span> textfile<span class="token punctuation">;</span>
</code></pre></div><p>####### 第二步：准备数据并加载数据</p> <ul><li>准备数据如下</li></ul> <div class="language- extra-class"><pre class="language-text"><code>a:shandong,b:beijing,c:hebei|1,2,3,4,5,6,7,8,9|
[{&quot;source&quot;:&quot;7fresh&quot;,&quot;monthSales&quot;:4900},
{&quot;source&quot;:&quot;jd&quot;,&quot;monthSales&quot;:2090},
{&quot;source&quot;:&quot;jdmart&quot;,&quot;monthSales&quot;:6987}]
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hivedatas

<span class="token function">vim</span> explode_json

a:shandong,b:beijing,c:hebei<span class="token operator">|</span><span class="token number">1,2</span>,3,4,5,6,7,8,9<span class="token operator">|</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;source&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;7fresh&quot;</span>,<span class="token string">&quot;monthSales&quot;</span>:4900,<span class="token string">&quot;userCount&quot;</span>:1900,<span class="token string">&quot;score&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;9.9&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;source&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;jd&quot;</span>,<span class="token string">&quot;monthSales&quot;</span>:2090,<span class="token string">&quot;userCount&quot;</span>:78981,<span class="token string">&quot;score&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;9.8&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;source&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;jdmart&quot;</span>,<span class="token string">&quot;monthSales&quot;</span>:6987,<span class="token string">&quot;userCount&quot;</span>:1600,<span class="token string">&quot;score&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;9.0&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><ul><li>加载数据到hive表当中去</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/explode_json'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> explode2<span class="token punctuation">;</span>
</code></pre></div><p>####### 第三步：使用explode拆分Array</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>goods_id<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> goods_id <span class="token keyword">from</span> explode2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+--+</span>
<span class="token operator">|</span> goods_id  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">4</span>         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">5</span>         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">6</span>         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">7</span>         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">8</span>         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">9</span>         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+--+</span>
</code></pre></div><p>####### 第四步：使用explode拆解Map</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>area<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> area <span class="token keyword">from</span> explode2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+--+</span>
<span class="token operator">|</span>    area     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+--+</span>
<span class="token operator">|</span> a:shandong  <span class="token operator">|</span>
<span class="token operator">|</span> b:beijing   <span class="token operator">|</span>
<span class="token operator">|</span> c:hebei     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+--+</span>
</code></pre></div><p>####### 第五步：拆解json字段</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#思路解析：</span>
<span class="token comment">#第一步，使用正则表达式，去除[{子字符串</span>
<span class="token keyword">select</span> regexp_replace<span class="token punctuation">(</span>sale_info<span class="token punctuation">,</span><span class="token string">'\\[\\{'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">from</span> explode2<span class="token punctuation">;</span>

<span class="token comment">#第二步，嵌套正则表达式，去除}]子字符串</span>
<span class="token keyword">select</span> regexp_replace<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>sale_info<span class="token punctuation">,</span><span class="token string">'\\[\\{'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'\\}\\]'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">from</span> explode2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+----------------+</span>
<span class="token operator">|</span>                        _c0                         <span class="token operator">|</span>                <span class="token operator">|</span>   
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+----------------+</span>
<span class="token operator">|</span> <span class="token string">&quot;source&quot;</span>:<span class="token string">&quot;7fresh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;monthSales&quot;</span>:<span class="token number">4900</span><span class="token punctuation">,</span><span class="token string">&quot;userCount&quot;</span>:<span class="token number">1900</span><span class="token punctuation">,</span><span class="token string">&quot;score&quot;</span>:<span class="token string">&quot;9.9&quot;</span>}<span class="token punctuation">,</span><span class="token operator">|</span>   {<span class="token string">&quot;source&quot;</span>:<span class="token string">&quot;jd&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;monthSales&quot;</span>:<span class="token number">2090</span><span class="token punctuation">,</span><span class="token string">&quot;userCount&quot;</span>:<span class="token number">78981</span><span class="token punctuation">,</span><span class="token string">&quot;score&quot;</span>:<span class="token string">&quot;9.8&quot;</span>}<span class="token punctuation">,</span>   {<span class="token string">&quot;source&quot;</span>:<span class="token string">&quot;jdmart&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;monthSales&quot;</span>:<span class="token number">6987</span><span class="token punctuation">,</span><span class="token string">&quot;userCount&quot;</span>:<span class="token number">1600</span><span class="token punctuation">,</span><span class="token string">&quot;score&quot;</span>:<span class="token string">&quot;9.0&quot;</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+----------------+</span>

<span class="token comment">#第三步，使用split进行分割，分隔符为 },{</span>
<span class="token comment">#并使用explode进行拆分成多行</span>
<span class="token keyword">select</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>sale_info<span class="token punctuation">,</span><span class="token string">'\\[\\{'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'}]'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'},\\{'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sale_info <span class="token keyword">from</span> explode2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+--+</span>
<span class="token operator">|</span>                     sale_info                      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+--+</span>
<span class="token operator">|</span> <span class="token string">&quot;source&quot;</span>:<span class="token string">&quot;7fresh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;monthSales&quot;</span>:<span class="token number">4900</span><span class="token punctuation">,</span><span class="token string">&quot;userCount&quot;</span>:<span class="token number">1900</span><span class="token punctuation">,</span><span class="token string">&quot;score&quot;</span>:<span class="token string">&quot;9.9&quot;</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token string">&quot;source&quot;</span>:<span class="token string">&quot;jd&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;monthSales&quot;</span>:<span class="token number">2090</span><span class="token punctuation">,</span><span class="token string">&quot;userCount&quot;</span>:<span class="token number">78981</span><span class="token punctuation">,</span><span class="token string">&quot;score&quot;</span>:<span class="token string">&quot;9.8&quot;</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token string">&quot;source&quot;</span>:<span class="token string">&quot;jdmart&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;monthSales&quot;</span>:<span class="token number">6987</span><span class="token punctuation">,</span><span class="token string">&quot;userCount&quot;</span>:<span class="token number">1600</span><span class="token punctuation">,</span><span class="token string">&quot;score&quot;</span>:<span class="token string">&quot;9.0&quot;</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+--+</span>

<span class="token comment">#第四步：使用get_json_object获取特定属性的值</span>
hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> get_json_object<span class="token punctuation">(</span>explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>sale_info<span class="token punctuation">,</span><span class="token string">'\\[\\{'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'}]'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'},\\{'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'$.monthSales'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sale_info <span class="token keyword">from</span> explode2<span class="token punctuation">;</span>

<span class="token comment">## 然后出现异常FAILED: SemanticException [Error 10081]: UDTF's are not supported outside the SELECT clause, nor nested in expressions</span>
<span class="token comment">## UDTF explode不能写在别的函数内</span>
</code></pre></div><p>select语句中，如果有explode函数，那么不能够查询两个字段及以上，如果想要实现多个字段，要结合lateral view使用。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>area<span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> area<span class="token punctuation">,</span>good_id <span class="token keyword">from</span> explode2<span class="token punctuation">;</span>
<span class="token comment">-- 会报错FAILED: SemanticException 1:40 Only a single expression in the SELECT clause is supported with UDTF's. Error encountered near token 'good_id'</span>
<span class="token comment">-- 使用UDTF的时候，只支持一个字段，这时候就需要LATERAL VIEW出场了</span>
</code></pre></div><h4 id="拓展-udf"><a href="#拓展-udf" class="header-anchor">#</a> 拓展：UDF</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>Hive中有三种UDF:
    <span class="token number">1</span>、用户定义函数<span class="token punctuation">(</span>user-defined <span class="token keyword">function</span><span class="token punctuation">)</span>UDF；
    <span class="token number">2</span>、用户定义聚集函数（user-defined aggregate function，UDAF）；
    <span class="token number">3</span>、用户定义表生成函数（user-defined table-generating function，UDTF）。
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

UDF操作作用于单个数据行，并且产生一个数据行作为输出。大多数函数都属于这一类（比如数学函数和字符串函数）。
UDAF 接受多个输入数据行，并产生一个输出数据行。像COUNT和MAX这样的函数就是聚集函数。
UDTF 操作作用于单个数据行，并且产生多个数据行-------一个表作为输出。lateral view explode<span class="token punctuation">(</span><span class="token punctuation">)</span>
简单来说：

UDF:返回对应值，一对一
UDAF：返回聚类值，多对一
UDTF：返回拆分值，一对多（explode就是一个udtf函数）
</code></pre></div><h4 id="explode配合lateral-view使用"><a href="#explode配合lateral-view使用" class="header-anchor">#</a> explode配合LATERAL  VIEW使用</h4> <p>lateral view用于和split、explode等UDTF一起使用的，能将一行数据拆分成多行数据，在此基础上可以对拆分的数据进行聚合</p> <p>lateral view首先为原始表的每行调用UDTF，UDTF会把一行拆分成一行或者多行，lateral view在把结果组合，产生一个支持别名表的<strong>虚拟表</strong>。</p> <p>####### 案例1：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#第一步，创建数据源</span>
vim vim explode_json2
a:shandong<span class="token punctuation">,</span>b:beijing<span class="token punctuation">,</span>c:hebei<span class="token operator">|</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">|</span><span class="token string">&quot;jimmy&quot;</span>


<span class="token comment">#第二步：创建表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> explode3<span class="token punctuation">(</span>area string<span class="token punctuation">,</span> goods_id string<span class="token punctuation">,</span> sale_info string<span class="token punctuation">)</span> <span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'|'</span> STORED <span class="token keyword">AS</span> textfile<span class="token punctuation">;</span>

<span class="token comment">#第三步：导入数据</span>
<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/explode_json'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> explode3<span class="token punctuation">;</span>

<span class="token comment">#第四步：查看表</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> explode3<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------------------------+--------------------+---------------------+--+</span>
<span class="token operator">|</span>         explode3<span class="token punctuation">.</span>area         <span class="token operator">|</span> explode3<span class="token punctuation">.</span>goods_id  <span class="token operator">|</span> explode3<span class="token punctuation">.</span>sale_info  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------------+--------------------+---------------------+--+</span>
<span class="token operator">|</span> a:shandong<span class="token punctuation">,</span>b:beijing<span class="token punctuation">,</span>c:hebei  <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span>  <span class="token operator">|</span> <span class="token string">&quot;jimmy&quot;</span>             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------------+--------------------+---------------------+--+</span>

<span class="token comment">#第五步，结合explode与lateral view来使用,查询两个字段</span>
<span class="token keyword">select</span> goods_id2<span class="token punctuation">,</span> sale_info <span class="token keyword">from</span> explode3 LATERAL <span class="token keyword">VIEW</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>goods_id<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span>goods <span class="token keyword">as</span> goods_id2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------+------------+--+</span>
<span class="token operator">|</span> goods_id2  <span class="token operator">|</span> sale_info  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+------------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>          <span class="token operator">|</span> <span class="token string">&quot;jimmy&quot;</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>          <span class="token operator">|</span> <span class="token string">&quot;jimmy&quot;</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>          <span class="token operator">|</span> <span class="token string">&quot;jimmy&quot;</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">4</span>          <span class="token operator">|</span> <span class="token string">&quot;jimmy&quot;</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">5</span>          <span class="token operator">|</span> <span class="token string">&quot;jimmy&quot;</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">6</span>          <span class="token operator">|</span> <span class="token string">&quot;jimmy&quot;</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">7</span>          <span class="token operator">|</span> <span class="token string">&quot;jimmy&quot;</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">8</span>          <span class="token operator">|</span> <span class="token string">&quot;jimmy&quot;</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">9</span>          <span class="token operator">|</span> <span class="token string">&quot;jimmy&quot;</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+------------+--+</span>

<span class="token comment">#goods只是虚拟表的一个别名，改成其它名称也行，不影响结果</span>
<span class="token comment">#goods_id2是拆分一行产生的列（字段）的名称</span>
</code></pre></div><p>####### 案例2：解决上面拆分json字段的问题</p> <ul><li>explode配合lateral view查询多个字段</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> goods_id2<span class="token punctuation">,</span> sale_info <span class="token keyword">from</span> explode2 LATERAL <span class="token keyword">VIEW</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>goods_id<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span>goods <span class="token keyword">as</span> goods_id2<span class="token punctuation">;</span>
<span class="token comment">#goods只是虚拟表的一个别名，改成其它名称也行，不影响结果</span>
<span class="token comment">#goods_id2是拆分一行产生的列（字段）的名称</span>
</code></pre></div><ul><li>其中explode2 LATERAL VIEW explode(split(goods_id,','))goods相当于一个虚拟表，该虚拟表与原表explode2的关系是笛卡尔积关联。</li> <li>笛卡尔积通俗解释：假设集合A={a, b}，集合B={0, 1, 2}，则两个集合的笛卡尔积为{(a, 0), (a, 1), (a, 2), (b, 0), (b, 1), (b, 2)}。</li> <li>也可以多重使用，如下，也是三个表笛卡尔积的结果</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> goods_id2<span class="token punctuation">,</span> sale_info<span class="token punctuation">,</span> area2 <span class="token keyword">from</span> explode2
LATERAL <span class="token keyword">VIEW</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>goods_id<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span>goods <span class="token keyword">as</span> goods_id2 
LATERAL <span class="token keyword">VIEW</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>area<span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span>area <span class="token keyword">as</span> area2<span class="token punctuation">;</span>
</code></pre></div><ul><li>最终，我们可以通过下面的句子，把这个json格式的一行数据，完全转换成二维表的方式展现</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> sale_info_1 <span class="token keyword">from</span> explode2  
LATERAL <span class="token keyword">VIEW</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>sale_info<span class="token punctuation">,</span><span class="token string">'\\[\\{'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'}]'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'},\\{'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sale_info <span class="token keyword">as</span> sale_info_1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+--+</span>
<span class="token operator">|</span>                    sale_info_1                     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+--+</span>
<span class="token operator">|</span> <span class="token string">&quot;source&quot;</span>:<span class="token string">&quot;7fresh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;monthSales&quot;</span>:<span class="token number">4900</span><span class="token punctuation">,</span><span class="token string">&quot;userCount&quot;</span>:<span class="token number">1900</span><span class="token punctuation">,</span><span class="token string">&quot;score&quot;</span>:<span class="token string">&quot;9.9&quot;</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token string">&quot;source&quot;</span>:<span class="token string">&quot;jd&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;monthSales&quot;</span>:<span class="token number">2090</span><span class="token punctuation">,</span><span class="token string">&quot;userCount&quot;</span>:<span class="token number">78981</span><span class="token punctuation">,</span><span class="token string">&quot;score&quot;</span>:<span class="token string">&quot;9.8&quot;</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token string">&quot;source&quot;</span>:<span class="token string">&quot;jdmart&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;monthSales&quot;</span>:<span class="token number">6987</span><span class="token punctuation">,</span><span class="token string">&quot;userCount&quot;</span>:<span class="token number">1600</span><span class="token punctuation">,</span><span class="token string">&quot;score&quot;</span>:<span class="token string">&quot;9.0&quot;</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+--+</span>



<span class="token keyword">select</span> 
get_json_object<span class="token punctuation">(</span>concat<span class="token punctuation">(</span><span class="token string">'{'</span><span class="token punctuation">,</span>sale_info_1<span class="token punctuation">,</span><span class="token string">'}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'$.source'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> source<span class="token punctuation">,</span> get_json_object<span class="token punctuation">(</span>concat<span class="token punctuation">(</span><span class="token string">'{'</span><span class="token punctuation">,</span>sale_info_1<span class="token punctuation">,</span><span class="token string">'}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'$.monthSales'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> monthSales<span class="token punctuation">,</span> get_json_object<span class="token punctuation">(</span>concat<span class="token punctuation">(</span><span class="token string">'{'</span><span class="token punctuation">,</span>sale_info_1<span class="token punctuation">,</span><span class="token string">'}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'$.userCount'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> userCount<span class="token punctuation">,</span>  get_json_object<span class="token punctuation">(</span>concat<span class="token punctuation">(</span><span class="token string">'{'</span><span class="token punctuation">,</span>sale_info_1<span class="token punctuation">,</span><span class="token string">'}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'$.score'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> score 
<span class="token keyword">from</span> explode2  
LATERAL <span class="token keyword">VIEW</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>sale_info<span class="token punctuation">,</span><span class="token string">'\\[\\{'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'}]'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'},\\{'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sale_info <span class="token keyword">as</span> sale_info_1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-------------+------------+--------+--+</span>
<span class="token operator">|</span> source  <span class="token operator">|</span> monthsales  <span class="token operator">|</span> usercount  <span class="token operator">|</span> score  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-------------+------------+--------+--+</span>
<span class="token operator">|</span> <span class="token number">7</span>fresh  <span class="token operator">|</span> <span class="token number">4900</span>        <span class="token operator">|</span> <span class="token number">1900</span>       <span class="token operator">|</span> <span class="token number">9.9</span>    <span class="token operator">|</span>
<span class="token operator">|</span> jd      <span class="token operator">|</span> <span class="token number">2090</span>        <span class="token operator">|</span> <span class="token number">78981</span>      <span class="token operator">|</span> <span class="token number">9.8</span>    <span class="token operator">|</span>
<span class="token operator">|</span> jdmart  <span class="token operator">|</span> <span class="token number">6987</span>        <span class="token operator">|</span> <span class="token number">1600</span>       <span class="token operator">|</span> <span class="token number">9.0</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-------------+------------+--------+--+</span>
</code></pre></div><p><strong>总结：</strong></p> <ul><li>Lateral View通常和UDTF一起出现，为了解决UDTF不允许在select字段的问题。</li> <li>Multiple Lateral View可以实现类似笛卡尔乘积。</li> <li>Outer关键字可以把不输出的UDTF的空结果，输出成NULL，防止丢失数据。</li></ul> <h4 id="列转行案例"><a href="#列转行案例" class="header-anchor">#</a> 列转行案例</h4> <h6 id="_1、函数说明"><a href="#_1、函数说明" class="header-anchor">#</a> 1、函数说明</h6> <ul><li><p>EXPLODE(col)：将hive一列中复杂的array或者map结构拆分成多行。</p></li> <li><p>LATERAL VIEW</p> <ul><li>用法：LATERAL VIEW udtf(expression) tableAlias AS columnAlias</li> <li>解释：用于和split, explode等UDTF一起使用，它能够将一列数据拆成多行数据，在此基础上可以对拆分后的数据进行聚合。</li></ul></li></ul> <h6 id="_2、数据准备-2"><a href="#_2、数据准备-2" class="header-anchor">#</a> 2、数据准备</h6> <ul><li>数据内容如下，字段之间都是使用\t进行分割</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hivedatas

<span class="token function">vim</span> movie.txt

《疑犯追踪》	悬疑,动作,科幻,剧情
《Lie to me》	悬疑,警匪,动作,心理,剧情
《战狼2》	战争,动作,灾难
</code></pre></div><h6 id="_3、需求-2"><a href="#_3、需求-2" class="header-anchor">#</a> 3、需求</h6> <ul><li>将电影分类中的数组数据展开。结果如下：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>《疑犯追踪》	悬疑
《疑犯追踪》	动作
《疑犯追踪》	科幻
《疑犯追踪》	剧情
《Lie to me》	悬疑
《Lie to me》	警匪
《Lie to me》	动作
《Lie to me》	心理
《Lie to me》	剧情
《战狼2》	战争
《战狼2》	动作
《战狼2》	灾难
</code></pre></div><h6 id="_4、创建hive表并导入数据"><a href="#_4、创建hive表并导入数据" class="header-anchor">#</a> 4、创建hive表并导入数据</h6> <ul><li>创建hive表</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> movie_info<span class="token punctuation">(</span>movie string<span class="token punctuation">,</span> category array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">)</span> 
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;\t&quot;</span> 
collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>加载数据</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">&quot;/kkb/install/hivedatas/movie.txt&quot;</span> <span class="token keyword">into</span> <span class="token keyword">table</span> movie_info<span class="token punctuation">;</span>
</code></pre></div><h6 id="_5、按需求查询数据"><a href="#_5、按需求查询数据" class="header-anchor">#</a> 5、按需求查询数据</h6> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> movie_info2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+-----------------------------+--+</span>
<span class="token operator">|</span> movie_info2<span class="token punctuation">.</span>movie  <span class="token operator">|</span>    movie_info2<span class="token punctuation">.</span>category     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+-----------------------------+--+</span>
<span class="token operator">|</span> 《疑犯追踪》             <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;悬疑&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;动作&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;科幻&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;剧情&quot;</span><span class="token punctuation">]</span>       <span class="token operator">|</span>
<span class="token operator">|</span> 《Lie <span class="token keyword">to</span> me》        <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;悬疑&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;警匪&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;动作&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;心理&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;剧情&quot;</span><span class="token punctuation">]</span>  <span class="token operator">|</span>
<span class="token operator">|</span> 《战狼<span class="token number">2</span>》              <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;战争&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;动作&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;灾难&quot;</span><span class="token punctuation">]</span>            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+-----------------------------+--+</span>


<span class="token keyword">select</span> movie<span class="token punctuation">,</span> category_name <span class="token keyword">from</span> movie_info2 
lateral <span class="token keyword">view</span> explode<span class="token punctuation">(</span>category<span class="token punctuation">)</span> table_tmp <span class="token keyword">as</span> category_name<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+----------------+--+</span>
<span class="token operator">|</span>    movie     <span class="token operator">|</span> category_name  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+----------------+--+</span>
<span class="token operator">|</span> 《疑犯追踪》       <span class="token operator">|</span> 悬疑             <span class="token operator">|</span>
<span class="token operator">|</span> 《疑犯追踪》       <span class="token operator">|</span> 动作             <span class="token operator">|</span>
<span class="token operator">|</span> 《疑犯追踪》       <span class="token operator">|</span> 科幻             <span class="token operator">|</span>
<span class="token operator">|</span> 《疑犯追踪》       <span class="token operator">|</span> 剧情             <span class="token operator">|</span>
<span class="token operator">|</span> 《Lie <span class="token keyword">to</span> me》  <span class="token operator">|</span> 悬疑             <span class="token operator">|</span>
<span class="token operator">|</span> 《Lie <span class="token keyword">to</span> me》  <span class="token operator">|</span> 警匪             <span class="token operator">|</span>
<span class="token operator">|</span> 《Lie <span class="token keyword">to</span> me》  <span class="token operator">|</span> 动作             <span class="token operator">|</span>
<span class="token operator">|</span> 《Lie <span class="token keyword">to</span> me》  <span class="token operator">|</span> 心理             <span class="token operator">|</span>
<span class="token operator">|</span> 《Lie <span class="token keyword">to</span> me》  <span class="token operator">|</span> 剧情             <span class="token operator">|</span>
<span class="token operator">|</span> 《战狼<span class="token number">2</span>》        <span class="token operator">|</span> 战争             <span class="token operator">|</span>
<span class="token operator">|</span> 《战狼<span class="token number">2</span>》        <span class="token operator">|</span> 动作             <span class="token operator">|</span>
<span class="token operator">|</span> 《战狼<span class="token number">2</span>》        <span class="token operator">|</span> 灾难             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+----------------+--+</span>

<span class="token comment">#table_tmp改成其它名称也行，只是一个别名，自定义即可，不影响结果</span>
</code></pre></div><h4 id="reflect函数"><a href="#reflect函数" class="header-anchor">#</a> reflect函数</h4> <p>reflect函数可以支持在sql中调用java中的自带函数，秒杀一切udf函数。</p> <h6 id="_1、使用java-lang-math当中的max求两列中最大值"><a href="#_1、使用java-lang-math当中的max求两列中最大值" class="header-anchor">#</a> 1、使用java.lang.Math当中的Max求两列中最大值</h6> <ul><li>创建hive表</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> test_udf<span class="token punctuation">(</span>col1 <span class="token keyword">int</span><span class="token punctuation">,</span>col2 <span class="token keyword">int</span><span class="token punctuation">)</span> 
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>准备数据并加载数据</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hivedatas
<span class="token function">vim</span> test_udf

<span class="token number">1,2</span>
<span class="token number">4,3</span>
<span class="token number">6,4</span>
<span class="token number">7,5</span>
<span class="token number">5,6</span>
</code></pre></div><ul><li>加载数据</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/test_udf'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> test_udf<span class="token punctuation">;</span>
</code></pre></div><ul><li>使用java.lang.Math当中的Max求两列当中的最大值</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> reflect<span class="token punctuation">(</span><span class="token string">&quot;java.lang.Math&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;max&quot;</span><span class="token punctuation">,</span> col1<span class="token punctuation">,</span> col2<span class="token punctuation">)</span> <span class="token keyword">from</span> test_udf<span class="token punctuation">;</span>
</code></pre></div><h6 id="_2、不同记录执行不同的java内置函数"><a href="#_2、不同记录执行不同的java内置函数" class="header-anchor">#</a> 2、不同记录执行不同的java内置函数</h6> <ul><li>创建hive表</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> test_udf2<span class="token punctuation">(</span>class_name string<span class="token punctuation">,</span> method_name string<span class="token punctuation">,</span> col1 <span class="token keyword">int</span><span class="token punctuation">,</span> col2 <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>准备数据</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">vim</span> test_udf2

java.lang.Math,min,1,2
java.lang.Math,max,2,3
</code></pre></div><ul><li>加载数据</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/test_udf2'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> test_udf2<span class="token punctuation">;</span>
</code></pre></div><ul><li>执行查询</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> reflect<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> method_name<span class="token punctuation">,</span> col1<span class="token punctuation">,</span> col2<span class="token punctuation">)</span> <span class="token keyword">from</span> test_udf2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+--+</span>
<span class="token operator">|</span> _c0  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+--+</span>
</code></pre></div><h6 id="_3、判断是否为数字"><a href="#_3、判断是否为数字" class="header-anchor">#</a> 3、判断是否为数字</h6> <ul><li><p>使用apache commons中的函数，commons下的jar已经包含在hadoop的classpath中，所以可以直接使用。</p></li> <li><p>使用方式如下：</p></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> reflect<span class="token punctuation">(</span><span class="token string">&quot;org.apache.commons.lang.math.NumberUtils&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;isNumber&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--+</span>
<span class="token operator">|</span>  _c0  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--+</span>
<span class="token operator">|</span> <span class="token boolean">true</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--+</span>
</code></pre></div><h4 id="分析函数-分组求topn"><a href="#分析函数-分组求topn" class="header-anchor">#</a> 分析函数—分组求topN</h4> <h6 id="_1、分析函数的作用"><a href="#_1、分析函数的作用" class="header-anchor">#</a> 1、分析函数的作用</h6> <ul><li>对于一些比较复杂的数据求取过程，我们可能就要用到分析函数</li> <li>分析函数主要用于==分组求topN或者求取百分比，或者进行数据的切片==等等，我们都可以使用分析函数来解决</li></ul> <h6 id="_2、常用的分析函数"><a href="#_2、常用的分析函数" class="header-anchor">#</a> 2、常用的分析函数</h6> <p>1、ROW_NUMBER()：</p> <ul><li>从1开始，按照顺序，给分组内的记录加序列；
<ul><li>比如，按照pv降序排列，生成分组内每天的pv名次,ROW_NUMBER()的应用场景非常多</li> <li>再比如，获取分组内排序第一的记录;</li> <li>获取一个session中的第一条refer等。</li></ul></li></ul> <p>2、RANK() ：</p> <ul><li>生成数据项在分组中的排名，排名相等会在名次中留下空位</li></ul> <p>3、DENSE_RANK() ：</p> <ul><li>生成数据项在分组中的排名，排名相等会在名次中不会留下空位</li></ul> <p>4、CUME_DIST ：</p> <ul><li>小于等于当前值的行数/分组内总行数。比如，统计小于等于当前薪水的人数，所占总人数的比例</li></ul> <p>5、PERCENT_RANK ：</p> <ul><li>分组内当前行的RANK值/分组内总行数</li></ul> <p>6、NTILE(n) ：</p> <ul><li>用于将分组数据按照顺序切分成n片，返回当前切片值</li> <li>如果切片不均匀，默认增加第一个切片的分布。</li> <li>NTILE不支持ROWS BETWEEN，比如 NTILE(2) OVER(PARTITION BY cookieid ORDER BY createtime ROWS BETWEEN 3 PRECEDING AND CURRENT ROW)</li></ul> <p>7、分析函数的常用语法格式</p> <ul><li>rank() over(partition by col1 order by col2)</li> <li>dense_rank() over(partition by col1 order by col2)</li> <li>row number over(partition by col1 order by col2)</li> <li>...</li></ul> <h6 id="_3、需求描述"><a href="#_3、需求描述" class="header-anchor">#</a> 3、需求描述</h6> <ul><li>现有数据内容格式如下，分别对应三个字段，cookieid，createtime ，pv</li> <li>求取每个cookie访问pv前三名的数据记录(根据pv字段的大小进行选取前三名），其实就是分组求topN，求取每组当中的前三个值</li></ul> <div class="language- extra-class"><pre class="language-text"><code>cookie1,2015-04-10,1
cookie1,2015-04-11,5
cookie1,2015-04-12,7
cookie1,2015-04-13,3
cookie1,2015-04-14,2
cookie1,2015-04-15,4
cookie1,2015-04-16,4
cookie2,2015-04-10,2
cookie2,2015-04-11,3
cookie2,2015-04-12,5
cookie2,2015-04-13,6
cookie2,2015-04-14,3
cookie2,2015-04-15,9
cookie2,2015-04-16,7
</code></pre></div><p>####### 第一步：创建数据库表</p> <ul><li>在hive当中创建数据库表</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> cookie_pv <span class="token punctuation">(</span>
cookieid string<span class="token punctuation">,</span>
createtime string<span class="token punctuation">,</span> 
pv <span class="token keyword">INT</span>
<span class="token punctuation">)</span> <span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span> <span class="token punctuation">;</span>
</code></pre></div><p>####### 第二步：准备数据并加载</p> <ul><li>node03执行以下命令，创建数据，并加载到hive表当中去</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hivedatas
<span class="token function">vim</span> cookiepv.txt

cookie1,2015-04-10,1
cookie1,2015-04-11,5
cookie1,2015-04-12,7
cookie1,2015-04-13,3
cookie1,2015-04-14,2
cookie1,2015-04-15,4
cookie1,2015-04-16,4
cookie2,2015-04-10,2
cookie2,2015-04-11,3
cookie2,2015-04-12,5
cookie2,2015-04-13,6
cookie2,2015-04-14,3
cookie2,2015-04-15,9
cookie2,2015-04-16,7
</code></pre></div><ul><li>加载数据到hive表当中去</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/cookiepv.txt'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span>  cookie_pv<span class="token punctuation">;</span>
</code></pre></div><p>####### 第三步：使用分析函数来求取每个cookie访问PV的前三条记录</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> 
cookieid<span class="token punctuation">,</span>
createtime<span class="token punctuation">,</span>
pv<span class="token punctuation">,</span>
RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pv <span class="token keyword">desc</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rn1<span class="token punctuation">,</span>
DENSE_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pv <span class="token keyword">desc</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rn2<span class="token punctuation">,</span>
ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pv <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rn3 
<span class="token keyword">FROM</span> cookie_pv 
<span class="token punctuation">)</span> <span class="token keyword">temp</span> <span class="token keyword">where</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>rn1 <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+------------------+----------+-----------+-----------+-----------+--+</span>
<span class="token operator">|</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>cookieid  <span class="token operator">|</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>createtime  <span class="token operator">|</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>pv  <span class="token operator">|</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>rn1  <span class="token operator">|</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>rn2  <span class="token operator">|</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>rn3  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+------------------+----------+-----------+-----------+-----------+--+</span>
<span class="token operator">|</span> cookie1        <span class="token operator">|</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>       <span class="token operator">|</span> <span class="token number">7</span>        <span class="token operator">|</span> <span class="token number">1</span>         <span class="token operator">|</span> <span class="token number">1</span>         <span class="token operator">|</span> <span class="token number">1</span>         <span class="token operator">|</span>
<span class="token operator">|</span> cookie1        <span class="token operator">|</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>       <span class="token operator">|</span> <span class="token number">5</span>        <span class="token operator">|</span> <span class="token number">2</span>         <span class="token operator">|</span> <span class="token number">2</span>         <span class="token operator">|</span> <span class="token number">2</span>         <span class="token operator">|</span>
<span class="token operator">|</span> cookie1        <span class="token operator">|</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>       <span class="token operator">|</span> <span class="token number">4</span>        <span class="token operator">|</span> <span class="token number">3</span>         <span class="token operator">|</span> <span class="token number">3</span>         <span class="token operator">|</span> <span class="token number">3</span>         <span class="token operator">|</span>
<span class="token operator">|</span> cookie1        <span class="token operator">|</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>       <span class="token operator">|</span> <span class="token number">4</span>        <span class="token operator">|</span> <span class="token number">3</span>         <span class="token operator">|</span> <span class="token number">3</span>         <span class="token operator">|</span> <span class="token number">4</span>         <span class="token operator">|</span>
<span class="token operator">|</span> cookie2        <span class="token operator">|</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>       <span class="token operator">|</span> <span class="token number">9</span>        <span class="token operator">|</span> <span class="token number">1</span>         <span class="token operator">|</span> <span class="token number">1</span>         <span class="token operator">|</span> <span class="token number">1</span>         <span class="token operator">|</span>
<span class="token operator">|</span> cookie2        <span class="token operator">|</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>       <span class="token operator">|</span> <span class="token number">7</span>        <span class="token operator">|</span> <span class="token number">2</span>         <span class="token operator">|</span> <span class="token number">2</span>         <span class="token operator">|</span> <span class="token number">2</span>         <span class="token operator">|</span>
<span class="token operator">|</span> cookie2        <span class="token operator">|</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>       <span class="token operator">|</span> <span class="token number">6</span>        <span class="token operator">|</span> <span class="token number">3</span>         <span class="token operator">|</span> <span class="token number">3</span>         <span class="token operator">|</span> <span class="token number">3</span>         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+------------------+----------+-----------+-----------+-----------+--+</span>
</code></pre></div><h4 id="hive自定义函数"><a href="#hive自定义函数" class="header-anchor">#</a> hive自定义函数</h4> <h6 id="_1、自定义函数的基本介绍"><a href="#_1、自定义函数的基本介绍" class="header-anchor">#</a> 1、自定义函数的基本介绍</h6> <ul><li><p>Hive 自带了一些函数，比如：max/min等，但是数量有限，自己可以通过自定义UDF来方便的扩展。</p></li> <li><p>当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义函数（UDF：user-defined function）</p></li> <li><p>根据用户自定义函数类别分为以下三种：</p> <ul><li><p>UDF（User-Defined-Function） 一进一出</p></li> <li><p>UDAF（User-Defined Aggregation Function）  聚集函数，多进一出，类似于：count/max/min</p></li> <li><p>UDTF（User-Defined Table-Generating Functions） 一进多出，如lateral view explode()</p></li></ul></li></ul> <p>​                如lateral view explode()</p> <ul><li><p>官方文档地址</p> <p>https://cwiki.apache.org/confluence/display/Hive/HivePlugins</p></li> <li><p>编程步骤：</p></li></ul> <p>​        （1）继承org.apache.hadoop.hive.ql.UDF</p> <p>​        （2）需要实现evaluate函数；evaluate函数支持重载；</p> <ul><li>注意事项</li></ul> <p>​        （1）UDF必须要有返回类型，可以返回null，但是返回类型不能为void；</p> <p>​        （2）UDF中常用Text/LongWritable等类型，不推荐使用java类型；</p> <h6 id="_2、自定义函数开发"><a href="#_2、自定义函数开发" class="header-anchor">#</a> 2、自定义函数开发</h6> <p>####### 第一步：创建maven java 工程，并导入jar包</p> <div class="language-xml extra-class"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cloudera<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-mr1-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-hdfs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-mapreduce-client-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hive-exec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hive-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hive-cli<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!--    &lt;verbal&gt;true&lt;/verbal&gt;--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>####### 第二步：开发java类继承UDF，并重载evaluate 方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kkb<span class="token punctuation">.</span>udf<span class="token punctuation">.</span></span><span class="token class-name">MyUDF</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyUDF</span> <span class="token keyword">extends</span> UDF <span class="token punctuation">{</span>
     <span class="token keyword">public</span> <span class="token class-name">Text</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Text</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token comment">//返回大写字母         </span>
         <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>####### 第三步：项目打包</p> <ul><li>使用maven的package进行打包</li> <li>将我们打包好的jar包上传到node03服务器的/kkb/install/hive-1.1.0-cdh5.14.2/lib 这个路径下</li></ul> <p>####### 第四步：添加我们的jar包</p> <ul><li>重命名我们的jar包名称</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hive-1.1.0-cdh5.14.2/lib
<span class="token function">mv</span> original-day_hive_udf-1.0-SNAPSHOT.jar udf.jar
</code></pre></div><ul><li>hive的客户端添加我们的jar包</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; add jar /kkb/install/hive-1.1.0-cdh5.14.2/lib/udf.jar;</span>
</code></pre></div><p>####### 第五步：设置函数与我们的自定义函数关联</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; create temporary function touppercase as 'com.kkb.udf.MyUDF';</span>
</code></pre></div><p>####### 第六步：使用自定义函数</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt;select tolowercase('abc');</span>
</code></pre></div><ul><li><p>hive当中如何创建永久函数</p></li> <li><p>在hive当中添加临时函数，需要我们每次进入hive客户端的时候都需要添加以下，退出hive客户端临时函数就会失效，那么我们也可以创建永久函数来让其不会失效</p></li> <li><p>创建永久函数</p></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 1、指定数据库，将我们的函数创建到指定的数据库下面</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt;use myhive;</span>

<span class="token comment">-- 2、使用add jar添加我们的jar包到hive当中来</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt;add jar /kkb/install/hive-1.1.0-cdh5.14.2/lib/udf.jar;</span>

<span class="token comment">-- 3、查看我们添加的所有的jar包</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt;list jars;</span>

<span class="token comment">-- 4、创建永久函数，与我们的函数进行关联</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt;create function myuppercase as 'com.kkb.udf.MyUDF';</span>

<span class="token comment">-- 5、查看我们的永久函数</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt;show functions like 'my*';</span>

<span class="token comment">-- 6、使用永久函数</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt;select myhive.myuppercase('helloworld');</span>

<span class="token comment">-- 7、删除永久函数</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt;drop function myhive.myuppercase;</span>

<span class="token comment">-- 8、查看函数</span>
 <span class="token keyword">show</span> functions <span class="token operator">like</span> <span class="token string">'my*'</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="json数据解析udf开发-作业"><a href="#json数据解析udf开发-作业" class="header-anchor">#</a> Json数据解析UDF开发（作业）</h4> <ul><li>有原始json数据格式内容如下：</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;movie&quot;</span><span class="token operator">:</span><span class="token string">&quot;1193&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rate&quot;</span><span class="token operator">:</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;978300760&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">}</span> 
<span class="token punctuation">{</span><span class="token property">&quot;movie&quot;</span><span class="token operator">:</span><span class="token string">&quot;661&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rate&quot;</span><span class="token operator">:</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;978302109&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token property">&quot;movie&quot;</span><span class="token operator">:</span><span class="token string">&quot;914&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rate&quot;</span><span class="token operator">:</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;978301968&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token property">&quot;movie&quot;</span><span class="token operator">:</span><span class="token string">&quot;3408&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rate&quot;</span><span class="token operator">:</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;978300275&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token property">&quot;movie&quot;</span><span class="token operator">:</span><span class="token string">&quot;2355&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rate&quot;</span><span class="token operator">:</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;978824291&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token property">&quot;movie&quot;</span><span class="token operator">:</span><span class="token string">&quot;1197&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rate&quot;</span><span class="token operator">:</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;978302268&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token property">&quot;movie&quot;</span><span class="token operator">:</span><span class="token string">&quot;1287&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rate&quot;</span><span class="token operator">:</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;978302039&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>需求：创建hive表，加载数据，使用自定义函数来解析json格式的数据，最后接的得到如下结果</li></ul> <table><thead><tr><th style="text-align:center;">movie</th> <th style="text-align:center;">rate</th> <th style="text-align:center;">timestamp</th> <th style="text-align:center;">uid</th></tr></thead> <tbody><tr><td style="text-align:center;">1193</td> <td style="text-align:center;">5</td> <td style="text-align:center;">978300760</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">661</td> <td style="text-align:center;">3</td> <td style="text-align:center;">978302109</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">914</td> <td style="text-align:center;">3</td> <td style="text-align:center;">978301968</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">3408</td> <td style="text-align:center;">4</td> <td style="text-align:center;">978300275</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">2355</td> <td style="text-align:center;">5</td> <td style="text-align:center;">978824291</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">1197</td> <td style="text-align:center;">3</td> <td style="text-align:center;">978302268</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">1287</td> <td style="text-align:center;">5</td> <td style="text-align:center;">978302039</td> <td style="text-align:center;">1</td></tr></tbody></table> <p>参考网页：https://blog.csdn.net/otengyue/article/details/70255202</p> <h2 id="hive表的数据压缩"><a href="#hive表的数据压缩" class="header-anchor">#</a> Hive表的数据压缩</h2> <h5 id="数据的压缩说明"><a href="#数据的压缩说明" class="header-anchor">#</a> 数据的压缩说明</h5> <p>可使用以下三种标准对压缩方式进行评价</p> <ul><li><p>1、压缩比：压缩比越高，压缩后文件越小，所以压缩比越高越好</p></li> <li><p>2、压缩时间：越快越好</p></li> <li><p>3、已经压缩的格式文件是否可以再分割：可以分割的格式允许单一文件由多个Mapper程序处理，可以更好的并行化。比如说，一个300M的压缩文件上传到hdfs后，会被分成3个block，如果该压缩文件不支持切分的话，那么只会产生一个maptask，这个maptask将会处理全部的3个block。</p></li> <li><p>常见压缩格式：</p></li></ul> <table><thead><tr><th style="text-align:center;">压缩方式</th> <th style="text-align:center;">压缩比</th> <th style="text-align:center;">压缩速度</th> <th style="text-align:center;">解压缩速度</th> <th style="text-align:center;">是否可分割</th></tr></thead> <tbody><tr><td style="text-align:center;">gzip</td> <td style="text-align:center;">13.4%</td> <td style="text-align:center;">21 MB/s</td> <td style="text-align:center;">118 MB/s</td> <td style="text-align:center;">否</td></tr> <tr><td style="text-align:center;">bzip2</td> <td style="text-align:center;">13.2%</td> <td style="text-align:center;">2.4MB/s</td> <td style="text-align:center;">9.5MB/s</td> <td style="text-align:center;">是</td></tr> <tr><td style="text-align:center;">lzo</td> <td style="text-align:center;">20.5%</td> <td style="text-align:center;">135 MB/s</td> <td style="text-align:center;">410 MB/s</td> <td style="text-align:center;">是</td></tr> <tr><td style="text-align:center;">snappy</td> <td style="text-align:center;">22.2%</td> <td style="text-align:center;">172 MB/s</td> <td style="text-align:center;">409 MB/s</td> <td style="text-align:center;">否</td></tr></tbody></table> <ul><li>Hadoop编码/解码器方式</li></ul> <table><thead><tr><th style="text-align:center;">压缩格式</th> <th style="text-align:center;">对应的编码/解码器</th></tr></thead> <tbody><tr><td style="text-align:center;">DEFLATE</td> <td style="text-align:center;">org.apache.hadoop.io.compress.DefaultCodec</td></tr> <tr><td style="text-align:center;">Gzip</td> <td style="text-align:center;">org.apache.hadoop.io.compress.GzipCodec</td></tr> <tr><td style="text-align:center;">BZip2</td> <td style="text-align:center;">org.apache.hadoop.io.compress.BZip2Codec</td></tr> <tr><td style="text-align:center;">LZO</td> <td style="text-align:center;">com.hadoop.compress.lzo.LzopCodec</td></tr> <tr><td style="text-align:center;">Snappy</td> <td style="text-align:center;">org.apache.hadoop.io.compress.SnappyCodec</td></tr></tbody></table> <p>压缩性能的比较</p> <table><thead><tr><th>压缩算法</th> <th>原始文件大小</th> <th>压缩文件大小</th> <th>压缩速度</th> <th>解压速度</th></tr></thead> <tbody><tr><td>gzip</td> <td>8.3GB</td> <td>1.8GB</td> <td>17.5MB/s</td> <td>58MB/s</td></tr> <tr><td>bzip2</td> <td>8.3GB</td> <td>1.1GB</td> <td>2.4MB/s</td> <td>9.5MB/s</td></tr> <tr><td>LZO</td> <td>8.3GB</td> <td>2.9GB</td> <td>49.3MB/s</td> <td>74.6MB/s</td></tr></tbody></table> <p>http://google.github.io/snappy/</p> <p>On a single core of a Core i7 processor in 64-bit mode, Snappy compresses at about 250 MB/sec or more and decompresses at about 500 MB/sec or more.</p> <h5 id="压缩配置参数"><a href="#压缩配置参数" class="header-anchor">#</a> 压缩配置参数</h5> <p>hadoop的压缩的默认配置信息，在hive-default.xml.template文件里都能看到，里面有每个参数的解释信息。</p> <p>想要在Hadoop中启用压缩，可以配置如下参数（mapred-site.xml文件中）:</p> <table><thead><tr><th>参数</th> <th>默认值</th> <th>阶段</th> <th>建议</th></tr></thead> <tbody><tr><td>io.compression.codecs      （在core-site.xml中配置）</td> <td>org.apache.hadoop.io.compress.DefaultCodec,   org.apache.hadoop.io.compress.GzipCodec, org.apache.hadoop.io.compress.BZip2Codec,   org.apache.hadoop.io.compress.Lz4Codec</td> <td>输入压缩</td> <td>Hadoop使用文件扩展名判断是否支持某种编解码器</td></tr> <tr><td>mapreduce.map.output.compress</td> <td>false</td> <td>mapper输出</td> <td>这个参数设为true启用压缩</td></tr> <tr><td>mapreduce.map.output.compress.codec</td> <td>org.apache.hadoop.io.compress.DefaultCodec</td> <td>mapper输出</td> <td>使用LZO、LZ4或snappy编解码器在此阶段压缩数据</td></tr> <tr><td>mapreduce.output.fileoutputformat.compress</td> <td>false</td> <td>reducer输出</td> <td>这个参数设为true启用压缩</td></tr> <tr><td>mapreduce.output.fileoutputformat.compress.codec</td> <td>org.apache.hadoop.io.compress. DefaultCodec</td> <td>reducer输出</td> <td>使用标准工具或者编解码器，如gzip和bzip2</td></tr> <tr><td>mapreduce.output.fileoutputformat.compress.type</td> <td>RECORD</td> <td>reducer输出</td> <td>SequenceFile输出使用的压缩类型：NONE和BLOCK</td></tr></tbody></table> <h5 id="开启map输出阶段压缩"><a href="#开启map输出阶段压缩" class="header-anchor">#</a> 开启Map输出阶段压缩</h5> <p>开启map输出阶段压缩可以减少job中map和Reduce task间数据传输量。具体配置如下：</p> <p><strong>案例实操：</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 1）开启hive中间传输数据压缩功能</span>
hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>intermediate<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">-- 2）开启mapreduce中map输出压缩功能</span>
hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>map<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">-- 3）设置mapreduce中map输出数据的压缩方式</span>
hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>map<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>codec<span class="token operator">=</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>

<span class="token comment">-- 4）执行查询语句</span>
   <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> score<span class="token punctuation">;</span>
</code></pre></div><p>中间传输的意思：一个hql语句中，可能产生多个mapreduce。比如说mr1---&gt;mr2---&gt;mr3---&gt;最终结果，那么mr2处理的数据就是中间传输数据。</p> <h5 id="开启reduce输出阶段压缩"><a href="#开启reduce输出阶段压缩" class="header-anchor">#</a> 开启Reduce输出阶段压缩</h5> <p>当Hive将输出写入到表中时，输出内容同样可以进行压缩。属性hive.exec.compress.output控制着这个功能。用户可能需要保持默认设置文件中的默认值false，这样默认的输出就是非压缩的纯文本文件了。用户可以通过在查询语句或执行脚本中设置这个值为true，来开启输出结果压缩功能。</p> <p><strong>案例实操：</strong>(只对当前session有效)</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 1）开启hive最终输出数据压缩功能</span>
hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">-- 2）开启mapreduce最终输出数据压缩</span>
hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>output<span class="token punctuation">.</span>fileoutputformat<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">-- 3）设置mapreduce最终数据输出压缩方式</span>
hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>output<span class="token punctuation">.</span>fileoutputformat<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>codec <span class="token operator">=</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>

<span class="token comment">-- 4）设置mapreduce最终数据输出压缩为块压缩</span>
hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>output<span class="token punctuation">.</span>fileoutputformat<span class="token punctuation">.</span>compress<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token operator">=</span>BLOCK<span class="token punctuation">;</span>

<span class="token comment">-- 5）测试一下输出结果是否是压缩文件</span>
<span class="token keyword">insert</span> overwrite <span class="token keyword">local</span> directory <span class="token string">'/kkb/install/hivedatas/score_export'</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score<span class="token punctuation">;</span>

</code></pre></div><p><img src="/assets/img/image-20200225021213538.b48fb651.png" alt="image-20200225021213538"></p> <h2 id="hive表的文件存储格式"><a href="#hive表的文件存储格式" class="header-anchor">#</a> Hive表的文件存储格式</h2> <p>Hive支持的存储数据的格式主要有：TEXTFILE（行式存储） 、SEQUENCEFILE(行式存储)、ORC（列式存储）、PARQUET（列式存储）。企业中使用orc较多。</p> <h5 id="_1、列式存储和行式存储"><a href="#_1、列式存储和行式存储" class="header-anchor">#</a> 1、列式存储和行式存储</h5> <p><img src="/assets/img/clip_image002.70f651ab.jpg" alt="img"></p> <p>上图左边为逻辑表，右边第一个为行式存储，第二个为列式存储。</p> <p><strong>行存储的特点：</strong> 查询满足条件的一整行数据的时候，列存储则需要去每个聚集的字段找到对应的每个列的值，行存储只需要找到其中一个值，其余的值都在相邻地方，所以此时行存储查询的速度更快。select  *</p> <p><strong>列存储的特点：</strong> 因为每个字段的数据聚集存储，在查询只需要少数几个字段的时候，能大大减少读取的数据量；每个字段的数据类型一定是相同的，列式存储可以针对性的设计更好的设计压缩算法。  select   某些字段效率更高</p> <p>TEXTFILE和SEQUENCEFILE的存储格式都是基于行存储的；</p> <p>ORC和PARQUET是基于列式存储的。</p> <h5 id="_2-、textfile格式"><a href="#_2-、textfile格式" class="header-anchor">#</a> 2 、TEXTFILE格式</h5> <p>默认格式，数据不做压缩，磁盘开销大，数据解析开销大。可结合Gzip、Bzip2使用(系统自动检查，执行查询时自动解压)，但使用这种方式，hive不会对数据进行切分，从而无法对数据进行并行操作。</p> <h5 id="_3-、orc格式-了解就行"><a href="#_3-、orc格式-了解就行" class="header-anchor">#</a> 3 、ORC格式（了解就行）</h5> <p>Orc (Optimized Row Columnar)是hive 0.11版里引入的新的存储格式。</p> <p>可以看到每个Orc文件由1个或多个stripe组成，每个stripe250MB大小，这个Stripe实际相当于RowGroup概念，不过大小由4MB-&gt;250MB，这样能提升顺序读的吞吐率。每个Stripe里有三部分组成，分别是Index Data,Row Data,Stripe Footer：</p> <p><img src="/assets/img/clip_image003.63ef9666.png" alt="img"></p> <p>一个orc文件可以分为若干个Stripe</p> <p>一个stripe可以分为三个部分</p> <p>indexData：某些列的索引数据</p> <p>rowData :真正的数据存储</p> <p>StripFooter：stripe的元数据信息</p> <p>1）Index Data：一个轻量级的index，默认是每隔1W行做一个索引。这里做的索引只是记录某行的各字段在Row Data中的offset。</p> <p>​    2）Row Data：存的是具体的数据，先取部分行，然后对这些行按列进行存储。对每个列进行了编码，分成多个Stream来存储。</p> <p>​    3）Stripe Footer：存的是各个stripe的元数据信息</p> <p>每个文件有一个File Footer，这里面存的是每个Stripe的行数，每个Column的数据类型信息等；每个文件的尾部是一个PostScript，这里面记录了整个文件的压缩类型以及FileFooter的长度信息等。在读取文件时，会seek到文件尾部读PostScript，从里面解析到File Footer长度，再读FileFooter，从里面解析到各个Stripe信息，再读各个Stripe，即从后往前读。</p> <h5 id="_4-、parquet格式-了解就行"><a href="#_4-、parquet格式-了解就行" class="header-anchor">#</a> 4 、PARQUET格式(了解就行)</h5> <p>Parquet是面向分析型业务的列式存储格式，由Twitter和Cloudera合作开发，2015年5月从Apache的孵化器里毕业成为Apache顶级项目。</p> <p>Parquet文件是以二进制方式存储的，所以是不可以直接读取的，文件中包括该文件的数据和元数据，因此Parquet格式文件是自解析的。</p> <p>通常情况下，在存储Parquet数据的时候会按照Block大小设置<strong>行组</strong>的大小，由于一般情况下每一个Mapper任务处理数据的最小单位是一个Block，这样可以把每一个行组由一个Mapper任务处理，增大任务执行并行度。Parquet文件的格式如下图所示。</p> <p><img src="/assets/img/clip_image005.1a12bbdc.jpg" alt="Parquet文件格式"></p> <p>上图展示了一个Parquet文件的内容，一个文件中可以存储多个行组，文件的首位都是该文件的Magic Code，用于校验它是否是一个Parquet文件，Footer length记录了文件元数据的大小，通过该值和文件长度可以计算出元数据的偏移量，文件的元数据中包括每一个行组的元数据信息和该文件存储数据的Schema信息。除了文件中每一个行组的元数据，每一页的开始都会存储该页的元数据，在Parquet中，有三种类型的页：数据页、字典页和索引页。数据页用于存储当前行组中该列的值，字典页存储该列值的编码字典，每一个列块中最多包含一个字典页，索引页用来存储当前行组下该列的索引，目前Parquet中还不支持索引页。</p> <h5 id="_5、主流文件存储格式对比实验"><a href="#_5、主流文件存储格式对比实验" class="header-anchor">#</a> 5、主流文件存储格式对比实验</h5> <p>从存储文件的压缩比和查询速度两个角度对比,使用stored as关键字来设置存储格式。</p> <h6 id="存储文件的压缩比测试"><a href="#存储文件的压缩比测试" class="header-anchor">#</a> 存储文件的压缩比测试</h6> <p>测试数据 参见log.data 18.1M</p> <p>####### 1）TextFile</p> <p>（1）创建表，存储数据格式为TEXTFILE</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">use</span> myhive<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> log_text <span class="token punctuation">(</span>
track_time string<span class="token punctuation">,</span>
url string<span class="token punctuation">,</span>
session_id string<span class="token punctuation">,</span>
referer string<span class="token punctuation">,</span>
ip string<span class="token punctuation">,</span>
end_user_id string<span class="token punctuation">,</span>
city_id string
<span class="token punctuation">)</span><span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\t'</span>
STORED <span class="token keyword">AS</span> TEXTFILE <span class="token punctuation">;</span>
</code></pre></div><p>（2）向表中加载数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/log.data'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> log_text <span class="token punctuation">;</span>
</code></pre></div><p>（3）查看表中数据大小，大小为18.1M</p> <div class="language-shell extra-class"><pre class="language-shell"><code>dfs -du -h /user/hive/warehouse/db1.db/log_text<span class="token punctuation">;</span>
+----------------------------------------------------+--+
<span class="token operator">|</span>                     DFS Output                     <span class="token operator">|</span>
+----------------------------------------------------+--+
<span class="token operator">|</span> <span class="token number">18.1</span> M  <span class="token number">54.4</span> M  /user/hive/warehouse/db1.db/log_text/log.data <span class="token operator">|</span>
+----------------------------------------------------+--+
</code></pre></div><p>####### 2）ORC</p> <p>（1）创建表，存储数据格式为ORC</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> log_orc<span class="token punctuation">(</span>
track_time string<span class="token punctuation">,</span>
url string<span class="token punctuation">,</span>
session_id string<span class="token punctuation">,</span>
referer string<span class="token punctuation">,</span>
ip string<span class="token punctuation">,</span>
end_user_id string<span class="token punctuation">,</span>
city_id string<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\t'</span>
STORED <span class="token keyword">AS</span> orc <span class="token punctuation">;</span>
</code></pre></div><p>（2）向表中加载数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span> log_orc <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> log_text <span class="token punctuation">;</span>
</code></pre></div><p>（3）查看表中数据大小,大小为2.8M</p> <div class="language-shell extra-class"><pre class="language-shell"><code>dfs -du -h /user/hive/warehouse/db1.db/log_orc<span class="token punctuation">;</span>
+----------------------------------------------------+--+
<span class="token operator">|</span>                     DFS Output                     <span class="token operator">|</span>
+----------------------------------------------------+--+
<span class="token operator">|</span> <span class="token number">2.8</span> M  <span class="token number">8.3</span> M  /user/hive/warehouse/db1.db/log_orc/000000_0 <span class="token operator">|</span>
+----------------------------------------------------+--+
</code></pre></div><p>orc这种存储格式，默认使用了zlib压缩方式来对数据进行压缩，所以数据会变成了2.8M，非常小</p> <p>####### 3）Parquet</p> <p>（1）创建表，存储数据格式为parquet</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> log_parquet<span class="token punctuation">(</span>
track_time string<span class="token punctuation">,</span>
url string<span class="token punctuation">,</span>
session_id string<span class="token punctuation">,</span>
referer string<span class="token punctuation">,</span>
ip string<span class="token punctuation">,</span>
end_user_id string<span class="token punctuation">,</span>
city_id string<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\t'</span>
STORED <span class="token keyword">AS</span> PARQUET <span class="token punctuation">;</span>  
</code></pre></div><p>（2）向表中加载数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span> log_parquet <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> log_text <span class="token punctuation">;</span>
</code></pre></div><p>（3）查看表中数据，大小为13.1M</p> <div class="language-shell extra-class"><pre class="language-shell"><code>dfs -du -h /user/hive/warehouse/db1.db/log_parquet<span class="token punctuation">;</span>
+----------------------------------------------------+--+
<span class="token operator">|</span>                     DFS Output                     <span class="token operator">|</span>
+----------------------------------------------------+--+
<span class="token operator">|</span> <span class="token number">13.1</span> M  <span class="token number">39.3</span> M  /user/hive/warehouse/db1.db/log_parquet/000000_0 <span class="token operator">|</span>
+----------------------------------------------------+--+
</code></pre></div><p>存储文件的压缩比总结：</p> <div class="language- extra-class"><pre class="language-text"><code>ORC &gt;  Parquet &gt;  textFile
</code></pre></div><h6 id="存储文件的查询速度测试"><a href="#存储文件的查询速度测试" class="header-anchor">#</a> 存储文件的查询速度测试</h6> <div class="language- extra-class"><pre class="language-text"><code>1）TextFile
hive (default)&gt; select count(*) from log_text;
_c0
100000
Time taken: 21.54 seconds, Fetched: 1 row(s)  

2）ORC
hive (default)&gt; select count(*) from log_orc;
_c0
100000
Time taken: 20.867 seconds, Fetched: 1 row(s)  

3）Parquet
hive (default)&gt; select count(*) from log_parquet; 
_c0
100000
Time taken: 22.922 seconds, Fetched: 1 row(s)

存储文件的查询速度总结：
ORC &gt; TextFile &gt; Parquet
</code></pre></div><h2 id="存储和压缩结合"><a href="#存储和压缩结合" class="header-anchor">#</a> 存储和压缩结合</h2> <p>官网：https://cwiki.apache.org/confluence/display/Hive/LanguageManual+ORC</p> <p>ORC存储方式的压缩信息如下，默认是使用ZLIB格式进行压缩：</p> <table><thead><tr><th>Key</th> <th>Default</th> <th>Notes</th></tr></thead> <tbody><tr><td>orc.compress</td> <td>ZLIB</td> <td>high level   compression (one of NONE, ZLIB, SNAPPY)</td></tr> <tr><td>orc.compress.size</td> <td>262,144</td> <td>number of bytes in   each compression chunk</td></tr> <tr><td>orc.stripe.size</td> <td>67,108,864</td> <td>number of bytes in   each stripe</td></tr> <tr><td>orc.row.index.stride</td> <td>10,000</td> <td>number of rows   between index entries (must be &gt;= 1000)</td></tr> <tr><td>orc.create.index</td> <td>true</td> <td>whether to create row   indexes</td></tr> <tr><td>orc.bloom.filter.columns</td> <td>&quot;&quot;</td> <td>comma separated list of column names for which bloom filter   should be created</td></tr> <tr><td>orc.bloom.filter.fpp</td> <td>0.05</td> <td>false positive probability for bloom filter (must &gt;0.0 and   &lt;1.0)</td></tr></tbody></table> <h5 id="_1-创建一个非压缩的的orc存储方式"><a href="#_1-创建一个非压缩的的orc存储方式" class="header-anchor">#</a> 1）创建一个非压缩的的ORC存储方式</h5> <p>修改ORC的压缩方式要通过关键字tblproperties来修改，tblproperties允许我们开发者定义一些自己的键值对信息。</p> <p>（1）建表语句</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> log_orc_none<span class="token punctuation">(</span>
track_time string<span class="token punctuation">,</span>
url string<span class="token punctuation">,</span>
session_id string<span class="token punctuation">,</span>
referer string<span class="token punctuation">,</span>
ip string<span class="token punctuation">,</span>
end_user_id string<span class="token punctuation">,</span>
city_id string
<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\t'</span>
STORED <span class="token keyword">AS</span> orc tblproperties <span class="token punctuation">(</span><span class="token string">&quot;orc.compress&quot;</span><span class="token operator">=</span><span class="token string">&quot;NONE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>（2）插入数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span> log_orc_none <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> log_text <span class="token punctuation">;</span>
</code></pre></div><p>（3）查看插入后数据,数据大小为7.7M</p> <div class="language-shell extra-class"><pre class="language-shell"><code>dfs -du -h /user/hive/warehouse/db1.db/log_orc_none<span class="token punctuation">;</span>
+----------------------------------------------------+--+
<span class="token operator">|</span>                     DFS Output                     <span class="token operator">|</span>
+----------------------------------------------------+--+
<span class="token operator">|</span> <span class="token number">7.7</span> M  <span class="token number">23.2</span> M  /user/hive/warehouse/db1.db/log_orc_none/000000_0 <span class="token operator">|</span>
+----------------------------------------------------+--+
</code></pre></div><h5 id="_2-创建一个snappy压缩的orc存储方式"><a href="#_2-创建一个snappy压缩的orc存储方式" class="header-anchor">#</a> 2）创建一个SNAPPY压缩的ORC存储方式</h5> <p>（1）建表语句</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> log_orc_snappy<span class="token punctuation">(</span>
track_time string<span class="token punctuation">,</span>
url string<span class="token punctuation">,</span>
session_id string<span class="token punctuation">,</span>
referer string<span class="token punctuation">,</span>
ip string<span class="token punctuation">,</span>
end_user_id string<span class="token punctuation">,</span>
city_id string
<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\t'</span>
STORED <span class="token keyword">AS</span> orc tblproperties <span class="token punctuation">(</span><span class="token string">&quot;orc.compress&quot;</span><span class="token operator">=</span><span class="token string">&quot;SNAPPY&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>（2）插入数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span> log_orc_snappy <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> log_text <span class="token punctuation">;</span>
</code></pre></div><p>（3）查看插入后数据,数据大小为3.8M</p> <div class="language-shell extra-class"><pre class="language-shell"><code>dfs -du -h /user/hive/warehouse/myhive.db/log_orc_snappy <span class="token punctuation">;</span>
+----------------------------------------------------+--+
<span class="token operator">|</span>                     DFS Output                     <span class="token operator">|</span>
+----------------------------------------------------+--+
<span class="token operator">|</span> <span class="token number">3.8</span> M  <span class="token number">11.4</span> M  /user/hive/warehouse/db1.db/log_orc_snappy/000000_0 <span class="token operator">|</span>
+----------------------------------------------------+--+
</code></pre></div><p>3）上一节中默认创建的ORC存储方式，导入数据后的大小为2.8M</p> <div class="language-shell extra-class"><pre class="language-shell"><code>dfs -du -h /user/hive/warehouse/db1.db/log_orc <span class="token punctuation">;</span>
+----------------------------------------------------+--+
<span class="token operator">|</span>                     DFS Output                     <span class="token operator">|</span>
+----------------------------------------------------+--+
<span class="token operator">|</span> <span class="token number">2.8</span> M  <span class="token number">8.3</span> M  /user/hive/warehouse/db1.db/log_orc/000000_0 <span class="token operator">|</span>
+----------------------------------------------------+--+
</code></pre></div><p>比Snappy压缩的还小。原因是orc存储文件默认采用ZLIB压缩。比snappy压缩的小。</p> <p>4）存储方式和压缩总结：</p> <p>==在实际的项目开发当中，hive表的数据存储格式一般选择：orc或parquet。压缩方式一般选择snappy。==</p> <h2 id="企业实战"><a href="#企业实战" class="header-anchor">#</a> 企业实战</h2> <h6 id="_1-通过multidelimitserde-解决多字符分割场景"><a href="#_1-通过multidelimitserde-解决多字符分割场景" class="header-anchor">#</a> 1 通过MultiDelimitSerDe 解决多字符分割场景</h6> <ul><li>1、创建表,指定分隔符为&quot;##&quot;</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> myhive<span class="token punctuation">;</span>
<span class="token keyword">use</span> myhive<span class="token punctuation">;</span>
<span class="token keyword">create</span>  <span class="token keyword">table</span> t1 <span class="token punctuation">(</span>id String<span class="token punctuation">,</span> name string<span class="token punctuation">)</span>
<span class="token keyword">row</span> format serde <span class="token string">'org.apache.hadoop.hive.contrib.serde2.MultiDelimitSerDe'</span>
<span class="token keyword">WITH</span> SERDEPROPERTIES <span class="token punctuation">(</span><span class="token string">&quot;field.delim&quot;</span><span class="token operator">=</span><span class="token string">&quot;##&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><ul><li>2、准备数据 t1.txt</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>cd <span class="token operator">/</span>kkb<span class="token operator">/</span>install<span class="token operator">/</span>hivedatas
vim t1<span class="token punctuation">.</span>txt


<span class="token number">1</span><span class="token comment">##xiaoming</span>
<span class="token number">2</span><span class="token comment">##xiaowang</span>
<span class="token number">3</span><span class="token comment">##xiaozhang</span>
</code></pre></div><ul><li>3、加载数据</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/t1.txt'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> t1<span class="token punctuation">;</span>
</code></pre></div><ul><li>4、查询数据</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node1:10000&gt; select * from t1;</span>
<span class="token operator">+</span><span class="token comment">--------+------------+--+</span>
<span class="token operator">|</span> t1<span class="token punctuation">.</span>id  <span class="token operator">|</span>  t1<span class="token punctuation">.</span>name   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> xiaoming   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> xiaowang   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>      <span class="token operator">|</span> xiaozhang  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+--+</span>
</code></pre></div><h6 id="_2-通过regexserde-解决多字符分割场景"><a href="#_2-通过regexserde-解决多字符分割场景" class="header-anchor">#</a> 2 通过RegexSerDe 解决多字符分割场景</h6> <ul><li>1、创建表</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span>  <span class="token keyword">table</span> t2<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span> name string<span class="token punctuation">)</span>
<span class="token keyword">row</span> format serde <span class="token string">'org.apache.hadoop.hive.serde2.RegexSerDe'</span> 
<span class="token keyword">WITH</span> SERDEPROPERTIES <span class="token punctuation">(</span><span class="token string">&quot;input.regex&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;^(.*)\\#\\#(.*)$&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">--参考java正则表达式即可</span>
</code></pre></div><ul><li>2、准备数据 t1.txt</li></ul> <div class="language- extra-class"><pre class="language-text"><code>1##xiaoming
2##xiaowang
3##xiaozhang
</code></pre></div><ul><li>3、加载数据</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/t1.txt'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> t2<span class="token punctuation">;</span>
</code></pre></div><ul><li>4、查询数据</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node1:10000&gt; select * from t2;</span>
<span class="token operator">+</span><span class="token comment">--------+------------+--+</span>
<span class="token operator">|</span> t2<span class="token punctuation">.</span>id  <span class="token operator">|</span>  t2<span class="token punctuation">.</span>name   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> xiaoming   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> xiaowang   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>      <span class="token operator">|</span> xiaozhang  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+--+</span>
</code></pre></div><h2 id="hive的企业级调优"><a href="#hive的企业级调优" class="header-anchor">#</a> hive的企业级调优</h2> <h5 id="_1、fetch抓取"><a href="#_1、fetch抓取" class="header-anchor">#</a> 1、Fetch抓取</h5> <ul><li><p>Fetch抓取是指，Hive中对某些情况的<strong>查询</strong>可以不必使用MapReduce计算。</p> <ul><li>例如：select * from score;</li> <li>在这种情况下，Hive可以简单地读取employee对应的存储目录下的文件，然后输出查询结果到控制台</li></ul></li> <li><p>在hive-default.xml.template文件中 hive.fetch.task.conversion默认是more，老版本hive默认是minimal，该属性修改为more以后，在全局查找、字段查找、limit查找等都不走mapreduce。</p></li> <li><p>案例实操</p> <ul><li>把 hive.fetch.task.conversion设置成none，然后执行查询语句，都会执行mapreduce程序</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">fetch</span><span class="token punctuation">.</span>task<span class="token punctuation">.</span>conversion<span class="token operator">=</span>none<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score<span class="token punctuation">;</span>
<span class="token keyword">select</span> s_id <span class="token keyword">from</span> score<span class="token punctuation">;</span>
<span class="token keyword">select</span> s_id <span class="token keyword">from</span> score <span class="token keyword">limit</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>把hive.fetch.task.conversion设置成more，然后执行查询语句，如下查询方式都不会执行mapreduce程序。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">fetch</span><span class="token punctuation">.</span>task<span class="token punctuation">.</span>conversion<span class="token operator">=</span>more<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score<span class="token punctuation">;</span>
<span class="token keyword">select</span> s_id <span class="token keyword">from</span> score<span class="token punctuation">;</span>
<span class="token keyword">select</span> s_id <span class="token keyword">from</span> score <span class="token keyword">limit</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h5 id="_2、本地模式"><a href="#_2、本地模式" class="header-anchor">#</a> 2、本地模式</h5> <ul><li><p>在Hive客户端测试时，默认情况下是启用hadoop的job模式,把任务提交到集群中运行，这样会导致计算非常缓慢；</p></li> <li><p>Hive可以通过本地模式在单台机器上处理任务。对于小数据集，执行时间可以明显被缩短。</p></li> <li><p>示意图如下：</p> <img src="hive.assets/image-20200225151252482.png" alt="image-20200225151252482" style="zoom:80%;"></li> <li><p>案例实操</p></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--开启本地模式，并执行查询语句</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span><span class="token keyword">mode</span><span class="token punctuation">.</span><span class="token keyword">local</span><span class="token punctuation">.</span>auto<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">//开启本地mr</span>

<span class="token comment">--设置local mr的最大输入数据量，当输入数据量小于这个值时采用local  mr的方式，</span>
<span class="token comment">--默认为134217728，即128M</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span><span class="token keyword">mode</span><span class="token punctuation">.</span><span class="token keyword">local</span><span class="token punctuation">.</span>auto<span class="token punctuation">.</span>inputbytes<span class="token punctuation">.</span>max<span class="token operator">=</span><span class="token number">50000000</span><span class="token punctuation">;</span>

<span class="token comment">--设置local mr的最大输入文件个数，当输入文件个数小于这个值时采用local mr的方式，</span>
<span class="token comment">--默认为4</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span><span class="token keyword">mode</span><span class="token punctuation">.</span><span class="token keyword">local</span><span class="token punctuation">.</span>auto<span class="token punctuation">.</span>input<span class="token punctuation">.</span>files<span class="token punctuation">.</span>max<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>


<span class="token comment">--执行查询的sql语句</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student cluster <span class="token keyword">by</span> s_id<span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--关闭本地运行模式</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span><span class="token keyword">mode</span><span class="token punctuation">.</span><span class="token keyword">local</span><span class="token punctuation">.</span>auto<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student cluster <span class="token keyword">by</span> s_id<span class="token punctuation">;</span>
</code></pre></div><h5 id="_3、表的优化"><a href="#_3、表的优化" class="header-anchor">#</a> 3、表的优化</h5> <h6 id="小表、大表-join"><a href="#小表、大表-join" class="header-anchor">#</a> 小表、大表 join</h6> <ul><li><p>将key相对分散，并且数据量小的表放在join的左边，hive会将小表进行缓存，这样可以有效减少内存溢出错误发生的几率。但是实际测试发现：新版的hive已经对小表 join 大表和大表 join 小表进行了优化。小表放在左边和右边已经没有明显区别。</p></li> <li><p>再进一步，可以使用map join让小的维度表（1000条以下的记录条数）先进内存。在map端完成reduce。</p></li> <li><p>多个表关联时，最好分拆成小段，避免大sql（否则无法控制中间Job）。a join b--&gt;b join c</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span>  <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> s_id<span class="token punctuation">)</span>  <span class="token keyword">from</span> score<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>s_id<span class="token punctuation">)</span> <span class="token keyword">from</span> score <span class="token keyword">group</span> <span class="token keyword">by</span> s_id<span class="token punctuation">;</span>  <span class="token comment">#在map端进行聚合，效率更高</span>


<span class="token keyword">select</span>  <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> s_id<span class="token punctuation">)</span>  <span class="token keyword">from</span> score<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> score <span class="token keyword">group</span>  <span class="token keyword">by</span>  s_id<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">## </span>
</code></pre></div></li></ul> <h6 id="大表-join-大表"><a href="#大表-join-大表" class="header-anchor">#</a> 大表 join 大表</h6> <ul><li><p>1．空 key 过滤</p> <ul><li><p>有时join超时是因为某些key对应的数据太多，而相同key对应的数据都会发送到相同的reducetask上，从而导致内存不够。</p></li> <li><p>此时我们应该仔细分析这些异常的key，很多情况下，这些key对应的数据是异常数据，我们需要在SQL语句中进行过滤掉这些数据。下面进行空key过滤的时候</p></li> <li><p>测试环境准备：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">## 数据格式大致如下，第一个字段是id,</span>
<span class="token number">1</span>	<span class="token number">20111230000005</span>	<span class="token number">57375476989</span>eea12893c0c3811607bcf	奇艺高清	<span class="token number">1</span>	<span class="token number">1</span>	http:<span class="token comment">//www.qiyi.com/</span>
<span class="token number">2</span>	<span class="token number">20111230000005</span>	<span class="token number">66</span>c5bb7774e31d0a22278249b26bc83a	凡人修仙传	<span class="token number">3</span>	<span class="token number">1</span>	http:<span class="token comment">//www.booksky.org/BookDetail.aspx?BookID=1050804&amp;Level=1</span>
<span class="token number">3</span>	<span class="token number">20111230000007</span>	b97920521c78de70ac38e3713f524b50	本本联盟	<span class="token number">1</span>	<span class="token number">1</span>	http:<span class="token comment">//www.bblianmeng.com/</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">use</span> myhive<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> ori<span class="token punctuation">(</span>id <span class="token keyword">bigint</span><span class="token punctuation">,</span> <span class="token keyword">time</span> <span class="token keyword">bigint</span><span class="token punctuation">,</span> uid string<span class="token punctuation">,</span> keyword string<span class="token punctuation">,</span> url_rank <span class="token keyword">int</span><span class="token punctuation">,</span> click_num <span class="token keyword">int</span><span class="token punctuation">,</span> click_url string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> nullidtable<span class="token punctuation">(</span>id <span class="token keyword">bigint</span><span class="token punctuation">,</span> <span class="token keyword">time</span> <span class="token keyword">bigint</span><span class="token punctuation">,</span> uid string<span class="token punctuation">,</span> keyword string<span class="token punctuation">,</span> url_rank <span class="token keyword">int</span><span class="token punctuation">,</span> click_num <span class="token keyword">int</span><span class="token punctuation">,</span> click_url string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> jointable<span class="token punctuation">(</span>id <span class="token keyword">bigint</span><span class="token punctuation">,</span> <span class="token keyword">time</span> <span class="token keyword">bigint</span><span class="token punctuation">,</span> uid string<span class="token punctuation">,</span> keyword string<span class="token punctuation">,</span> url_rank <span class="token keyword">int</span><span class="token punctuation">,</span> click_num <span class="token keyword">int</span><span class="token punctuation">,</span> click_url string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token comment">## 把没那么多id为null的数据加载进ori</span>
<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/hive_big_table/*'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> ori<span class="token punctuation">;</span> 
<span class="token comment">## 把很多id为null的数据加载进nullidtable</span>
<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/hive_have_null_id/*'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> nullidtable<span class="token punctuation">;</span>
</code></pre></div><p>过滤空key与不过滤空key的结果比较</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#不过滤：</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> jointable
<span class="token keyword">SELECT</span> a<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> nullidtable a <span class="token keyword">JOIN</span> ori b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
<span class="token comment">#结果：</span>
<span class="token keyword">No</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">152.135</span> seconds<span class="token punctuation">)</span>

<span class="token comment">#过滤：</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> jointable
<span class="token keyword">SELECT</span> a<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> nullidtable <span class="token keyword">WHERE</span> id <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">)</span> a <span class="token keyword">JOIN</span> ori b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
<span class="token comment">#结果：</span>
<span class="token keyword">No</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">141.585</span> seconds<span class="token punctuation">)</span>
</code></pre></div></li></ul></li> <li><p>2、空 key 转换</p> <ul><li><p>有时虽然某个 key 为空对应的数据很多，但是相应的数据不是异常数据，必须要包含在 join 的结果中，此时我们可以表 a 中 key 为空的字段赋一个随机的值，使得数据随机均匀地分不到不同的 reducer 上。</p></li> <li><p>不随机分布：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>reducers<span class="token punctuation">.</span>bytes<span class="token punctuation">.</span>per<span class="token punctuation">.</span>reducer<span class="token operator">=</span><span class="token number">32123456</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>job<span class="token punctuation">.</span>reduces<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> jointable
<span class="token keyword">SELECT</span> a<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> nullidtable a
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> ori b <span class="token keyword">ON</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> a<span class="token punctuation">.</span>id <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token keyword">THEN</span> <span class="token string">'hive'</span> <span class="token keyword">ELSE</span> a<span class="token punctuation">.</span>id <span class="token keyword">END</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
<span class="token keyword">No</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">41.668</span> seconds<span class="token punctuation">)</span>  
</code></pre></div></li> <li><p>结果：这样的后果就是所有为null值的id全部都变成了相同的字符串，及其容易造成数据的倾斜（所有的key相同，相同key的数据依然会到同一个reduce当中去）</p> <p>为了解决这种情况，我们可以通过hive的rand函数，随记的给每一个为空的id赋上一个随机值，这样就不会造成数据倾斜。</p></li> <li><p>随机分布：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>reducers<span class="token punctuation">.</span>bytes<span class="token punctuation">.</span>per<span class="token punctuation">.</span>reducer<span class="token operator">=</span><span class="token number">32123456</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>job<span class="token punctuation">.</span>reduces<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> jointable
<span class="token keyword">SELECT</span> a<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> nullidtable a
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> ori b <span class="token keyword">ON</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> a<span class="token punctuation">.</span>id <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token keyword">THEN</span> concat<span class="token punctuation">(</span><span class="token string">'hive'</span><span class="token punctuation">,</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ELSE</span> a<span class="token punctuation">.</span>id <span class="token keyword">END</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>id<span class="token punctuation">;</span>

<span class="token keyword">No</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">42.594</span> seconds<span class="token punctuation">)</span>  
</code></pre></div></li></ul></li></ul> <h6 id="大表join小表与小表join大表实测"><a href="#大表join小表与小表join大表实测" class="header-anchor">#</a> 大表join小表与小表join大表实测</h6> <p>需求：测试大表JOIN小表和小表JOIN大表的效率 （新的版本当中已经没有区别了，旧的版本当中需要使用小表）</p> <p>（1）建大表、小表和JOIN后表的语句</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> bigtable<span class="token punctuation">(</span>id <span class="token keyword">bigint</span><span class="token punctuation">,</span> <span class="token keyword">time</span> <span class="token keyword">bigint</span><span class="token punctuation">,</span> uid string<span class="token punctuation">,</span> keyword string<span class="token punctuation">,</span> url_rank <span class="token keyword">int</span><span class="token punctuation">,</span> click_num <span class="token keyword">int</span><span class="token punctuation">,</span> click_url string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> smalltable<span class="token punctuation">(</span>id <span class="token keyword">bigint</span><span class="token punctuation">,</span> <span class="token keyword">time</span> <span class="token keyword">bigint</span><span class="token punctuation">,</span> uid string<span class="token punctuation">,</span> keyword string<span class="token punctuation">,</span> url_rank <span class="token keyword">int</span><span class="token punctuation">,</span> click_num <span class="token keyword">int</span><span class="token punctuation">,</span> click_url string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> jointable2<span class="token punctuation">(</span>id <span class="token keyword">bigint</span><span class="token punctuation">,</span> <span class="token keyword">time</span> <span class="token keyword">bigint</span><span class="token punctuation">,</span> uid string<span class="token punctuation">,</span> keyword string<span class="token punctuation">,</span> url_rank <span class="token keyword">int</span><span class="token punctuation">,</span> click_num <span class="token keyword">int</span><span class="token punctuation">,</span> click_url string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

</code></pre></div><p>（2）分别向大表和小表中导入数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code>hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/big_data'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> bigtable<span class="token punctuation">;</span>

hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/small_data'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> smalltable<span class="token punctuation">;</span>
</code></pre></div><h6 id="map-join"><a href="#map-join" class="header-anchor">#</a> map  join</h6> <ul><li><p>如果不指定MapJoin 或者不符合 MapJoin的条件，那么Hive解析器会将Join操作转换成Common Join，即：在Reduce阶段完成join。容易发生数据倾斜。可以用 MapJoin 把小表全部加载到内存，在map端进行join，避免reducer处理,参考学习mpareduce时候的mapjoin,原理是一样的。</p></li> <li><p>1、开启MapJoin参数设置</p></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code> <span class="token comment">--默认为true</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span>auto<span class="token punctuation">.</span><span class="token keyword">convert</span><span class="token punctuation">.</span><span class="token keyword">join</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>2、大表小表的阈值设置（默认25M一下认为是小表）</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> hive<span class="token punctuation">.</span>mapjoin<span class="token punctuation">.</span>smalltable<span class="token punctuation">.</span>filesize<span class="token operator">=</span><span class="token number">26214400</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>3、MapJoin工作机制</li></ul> <p><img src="/assets/img/xxx-1570506631515.1161c07e.jpg" alt="xxx"></p> <p>首先是Task A，它是一个Local Task（在客户端本地执行的Task），负责扫描小表b的数据，将其转换成一个HashTable的数据结构，并写入本地的文件中，之后将该文件加载到DistributeCache分布式缓存中。</p> <p>接下来是Task B，该任务是一个没有Reduce的MR，启动MapTasks扫描大表a,在Map阶段，根据a的每一条记录去和DistributeCache中b表对应的HashTable关联，并直接输出结果。</p> <p>由于MapJoin没有Reduce，所以由Map直接输出结果文件，有多少个Map Task，就有多少个结果文件。</p> <p><strong>案例实操：</strong></p> <p>（1）开启Mapjoin功能</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> hive<span class="token punctuation">.</span>auto<span class="token punctuation">.</span><span class="token keyword">convert</span><span class="token punctuation">.</span><span class="token keyword">join</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 默认为<span class="token boolean">true</span>
</code></pre></div><p>（2）执行小表JOIN大表语句</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> jointable2
<span class="token keyword">SELECT</span> b<span class="token punctuation">.</span>id<span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token keyword">time</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> b<span class="token punctuation">.</span>keyword<span class="token punctuation">,</span> b<span class="token punctuation">.</span>url_rank<span class="token punctuation">,</span> b<span class="token punctuation">.</span>click_num<span class="token punctuation">,</span> b<span class="token punctuation">.</span>click_url
<span class="token keyword">FROM</span> smalltable s
<span class="token keyword">JOIN</span> bigtable  b
<span class="token keyword">ON</span> s<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>id<span class="token punctuation">;</span>

<span class="token keyword">Time</span> taken: <span class="token number">31.814</span> seconds
</code></pre></div><p>（3）执行大表JOIN小表语句</p> <div class="language- extra-class"><pre class="language-text"><code>INSERT OVERWRITE TABLE jointable2
SELECT b.id, b.time, b.uid, b.keyword, b.url_rank, b.click_num, b.click_url
FROM bigtable  b
JOIN smalltable  s
ON s.id = b.id;

Time taken: 28.46 seconds
</code></pre></div><h6 id="group-by"><a href="#group-by" class="header-anchor">#</a> group By</h6> <p>默认情况下，Map阶段同一Key数据分发给一个reduce，当一个key数据过大时就倾斜了。</p> <p>并不是所有的聚合操作都需要在Reduce端完成，很多聚合操作都可以先在Map端进行部分聚合，最后在Reduce端得出最终结果。</p> <p>开启Map端聚合参数设置:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--是否在Map端进行聚合，默认为True</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span>map<span class="token punctuation">.</span>aggr <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">--在Map端进行聚合操作的条目数目</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span>groupby<span class="token punctuation">.</span>mapaggr<span class="token punctuation">.</span>checkinterval <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>
<span class="token comment">--有数据倾斜的时候进行负载均衡（默认是false）</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span>groupby<span class="token punctuation">.</span>skewindata <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

当hive<span class="token punctuation">.</span>groupby<span class="token punctuation">.</span>skewindata选项设定为 <span class="token boolean">true</span>，生成的查询计划会有两个MR Job。第一个MR Job中，Map的输出结果会随机分布到Reduce中，每个Reduce做部分聚合操作，并输出结果，这样处理的结果是相同的<span class="token keyword">Group</span> <span class="token keyword">By</span> <span class="token keyword">Key</span>有可能被分发到不同的Reduce中，从而达到负载均衡的目的；第二个MR Job再根据预处理的数据结果按照<span class="token keyword">Group</span> <span class="token keyword">By</span> <span class="token keyword">Key</span>分布到Reduce中（这个过程可以保证相同的<span class="token keyword">Group</span> <span class="token keyword">By</span> <span class="token keyword">Key</span>被分布到同一个Reduce中），最后完成最终的聚合操作。
</code></pre></div><p><img src="/assets/img/image-20200225223900011.b5fb4bf2.png" alt="image-20200225223900011"></p> <h6 id="count-distinct"><a href="#count-distinct" class="header-anchor">#</a> count(distinct)</h6> <ul><li><p>数据量小的时候无所谓，数据量大的情况下，由于count distinct 操作需要用一个reduce Task来完成，这一个Reduce需要处理的数据量太大，就会导致整个Job很难完成，一般count distinct使用先group by 再count的方式替换</p> <p>环境准备：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> bigtable<span class="token punctuation">(</span>id <span class="token keyword">bigint</span><span class="token punctuation">,</span> <span class="token keyword">time</span> <span class="token keyword">bigint</span><span class="token punctuation">,</span> uid string<span class="token punctuation">,</span> keyword string<span class="token punctuation">,</span> url_rank <span class="token keyword">int</span><span class="token punctuation">,</span> click_num <span class="token keyword">int</span><span class="token punctuation">,</span> click_url string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/kkb/install/hivedatas/data/100万条大表数据（id除以10取整）/bigtable'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> bigtable<span class="token punctuation">;</span>


<span class="token comment">--每个reduce任务处理的数据量 默认256000000（256M）</span>
 <span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>reducers<span class="token punctuation">.</span>bytes<span class="token punctuation">.</span>per<span class="token punctuation">.</span>reducer<span class="token operator">=</span><span class="token number">32123456</span><span class="token punctuation">;</span>
 
 <span class="token keyword">select</span>  <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> ip <span class="token punctuation">)</span>  <span class="token keyword">from</span> log_text<span class="token punctuation">;</span>
 
<span class="token comment">--转换成:</span>
 <span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>reducers<span class="token punctuation">.</span>bytes<span class="token punctuation">.</span>per<span class="token punctuation">.</span>reducer<span class="token operator">=</span><span class="token number">32123456</span><span class="token punctuation">;</span>
 <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> ip <span class="token keyword">from</span> log_text <span class="token keyword">group</span> <span class="token keyword">by</span> ip<span class="token punctuation">)</span> t<span class="token punctuation">;</span>

<span class="token comment">--虽然会多用一个Job来完成，但在数据量大的情况下，这个绝对是值得的。</span>
</code></pre></div></li></ul> <h6 id="笛卡尔积"><a href="#笛卡尔积" class="header-anchor">#</a> 笛卡尔积</h6> <ul><li>尽量避免笛卡尔积，即避免join的时候不加on条件，或者无效的on条件</li> <li>Hive只能使用1个reducer来完成笛卡尔积。</li></ul> <h5 id="_4、使用分区剪裁、列剪裁"><a href="#_4、使用分区剪裁、列剪裁" class="header-anchor">#</a> 4、使用分区剪裁、列剪裁</h5> <p>尽可能早地过滤掉尽可能多的数据量，避免大量数据流入外层SQL。</p> <p><strong>列剪裁</strong></p> <ul><li>只获取需要的列的数据，减少数据输入。</li></ul> <p><strong>分区裁剪</strong></p> <ul><li>分区在hive实质上是目录，分区裁剪可以方便直接地过滤掉大部分数据。</li></ul> <p>尽量使用<strong>分区过滤</strong>，少用select  *</p> <p>案例环境准备：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> ori<span class="token punctuation">(</span>id <span class="token keyword">bigint</span><span class="token punctuation">,</span> <span class="token keyword">time</span> <span class="token keyword">bigint</span><span class="token punctuation">,</span> uid string<span class="token punctuation">,</span> keyword string<span class="token punctuation">,</span> url_rank <span class="token keyword">int</span><span class="token punctuation">,</span> click_num <span class="token keyword">int</span><span class="token punctuation">,</span> click_url string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> bigtable<span class="token punctuation">(</span>id <span class="token keyword">bigint</span><span class="token punctuation">,</span> <span class="token keyword">time</span> <span class="token keyword">bigint</span><span class="token punctuation">,</span> uid string<span class="token punctuation">,</span> keyword string<span class="token punctuation">,</span> url_rank <span class="token keyword">int</span><span class="token punctuation">,</span> click_num <span class="token keyword">int</span><span class="token punctuation">,</span> click_url string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>

<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/home/admin/softwares/data/加递增id的原始数据/ori'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> ori<span class="token punctuation">;</span>

<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/home/admin/softwares/data/100万条大表数据（id除以10取整）/bigtable'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> bigtable<span class="token punctuation">;</span>
</code></pre></div><p>先关联再Where：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>id
<span class="token keyword">FROM</span> bigtable a
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> ori b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>id
<span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>id <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre></div><p>正确的写法是写在ON后面：先Where再关联</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>id
<span class="token keyword">FROM</span> ori a
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> bigtable b <span class="token keyword">ON</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>id <span class="token operator">&lt;=</span> <span class="token number">10</span> <span class="token operator">AND</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或者直接写成子查询：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>id
<span class="token keyword">FROM</span> bigtable a
<span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id
<span class="token keyword">FROM</span> ori
<span class="token keyword">WHERE</span> id <span class="token operator">&lt;=</span> <span class="token number">10</span>
<span class="token punctuation">)</span> b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre></div><h5 id="_5、并行执行"><a href="#_5、并行执行" class="header-anchor">#</a> 5、并行执行</h5> <ul><li>把一个sql语句中没有相互依赖的阶段并行去运行。提高集群资源利用率</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--开启并行执行</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>parallel<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">--同一个sql允许最大并行度，默认为8。</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>parallel<span class="token punctuation">.</span>thread<span class="token punctuation">.</span>number<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_6、严格模式"><a href="#_6、严格模式" class="header-anchor">#</a> 6、严格模式</h5> <ul><li><p>Hive提供了一个严格模式，可以防止用户执行那些可能意想不到的不好的影响的查询。</p></li> <li><p>通过设置属性hive.mapred.mode值为默认是非严格模式<strong>nonstrict</strong> 。开启严格模式需要修改hive.mapred.mode值为<strong>strict</strong>，开启严格模式可以禁止3种类型的查询。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--设置非严格模式（默认）</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span>mapred<span class="token punctuation">.</span><span class="token keyword">mode</span><span class="token operator">=</span>nonstrict<span class="token punctuation">;</span>

<span class="token comment">--设置严格模式</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span>mapred<span class="token punctuation">.</span><span class="token keyword">mode</span><span class="token operator">=</span>strict<span class="token punctuation">;</span>
</code></pre></div></li> <li><p>（1）对于分区表，除非where语句中含有分区字段过滤条件来限制范围，否则不允许执行</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">## 设置严格模式下 执行select *语句报错； 非严格模式下是可以的</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; show partitions score;</span>
<span class="token operator">+</span><span class="token comment">---------------+--+</span>
<span class="token operator">|</span>   <span class="token keyword">partition</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+--+</span>
<span class="token operator">|</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token number">201805</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+--+</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from score; #报错</span>
Error: Error <span class="token keyword">while</span> compiling statement: FAILED: SemanticException <span class="token punctuation">[</span>Error <span class="token number">10041</span><span class="token punctuation">]</span>: <span class="token keyword">No</span> <span class="token keyword">partition</span> predicate found <span class="token keyword">for</span> Alias <span class="token string">&quot;score&quot;</span> <span class="token keyword">Table</span> <span class="token string">&quot;score&quot;</span> <span class="token punctuation">(</span>state<span class="token operator">=</span><span class="token number">42000</span><span class="token punctuation">,</span>code<span class="token operator">=</span><span class="token number">10041</span><span class="token punctuation">)</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from score where month=201805;</span>
<span class="token operator">+</span><span class="token comment">-------------+-------------+----------------+--------------+--+</span>
<span class="token operator">|</span> score<span class="token punctuation">.</span>s_id  <span class="token operator">|</span> score<span class="token punctuation">.</span>c_id  <span class="token operator">|</span> score<span class="token punctuation">.</span>s_score  <span class="token operator">|</span> score<span class="token punctuation">.</span><span class="token keyword">month</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+-------------+----------------+--------------+--+</span>
<span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">80</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">90</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">99</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">70</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">60</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">80</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">80</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">80</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">80</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>          <span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">50</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>          <span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">30</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">04</span>          <span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">20</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">05</span>          <span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">76</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">05</span>          <span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">87</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">06</span>          <span class="token operator">|</span> <span class="token number">01</span>          <span class="token operator">|</span> <span class="token number">31</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">06</span>          <span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">34</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">07</span>          <span class="token operator">|</span> <span class="token number">02</span>          <span class="token operator">|</span> <span class="token number">89</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">07</span>          <span class="token operator">|</span> <span class="token number">03</span>          <span class="token operator">|</span> <span class="token number">98</span>             <span class="token operator">|</span> <span class="token number">201805</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+-------------+----------------+--------------+--+</span>
</code></pre></div></li> <li><p>（2）对于使用了order by语句的查询，要求必须使用limit语句。因为order by是全局排序，只产生一个reducetask，是比较危险的,数据量可能很大。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--设置严格模式下 执行sql语句报错； 非严格模式下是可以的</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> order_partition <span class="token keyword">where</span> <span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'2019-03'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> order_price<span class="token punctuation">;</span> 

异常信息：Error: Error <span class="token keyword">while</span> compiling statement: FAILED: SemanticException <span class="token number">1</span>:<span class="token number">61</span> <span class="token operator">In</span> strict <span class="token keyword">mode</span><span class="token punctuation">,</span> <span class="token keyword">if</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token operator">is</span> specified<span class="token punctuation">,</span> <span class="token keyword">LIMIT</span> must also be specified<span class="token punctuation">.</span> Error encountered near token <span class="token string">'order_price'</span>
</code></pre></div></li> <li><p>（3）限制笛卡尔积的查询</p> <ul><li>严格模式下，避免出现笛卡尔积的查询</li></ul></li></ul> <h5 id="_7、jvm重用"><a href="#_7、jvm重用" class="header-anchor">#</a> 7、JVM重用</h5> <ul><li><p>JVM重用是Hadoop调优参数的内容，其对Hive的性能具有非常大的影响，特别是对于很难避免小文件的场景或task特别多的场景，这类场景大多数执行时间都很短。</p> <p>Hadoop的默认配置通常是使用派生JVM来执行map和Reduce任务的。这时JVM的启动过程可能会造成相当大的开销，尤其是执行的job包含有成百上千task任务的情况。JVM重用可以使得JVM实例在同一个job中重新使用N次。N的值可以在Hadoop的mapred-site.xml文件中进行配置。通常在10-20之间，具体多少需要根据具体业务场景测试得出。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;property&gt;
  &lt;name&gt;mapreduce.job.jvm.numtasks&lt;/name&gt;
  &lt;value&gt;10&lt;/value&gt;
  &lt;description&gt;How many tasks to run per jvm. If set to -1, there is
  no limit. 
  &lt;/description&gt;
&lt;/property&gt;

</code></pre></div><p>我们也可以在hive当中通过</p> <div class="language- extra-class"><pre class="language-text"><code> set  mapred.job.reuse.jvm.num.tasks=10;
</code></pre></div><p>这个设置来设置我们的jvm重用</p> <p>这个功能的缺点是，开启JVM重用将一直占用使用到的task插槽，以便进行重用，直到任务完成后才能释放。如果某个“不平衡的”job中有某几个reduce task执行的时间要比其他Reduce task消耗的时间多的多的话，那么保留的插槽就会一直空闲着却无法被其他的job使用，直到所有的task都结束了才会释放。</p></li></ul> <h5 id="_8、推测执行"><a href="#_8、推测执行" class="header-anchor">#</a> 8、推测执行</h5> <ul><li><p>在分布式集群环境下，因为程序Bug（包括Hadoop本身的bug），负载不均衡或者资源分布不均等原因，会造成同一个job作业的多个任务之间运行速度不一致，有些任务的运行速度可能明显慢于其他任务（比如一个作业的某个任务进度只有50%，而其他所有任务已经运行完毕），则这些任务会拖慢作业的整体执行进度。为了避免这种情况发生，Hadoop采用了推测执行（Speculative Execution）机制，它根据一定的法则推测出“拖后腿”的任务，并为这样的任务启动一个备份任务，让该任务与原始任务同时处理同一份数据，并最终选用最先成功运行完成任务的计算结果作为最终结果。</p> <p><img src="/assets/img/image-20200225233240867.22871f70.png" alt="image-20200225233240867"></p> <p>设置开启推测执行参数：Hadoop的mapred-site.xml文件中进行配置</p></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>mapreduce<span class="token punctuation">.</span>map<span class="token punctuation">.</span>speculative<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token keyword">value</span><span class="token operator">&gt;</span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">value</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span><span class="token keyword">If</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">then</span> multiple instances <span class="token keyword">of</span> <span class="token keyword">some</span> map tasks 
               may be executed <span class="token operator">in</span> parallel<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>mapreduce<span class="token punctuation">.</span>reduce<span class="token punctuation">.</span>speculative<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token keyword">value</span><span class="token operator">&gt;</span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">value</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span><span class="token keyword">If</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">then</span> multiple instances <span class="token keyword">of</span> <span class="token keyword">some</span> reduce tasks 
               may be executed <span class="token operator">in</span> parallel<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

</code></pre></div><p>不过hive本身也提供了配置项来控制reduce-side的推测执行：</p> <div class="language- extra-class"><pre class="language-text"><code>  &lt;property&gt;
    &lt;name&gt;hive.mapred.reduce.tasks.speculative.execution&lt;/name&gt;
    &lt;value&gt;true&lt;/value&gt;
    &lt;description&gt;Whether speculative execution for reducers should be turned on. &lt;/description&gt;
  &lt;/property&gt;

</code></pre></div><p>关于调优这些推测执行变量，还很难给一个具体的建议。如果用户对于运行时的偏差非常敏感的话，那么可以将这些功能关闭掉。如果用户因为输入数据量很大而需要执行长时间的map或者Reduce task的话，那么启动推测执行造成的浪费是非常巨大大。</p> <h5 id="_9、压缩"><a href="#_9、压缩" class="header-anchor">#</a> 9、压缩</h5> <p>​	参见数据的压缩</p> <ul><li><p>Hive表中间数据压缩</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#设置为true为激活中间数据压缩功能，默认是false，没有开启</span>
<span class="token builtin class-name">set</span> hive.exec.compress.intermediate<span class="token operator">=</span>true<span class="token punctuation">;</span>
<span class="token comment">#设置中间数据的压缩算法</span>
<span class="token builtin class-name">set</span> mapred.map.output.compression.codec<span class="token operator">=</span> org.apache.hadoop.io.compress.SnappyCodec<span class="token punctuation">;</span>

</code></pre></div></li> <li><p>Hive表最终输出结果压缩</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">set</span> hive.exec.compress.output<span class="token operator">=</span>true<span class="token punctuation">;</span>
<span class="token builtin class-name">set</span> mapred.output.compression.codec<span class="token operator">=</span> 
org.apache.hadoop.io.compress.SnappyCodec<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h5 id="_10、使用explain-执行计划-todo"><a href="#_10、使用explain-执行计划-todo" class="header-anchor">#</a> 10、使用EXPLAIN--执行计划（TODO）</h5> <p>有待其它时间继续深入理解explain执行计划</p> <p>查看hql执行计划方法：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; expain select * from score where month=201805;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+--+</span>
<span class="token operator">|</span>                      <span class="token keyword">Explain</span>                       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+--+</span>
<span class="token operator">|</span> STAGE DEPENDENCIES:                                <span class="token operator">|</span>
<span class="token operator">|</span>   Stage<span class="token operator">-</span><span class="token number">0</span> <span class="token operator">is</span> a root stage                          <span class="token operator">|</span>
<span class="token operator">|</span>                                                    <span class="token operator">|</span>
<span class="token operator">|</span> STAGE PLANS:                                       <span class="token operator">|</span>
<span class="token operator">|</span>   Stage: Stage<span class="token operator">-</span><span class="token number">0</span>                                   <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token keyword">Fetch</span> Operator                                 <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token keyword">limit</span>: <span class="token operator">-</span><span class="token number">1</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span>       Processor Tree:                              <span class="token operator">|</span>
<span class="token operator">|</span>         TableScan                                  <span class="token operator">|</span>
<span class="token operator">|</span>           alias: score                             <span class="token operator">|</span>
<span class="token operator">|</span>           <span class="token keyword">Statistics</span>: Num <span class="token keyword">rows</span>: <span class="token number">1</span> <span class="token keyword">Data</span> size: <span class="token number">162</span> Basic stats: <span class="token keyword">PARTIAL</span> <span class="token keyword">Column</span> stats: NONE <span class="token operator">|</span>
<span class="token operator">|</span>           <span class="token keyword">Select</span> Operator                          <span class="token operator">|</span>
<span class="token operator">|</span>             expressions: s_id <span class="token punctuation">(</span><span class="token keyword">type</span>: string<span class="token punctuation">)</span><span class="token punctuation">,</span> c_id <span class="token punctuation">(</span><span class="token keyword">type</span>: string<span class="token punctuation">)</span><span class="token punctuation">,</span> s_score <span class="token punctuation">(</span><span class="token keyword">type</span>: <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'201805'</span> <span class="token punctuation">(</span><span class="token keyword">type</span>: string<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">|</span>             outputColumnNames: _col0<span class="token punctuation">,</span> _col1<span class="token punctuation">,</span> _col2<span class="token punctuation">,</span> _col3 <span class="token operator">|</span>
<span class="token operator">|</span>             <span class="token keyword">Statistics</span>: Num <span class="token keyword">rows</span>: <span class="token number">1</span> <span class="token keyword">Data</span> size: <span class="token number">162</span> Basic stats: <span class="token keyword">PARTIAL</span> <span class="token keyword">Column</span> stats: NONE <span class="token operator">|</span>
<span class="token operator">|</span>             ListSink                               <span class="token operator">|</span>
<span class="token operator">|</span>                                                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+--+</span>
</code></pre></div><h5 id="_11、数据倾斜"><a href="#_11、数据倾斜" class="header-anchor">#</a> 11、数据倾斜</h5> <h6 id="_1-合理设置map数"><a href="#_1-合理设置map数" class="header-anchor">#</a> 1 合理设置Map数</h6> <ul><li><ol><li>通常情况下，作业会通过input的目录产生一个或者多个map任务。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>主要的决定因素有：input的文件总个数，input的文件大小，集群设置的文件块大小。

举例：
a)  假设input目录下有1个文件a，大小为780M，那么hadoop会将该文件a分隔成7个块（6个128m的块和1个12m的块），从而产生7个map数。
b) 假设input目录下有3个文件a，b，c大小分别为10m，20m，150m，那么hadoop会分隔成4个块（10m，20m，128m，22m），从而产生4个map数。即，如果文件大于块大小(128m)，那么会拆分，如果小于块大小，则把该文件当成一个块。
</code></pre></div></li> <li><p>2） 是不是map数越多越好？</p> <div class="language- extra-class"><pre class="language-text"><code>  答案是否定的。如果一个任务有很多小文件（远远小于块大小128m），则每个小文件也会被当做一个块，用一个map任务来完成，而一个map任务启动和初始化的时间远远大于逻辑处理的时间，就会造成很大的资源浪费。而且，同时可执行的map数是受限的。
</code></pre></div></li> <li><p>3） 是不是保证每个map处理接近128m的文件块，就高枕无忧了？</p> <div class="language- extra-class"><pre class="language-text"><code>答案也是不一定。比如有一个127m的文件，正常会用一个map去完成，但这个文件只有一个或者两个小字段，却有几千万的记录，如果map处理的逻辑比较复杂，用一个map任务去做，肯定也比较耗时。

针对上面的问题2和3，我们需要采取两种方式来解决：即减少map数和增加map数；

</code></pre></div></li></ul> <h6 id="_2-小文件合并"><a href="#_2-小文件合并" class="header-anchor">#</a> 2 小文件合并</h6> <ul><li><p>在map执行前合并小文件，减少map数：</p></li> <li><p>CombineHiveInputFormat 具有对小文件进行合并的功能（系统默认的格式）</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> mapred<span class="token punctuation">.</span>max<span class="token punctuation">.</span>split<span class="token punctuation">.</span>size<span class="token operator">=</span><span class="token number">112345600</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> mapred<span class="token punctuation">.</span>min<span class="token punctuation">.</span>split<span class="token punctuation">.</span>size<span class="token punctuation">.</span>per<span class="token punctuation">.</span>node<span class="token operator">=</span><span class="token number">112345600</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> mapred<span class="token punctuation">.</span>min<span class="token punctuation">.</span>split<span class="token punctuation">.</span>size<span class="token punctuation">.</span>per<span class="token punctuation">.</span>rack<span class="token operator">=</span><span class="token number">112345600</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span>input<span class="token punctuation">.</span>format<span class="token operator">=</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>ql<span class="token punctuation">.</span>io<span class="token punctuation">.</span>CombineHiveInputFormat<span class="token punctuation">;</span>
</code></pre></div><p>这个参数表示执行前进行小文件合并，前面三个参数确定合并文件块的大小，大于文件块大小128m的，按照128m来分隔，小于128m，大于100m的，按照100m来分隔，把那些小于100m的（包括小文件和分隔大文件剩下的），进行合并。</p></li></ul> <h6 id="_3-复杂文件增加map数"><a href="#_3-复杂文件增加map数" class="header-anchor">#</a> 3 复杂文件增加Map数</h6> <ul><li><p>当input的文件都很大，任务逻辑复杂，map执行非常慢的时候，可以考虑增加Map数，来使得每个map处理的数据量减少，从而提高任务的执行效率。</p></li> <li><p>增加map的方法为</p> <ul><li>根据 ==computeSliteSize(Math.max(minSize,Math.min(maxSize,blocksize)))==公式</li> <li>==调整maxSize最大值==。让maxSize最大值低于blocksize就可以增加map的个数。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>mapreduce.input.fileinputformat.split.minsize=1 默认值为1

mapreduce.input.fileinputformat.split.maxsize=Long.MAXValue 默认值Long.MAXValue因此，默认情况下，切片大小=blocksize 

maxsize（切片最大值): 参数如果调到比blocksize小，则会让切片变小，而且就等于配置的这个参数的值。

minsize(切片最小值): 参数调的比blockSize大，则可以让切片变得比blocksize还大。

</code></pre></div><ul><li>例如</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--设置maxsize大小为10M，也就是说一个fileSplit的大小为10M</span>
<span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>input<span class="token punctuation">.</span>fileinputformat<span class="token punctuation">.</span>split<span class="token punctuation">.</span>maxsize<span class="token operator">=</span><span class="token number">10485760</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h6 id="_4-合理设置reduce数"><a href="#_4-合理设置reduce数" class="header-anchor">#</a> 4 合理设置Reduce数</h6> <ul><li><p>1、调整reduce个数方法一</p> <ul><li><p>1）每个Reduce处理的数据量默认是256MB</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>reducers<span class="token punctuation">.</span>bytes<span class="token punctuation">.</span>per<span class="token punctuation">.</span>reducer<span class="token operator">=</span><span class="token number">256000000</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><ol start="2"><li>每个任务最大的reduce数，默认为1009</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>reducers<span class="token punctuation">.</span>max<span class="token operator">=</span><span class="token number">1009</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><ol start="3"><li>计算reducer数的公式</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code>N<span class="token operator">=</span><span class="token function">min</span><span class="token punctuation">(</span>参数<span class="token number">2</span>，总输入数据量<span class="token operator">/</span>参数<span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li> <li><p>2、调整reduce个数方法二</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--设置每一个job中reduce个数</span>
<span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>job<span class="token punctuation">.</span>reduces<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>3、reduce个数并不是越多越好</p> <ul><li><p>过多的启动和初始化reduce也会消耗时间和资源；</p></li> <li><p>同时过多的reduce会生成很多个文件，也有可能出现小文件问题</p></li></ul></li></ul> <h2 id="hive的综合案例实战"><a href="#hive的综合案例实战" class="header-anchor">#</a> hive的综合案例实战</h2> <h3 id="案例需求"><a href="#案例需求" class="header-anchor">#</a> 案例需求</h3> <p>统计youtube影音视频网站的常规指标，各种TopN指标：</p> <p>--统计视频观看数Top10</p> <p>--统计视频类别热度Top10</p> <p>--统计视频观看数Top20所属类别</p> <p>--统计视频观看数Top50所关联视频的所属类别Rank</p> <p>--统计每个类别中的视频热度Top10</p> <p>--统计每个类别中视频流量Top10</p> <p>--统计上传视频最多的用户Top10以及他们上传的视频</p> <p>--统计每个类别视频观看数Top10</p> <h3 id="项目表字段"><a href="#项目表字段" class="header-anchor">#</a> 项目表字段</h3> <h5 id="_1-视频表"><a href="#_1-视频表" class="header-anchor">#</a> 1．视频表</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#数据字段情况大致如下：</span>
LKh7zAJ4nwo	TheReceptionist	<span class="token number">653</span>	Entertainment	<span class="token number">424</span>	<span class="token number">13021</span>	<span class="token number">4.34</span>	<span class="token number">1305</span>	<span class="token number">744</span>	DjdA<span class="token operator">-</span><span class="token number">5</span>oKYFQ	NxTDlnOuybo	c<span class="token operator">-</span><span class="token number">8</span>VuICzXtU	DH56yrIO5nI	W1Uo5DQTtzc	E<span class="token operator">-</span><span class="token number">3</span>zXq_r4w0	<span class="token number">1</span>TCeoRPg5dE	yAr26YhuYNY	<span class="token number">2</span>ZgXx72XmoE	<span class="token operator">-</span><span class="token number">7</span>ClGo<span class="token operator">-</span>YgZ0	vmdPOOd6cxI	KRHfMQqSHpk	pIMpORZthYw	<span class="token number">1</span>tUDzOp10pk	heqocRij5P0	_XIuvoH6rUg	LGVU5DsezE0	uO2kj6_D8B4	xiDqywcDQRM	uX81lMev6_o

fQShwYqGqsw	lonelygirl15	<span class="token number">736</span>	People <span class="token operator">&amp;</span> Blogs	<span class="token number">133</span>	<span class="token number">151763</span>	<span class="token number">3.01</span>	<span class="token number">666</span>	<span class="token number">765</span>	fQShwYqGqsw	LfAaY1p_2Is	<span class="token number">5</span>LELNIVyMqo	vW6ZpqXjCE4	vPUAf43vc<span class="token operator">-</span>Q	ZllfQZCc2_M	it2d7LaU_TA	KGRx8TgZEeU	aQWdqI1vd6o	kzwa8NBlUeo	X3ctuFCCF5k	Ble9N2kDiGc	R24FONE2CDs	IAY5q60CmYY	mUd0hcEnHiU	<span class="token number">6</span>OUcp6UJ2bA	dv0Y_uoHrLc	<span class="token number">8</span>YoxhsUMlgA	h59nXANN<span class="token operator">-</span>oo	<span class="token number">113</span>yn3sv0eo
</code></pre></div><table><thead><tr><th>字段</th> <th>备注</th> <th>详细描述</th></tr></thead> <tbody><tr><td>video id</td> <td>视频唯一id</td> <td>11位字符串</td></tr> <tr><td>uploader</td> <td>视频上传者</td> <td>上传视频的用户名String</td></tr> <tr><td>age</td> <td>视频年龄</td> <td>视频在平台上的整数天</td></tr> <tr><td>category</td> <td>视频类别</td> <td>上传视频指定的视频分类</td></tr> <tr><td>length</td> <td>视频长度</td> <td>整形数字标识的视频长度</td></tr> <tr><td>views</td> <td>观看次数</td> <td>视频被浏览的次数</td></tr> <tr><td>rate</td> <td>视频评分</td> <td>满分5分</td></tr> <tr><td>ratings</td> <td>流量</td> <td>视频的流量，整型数字</td></tr> <tr><td>conments</td> <td>评论数</td> <td>一个视频的整数评论数</td></tr> <tr><td>related   ids</td> <td>相关视频id</td> <td>相关视频的id，最多20个</td></tr></tbody></table> <h5 id="_2-用户表"><a href="#_2-用户表" class="header-anchor">#</a> 2．用户表</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#数据字段情况大致如下：</span>
barelypolitical	<span class="token number">151</span>	<span class="token number">5106</span>
bonk65	<span class="token number">89</span>	<span class="token number">144</span>
camelcars	<span class="token number">26</span>	<span class="token number">674</span>
cubskickass34	<span class="token number">13</span>	<span class="token number">126</span>
boydism08	<span class="token number">32</span>	<span class="token number">50</span>
</code></pre></div><table><thead><tr><th>字段</th> <th>备注</th> <th>字段类型</th></tr></thead> <tbody><tr><td>uploader</td> <td>上传者用户名</td> <td>string</td></tr> <tr><td>videos</td> <td>上传视频数</td> <td>int</td></tr> <tr><td>friends</td> <td>朋友数量</td> <td>int</td></tr></tbody></table> <h3 id="etl原始数据清洗"><a href="#etl原始数据清洗" class="header-anchor">#</a> ETL原始数据清洗</h3> <p>通过观察原始数据形式，可以发现：</p> <ul><li>视频可以有多个所属分类category,如People &amp; Blogs，每个所属分类用&amp;符号分割，且分割的两边有空格字符</li> <li>同时相关视频也是可以有多个元素，多个相关视频又用“\t”进行分割。</li> <li>为了分析数据时方便对存在多个子元素的数据进行操作，我们首先进行数据重组清洗操作。即：将所有的类别用“&amp;”分割，同时去掉两边空格，多个相关视频id也使用“&amp;”进行分割。</li> <li>视频的原始数据里，一行应该有至少9个字段。三件事情</li></ul> <p>因为我们的数据清洗工作主要有以下三件事情：</p> <ul><li>长度不够9的删掉。（视频数据里，一行数据不够9个字段的证明改行数据损坏掉，要删掉）</li> <li>视频类别删掉空格</li> <li>相关视频的分割符用&amp;</li></ul> <h4 id="第一步-创建maven工程"><a href="#第一步-创建maven工程" class="header-anchor">#</a> 第一步：创建Maven工程</h4> <div class="language-xml extra-class"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cloudera<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-mr1-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-hdfs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-mapreduce-client-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.38<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!--    &lt;verbal&gt;true&lt;/verbal&gt;--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-shade-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>shade<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>minimizeJar</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>minimizeJar</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--  &lt;plugin&gt;
                  &lt;artifactId&gt;maven-assembly-plugin &lt;/artifactId&gt;
                  &lt;configuration&gt;
                      &lt;descriptorRefs&gt;
                          &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;
                      &lt;/descriptorRefs&gt;
                      &lt;archive&gt;
                          &lt;manifest&gt;
                              &lt;mainClass&gt;&lt;/mainClass&gt;
                          &lt;/manifest&gt;
                      &lt;/archive&gt;
                  &lt;/configuration&gt;
                  &lt;executions&gt;
                      &lt;execution&gt;
                          &lt;id&gt;make-assembly&lt;/id&gt;
                          &lt;phase&gt;package&lt;/phase&gt;
                          &lt;goals&gt;
                              &lt;goal&gt;single&lt;/goal&gt;
                          &lt;/goals&gt;
                      &lt;/execution&gt;
                  &lt;/executions&gt;
              &lt;/plugin&gt;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="第二部-代码开发-etlutil"><a href="#第二部-代码开发-etlutil" class="header-anchor">#</a> 第二部：代码开发：ETLUtil</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VideoUtil</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 对我们的数据进行清洗的工作，
     * 数据切割，如果长度小于9 直接丢掉
     * 视频类别中间空格 去掉
     * 关联视频，使用 &amp;  进行分割
     * @param line
     * @return
     * FM1KUDE3C3k  renetto	736	News &amp; Politics	1063	9062	4.57	525	488	LnMvSxl0o0A&amp;IKMtzNuKQso&amp;Bq8ubu7WHkY&amp;Su0VTfwia1w&amp;0SNRfquDfZs&amp;C72NVoPsRGw
     */</span>
    <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">washDatas</span><span class="token punctuation">(</span><span class="token class-name">String</span> line<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> line <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//判断数据的长度，如果小于9，直接丢掉</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>split<span class="token punctuation">.</span>length <span class="token operator">&lt;</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//将视频类别空格进行去掉</span>
        split<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span>  split<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>split<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//这里面是前面八个字段</span>
                builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&gt;=</span><span class="token number">9</span>  <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> split<span class="token punctuation">.</span>length <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> i <span class="token operator">==</span> split<span class="token punctuation">.</span>length <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span>  builder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="第三步-代码开发-etlmapper"><a href="#第三步-代码开发-etlmapper" class="header-anchor">#</a> 第三步：代码开发：ETLMapper</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">LongWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">NullWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Text</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VideoMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span><span class="token class-name">Text</span><span class="token punctuation">,</span><span class="token class-name">Text</span><span class="token punctuation">,</span><span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Text</span>  key2 <span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        key2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token class-name">VideoUtils</span><span class="token punctuation">.</span><span class="token function">washDatas</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> s <span class="token punctuation">)</span><span class="token punctuation">{</span>
            key2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key2<span class="token punctuation">,</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="第四步-代码开发-etlrunner"><a href="#第四步-代码开发-etlrunner" class="header-anchor">#</a> 第四步：代码开发：ETLRunner</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configured</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>fs<span class="token punctuation">.</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">NullWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Text</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">Job</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>input<span class="token punctuation">.</span></span><span class="token class-name">TextInputFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>output<span class="token punctuation">.</span></span><span class="token class-name">TextOutputFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Tool</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ToolRunner</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VideoMain</span> <span class="token keyword">extends</span> <span class="token class-name">Configured</span> <span class="token keyword">implements</span> <span class="token class-name">Tool</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getConf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;washDatas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">VideoMain</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setInputFormatClass</span><span class="token punctuation">(</span><span class="token class-name">TextInputFormat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TextInputFormat</span><span class="token punctuation">.</span><span class="token function">addInputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">VideoMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputFormatClass</span><span class="token punctuation">(</span><span class="token class-name">TextOutputFormat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TextOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//注意，我们这里没有自定义reducer，会使用默认的reducer类</span>
        <span class="token comment">//设置reduceTask为7，从而生成7个文件，便于后面表的数据加载</span>
        job<span class="token punctuation">.</span><span class="token function">setNumReduceTasks</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> b <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> b<span class="token operator">?</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> run <span class="token operator">=</span> <span class="token class-name">ToolRunner</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">VideoMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="第五步-打包jar包到集群运行"><a href="#第五步-打包jar包到集群运行" class="header-anchor">#</a> 第五步：打包jar包到集群运行</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#上传jar包到集群任意节点，这里以node03节点为例</span>
<span class="token punctuation">[</span>hadoop@node03 hivedatas<span class="token punctuation">]</span>$ rz 
	original-MyHive-1.0-SNAPSHOT.jar
	
<span class="token comment">#上传视频数据到linux本地，再从本地到hdfs</span>
<span class="token punctuation">[</span>hadoop@node03 hivedatas<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> videoData
<span class="token punctuation">[</span>hadoop@node03 hivedatas<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> videoData
<span class="token punctuation">[</span>hadoop@node03 videoData<span class="token punctuation">]</span>$ rz
	<span class="token number">0</span>.txt  <span class="token number">1</span>.txt  <span class="token number">2</span>.txt  <span class="token number">3</span>.txt  <span class="token number">4</span>.txt
hdfs dfs -put videoData /

<span class="token comment">#上传用户数据到linux本地，再从本地到hdfs</span>
<span class="token punctuation">[</span>hadoop@node03 hivedatas<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> userData<span class="token punctuation">;</span><span class="token builtin class-name">cd</span> userData
<span class="token punctuation">[</span>hadoop@node03 userData<span class="token punctuation">]</span>$ rz
	user.txt
hdfs dfs -put userData /

<span class="token comment">#运行jar包</span>
<span class="token punctuation">[</span>hadoop@node03 hivedatas<span class="token punctuation">]</span>$ hadoop jar original-MyHive-1.0-SNAPSHOT.jar com.jimmy.ETL.VideoMain /videoData/ /videoOut
</code></pre></div><h3 id="项目建表并加载数据"><a href="#项目建表并加载数据" class="header-anchor">#</a> 项目建表并加载数据</h3> <h5 id="创建普通表"><a href="#创建普通表" class="header-anchor">#</a> 创建普通表</h5> <p>接下来我们要建立分桶表，因为分桶表不能够直接通过load方式加载数据，因此我们首先要建立两个对应的普通表来为接下来分桶表加载数据做准备。普通表使用textfile格式进行存储。</p> <p>####### youtubevideo_ori</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> hive<span class="token punctuation">.</span>enforce<span class="token punctuation">.</span>bucketing<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>job<span class="token punctuation">.</span>reduces<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">database</span> youtube<span class="token punctuation">;</span>
<span class="token keyword">use</span> youtube<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> youtubevideo_ori<span class="token punctuation">(</span>
    videoId string<span class="token punctuation">,</span> 
    uploader string<span class="token punctuation">,</span> 
    age <span class="token keyword">int</span><span class="token punctuation">,</span> 
    category array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span> 
    length <span class="token keyword">int</span><span class="token punctuation">,</span> 
    views <span class="token keyword">int</span><span class="token punctuation">,</span> 
    rate <span class="token keyword">float</span><span class="token punctuation">,</span> 
    ratings <span class="token keyword">int</span><span class="token punctuation">,</span> 
    comments <span class="token keyword">int</span><span class="token punctuation">,</span>
    relatedId array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;\t&quot;</span>
collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;&amp;&quot;</span>
stored <span class="token keyword">as</span> textfile<span class="token punctuation">;</span>
</code></pre></div><p>####### youtubevideo_user_ori</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> youtubevideo_user_ori<span class="token punctuation">(</span>
    uploader string<span class="token punctuation">,</span>
    videos <span class="token keyword">int</span><span class="token punctuation">,</span>
    friends <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;\t&quot;</span> 
stored <span class="token keyword">as</span> textfile<span class="token punctuation">;</span>
</code></pre></div><h5 id="创建分桶表"><a href="#创建分桶表" class="header-anchor">#</a> 创建分桶表</h5> <p>####### youtubevideo_orc</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> youtubevideo_orc<span class="token punctuation">(</span>
    videoId string<span class="token punctuation">,</span> 
    uploader string<span class="token punctuation">,</span> 
    age <span class="token keyword">int</span><span class="token punctuation">,</span> 
    category array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span> 
    length <span class="token keyword">int</span><span class="token punctuation">,</span> 
    views <span class="token keyword">int</span><span class="token punctuation">,</span> 
    rate <span class="token keyword">float</span><span class="token punctuation">,</span> 
    ratings <span class="token keyword">int</span><span class="token punctuation">,</span> 
    comments <span class="token keyword">int</span><span class="token punctuation">,</span>
    relatedId array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token keyword">clustered</span> <span class="token keyword">by</span> <span class="token punctuation">(</span>uploader<span class="token punctuation">)</span> <span class="token keyword">into</span> <span class="token number">8</span> buckets 
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;\t&quot;</span> 
collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;&amp;&quot;</span> 
stored <span class="token keyword">as</span> orc<span class="token punctuation">;</span>
</code></pre></div><p>####### youtubevideo_user_orc</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> youtubevideo_user_orc<span class="token punctuation">(</span>
    uploader string<span class="token punctuation">,</span>
    videos <span class="token keyword">int</span><span class="token punctuation">,</span>
    friends <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">clustered</span> <span class="token keyword">by</span> <span class="token punctuation">(</span>uploader<span class="token punctuation">)</span> <span class="token keyword">into</span> <span class="token number">24</span> buckets 
<span class="token keyword">row</span> format delimited 
<span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;\t&quot;</span> 
stored <span class="token keyword">as</span> orc<span class="token punctuation">;</span>
</code></pre></div><h4 id="_2、导入etl之后的数据"><a href="#_2、导入etl之后的数据" class="header-anchor">#</a> 2、导入ETL之后的数据</h4> <p>youtubevideo_ori</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> inpath <span class="token string">&quot;/videoOut&quot;</span> <span class="token keyword">into</span> <span class="token keyword">table</span> youtubevideo_ori<span class="token punctuation">;</span>
</code></pre></div><p>youtubevideo_user_ori：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">load</span> <span class="token keyword">data</span> inpath <span class="token string">&quot;/userData&quot;</span> <span class="token keyword">into</span> <span class="token keyword">table</span> youtubevideo_user_ori<span class="token punctuation">;</span>
</code></pre></div><h4 id="_3、向orc表插入数据"><a href="#_3、向orc表插入数据" class="header-anchor">#</a> 3、向ORC表插入数据</h4> <p>youtubevideo_orc：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> overwrite <span class="token keyword">table</span> youtubevideo_orc <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> youtubevideo_ori<span class="token punctuation">;</span>
</code></pre></div><p>youtubevideo_user_orc：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span> youtubevideo_user_orc <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> youtubevideo_user_ori<span class="token punctuation">;</span>
</code></pre></div><h4 id="_4、查看表结构"><a href="#_4、查看表结构" class="header-anchor">#</a> 4、查看表结构</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; desc youtubevideo_orc;</span>
<span class="token operator">+</span><span class="token comment">------------+----------------+----------+--+</span>
<span class="token operator">|</span>  col_name  <span class="token operator">|</span>   data_type    <span class="token operator">|</span> <span class="token keyword">comment</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+----------------+----------+--+</span>
<span class="token operator">|</span> videoid    <span class="token operator">|</span> string         <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> uploader   <span class="token operator">|</span> string         <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> age        <span class="token operator">|</span> <span class="token keyword">int</span>            <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> category   <span class="token operator">|</span> array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>  <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> length     <span class="token operator">|</span> <span class="token keyword">int</span>            <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> views      <span class="token operator">|</span> <span class="token keyword">int</span>            <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> rate       <span class="token operator">|</span> <span class="token keyword">float</span>          <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> ratings    <span class="token operator">|</span> <span class="token keyword">int</span>            <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> comments   <span class="token operator">|</span> <span class="token keyword">int</span>            <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> relatedid  <span class="token operator">|</span> array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>  <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+----------------+----------+--+</span>
<span class="token number">10</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.084</span> seconds<span class="token punctuation">)</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; desc youtubevideo_user_orc ;</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+----------+--+</span>
<span class="token operator">|</span> col_name  <span class="token operator">|</span> data_type  <span class="token operator">|</span> <span class="token keyword">comment</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+----------+--+</span>
<span class="token operator">|</span> uploader  <span class="token operator">|</span> string     <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> videos    <span class="token operator">|</span> <span class="token keyword">int</span>        <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> friends   <span class="token operator">|</span> <span class="token keyword">int</span>        <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+----------+--+</span>
</code></pre></div><h3 id="业务分析"><a href="#业务分析" class="header-anchor">#</a> 业务分析</h3> <h4 id="_1、统计视频观看数top10的视频"><a href="#_1、统计视频观看数top10的视频" class="header-anchor">#</a> 1、统计视频观看数Top10的视频</h4> <p>思路：使用order by按照views字段做一个全局排序即可，同时我们设置只显示前10条。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> videoid<span class="token punctuation">,</span>views
<span class="token keyword">from</span> youtubevideo_orc
<span class="token keyword">order</span> <span class="token keyword">by</span> views <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+-----------+--+</span>
<span class="token operator">|</span>   videoid    <span class="token operator">|</span>   views   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+-----------+--+</span>
<span class="token operator">|</span> dMH0bHeiRNg  <span class="token operator">|</span> <span class="token number">42513417</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">0</span>XxI<span class="token operator">-</span>hvPRRA  <span class="token operator">|</span> <span class="token number">20282464</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span>dmVU08zVpA  <span class="token operator">|</span> <span class="token number">16087899</span>  <span class="token operator">|</span>
<span class="token operator">|</span> RB<span class="token operator">-</span>wUgnyGv0  <span class="token operator">|</span> <span class="token number">15712924</span>  <span class="token operator">|</span>
<span class="token operator">|</span> QjA5faZF1A8  <span class="token operator">|</span> <span class="token number">15256922</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token operator">-</span>_CSo1gOd48  <span class="token operator">|</span> <span class="token number">13199833</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">49</span>IDp76kjPw  <span class="token operator">|</span> <span class="token number">11970018</span>  <span class="token operator">|</span>
<span class="token operator">|</span> tYnn51C3X_w  <span class="token operator">|</span> <span class="token number">11823701</span>  <span class="token operator">|</span>
<span class="token operator">|</span> pv5zWaTEVkI  <span class="token operator">|</span> <span class="token number">11672017</span>  <span class="token operator">|</span>
<span class="token operator">|</span> D2kJZOfq7zk  <span class="token operator">|</span> <span class="token number">11184051</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+-----------+--+</span>
</code></pre></div><h4 id="_2、统计视频类别热度top10的类别"><a href="#_2、统计视频类别热度top10的类别" class="header-anchor">#</a> 2、统计视频类别热度Top10的类别</h4> <p>思路：</p> <ol><li><p>即统计每个类别有多少个视频，显示出包含视频最多的前10个类别。</p></li> <li><p>我们需要按照类别group by聚合，然后count组内的videoId个数即可。</p></li> <li><p>因为当前表结构为：一个视频对应一个或多个类别。所以如果要group by类别，需要先将类别进行列转行(展开)，然后再进行count即可。</p></li> <li><p>最后按照热度排序，显示前10条。</p></li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> t1<span class="token punctuation">.</span>category_col <span class="token keyword">as</span> category<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>videoid<span class="token punctuation">)</span> <span class="token keyword">as</span> hot
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> videoid<span class="token punctuation">,</span>category_col
<span class="token keyword">from</span> youtubevideo_orc lateral <span class="token keyword">view</span> explode<span class="token punctuation">(</span>category<span class="token punctuation">)</span> t_cate <span class="token keyword">as</span> category_col<span class="token punctuation">)</span> t1
<span class="token keyword">group</span> <span class="token keyword">by</span> t1<span class="token punctuation">.</span>category_col
<span class="token keyword">order</span> <span class="token keyword">by</span> hot <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+---------+--+</span>
<span class="token operator">|</span>    category    <span class="token operator">|</span>   hot   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+---------+--+</span>
<span class="token operator">|</span> Music          <span class="token operator">|</span> <span class="token number">179049</span>  <span class="token operator">|</span>
<span class="token operator">|</span> Entertainment  <span class="token operator">|</span> <span class="token number">127674</span>  <span class="token operator">|</span>
<span class="token operator">|</span> Comedy         <span class="token operator">|</span> <span class="token number">87818</span>   <span class="token operator">|</span>
<span class="token operator">|</span> Animation      <span class="token operator">|</span> <span class="token number">73293</span>   <span class="token operator">|</span>
<span class="token operator">|</span> Film           <span class="token operator">|</span> <span class="token number">73293</span>   <span class="token operator">|</span>
<span class="token operator">|</span> Sports         <span class="token operator">|</span> <span class="token number">67329</span>   <span class="token operator">|</span>
<span class="token operator">|</span> Gadgets        <span class="token operator">|</span> <span class="token number">59817</span>   <span class="token operator">|</span>
<span class="token operator">|</span> Games          <span class="token operator">|</span> <span class="token number">59817</span>   <span class="token operator">|</span>
<span class="token operator">|</span> Blogs          <span class="token operator">|</span> <span class="token number">48890</span>   <span class="token operator">|</span>
<span class="token operator">|</span> People         <span class="token operator">|</span> <span class="token number">48890</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+---------+--+</span>
</code></pre></div><h4 id="_3、统计出观看数最高的20个视频的所属类别以及类别包含top20视频的个数"><a href="#_3、统计出观看数最高的20个视频的所属类别以及类别包含top20视频的个数" class="header-anchor">#</a> 3、统计出观看数最高的20个视频的所属类别以及类别包含Top20视频的个数</h4> <p>思路：</p> <ol><li><p>先找到观看数最高的20个视频所属条目的所有信息，降序排列</p></li> <li><p>把这20条信息中的category分裂出来(列转行)</p></li> <li><p>最后查询视频分类名称和该分类下有多少个Top20的视频</p></li></ol> <p>####### 视频观看数最高的20个视频的所属类别</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> videoid<span class="token punctuation">,</span>views<span class="token punctuation">,</span>category
<span class="token keyword">from</span> youtubevideo_orc
<span class="token keyword">order</span> <span class="token keyword">by</span> views <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+-----------+---------------------+--+</span>
<span class="token operator">|</span>   videoid    <span class="token operator">|</span>   views   <span class="token operator">|</span>      category       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+-----------+---------------------+--+</span>
<span class="token operator">|</span> dMH0bHeiRNg  <span class="token operator">|</span> <span class="token number">42513417</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Comedy&quot;</span><span class="token punctuation">]</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">0</span>XxI<span class="token operator">-</span>hvPRRA  <span class="token operator">|</span> <span class="token number">20282464</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Comedy&quot;</span><span class="token punctuation">]</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span>dmVU08zVpA  <span class="token operator">|</span> <span class="token number">16087899</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Entertainment&quot;</span><span class="token punctuation">]</span>   <span class="token operator">|</span>
<span class="token operator">|</span> RB<span class="token operator">-</span>wUgnyGv0  <span class="token operator">|</span> <span class="token number">15712924</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Entertainment&quot;</span><span class="token punctuation">]</span>   <span class="token operator">|</span>
<span class="token operator">|</span> QjA5faZF1A8  <span class="token operator">|</span> <span class="token number">15256922</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Music&quot;</span><span class="token punctuation">]</span>           <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token operator">-</span>_CSo1gOd48  <span class="token operator">|</span> <span class="token number">13199833</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;People&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Blogs&quot;</span><span class="token punctuation">]</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">49</span>IDp76kjPw  <span class="token operator">|</span> <span class="token number">11970018</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Comedy&quot;</span><span class="token punctuation">]</span>          <span class="token operator">|</span>
<span class="token operator">|</span> tYnn51C3X_w  <span class="token operator">|</span> <span class="token number">11823701</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Music&quot;</span><span class="token punctuation">]</span>           <span class="token operator">|</span>
<span class="token operator">|</span> pv5zWaTEVkI  <span class="token operator">|</span> <span class="token number">11672017</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Music&quot;</span><span class="token punctuation">]</span>           <span class="token operator">|</span>
<span class="token operator">|</span> D2kJZOfq7zk  <span class="token operator">|</span> <span class="token number">11184051</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;People&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Blogs&quot;</span><span class="token punctuation">]</span>  <span class="token operator">|</span>
<span class="token operator">|</span> vr3x_RRJdd4  <span class="token operator">|</span> <span class="token number">10786529</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Entertainment&quot;</span><span class="token punctuation">]</span>   <span class="token operator">|</span>
<span class="token operator">|</span> lsO6D1rwrKc  <span class="token operator">|</span> <span class="token number">10334975</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Entertainment&quot;</span><span class="token punctuation">]</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">5</span>P6UU6m3cqk  <span class="token operator">|</span> <span class="token number">10107491</span>  <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Comedy&quot;</span><span class="token punctuation">]</span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">8</span>bbTtPL1jRs  <span class="token operator">|</span> <span class="token number">9579911</span>   <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Music&quot;</span><span class="token punctuation">]</span>           <span class="token operator">|</span>
<span class="token operator">|</span> _BuRwH59oAo  <span class="token operator">|</span> <span class="token number">9566609</span>   <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Comedy&quot;</span><span class="token punctuation">]</span>          <span class="token operator">|</span>
<span class="token operator">|</span> aRNzWyD7C9o  <span class="token operator">|</span> <span class="token number">8825788</span>   <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;UNA&quot;</span><span class="token punctuation">]</span>             <span class="token operator">|</span>
<span class="token operator">|</span> UMf40daefsI  <span class="token operator">|</span> <span class="token number">7533070</span>   <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Music&quot;</span><span class="token punctuation">]</span>           <span class="token operator">|</span>
<span class="token operator">|</span> ixsZy2425eY  <span class="token operator">|</span> <span class="token number">7456875</span>   <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Entertainment&quot;</span><span class="token punctuation">]</span>   <span class="token operator">|</span>
<span class="token operator">|</span> MNxwAU_xAMk  <span class="token operator">|</span> <span class="token number">7066676</span>   <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Comedy&quot;</span><span class="token punctuation">]</span>          <span class="token operator">|</span>
<span class="token operator">|</span> RUCZJVJ_M8o  <span class="token operator">|</span> <span class="token number">6952767</span>   <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">&quot;Entertainment&quot;</span><span class="token punctuation">]</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+-----------+---------------------+--+</span>
</code></pre></div><p>####### 视频观看数最高的20个视频的所属类别包含Top20视频的个数</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> t2<span class="token punctuation">.</span>category_col <span class="token keyword">as</span> category<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>videoid<span class="token punctuation">)</span> <span class="token keyword">as</span> hot_videos
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> videoid<span class="token punctuation">,</span>category_col
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> videoid<span class="token punctuation">,</span>views<span class="token punctuation">,</span>category
<span class="token keyword">from</span> youtubevideo_orc
<span class="token keyword">order</span> <span class="token keyword">by</span> views <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">20</span><span class="token punctuation">)</span> t1 
lateral <span class="token keyword">view</span> explode<span class="token punctuation">(</span>category<span class="token punctuation">)</span> t_category <span class="token keyword">as</span> category_col<span class="token punctuation">)</span> t2
<span class="token keyword">group</span> <span class="token keyword">by</span> t2<span class="token punctuation">.</span>category_col
<span class="token keyword">order</span> <span class="token keyword">by</span> hot_videos <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+-------------+--+</span>
<span class="token operator">|</span>    category    <span class="token operator">|</span> hot_videos  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+-------------+--+</span>
<span class="token operator">|</span> Entertainment  <span class="token operator">|</span> <span class="token number">6</span>           <span class="token operator">|</span>
<span class="token operator">|</span> Comedy         <span class="token operator">|</span> <span class="token number">6</span>           <span class="token operator">|</span>
<span class="token operator">|</span> Music          <span class="token operator">|</span> <span class="token number">5</span>           <span class="token operator">|</span>
<span class="token operator">|</span> People         <span class="token operator">|</span> <span class="token number">2</span>           <span class="token operator">|</span>
<span class="token operator">|</span> Blogs          <span class="token operator">|</span> <span class="token number">2</span>           <span class="token operator">|</span>
<span class="token operator">|</span> UNA            <span class="token operator">|</span> <span class="token number">1</span>           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+-------------+--+</span>
</code></pre></div><h4 id="_4、-统计观看数top50的视频所关联的视频的所属类别rank"><a href="#_4、-统计观看数top50的视频所关联的视频的所属类别rank" class="header-anchor">#</a> 4、 统计观看数Top50的视频所关联的视频的所属类别Rank</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#分析思路</span>

<span class="token comment">#第一步，获取观看数前50的视频，select一定要有views，因为是根据views来排序的</span>
<span class="token keyword">select</span> videoid<span class="token punctuation">,</span>relatedid<span class="token punctuation">,</span>views  
<span class="token keyword">from</span> youtubevideo_orc
<span class="token keyword">order</span> <span class="token keyword">by</span> views <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">50</span>

<span class="token comment">#第二步，获取每一个视频的关联视频</span>
<span class="token keyword">select</span> explode<span class="token punctuation">(</span>t1<span class="token punctuation">.</span>relatedid<span class="token punctuation">)</span> <span class="token keyword">as</span> videoid
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> videoid<span class="token punctuation">,</span>relatedid<span class="token punctuation">,</span>views  
<span class="token keyword">from</span> youtubevideo_orc
<span class="token keyword">order</span> <span class="token keyword">by</span> views <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">50</span><span class="token punctuation">)</span> t1


<span class="token comment">#第三步，对视频去重，再获取每一个视频的所属类型</span>
<span class="token keyword">select</span> <span class="token keyword">distinct</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>videoid<span class="token punctuation">)</span><span class="token punctuation">,</span>t3<span class="token punctuation">.</span>category
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> explode<span class="token punctuation">(</span>t1<span class="token punctuation">.</span>relatedid<span class="token punctuation">)</span> <span class="token keyword">as</span> videoid
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> videoid<span class="token punctuation">,</span>relatedid<span class="token punctuation">,</span>views  
<span class="token keyword">from</span> youtubevideo_orc
<span class="token keyword">order</span> <span class="token keyword">by</span> views <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">50</span><span class="token punctuation">)</span> t1<span class="token punctuation">)</span> t2 <span class="token keyword">inner</span> <span class="token keyword">join</span> youtubevideo_orc t3 <span class="token keyword">on</span> t3<span class="token punctuation">.</span>videoid<span class="token operator">=</span>t2<span class="token punctuation">.</span>videoid

<span class="token comment">#第四步，展开视频所属类型</span>
<span class="token keyword">select</span> videoid<span class="token punctuation">,</span>category_col <span class="token keyword">as</span> category
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>videoid<span class="token punctuation">)</span><span class="token punctuation">,</span>t3<span class="token punctuation">.</span>category
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> explode<span class="token punctuation">(</span>t1<span class="token punctuation">.</span>relatedid<span class="token punctuation">)</span> <span class="token keyword">as</span> videoid
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> videoid<span class="token punctuation">,</span>relatedid<span class="token punctuation">,</span>views  
<span class="token keyword">from</span> youtubevideo_orc
<span class="token keyword">order</span> <span class="token keyword">by</span> views <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">50</span><span class="token punctuation">)</span> t1<span class="token punctuation">)</span> t2 <span class="token keyword">inner</span> <span class="token keyword">join</span> youtubevideo_orc t3 <span class="token keyword">on</span> t3<span class="token punctuation">.</span>videoid<span class="token operator">=</span>t2<span class="token punctuation">.</span>videoid
<span class="token punctuation">)</span> t4 lateral <span class="token keyword">view</span> explode<span class="token punctuation">(</span>category<span class="token punctuation">)</span>t_category <span class="token keyword">as</span> category_col
 
 
<span class="token comment">#第五步，进行分组，计数，排序</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>t5<span class="token punctuation">.</span>videoid<span class="token punctuation">)</span> <span class="token keyword">as</span> hot<span class="token punctuation">,</span>category
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> videoid<span class="token punctuation">,</span>category_col <span class="token keyword">as</span> category
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>videoid<span class="token punctuation">)</span><span class="token punctuation">,</span>t3<span class="token punctuation">.</span>category
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> explode<span class="token punctuation">(</span>t1<span class="token punctuation">.</span>relatedid<span class="token punctuation">)</span> <span class="token keyword">as</span> videoid
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> videoid<span class="token punctuation">,</span>relatedid<span class="token punctuation">,</span>views  
<span class="token keyword">from</span> youtubevideo_orc
<span class="token keyword">order</span> <span class="token keyword">by</span> views <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">50</span><span class="token punctuation">)</span> t1<span class="token punctuation">)</span> t2 <span class="token keyword">inner</span> <span class="token keyword">join</span> youtubevideo_orc t3 <span class="token keyword">on</span> t3<span class="token punctuation">.</span>videoid<span class="token operator">=</span>t2<span class="token punctuation">.</span>videoid
<span class="token punctuation">)</span> t4 lateral <span class="token keyword">view</span> explode<span class="token punctuation">(</span>category<span class="token punctuation">)</span>t_category <span class="token keyword">as</span> category_col
<span class="token punctuation">)</span> t5
<span class="token keyword">group</span> <span class="token keyword">by</span> category
<span class="token keyword">order</span> <span class="token keyword">by</span> hot <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+----------------+--+</span>
<span class="token operator">|</span> hot  <span class="token operator">|</span>    category    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+----------------+--+</span>
<span class="token operator">|</span> <span class="token number">232</span>  <span class="token operator">|</span> Comedy         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">216</span>  <span class="token operator">|</span> Entertainment  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">195</span>  <span class="token operator">|</span> Music          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">51</span>   <span class="token operator">|</span> Blogs          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">51</span>   <span class="token operator">|</span> People         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">47</span>   <span class="token operator">|</span> Film           <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">47</span>   <span class="token operator">|</span> Animation      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">22</span>   <span class="token operator">|</span> News           <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">22</span>   <span class="token operator">|</span> Politics       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">20</span>   <span class="token operator">|</span> Games          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">20</span>   <span class="token operator">|</span> Gadgets        <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">19</span>   <span class="token operator">|</span> Sports         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">14</span>   <span class="token operator">|</span> Howto          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">14</span>   <span class="token operator">|</span> DIY            <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">13</span>   <span class="token operator">|</span> UNA            <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">12</span>   <span class="token operator">|</span> Places         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">12</span>   <span class="token operator">|</span> Travel         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">11</span>   <span class="token operator">|</span> Animals        <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">11</span>   <span class="token operator">|</span> Pets           <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">4</span>    <span class="token operator">|</span> Autos          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">4</span>    <span class="token operator">|</span> Vehicles       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+----------------+--+</span>
</code></pre></div><h4 id="_5、统计每个类别中的视频热度top10-以music为例"><a href="#_5、统计每个类别中的视频热度top10-以music为例" class="header-anchor">#</a> 5、统计每个类别中的视频热度Top10，以Music为例</h4> <h6 id="第一种做法-直接查询"><a href="#第一种做法-直接查询" class="header-anchor">#</a> 第一种做法：直接查询</h6> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> t1<span class="token punctuation">.</span>category<span class="token punctuation">,</span>t1<span class="token punctuation">.</span>videoid<span class="token punctuation">,</span>t1<span class="token punctuation">.</span>views
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> videoid<span class="token punctuation">,</span> category_col <span class="token keyword">as</span> category<span class="token punctuation">,</span>views
<span class="token keyword">from</span> youtubevideo_orc lateral <span class="token keyword">view</span> explode <span class="token punctuation">(</span>category<span class="token punctuation">)</span> t_category <span class="token keyword">as</span> category_col
<span class="token punctuation">)</span> t1 <span class="token keyword">where</span> t1<span class="token punctuation">.</span>category<span class="token operator">=</span><span class="token string">&quot;Music&quot;</span> 
<span class="token keyword">order</span> <span class="token keyword">by</span> views <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+-----------+--+</span>
<span class="token operator">|</span> t1<span class="token punctuation">.</span>category  <span class="token operator">|</span>  t1<span class="token punctuation">.</span>videoid  <span class="token operator">|</span> t1<span class="token punctuation">.</span>views  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+-----------+--+</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> QjA5faZF1A8  <span class="token operator">|</span> <span class="token number">15256922</span>  <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> tYnn51C3X_w  <span class="token operator">|</span> <span class="token number">11823701</span>  <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> pv5zWaTEVkI  <span class="token operator">|</span> <span class="token number">11672017</span>  <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> <span class="token number">8</span>bbTtPL1jRs  <span class="token operator">|</span> <span class="token number">9579911</span>   <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> UMf40daefsI  <span class="token operator">|</span> <span class="token number">7533070</span>   <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> <span class="token operator">-</span>xEzGIuY7kw  <span class="token operator">|</span> <span class="token number">6946033</span>   <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> d6C0bNDqf3Y  <span class="token operator">|</span> <span class="token number">6935578</span>   <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> HSoVKUVOnfQ  <span class="token operator">|</span> <span class="token number">6193057</span>   <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> <span class="token number">3</span>URfWTEPmtE  <span class="token operator">|</span> <span class="token number">5581171</span>   <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> thtmaZnxk_0  <span class="token operator">|</span> <span class="token number">5142238</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+-----------+--+</span>
</code></pre></div><h6 id="第二种做法-创建表"><a href="#第二种做法-创建表" class="header-anchor">#</a> 第二种做法：创建表</h6> <ol><li><p>要想统计Music类别中的视频热度Top10，需要先找到Music类别，那么就需要将category展开，所以可以创建一张表用于存放categoryId展开的数据。</p></li> <li><p>向category展开的表中插入数据。</p></li> <li><p>统计对应类别（Music）中的视频热度。</p></li></ol> <p>创建表类别表：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> youtubevideo_category<span class="token punctuation">(</span>
    videoId string<span class="token punctuation">,</span> 
    uploader string<span class="token punctuation">,</span> 
    age <span class="token keyword">int</span><span class="token punctuation">,</span> 
    categoryId string<span class="token punctuation">,</span> 
    length <span class="token keyword">int</span><span class="token punctuation">,</span> 
    views <span class="token keyword">int</span><span class="token punctuation">,</span> 
    rate <span class="token keyword">float</span><span class="token punctuation">,</span> 
    ratings <span class="token keyword">int</span><span class="token punctuation">,</span> 
    comments <span class="token keyword">int</span><span class="token punctuation">,</span> 
    relatedId array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token keyword">row</span> format delimited 
<span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;\t&quot;</span> 
collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;&amp;&quot;</span> 
stored <span class="token keyword">as</span> orc<span class="token punctuation">;</span>
</code></pre></div><p>向类别表中插入数据：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span> youtubevideo_category  
    <span class="token keyword">select</span> 
        videoId<span class="token punctuation">,</span>
        uploader<span class="token punctuation">,</span>
        age<span class="token punctuation">,</span>
        categoryId<span class="token punctuation">,</span>
        length<span class="token punctuation">,</span>
        views<span class="token punctuation">,</span>
        rate<span class="token punctuation">,</span>
        ratings<span class="token punctuation">,</span>
        comments<span class="token punctuation">,</span>
        relatedId 
    <span class="token keyword">from</span> 
        youtubevideo_orc lateral <span class="token keyword">view</span> explode<span class="token punctuation">(</span>category<span class="token punctuation">)</span> catetory <span class="token keyword">as</span> categoryId<span class="token punctuation">;</span>

</code></pre></div><p>统计Music类别的Top10（也可以统计其他）</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> 
    videoId<span class="token punctuation">,</span> 
    views
<span class="token keyword">from</span> 
    youtubevideo_category 
<span class="token keyword">where</span> 
    categoryId <span class="token operator">=</span> <span class="token string">&quot;Music&quot;</span> 
<span class="token keyword">order</span> <span class="token keyword">by</span> 
    views 
<span class="token keyword">desc</span> <span class="token keyword">limit</span>
    <span class="token number">10</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="_6、-统计每个类别中视频流量top10-以music为例"><a href="#_6、-统计每个类别中视频流量top10-以music为例" class="header-anchor">#</a> 6、 统计每个类别中视频流量Top10，以Music为例</h4> <p>最终代码：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> t1<span class="token punctuation">.</span>category<span class="token punctuation">,</span>t1<span class="token punctuation">.</span>videoid<span class="token punctuation">,</span>t1<span class="token punctuation">.</span>ratings
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> videoid<span class="token punctuation">,</span> category_col <span class="token keyword">as</span> category<span class="token punctuation">,</span>ratings
<span class="token keyword">from</span> youtubevideo_orc lateral <span class="token keyword">view</span> explode <span class="token punctuation">(</span>category<span class="token punctuation">)</span> t_category <span class="token keyword">as</span> category_col
<span class="token punctuation">)</span> t1 <span class="token keyword">where</span> t1<span class="token punctuation">.</span>category<span class="token operator">=</span><span class="token string">&quot;Music&quot;</span> 
<span class="token keyword">order</span> <span class="token keyword">by</span> ratings <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+-------------+--+</span>
<span class="token operator">|</span> t1<span class="token punctuation">.</span>category  <span class="token operator">|</span>  t1<span class="token punctuation">.</span>videoid  <span class="token operator">|</span> t1<span class="token punctuation">.</span>ratings  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+-------------+--+</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> QjA5faZF1A8  <span class="token operator">|</span> <span class="token number">120506</span>      <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> pv5zWaTEVkI  <span class="token operator">|</span> <span class="token number">42386</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> UMf40daefsI  <span class="token operator">|</span> <span class="token number">31886</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> tYnn51C3X_w  <span class="token operator">|</span> <span class="token number">29479</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> <span class="token number">59</span>ZX5qdIEB0  <span class="token operator">|</span> <span class="token number">21481</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> FLn45<span class="token operator">-</span><span class="token number">7</span>Pn2Y  <span class="token operator">|</span> <span class="token number">21249</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> <span class="token operator">-</span>xEzGIuY7kw  <span class="token operator">|</span> <span class="token number">20828</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> HSoVKUVOnfQ  <span class="token operator">|</span> <span class="token number">19803</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> ARHyRI9_NB4  <span class="token operator">|</span> <span class="token number">19243</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Music        <span class="token operator">|</span> gg5_mlQOsUQ  <span class="token operator">|</span> <span class="token number">19190</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+-------------+--+</span>
</code></pre></div><h4 id="_7、-统计上传视频最多的用户top10以及他们上传的观看次数在前20的视频"><a href="#_7、-统计上传视频最多的用户top10以及他们上传的观看次数在前20的视频" class="header-anchor">#</a> 7、 统计上传视频最多的用户Top10以及他们上传的观看次数在前20的视频</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#第一步，找到上传视频最多的用户Top10</span>
<span class="token keyword">select</span> uploader<span class="token punctuation">,</span>videos
<span class="token keyword">from</span> youtubevideo_user_orc
<span class="token keyword">order</span> <span class="token keyword">by</span> videos <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">10</span>

<span class="token comment">#第二步，找到Top10用户上传的视频，并按照views排序、截取</span>
<span class="token keyword">select</span> t2<span class="token punctuation">.</span>videoid<span class="token punctuation">,</span>t2<span class="token punctuation">.</span>views<span class="token punctuation">,</span>t2<span class="token punctuation">.</span>ratings<span class="token punctuation">,</span>t1<span class="token punctuation">.</span>uploader<span class="token punctuation">,</span>t1<span class="token punctuation">.</span>videos
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> uploader<span class="token punctuation">,</span>videos
<span class="token keyword">from</span> youtubevideo_user_orc
<span class="token keyword">order</span> <span class="token keyword">by</span> videos <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">)</span> t1 <span class="token keyword">join</span> youtubevideo_orc t2 <span class="token keyword">on</span> t2<span class="token punctuation">.</span>uploader<span class="token operator">=</span>t1<span class="token punctuation">.</span>uploader
<span class="token keyword">order</span> <span class="token keyword">by</span> views <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">20</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_8、统计每个类别视频观看数top10"><a href="#_8、统计每个类别视频观看数top10" class="header-anchor">#</a> 8、统计每个类别视频观看数Top10</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> category_col<span class="token punctuation">,</span>videoid<span class="token punctuation">,</span>views<span class="token punctuation">,</span>rankcol 
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> videoid<span class="token punctuation">,</span>views<span class="token punctuation">,</span>category_col<span class="token punctuation">,</span>
rank<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> category_col <span class="token keyword">order</span> <span class="token keyword">by</span> views <span class="token keyword">desc</span><span class="token punctuation">)</span> <span class="token keyword">as</span> rankcol
<span class="token keyword">from</span> youtubevideo_orc lateral <span class="token keyword">view</span> explode<span class="token punctuation">(</span>category<span class="token punctuation">)</span>t_category <span class="token keyword">as</span> category_col
<span class="token punctuation">)</span> t1 <span class="token keyword">where</span> rankcol<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">----------------+--------------+-----------+----------+--+</span>
<span class="token operator">|</span>  category_col  <span class="token operator">|</span>   videoid    <span class="token operator">|</span>   views   <span class="token operator">|</span> rankcol  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+-----------+----------+--+</span>
<span class="token operator">|</span> Animals        <span class="token operator">|</span> <span class="token number">2</span>GWPOPSXGYI  <span class="token operator">|</span> <span class="token number">3660009</span>   <span class="token operator">|</span> <span class="token number">1</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animals        <span class="token operator">|</span> xmsV9R8FsDA  <span class="token operator">|</span> <span class="token number">3164582</span>   <span class="token operator">|</span> <span class="token number">2</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animals        <span class="token operator">|</span> <span class="token number">12</span>PsUW<span class="token operator">-</span><span class="token number">8</span>ge4  <span class="token operator">|</span> <span class="token number">3133523</span>   <span class="token operator">|</span> <span class="token number">3</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animals        <span class="token operator">|</span> OeNggIGSKH8  <span class="token operator">|</span> <span class="token number">2457750</span>   <span class="token operator">|</span> <span class="token number">4</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animals        <span class="token operator">|</span> WofFb_eOxxA  <span class="token operator">|</span> <span class="token number">2075728</span>   <span class="token operator">|</span> <span class="token number">5</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animals        <span class="token operator">|</span> AgEmZ39EtFk  <span class="token operator">|</span> <span class="token number">1999469</span>   <span class="token operator">|</span> <span class="token number">6</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animals        <span class="token operator">|</span> a<span class="token operator">-</span>gW3RbJd8U  <span class="token operator">|</span> <span class="token number">1836870</span>   <span class="token operator">|</span> <span class="token number">7</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animals        <span class="token operator">|</span> <span class="token number">8</span>CL2hetqpfg  <span class="token operator">|</span> <span class="token number">1646808</span>   <span class="token operator">|</span> <span class="token number">8</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animals        <span class="token operator">|</span> QmroaYVD_so  <span class="token operator">|</span> <span class="token number">1645984</span>   <span class="token operator">|</span> <span class="token number">9</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animals        <span class="token operator">|</span> Sg9x5mUjbH8  <span class="token operator">|</span> <span class="token number">1527238</span>   <span class="token operator">|</span> <span class="token number">10</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Animation      <span class="token operator">|</span> sdUUx5FdySs  <span class="token operator">|</span> <span class="token number">5840839</span>   <span class="token operator">|</span> <span class="token number">1</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animation      <span class="token operator">|</span> <span class="token number">6</span>B26asyGKDo  <span class="token operator">|</span> <span class="token number">5147533</span>   <span class="token operator">|</span> <span class="token number">2</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animation      <span class="token operator">|</span> H20dhY01Xjk  <span class="token operator">|</span> <span class="token number">3772116</span>   <span class="token operator">|</span> <span class="token number">3</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animation      <span class="token operator">|</span> <span class="token number">55</span>YYaJIrmzo  <span class="token operator">|</span> <span class="token number">3356163</span>   <span class="token operator">|</span> <span class="token number">4</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animation      <span class="token operator">|</span> JzqumbhfxRo  <span class="token operator">|</span> <span class="token number">3230774</span>   <span class="token operator">|</span> <span class="token number">5</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animation      <span class="token operator">|</span> eAhfZUZiwSE  <span class="token operator">|</span> <span class="token number">3114215</span>   <span class="token operator">|</span> <span class="token number">6</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animation      <span class="token operator">|</span> h7svw0m<span class="token operator">-</span>wO0  <span class="token operator">|</span> <span class="token number">2866490</span>   <span class="token operator">|</span> <span class="token number">7</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animation      <span class="token operator">|</span> tAq3hWBlalU  <span class="token operator">|</span> <span class="token number">2830024</span>   <span class="token operator">|</span> <span class="token number">8</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animation      <span class="token operator">|</span> AJzU3NjDikY  <span class="token operator">|</span> <span class="token number">2569611</span>   <span class="token operator">|</span> <span class="token number">9</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Animation      <span class="token operator">|</span> ElrldD02if0  <span class="token operator">|</span> <span class="token number">2337238</span>   <span class="token operator">|</span> <span class="token number">10</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Autos          <span class="token operator">|</span> RjrEQaG5jPM  <span class="token operator">|</span> <span class="token number">2803140</span>   <span class="token operator">|</span> <span class="token number">1</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Autos          <span class="token operator">|</span> cv157ZIInUk  <span class="token operator">|</span> <span class="token number">2773979</span>   <span class="token operator">|</span> <span class="token number">2</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Autos          <span class="token operator">|</span> Gyg9U1YaVk8  <span class="token operator">|</span> <span class="token number">1832224</span>   <span class="token operator">|</span> <span class="token number">3</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Autos          <span class="token operator">|</span> <span class="token number">6</span>GNB7xT3rNE  <span class="token operator">|</span> <span class="token number">1412497</span>   <span class="token operator">|</span> <span class="token number">4</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Autos          <span class="token operator">|</span> tth9krDtxII  <span class="token operator">|</span> <span class="token number">1347317</span>   <span class="token operator">|</span> <span class="token number">5</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Autos          <span class="token operator">|</span> <span class="token number">46</span>LQd9dXFRU  <span class="token operator">|</span> <span class="token number">1262173</span>   <span class="token operator">|</span> <span class="token number">6</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Autos          <span class="token operator">|</span> pdiuDXwgrjQ  <span class="token operator">|</span> <span class="token number">1013697</span>   <span class="token operator">|</span> <span class="token number">7</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Autos          <span class="token operator">|</span> kY_cDpENQLE  <span class="token operator">|</span> <span class="token number">956665</span>    <span class="token operator">|</span> <span class="token number">8</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Autos          <span class="token operator">|</span> YtxfbxGz1u4  <span class="token operator">|</span> <span class="token number">942604</span>    <span class="token operator">|</span> <span class="token number">9</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Autos          <span class="token operator">|</span> aCamHfJwSGU  <span class="token operator">|</span> <span class="token number">847442</span>    <span class="token operator">|</span> <span class="token number">10</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Blogs          <span class="token operator">|</span> <span class="token operator">-</span>_CSo1gOd48  <span class="token operator">|</span> <span class="token number">13199833</span>  <span class="token operator">|</span> <span class="token number">1</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Blogs          <span class="token operator">|</span> D2kJZOfq7zk  <span class="token operator">|</span> <span class="token number">11184051</span>  <span class="token operator">|</span> <span class="token number">2</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Blogs          <span class="token operator">|</span> pa_7P5AbUww  <span class="token operator">|</span> <span class="token number">5705136</span>   <span class="token operator">|</span> <span class="token number">3</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Blogs          <span class="token operator">|</span> f4B<span class="token operator">-</span>r8KJhlE  <span class="token operator">|</span> <span class="token number">4937616</span>   <span class="token operator">|</span> <span class="token number">4</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Blogs          <span class="token operator">|</span> LB84A3zcmVo  <span class="token operator">|</span> <span class="token number">4866739</span>   <span class="token operator">|</span> <span class="token number">5</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Blogs          <span class="token operator">|</span> tXNquTYnyg0  <span class="token operator">|</span> <span class="token number">3613323</span>   <span class="token operator">|</span> <span class="token number">6</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Blogs          <span class="token operator">|</span> EYppbbbSxjc  <span class="token operator">|</span> <span class="token number">2896562</span>   <span class="token operator">|</span> <span class="token number">7</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Blogs          <span class="token operator">|</span> LH7vrLlDZ6U  <span class="token operator">|</span> <span class="token number">2615359</span>   <span class="token operator">|</span> <span class="token number">8</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Blogs          <span class="token operator">|</span> bTV85fQhj0E  <span class="token operator">|</span> <span class="token number">2192656</span>   <span class="token operator">|</span> <span class="token number">9</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Blogs          <span class="token operator">|</span> eVFF98kNg8Q  <span class="token operator">|</span> <span class="token number">1813803</span>   <span class="token operator">|</span> <span class="token number">10</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Comedy         <span class="token operator">|</span> dMH0bHeiRNg  <span class="token operator">|</span> <span class="token number">42513417</span>  <span class="token operator">|</span> <span class="token number">1</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Comedy         <span class="token operator">|</span> <span class="token number">0</span>XxI<span class="token operator">-</span>hvPRRA  <span class="token operator">|</span> <span class="token number">20282464</span>  <span class="token operator">|</span> <span class="token number">2</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Comedy         <span class="token operator">|</span> <span class="token number">49</span>IDp76kjPw  <span class="token operator">|</span> <span class="token number">11970018</span>  <span class="token operator">|</span> <span class="token number">3</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Comedy         <span class="token operator">|</span> <span class="token number">5</span>P6UU6m3cqk  <span class="token operator">|</span> <span class="token number">10107491</span>  <span class="token operator">|</span> <span class="token number">4</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Comedy         <span class="token operator">|</span> _BuRwH59oAo  <span class="token operator">|</span> <span class="token number">9566609</span>   <span class="token operator">|</span> <span class="token number">5</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Comedy         <span class="token operator">|</span> MNxwAU_xAMk  <span class="token operator">|</span> <span class="token number">7066676</span>   <span class="token operator">|</span> <span class="token number">6</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Comedy         <span class="token operator">|</span> pYak2F1hUYA  <span class="token operator">|</span> <span class="token number">6322117</span>   <span class="token operator">|</span> <span class="token number">7</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Comedy         <span class="token operator">|</span> h0zAlXr1UOs  <span class="token operator">|</span> <span class="token number">5826923</span>   <span class="token operator">|</span> <span class="token number">8</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Comedy         <span class="token operator">|</span> C8rjr4jmWd0  <span class="token operator">|</span> <span class="token number">5587299</span>   <span class="token operator">|</span> <span class="token number">9</span>        <span class="token operator">|</span>
<span class="token operator">|</span> omedy         <span class="token operator">|</span> R4cQ3BoHFas  <span class="token operator">|</span> <span class="token number">5508079</span>   <span class="token operator">|</span> <span class="token number">10</span>       <span class="token operator">|</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MaLunan/press/edit/dev-mln/docs/hive/hive.md" target="_blank" rel="noopener noreferrer">在GitHub 上编辑此页！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">1/19/2021, 1:41:59 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fdd7a502.js" defer></script><script src="/assets/js/16.375b747e.js" defer></script><script src="/assets/js/14.1f257a58.js" defer></script>
  </body>
</html>
