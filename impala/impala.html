<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>impala课前准备 | 个人博客 | JiiiiG</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="自是年少，韶华倾负">
    
    <link rel="preload" href="/assets/css/0.styles.420b7c1f.css" as="style"><link rel="preload" href="/assets/js/app.fdd7a502.js" as="script"><link rel="preload" href="/assets/js/16.375b747e.js" as="script"><link rel="preload" href="/assets/js/35.ad3402e6.js" as="script"><link rel="prefetch" href="/assets/js/10.bbd38b9e.js"><link rel="prefetch" href="/assets/js/11.f49fc7d3.js"><link rel="prefetch" href="/assets/js/12.c5d97aa1.js"><link rel="prefetch" href="/assets/js/13.426d0224.js"><link rel="prefetch" href="/assets/js/14.1f257a58.js"><link rel="prefetch" href="/assets/js/15.be29bb6a.js"><link rel="prefetch" href="/assets/js/17.d02cdd8b.js"><link rel="prefetch" href="/assets/js/18.5d2371a4.js"><link rel="prefetch" href="/assets/js/19.038919a3.js"><link rel="prefetch" href="/assets/js/2.d6257727.js"><link rel="prefetch" href="/assets/js/20.b3582e09.js"><link rel="prefetch" href="/assets/js/21.0c1e826b.js"><link rel="prefetch" href="/assets/js/22.91bff1a5.js"><link rel="prefetch" href="/assets/js/23.faacea60.js"><link rel="prefetch" href="/assets/js/24.69816497.js"><link rel="prefetch" href="/assets/js/25.c9fcaa62.js"><link rel="prefetch" href="/assets/js/26.d28c3abe.js"><link rel="prefetch" href="/assets/js/27.1518da7d.js"><link rel="prefetch" href="/assets/js/28.748a5581.js"><link rel="prefetch" href="/assets/js/29.775019f1.js"><link rel="prefetch" href="/assets/js/3.141002a4.js"><link rel="prefetch" href="/assets/js/30.74e7c570.js"><link rel="prefetch" href="/assets/js/31.190b11f2.js"><link rel="prefetch" href="/assets/js/32.d8f4f116.js"><link rel="prefetch" href="/assets/js/33.c489bc81.js"><link rel="prefetch" href="/assets/js/34.db609d51.js"><link rel="prefetch" href="/assets/js/36.45f11923.js"><link rel="prefetch" href="/assets/js/37.b47e0576.js"><link rel="prefetch" href="/assets/js/38.58b934a2.js"><link rel="prefetch" href="/assets/js/39.e4d6bcdf.js"><link rel="prefetch" href="/assets/js/4.e9b44388.js"><link rel="prefetch" href="/assets/js/40.555106bc.js"><link rel="prefetch" href="/assets/js/41.4387ceb1.js"><link rel="prefetch" href="/assets/js/42.9bd4aea0.js"><link rel="prefetch" href="/assets/js/43.587e7966.js"><link rel="prefetch" href="/assets/js/44.80285763.js"><link rel="prefetch" href="/assets/js/45.f978da77.js"><link rel="prefetch" href="/assets/js/46.d93e3f2e.js"><link rel="prefetch" href="/assets/js/47.c15bd2aa.js"><link rel="prefetch" href="/assets/js/48.cb55fa72.js"><link rel="prefetch" href="/assets/js/49.d0f4e454.js"><link rel="prefetch" href="/assets/js/5.b90b80cb.js"><link rel="prefetch" href="/assets/js/50.112e8260.js"><link rel="prefetch" href="/assets/js/51.a66bcd03.js"><link rel="prefetch" href="/assets/js/52.0c7cbfb1.js"><link rel="prefetch" href="/assets/js/53.67ef240b.js"><link rel="prefetch" href="/assets/js/54.2c2d082d.js"><link rel="prefetch" href="/assets/js/55.88f19a20.js"><link rel="prefetch" href="/assets/js/56.c726e920.js"><link rel="prefetch" href="/assets/js/57.eaee47c5.js"><link rel="prefetch" href="/assets/js/58.ac15a3ac.js"><link rel="prefetch" href="/assets/js/59.64bdc849.js"><link rel="prefetch" href="/assets/js/6.7eea74ff.js"><link rel="prefetch" href="/assets/js/7.a1370e98.js"><link rel="prefetch" href="/assets/js/8.2e898240.js"><link rel="prefetch" href="/assets/js/9.a2439994.js">
    <link rel="stylesheet" href="/assets/css/0.styles.420b7c1f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人博客 | JiiiiG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/linux/linux常用命令/01linux常用命令01.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hadoop/01hadoop环境搭建/01搭建hadoop集群.html" class="nav-link">
  hadoop
</a></li><li class="dropdown-item"><!----> <a href="/hbase/hbase.html" class="nav-link">
  hbase
</a></li><li class="dropdown-item"><!----> <a href="/flink/flink.html" class="nav-link">
  flink
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/impala/.html" class="nav-link">
  java
</a></li></ul></div></div> <a href="https://github.com/MaLunan/press" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/linux/linux常用命令/01linux常用命令01.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hadoop/01hadoop环境搭建/01搭建hadoop集群.html" class="nav-link">
  hadoop
</a></li><li class="dropdown-item"><!----> <a href="/hbase/hbase.html" class="nav-link">
  hbase
</a></li><li class="dropdown-item"><!----> <a href="/flink/flink.html" class="nav-link">
  flink
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/impala/.html" class="nav-link">
  java
</a></li></ul></div></div> <a href="https://github.com/MaLunan/press" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="impala课前准备"><a href="#impala课前准备" class="header-anchor">#</a> impala课前准备</h2> <p>安装好hive以及hadoop运行环境，并正常启动hadoop以及hive的</p> <h2 id="离线任务处理流程概述"><a href="#离线任务处理流程概述" class="header-anchor">#</a> 离线任务处理流程概述</h2> <p>离线任务的大致流程：数据采集--&gt;HDFS存储--&gt;ETL清洗数据--&gt;构建数据仓库--&gt;web界面数据展示。离线处理大致示意图如下：</p> <p><img src="/assets/img/离线任务处理流程.dd560017.png" alt="离线任务处理流程"></p> <p>前面我们学习了一些离线处理的框架：</p> <ul><li>flume--&gt;日志数据的采集</li> <li>sqoop--&gt;数据导入导出工具</li> <li>mapreduce--&gt;数据清洗工作</li> <li>hive--&gt;数据仓库的构建</li> <li>azkaban--&gt;实现定时任务</li> <li>echarts/highcharts--&gt;数据报表展示（还没学）</li></ul> <p>hive是一个数据仓库工具，底层的执行引擎是mapreduce，查询速度比较慢，是较早的一个sql on hadoop的工具。</p> <p>现在，我们要学习另一个sql on hadoop的工具，叫做impala，impala可以完全替代hive，而且速度很快。</p> <h2 id="imala基本介绍"><a href="#imala基本介绍" class="header-anchor">#</a> imala基本介绍</h2> <p>impala是cloudera提供的一款高效率的sql查询工具，提供实时的查询效果，官方测试性能比hive快10到100倍，其sql查询比sparkSQL还要更加快速，号称是当前大数据领域最快的查询sql工具，impala是参照谷歌的新三篇论文（Caffeine、Pregel、Dremel）当中的Dremel实现而来，其中旧三篇论文分别是（BigTable，GFS，MapReduce）分别对应HBase、HDFS以及MapReduce</p> <p>impala是基于hive并使用<strong>内存</strong>进行计算，兼顾数据仓库，具有实时，批处理，多并发等优点</p> <h2 id="impala与hive的关系"><a href="#impala与hive的关系" class="header-anchor">#</a> impala与hive的关系</h2> <p>impala是基于hive的大数据分析查询引擎，直接使用hive的元数据库metadata，意味着impala元数据都存储在hive的metastore当中，并且impala兼容hive的绝大多数sql语法。所以需要安装impala的话，必须先安装hive，保证hive安装成功，并且还需要启动hive的metastore服务。</p> <p>Hive的元数据信息存储在mysql表上，impala要访问hive的元数据库metadata，不是直接访问mysql表的，而是先通过hive，再访问mysql表的。（前提是开启了Hive的对外元数据访问服务——metastore）</p> <img src="impala.assets/image-20200330145129427.png" alt="image-20200330145129427" style="zoom:80%;"> <h2 id="impala的优点-缺点"><a href="#impala的优点-缺点" class="header-anchor">#</a> impala的优点/缺点</h2> <p>优点：</p> <ol><li><p>impala比较快，非常快，特别快，因为所有的计算都可以放入内存当中进行完成，只要你内存足够大</p></li> <li><p>摈弃了MR的计算，改用C++来实现，有针对性的硬件优化</p></li> <li><p>具有数据仓库的特性，对hive的原有数据做数据分析</p></li> <li><p>支持ODBC，jdbc远程访问</p></li></ol> <p>缺点：</p> <ol><li><p>基于内存计算，对内存依赖性较大</p></li> <li><p>改用C++编写，意味着维护难度增大</p></li> <li><p>基于hive，与hive共存亡，紧耦合</p></li> <li><p>稳定性不如hive，不存在数据丢失的情况</p></li></ol> <h2 id="impala的架构"><a href="#impala的架构" class="header-anchor">#</a> impala的架构</h2> <p>impala是一个主从架构，架构模块如下：</p> <ul><li><p>impala-statestore：主节点，状态存储区，sql语句执行的状态都在这里看</p></li> <li><p>impalas-catalog：主节点，元数据管理区</p></li> <li><p>impala-server(impalad)：从节点，启动的守护进程，执行我们的sql查询计划，官方建议impalad与所有的datanode装在一起，可以通过hadoop的短路读取特性实现数据的快速查询</p></li></ul> <p><img src="/assets/img/clip_image002.4e45677b.png" alt="img"></p> <h2 id="impala的执行计划"><a href="#impala的执行计划" class="header-anchor">#</a> impala的执行计划</h2> <p><strong>查询执行</strong></p> <p>impalad分为frontend和backend两个层次， frondend用java实现（通过JNI嵌入impalad），负责查询计划生成， 而backend用C++实现， 负责查询执行。</p> <p>frontend生成查询计划分为两个阶段：</p> <p>（1）生成单机查询计划，单机执行计划与关系数据库执行计划相同，所用查询优化方法也类似。</p> <p>（2）生成分布式查询计划。 根据单机执行计划， 生成真正可执行的分布式执行计划，降低数据移动， 尽量把数据和计算放在一起。</p> <p><img src="/assets/img/clip_image004.a3ba01e7.jpg" alt="http://www.aboutyun.com/data/attachment/forum/201507/27/134940kb7luw6ix8in3w3s.png"></p> <p>上图是SQL查询例子， 该SQL的目标是在三表join的基础上算聚集， 并按照聚集列排序取topN。</p> <p>impala的查询优化器支持代价模型： 利用表和分区的cardinality，每列的distinct值个数等统计数据， impala可估算执行计划代价， 并生成较优的执行计划。 上图左边是frontend查询优化器生成的单机查询计划， 与传统关系数据库不同， 单机查询计划不能直接执行， 必须转换成如图右半部分所示的分布式查询计划。 该分布式查询计划共分成6个segment（图中彩色无边框圆角矩形）， 每个segment是可以被单台服务器独立执行的计划子树。</p> <h2 id="impala-spark-hive对比"><a href="#impala-spark-hive对比" class="header-anchor">#</a> impala/SPARK/hive对比</h2> <table><thead><tr><th></th> <th>HIVE</th> <th>SPARK</th> <th>Impala</th></tr></thead> <tbody><tr><td>概要</td> <td>Hive是老牌的SQL-on-hadoop解决方案</td> <td>spark上的交互式SQL解决方案提供DataFrame API做为SQL补充，方便实现ETL、分析、机器学习等复杂逻辑。</td> <td>hadoop上交互式的MPP SQL引擎</td></tr> <tr><td>容错</td> <td>强，中间结果落盘，容错能力强，最细粒度容错</td> <td>较强，基于数据血缘关系的数据恢复</td> <td>弱，遇到问题时，需要重做查询</td></tr> <tr><td>性能</td> <td>慢，MR启动慢，中间结果落盘</td> <td>较快，基于RDD模型，DAG执行基于代价的查询优化内存基于列存储编译执行（生成Java字节码）Java实现</td> <td>快，MPP架构基于代价的查询优化，JOIN优化LLVM查询，编译C++实现向量执行引擎，可使用SSE指令列存IO本地化资源管理器优化（LLAM）</td></tr></tbody></table> <p>注释：落盘——写到磁盘中？</p> <h2 id="impala的安装-todo"><a href="#impala的安装-todo" class="header-anchor">#</a> impala的安装（TODO）</h2> <h4 id="安装方式的选择"><a href="#安装方式的选择" class="header-anchor">#</a> 安装方式的选择</h4> <p>由于大部分的软件框架，CDH都提供了压缩包的安装方式，但是由于impala有部分代码使用C++编写，所以impala在安装包的选择上面，cloudera公司没有提供tar包的安装方式，只提供了rpm的安装方式，我们可以通过下载rpm包来进行安装。注意：rpm包是linux操作系统上面的一种安装压缩包</p> <p>由于impala没有提供tar包供我们进行安装，只提供了rpm包，所以我们在安装impala的时候，需要使用rpm包来进行安装，rpm包只有cloudera公司提供了，所以我们去cloudera公司网站进行下载rpm包即可，但是另外一个问题，impala的rpm包依赖非常多的其他的rpm包，可以一个个的将依赖找出来，也可以将所有的rpm包下载下来，制作成我们本地yum源来进行安装。我们选择这个方式安装impala。</p> <h4 id="拓展-yum命令的实质"><a href="#拓展-yum命令的实质" class="header-anchor">#</a> 拓展：yum命令的实质</h4> <p>当执行一个命令：yum install xxx时，首先会去配置文件里查找rmp仓库的地址，然后通过某种网络协议去对应的rmp仓下载rpm包。因此，要制作自己的本地yum源来安装东西，我们只需执行以下3步：</p> <ol><li>制作rpm本地仓库</li> <li>写一个配置文件，指定rpm本地仓库的地址</li> <li>安装httpd服务：yum -y install httpd</li></ol> <p><img src="/assets/img/image-20200331002442077.0ecb9350.png" alt="image-20200331002442077"></p> <h4 id="制作自己的本地yum源"><a href="#制作自己的本地yum源" class="header-anchor">#</a> 制作自己的本地yum源</h4> <h6 id="制作rpm本地仓库"><a href="#制作rpm本地仓库" class="header-anchor">#</a> 制作rpm本地仓库</h6> <p>下载所有的rpm包，下载地址：http://archive.cloudera.com/cdh5/repo-as-tarball/5.14.2/cdh5.14.2-centos7.tar.gz</p> <img src="impala.assets/image-20200330161714919.png" alt="image-20200330161714919" style="zoom:67%;"> <p>将我们下载好的压缩包cdh5.14.2-centos7.tar.gz，上传到node03服务器的/kkb/soft路径下，并进行解压：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /kkb/soft
rz <span class="token comment">#文件大于4G，可能要使用security Fx上传</span>
<span class="token punctuation">[</span>hadoop@node03 soft<span class="token punctuation">]</span>$ <span class="token function">tar</span> -zxvf cdh5.14.2-centos7.tar.gz
</code></pre></div><h6 id="安装并启动httpd服务"><a href="#安装并启动httpd服务" class="header-anchor">#</a> 安装并启动httpd服务</h6> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> yum  -y <span class="token function">install</span> httpd
<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl start httpd.service

<span class="token comment">#验证是否启动httpd了:</span>
<span class="token punctuation">[</span>hadoop@node03 soft<span class="token punctuation">]</span>$ <span class="token function">ps</span> -ef<span class="token operator">|</span><span class="token function">grep</span> httpd
root      <span class="token number">49419</span>      <span class="token number">1</span>  <span class="token number">0</span> 00:37 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
apache    <span class="token number">49420</span>  <span class="token number">49419</span>  <span class="token number">0</span> 00:37 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
apache    <span class="token number">49421</span>  <span class="token number">49419</span>  <span class="token number">0</span> 00:37 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
apache    <span class="token number">49422</span>  <span class="token number">49419</span>  <span class="token number">0</span> 00:37 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
apache    <span class="token number">49423</span>  <span class="token number">49419</span>  <span class="token number">0</span> 00:37 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
apache    <span class="token number">49424</span>  <span class="token number">49419</span>  <span class="token number">0</span> 00:37 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
hadoop    <span class="token number">49427</span>  <span class="token number">49040</span>  <span class="token number">0</span> 00:37 pts/0    00:00:00 <span class="token function">grep</span> --color<span class="token operator">=</span>auto httpd
</code></pre></div><h6 id="创建yum配置文件"><a href="#创建yum配置文件" class="header-anchor">#</a> 创建yum配置文件</h6> <p>镜像源是centos当中下载相关软件的地址，选用第三台机器作为镜像源的服务端，node03机器上执行以下命令：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /etc/yum.repos.d
<span class="token function">sudo</span> <span class="token function">vim</span> localimp.repo 

<span class="token punctuation">[</span>localimp<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>localimp
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://node03/cdh5.14.2/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre></div><h6 id="创建apache-httpd的读取链接"><a href="#创建apache-httpd的读取链接" class="header-anchor">#</a> 创建apache httpd的读取链接</h6> <p>启动httpd服务后，在/var/www/html/上的文件都可以通过http访问到，因此我们要在/var/www/html/路径下，创建本地rpm仓库的软链接。</p> <div class="language- extra-class"><pre class="language-text"><code>sudo ln -s /kkb/soft/cdh/5.14.2 /var/www/html/cdh5.14.2
</code></pre></div><h6 id="web页面访问本地yum源"><a href="#web页面访问本地yum源" class="header-anchor">#</a> web页面访问本地yum源</h6> <p>访问地址：http://node03/cdh5.14.2，出现下面这个界面表示本地yum源制作成功</p> <img src="impala.assets/image-20200331005620914.png" alt="image-20200331005620914" style="zoom:67%;"> <h6 id="分发配置文件"><a href="#分发配置文件" class="header-anchor">#</a> 分发配置文件</h6> <p>将node03制作好的localimp配置文件发放到所有需要安装impala的节点上去</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /etc/yum.repos.d/
<span class="token punctuation">[</span>hadoop@node03 yum.repos.d<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">scp</span> localimp.repo  node02:/etc/yum.repos.d/
<span class="token punctuation">[</span>hadoop@node03 yum.repos.d<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">scp</span> localimp.repo  node01:/etc/yum.repos.d/
</code></pre></div><h4 id="开始安装impala"><a href="#开始安装impala" class="header-anchor">#</a> 开始安装impala</h4> <p>安装规划如下，以node03作为主节点，node02/node01作为从节点。</p> <table><thead><tr><th>服务名称</th> <th>node01</th> <th>node02</th> <th>node03</th></tr></thead> <tbody><tr><td>impala-catalog</td> <td>×</td> <td>×</td> <td>安装</td></tr> <tr><td>impala-state-store</td> <td>×</td> <td>×</td> <td>安装</td></tr> <tr><td>impala-server</td> <td>安装</td> <td>安装</td> <td>安装</td></tr></tbody></table> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#主节点node03执行以下命令进行安装</span>
<span class="token function">sudo</span> yum  <span class="token function">install</span>  impala -y
<span class="token function">sudo</span> yum <span class="token function">install</span> impala-server -y
<span class="token function">sudo</span> yum <span class="token function">install</span> impala-state-store  -y
<span class="token function">sudo</span> yum <span class="token function">install</span> impala-catalog  -y
<span class="token function">sudo</span> yum  <span class="token function">install</span>  impala-shell -y

<span class="token comment">#从节点node01与node02安装以下服务</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> impala-server -y
</code></pre></div><p>补充：</p> <p>在这一步时，遇到过一个错误：http://node03/cdh5.14.2/repodata/repomd.xml: [Errno 14] HTTP Error 404 - Not Found，是因为我们制作本地rpm仓库的时候，解压出来的文件没有包含repodata文件夹，也不知道怎么没有的，但是重新rz将缺失的repodata文件夹上传就可以解决了。</p> <img src="impala.assets/image-20200331015723512.png" alt="image-20200331015723512" style="zoom:67%;"> <h4 id="node03修改hive-site-xml"><a href="#node03修改hive-site-xml" class="header-anchor">#</a> node03修改hive-site.xml</h4> <p>node03机器修改hive-site.xml内容如下</p> <p>hive-site.xml配置</p> <div class="language-xml extra-class"><pre class="language-xml"><code>vim /kkb/install/hive-1.1.0-cdh5.14.2/conf/hive-site.xml
添加以下三个配置属性

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.server2.thrift.bind.host<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
 	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>node03<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.metastore.uris<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>thrift://node03:9083<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.metastore.client.socket.timeout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>3600<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>注意：hive.server2.thrift.bind.host可能本来就存在，可以不用添加。</p> <h4 id="拷贝hive安装包"><a href="#拷贝hive安装包" class="header-anchor">#</a> 拷贝hive安装包</h4> <p>之前只是在node03安装了hive，需要将hive的安装包，拷贝到所有的服务器上面都保存一份，因为impala需要引用hive的安装目录下面的一些依赖的jar包。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /kkb/install/
<span class="token punctuation">[</span>hadoop@node03 install<span class="token punctuation">]</span>$ <span class="token function">scp</span> -r hive-1.1.0-cdh5.14.2/ node02:/kkb/install/
<span class="token punctuation">[</span>hadoop@node03 install<span class="token punctuation">]</span>$ <span class="token function">scp</span> -r hive-1.1.0-cdh5.14.2/ node01:/kkb/install/
</code></pre></div><h4 id="node01-02-03修改hdfs-site-xml-疑点"><a href="#node01-02-03修改hdfs-site-xml-疑点" class="header-anchor">#</a> node01/02/03修改hdfs-site.xml（疑点）</h4> <p>所有的节点创建目录：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /var/run/hdfs-sockets
<span class="token function">sudo</span> <span class="token function">chown</span> -R  hadoop:hadoop   /var/run/hdfs-sockets/
</code></pre></div><p>修改所有节点的hdfs-site.xml添加以下配置，修改完之后重启hdfs集群生效</p> <div class="language-xml extra-class"><pre class="language-xml"><code>vim  /kkb/install/hadoop-2.6.0-cdh5.14.2/etc/hadoop/hdfs-site.xml

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.client.read.shortcircuit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.domain.socket.path<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/var/run/hdfs-sockets/dn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.client.file-block-storage-locations.timeout.millis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>10000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.datanode.hdfs-blocks-metadata.enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="重启hdfs"><a href="#重启hdfs" class="header-anchor">#</a> 重启hdfs</h4> <p>重启hdfs文件系统，node01服务器上面执行以下命令：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /kkb/install/hadoop-2.6.0-cdh5.14.2/

sbin/stop-dfs.sh
sbin/start-dfs.sh
</code></pre></div><h4 id="创建hadoop与hive的配置文件的连接"><a href="#创建hadoop与hive的配置文件的连接" class="header-anchor">#</a> 创建hadoop与hive的配置文件的连接</h4> <p>所有节点，在impala的配置目录/etc/impala/conf创建core-site.xml，hdfs-site.xml以及hive-site.xml配置文件的软链接：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">ln</span> -s /kkb/install/hadoop-2.6.0-cdh5.14.2/etc/hadoop/core-site.xml /etc/impala/conf/core-site.xml

<span class="token function">sudo</span> <span class="token function">ln</span> -s /kkb/install/hadoop-2.6.0-cdh5.14.2/etc/hadoop/hdfs-site.xml /etc/impala/conf/hdfs-site.xml

<span class="token function">sudo</span> <span class="token function">ln</span> -s /kkb/install/hive-1.1.0-cdh5.14.2/conf/hive-site.xml /etc/impala/conf/hive-site.xml 
</code></pre></div><h4 id="修改impala的配置文件"><a href="#修改impala的配置文件" class="header-anchor">#</a> 修改impala的配置文件</h4> <p>所有节点：更改impala默认配置文件以及添加mysql的连接驱动包</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/default/impala

<span class="token assign-left variable">IMPALA_CATALOG_SERVICE_HOST</span><span class="token operator">=</span>node03
<span class="token assign-left variable">IMPALA_STATE_STORE_HOST</span><span class="token operator">=</span>node03

<span class="token comment">## 所有节点创建mysql的驱动包的软连接</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> -p /usr/share/java
<span class="token function">sudo</span> <span class="token function">ln</span> -s /kkb/install/hive-1.1.0-cdh5.14.2/lib/mysql-connector-java-5.1.38.jar /usr/share/java/mysql-connector-java.jar
</code></pre></div><h4 id="修改bigtop的java路径"><a href="#修改bigtop的java路径" class="header-anchor">#</a> 修改bigtop的java路径</h4> <p>所有节点：修改bigtop的java_home路径</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/default/bigtop-utils

<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/kkb/install/jdk1.8.0_141
</code></pre></div><h2 id="启动impala服务"><a href="#启动impala服务" class="header-anchor">#</a> 启动impala服务</h2> <p>启动node03的hive的metastore服务：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span>  /kkb/install/hive-1.1.0-cdh5.14.2

<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token function">nohup</span> hive --service metastore <span class="token operator">&amp;</span>
<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token function">nohup</span> hive --service hiveserver2 <span class="token operator">&amp;</span>
</code></pre></div><p>注意：一定要保证mysql的服务正常启动，否则metastore的服务不能够启动,查看mysql是否开启的方式如下：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token operator">/</span>bin<span class="token operator">/</span>systemctl status mysqld<span class="token punctuation">.</span>service
</code></pre></div><p>主节点node03启动以下三个服务进程</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">service</span> impala-state-store start
<span class="token function">sudo</span> <span class="token function">service</span> impala-catalog start
<span class="token function">sudo</span> <span class="token function">service</span> impala-server start

<span class="token comment">#关闭方式如下：</span>
<span class="token function">sudo</span> <span class="token function">service</span> impala-state-store stop
<span class="token function">sudo</span> <span class="token function">service</span> impala-catalog stop
<span class="token function">sudo</span> <span class="token function">service</span> impala-server stop
</code></pre></div><p>从节点启动node01与node02启动impala-server</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">service</span>  impala-server  start
</code></pre></div><p>三台机器可以通过以下命令，查看impala进程是否存在</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> impala
</code></pre></div><p>注意：启动之后所有关于impala的日志默认都在/var/log/impala 这个路径下，node03机器上面应该有三个进程，node02与node01机器上面只有一个进程，如果进程个数不对，去对应目录下查看报错日志</p> <h2 id="浏览器页面访问"><a href="#浏览器页面访问" class="header-anchor">#</a> 浏览器页面访问</h2> <p>访问impalad的管理界面</p> <p>http://node03:25000/</p> <p>访问statestored的管理界面</p> <p>http://node03:25010/</p> <p>访问catalog的管理界面</p> <p>http://node03:25020</p> <h2 id="impala-shell的外部命令"><a href="#impala-shell的外部命令" class="header-anchor">#</a> impala-shell的外部命令</h2> <p>impala-shell外部命令是指不需要进入到impala-shell中即可执行的命令。</p> <h4 id="h-查看帮助文档"><a href="#h-查看帮助文档" class="header-anchor">#</a> -h  查看帮助文档</h4> <p>impala-shell外部命令的常用option是:</p> <ul><li>-q:不进入impala-shell客户端，直接执行sql语句</li> <li>-f:执行sql脚本文件</li> <li>-r:刷新元数据</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ impala-shell -h
Options:
  -h, --help            show this <span class="token builtin class-name">help</span> message and <span class="token builtin class-name">exit</span>
  -q QUERY, --query<span class="token operator">=</span>QUERY
                        Execute a query without the shell <span class="token punctuation">[</span>default: none<span class="token punctuation">]</span>
  -f QUERY_FILE, --query_file<span class="token operator">=</span>QUERY_FILE
                        Execute the queries <span class="token keyword">in</span> the query file, delimited by <span class="token punctuation">;</span><span class="token builtin class-name">.</span>
                        If the argument to -f is <span class="token string">&quot;-&quot;</span>, <span class="token keyword">then</span> queries are <span class="token builtin class-name">read</span>
                        from stdin and terminated with ctrl-d. <span class="token punctuation">[</span>default: none<span class="token punctuation">]</span>
  -r, --refresh_after_connect
                        Refresh Impala catalog after connecting
                        <span class="token punctuation">[</span>default: False<span class="token punctuation">]</span>
</code></pre></div><h4 id="r-刷新整个元数据"><a href="#r-刷新整个元数据" class="header-anchor">#</a> -r  刷新整个元数据</h4> <p>数据量大的时候，比较消耗服务器性能</p> <div class="language-sh extra-class"><pre class="language-sh"><code>impala-shell -r
</code></pre></div><h4 id="v-查看对应版本"><a href="#v-查看对应版本" class="header-anchor">#</a> -v  查看对应版本</h4> <p>查看impala-shell的版本</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ impala-shell -v
Impala Shell v2.11.0-cdh5.14.2 <span class="token punctuation">(</span>ed85dce<span class="token punctuation">)</span> built on Tue Mar <span class="token number">27</span> <span class="token number">13</span>:39:48 PDT <span class="token number">2018</span>
</code></pre></div><h4 id="f-执行sql脚本"><a href="#f-执行sql脚本" class="header-anchor">#</a> -f  执行sql脚本</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /kkb/install
<span class="token function">vim</span> impala-shell.sql

<span class="token keyword">select</span> * from course.score<span class="token punctuation">;</span>


<span class="token comment">#通过-f 参数来执行执行的查询文件</span>
impala-shell -f impala-shell.sql
</code></pre></div><h4 id="p-显示查询计划"><a href="#p-显示查询计划" class="header-anchor">#</a> -p  显示查询计划</h4> <div class="language-sh extra-class"><pre class="language-sh"><code>impala-shell -f impala-shell.sql -p
</code></pre></div><h4 id="_9-1-2、impala-shell的内部命令行参数语法"><a href="#_9-1-2、impala-shell的内部命令行参数语法" class="header-anchor">#</a> 9.1.2、impala-shell的内部命令行参数语法</h4> <p>进入impala-shell命令行之后可以执行的语法</p> <h5 id="help命令"><a href="#help命令" class="header-anchor">#</a> help命令</h5> <p>帮助文档</p> <h5 id="connect命令"><a href="#connect命令" class="header-anchor">#</a> connect命令</h5> <p>connect  hostname 连接到某一台机器上面去执行</p> <h5 id="refresh-命令"><a href="#refresh-命令" class="header-anchor">#</a> refresh 命令</h5> <p>refresh dbname.tablename  增量刷新，刷新某一张表的元数据，主要用于刷新hive当中数据表里面的数据改变的情况</p> <div class="language- extra-class"><pre class="language-text"><code>refresh course.score;
</code></pre></div><h5 id="invalidate-metadata-命令"><a href="#invalidate-metadata-命令" class="header-anchor">#</a> invalidate  metadata 命令：</h5> <div class="language- extra-class"><pre class="language-text"><code>invalidate  metadata
全量刷新，性能消耗较大，主要用于hive当中新建数据库或者数据库表的时候来进行刷新
</code></pre></div><h5 id="explain-命令"><a href="#explain-命令" class="header-anchor">#</a> explain 命令：</h5> <p>用于查看sql语句的执行计划</p> <div class="language- extra-class"><pre class="language-text"><code>explain select * from course.score;

explain的值可以设置成0,1,2,3等几个值，其中3级别是最高的，可以打印出最全的信息

set explain_level=3;
</code></pre></div><h5 id="profile命令"><a href="#profile命令" class="header-anchor">#</a> profile命令：</h5> <p>执行sql语句之后执行，可以打印出更加详细的执行步骤，</p> <p>主要用于查询结果的查看，集群的调优等</p> <div class="language- extra-class"><pre class="language-text"><code>select * from course.score;

profile;
</code></pre></div><p>注意:在hive窗口当中插入的数据或者新建的数据库或者数据库表，在impala当中是不可直接查询到的，需要刷新数据库，在impala-shell当中插入的数据，在impala当中是可以直接查询到的，不需要刷新数据库，其中使用的就是catalog这个服务的功能实现的，catalog是impala1.2版本之后增加的模块功能，主要作用就是同步impala之间的元数据</p> <h3 id="_2、创建数据库"><a href="#_2、创建数据库" class="header-anchor">#</a> 2、创建数据库</h3> <p>impala-shell进入到impala的交互窗口</p> <h4 id="_2-1、查看所有数据库"><a href="#_2-1、查看所有数据库" class="header-anchor">#</a> 2.1、查看所有数据库</h4> <p>show databases;</p> <h4 id="_2-2、创建与删除数据库"><a href="#_2-2、创建与删除数据库" class="header-anchor">#</a> 2.2、创建与删除数据库</h4> <p>创建数据库</p> <div class="language- extra-class"><pre class="language-text"><code>CREATE DATABASE IF NOT EXISTS mydb1;
drop database  if exists  mydb;
</code></pre></div><p>创建数据库表并指定数据库表数据存放hdfs的位置（与hive建表语法类似）</p> <div class="language- extra-class"><pre class="language-text"><code>hdfs dfs -mkdir -p /input/impala

create  external table  t3(id int ,name string ,age int )  row  format  delimited fields terminated  by  '\t' location  '/input/impala/external';
</code></pre></div><h3 id="_3、-创建数据库表"><a href="#_3、-创建数据库表" class="header-anchor">#</a> 3、 创建数据库表</h3> <div class="language- extra-class"><pre class="language-text"><code>创建student表

CREATE TABLE IF NOT EXISTS mydb1.student (name STRING, age INT, contact INT );

创建employ表

create table employee (Id INT, name STRING, age INT,address STRING, salary BIGINT);
</code></pre></div><h4 id="_3-1、-数据库表中插入数据"><a href="#_3-1、-数据库表中插入数据" class="header-anchor">#</a> 3.1、 数据库表中插入数据</h4> <div class="language- extra-class"><pre class="language-text"><code>insert into employee (ID,NAME,AGE,ADDRESS,SALARY)VALUES (1, 'Ramesh', 32, 'Ahmedabad', 20000 );
insert into employee values (2, 'Khilan', 25, 'Delhi', 15000 );
Insert into employee values (3, 'kaushik', 23, 'Kota', 30000 );
Insert into employee values (4, 'Chaitali', 25, 'Mumbai', 35000 );
Insert into employee values (5, 'Hardik', 27, 'Bhopal', 40000 );
Insert into employee values (6, 'Komal', 22, 'MP', 32000 );
</code></pre></div><p>数据的覆盖</p> <div class="language- extra-class"><pre class="language-text"><code>Insert overwrite employee values (1, 'Ram', 26, 'Vishakhapatnam', 37000 );
执行覆盖之后，表中只剩下了这一条数据了

另外一种建表语句

create table customer as select * from employee;

</code></pre></div><h4 id="_3-2、-数据的查询"><a href="#_3-2、-数据的查询" class="header-anchor">#</a> 3.2、 数据的查询</h4> <div class="language- extra-class"><pre class="language-text"><code>select * from employee;

select name,age from employee;
</code></pre></div><h4 id="_3-3、-删除表"><a href="#_3-3、-删除表" class="header-anchor">#</a> 3.3、 删除表</h4> <div class="language- extra-class"><pre class="language-text"><code>DROP table  mydb1.employee;
</code></pre></div><h4 id="_3-4、-清空表数据"><a href="#_3-4、-清空表数据" class="header-anchor">#</a> 3.4、 清空表数据</h4> <div class="language- extra-class"><pre class="language-text"><code>truncate  employee;
</code></pre></div><h4 id="_3-5、-查看视图数据"><a href="#_3-5、-查看视图数据" class="header-anchor">#</a> 3.5、 查看视图数据</h4> <div class="language- extra-class"><pre class="language-text"><code>select * from employee_view;
</code></pre></div><h3 id="_4、-order-by语句"><a href="#_4、-order-by语句" class="header-anchor">#</a> 4、 order  by语句</h3> <p>基础语法</p> <div class="language- extra-class"><pre class="language-text"><code>select * from table_name ORDER BY col_name [ASC|DESC] [NULLS FIRST|NULLS LAST]
Select * from employee ORDER BY id asc;
</code></pre></div><h3 id="_5、group-by-语句"><a href="#_5、group-by-语句" class="header-anchor">#</a> 5、group  by  语句</h3> <div class="language- extra-class"><pre class="language-text"><code>Select name, sum(salary) from employee Group BY name;
</code></pre></div><h3 id="_6、-having-语句"><a href="#_6、-having-语句" class="header-anchor">#</a> 6、 having 语句</h3> <p>基础语法</p> <div class="language- extra-class"><pre class="language-text"><code>select * from table_name ORDER BY col_name [ASC|DESC] [NULLS FIRST|NULLS LAST]

按年龄对表进行分组，并选择每个组的最大工资，并显示大于20000的工资

select max(salary) from employee group by age having max(salary) &gt; 20000;

</code></pre></div><h3 id="_7、-limit语句"><a href="#_7、-limit语句" class="header-anchor">#</a> 7、 limit语句</h3> <div class="language- extra-class"><pre class="language-text"><code>select * from employee order by id limit 4;
</code></pre></div><h2 id="_8、impala当中的数据表导入几种方式"><a href="#_8、impala当中的数据表导入几种方式" class="header-anchor">#</a> 8、impala当中的数据表导入几种方式</h2> <p>第一种方式，通过load  hdfs的数据到impala当中去</p> <div class="language- extra-class"><pre class="language-text"><code>create table user(id int ,name string,age int ) row format delimited fields terminated by &quot;\t&quot;;

准备数据user.txt并上传到hdfs的 /user/impala路径下去

1	hello	15
2	zhangsan	20
3	lisi	30
4	wangwu	50
</code></pre></div><p>加载数据</p> <div class="language- extra-class"><pre class="language-text"><code>load data inpath '/user/impala/' into table user;
</code></pre></div><p>查询加载的数据</p> <div class="language- extra-class"><pre class="language-text"><code>select  *  from  user;

如果查询不不到数据，那么需要刷新一遍数据表

refresh  user;
</code></pre></div><p>第二种方式：</p> <div class="language- extra-class"><pre class="language-text"><code>create  table  user2   as   select * from  user;
</code></pre></div><p>第三种方式：</p> <p>insert  into  不推荐使用 因为会产生大量的小文件</p> <p>千万不要把impala当做一个数据库来使用</p> <p>第四种：</p> <div class="language- extra-class"><pre class="language-text"><code>insert  into  select  用的比较多
</code></pre></div><h2 id="_9、impala的java开发"><a href="#_9、impala的java开发" class="header-anchor">#</a> 9、impala的java开发</h2> <p>在实际工作当中，因为impala的查询比较快，所以可能有会使用到impala来做数据库查询的情况，我们可以通过java代码来进行操作impala的查询</p> <h3 id="第一步-导入jar包"><a href="#第一步-导入jar包" class="header-anchor">#</a> 第一步：导入jar包</h3> <div class="language- extra-class"><pre class="language-text"><code>  &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;cloudera&lt;/id&gt;
            &lt;url&gt;https://repository.cloudera.com/artifactory/cloudera-repos/&lt;/url&gt;
        &lt;/repository&gt;
        &lt;repository&gt;
            &lt;id&gt;central&lt;/id&gt;
            &lt;url&gt;http://repo1.maven.org/maven2/&lt;/url&gt;
            &lt;releases&gt;
                &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;/releases&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;
            &lt;artifactId&gt;hadoop-common&lt;/artifactId&gt;
            &lt;version&gt;2.6.0-cdh5.14.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.hive&lt;/groupId&gt;
            &lt;artifactId&gt;hive-common&lt;/artifactId&gt;
            &lt;version&gt;1.1.0-cdh5.14.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.hive&lt;/groupId&gt;
            &lt;artifactId&gt;hive-metastore&lt;/artifactId&gt;
            &lt;version&gt;1.1.0-cdh5.14.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.hive&lt;/groupId&gt;
            &lt;artifactId&gt;hive-service&lt;/artifactId&gt;
            &lt;version&gt;1.1.0-cdh5.14.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.hive&lt;/groupId&gt;
            &lt;artifactId&gt;hive-jdbc&lt;/artifactId&gt;
            &lt;version&gt;1.1.0-cdh5.14.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.hive&lt;/groupId&gt;
            &lt;artifactId&gt;hive-exec&lt;/artifactId&gt;
            &lt;version&gt;1.1.0-cdh5.14.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.apache.thrift/libfb303 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.thrift&lt;/groupId&gt;
            &lt;artifactId&gt;libfb303&lt;/artifactId&gt;
            &lt;version&gt;0.9.0&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
        &lt;/dependency&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.apache.thrift/libthrift --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.thrift&lt;/groupId&gt;
            &lt;artifactId&gt;libthrift&lt;/artifactId&gt;
            &lt;version&gt;0.9.0&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;
            &lt;artifactId&gt;httpclient&lt;/artifactId&gt;
            &lt;version&gt;4.2.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;
            &lt;artifactId&gt;httpcore&lt;/artifactId&gt;
            &lt;version&gt;4.2.5&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

</code></pre></div><h3 id="第二步-impala的java代码查询开发"><a href="#第二步-impala的java代码查询开发" class="header-anchor">#</a> 第二步：impala的java代码查询开发</h3> <div class="language- extra-class"><pre class="language-text"><code>public class ImpalaJdbc {
     public static void main(String[] args) throws Exception {
     //定义连接驱动类，以及连接url和执行的sql**语句     
	 String driver = &quot;org.apache.hive.jdbc.HiveDriver&quot;;
     String driverUrl = &quot;jdbc:hive2://192.168.52.120:21050/mydb1;auth=noSasl&quot;;
     String sql = &quot;select * from student&quot;;
 
     //通过反射加载数据库连接驱动*    
	 Class.forName(driver);
     Connection connection = DriverManager.getConnection(driverUrl);
     PreparedStatement preparedStatement = connection.prepareStatement(sql);
     ResultSet resultSet = preparedStatement.executeQuery();
     //通过查询，得到数据一共有多少列     
	 int col = resultSet.getMetaData().getColumnCount();
     //遍历结果集     
	 while (resultSet.next()){
         for(int i=1;i&lt;=col;i++){
             System.out.print(resultSet.getString(i)+&quot;\t&quot;);
         }
         System.out.print(&quot;\n&quot;);
     }
     preparedStatement.close();
     connection.close();
 }
 }
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MaLunan/press/edit/dev-mln/docs/impala/impala.md" target="_blank" rel="noopener noreferrer">在GitHub 上编辑此页！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">1/19/2021, 1:41:59 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fdd7a502.js" defer></script><script src="/assets/js/16.375b747e.js" defer></script><script src="/assets/js/35.ad3402e6.js" defer></script>
  </body>
</html>
