<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>sqoop概述 | 个人博客 | JiiiiG</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="自是年少，韶华倾负">
    
    <link rel="preload" href="/assets/css/0.styles.420b7c1f.css" as="style"><link rel="preload" href="/assets/js/app.fdd7a502.js" as="script"><link rel="preload" href="/assets/js/16.375b747e.js" as="script"><link rel="preload" href="/assets/js/36.45f11923.js" as="script"><link rel="prefetch" href="/assets/js/10.bbd38b9e.js"><link rel="prefetch" href="/assets/js/11.f49fc7d3.js"><link rel="prefetch" href="/assets/js/12.c5d97aa1.js"><link rel="prefetch" href="/assets/js/13.426d0224.js"><link rel="prefetch" href="/assets/js/14.1f257a58.js"><link rel="prefetch" href="/assets/js/15.be29bb6a.js"><link rel="prefetch" href="/assets/js/17.d02cdd8b.js"><link rel="prefetch" href="/assets/js/18.5d2371a4.js"><link rel="prefetch" href="/assets/js/19.038919a3.js"><link rel="prefetch" href="/assets/js/2.d6257727.js"><link rel="prefetch" href="/assets/js/20.b3582e09.js"><link rel="prefetch" href="/assets/js/21.0c1e826b.js"><link rel="prefetch" href="/assets/js/22.91bff1a5.js"><link rel="prefetch" href="/assets/js/23.faacea60.js"><link rel="prefetch" href="/assets/js/24.69816497.js"><link rel="prefetch" href="/assets/js/25.c9fcaa62.js"><link rel="prefetch" href="/assets/js/26.d28c3abe.js"><link rel="prefetch" href="/assets/js/27.1518da7d.js"><link rel="prefetch" href="/assets/js/28.748a5581.js"><link rel="prefetch" href="/assets/js/29.775019f1.js"><link rel="prefetch" href="/assets/js/3.141002a4.js"><link rel="prefetch" href="/assets/js/30.74e7c570.js"><link rel="prefetch" href="/assets/js/31.190b11f2.js"><link rel="prefetch" href="/assets/js/32.d8f4f116.js"><link rel="prefetch" href="/assets/js/33.c489bc81.js"><link rel="prefetch" href="/assets/js/34.db609d51.js"><link rel="prefetch" href="/assets/js/35.ad3402e6.js"><link rel="prefetch" href="/assets/js/37.b47e0576.js"><link rel="prefetch" href="/assets/js/38.58b934a2.js"><link rel="prefetch" href="/assets/js/39.e4d6bcdf.js"><link rel="prefetch" href="/assets/js/4.e9b44388.js"><link rel="prefetch" href="/assets/js/40.555106bc.js"><link rel="prefetch" href="/assets/js/41.4387ceb1.js"><link rel="prefetch" href="/assets/js/42.9bd4aea0.js"><link rel="prefetch" href="/assets/js/43.587e7966.js"><link rel="prefetch" href="/assets/js/44.80285763.js"><link rel="prefetch" href="/assets/js/45.f978da77.js"><link rel="prefetch" href="/assets/js/46.d93e3f2e.js"><link rel="prefetch" href="/assets/js/47.c15bd2aa.js"><link rel="prefetch" href="/assets/js/48.cb55fa72.js"><link rel="prefetch" href="/assets/js/49.d0f4e454.js"><link rel="prefetch" href="/assets/js/5.b90b80cb.js"><link rel="prefetch" href="/assets/js/50.112e8260.js"><link rel="prefetch" href="/assets/js/51.a66bcd03.js"><link rel="prefetch" href="/assets/js/52.0c7cbfb1.js"><link rel="prefetch" href="/assets/js/53.67ef240b.js"><link rel="prefetch" href="/assets/js/54.2c2d082d.js"><link rel="prefetch" href="/assets/js/55.88f19a20.js"><link rel="prefetch" href="/assets/js/56.c726e920.js"><link rel="prefetch" href="/assets/js/57.eaee47c5.js"><link rel="prefetch" href="/assets/js/58.ac15a3ac.js"><link rel="prefetch" href="/assets/js/59.64bdc849.js"><link rel="prefetch" href="/assets/js/6.7eea74ff.js"><link rel="prefetch" href="/assets/js/7.a1370e98.js"><link rel="prefetch" href="/assets/js/8.2e898240.js"><link rel="prefetch" href="/assets/js/9.a2439994.js">
    <link rel="stylesheet" href="/assets/css/0.styles.420b7c1f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人博客 | JiiiiG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/linux/linux常用命令/01linux常用命令01.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hadoop/01hadoop环境搭建/01搭建hadoop集群.html" class="nav-link">
  hadoop
</a></li><li class="dropdown-item"><!----> <a href="/hbase/hbase.html" class="nav-link">
  hbase
</a></li><li class="dropdown-item"><!----> <a href="/flink/flink.html" class="nav-link">
  flink
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sqoop/.html" class="nav-link">
  java
</a></li></ul></div></div> <a href="https://github.com/MaLunan/press" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/linux/linux常用命令/01linux常用命令01.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hadoop/01hadoop环境搭建/01搭建hadoop集群.html" class="nav-link">
  hadoop
</a></li><li class="dropdown-item"><!----> <a href="/hbase/hbase.html" class="nav-link">
  hbase
</a></li><li class="dropdown-item"><!----> <a href="/flink/flink.html" class="nav-link">
  flink
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sqoop/.html" class="nav-link">
  java
</a></li></ul></div></div> <a href="https://github.com/MaLunan/press" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="sqoop概述"><a href="#sqoop概述" class="header-anchor">#</a> sqoop概述</h2> <p>Sqoop是apache旗下的一款 ”Hadoop和关系数据库之间传输数据“ 的工具</p> <p>导入数据：将MySQL，Oracle导入数据到Hadoop的HDFS、HIVE、HBASE等数据存储系统</p> <p>导出数据：从Hadoop的文件系统HDFS中导出数据到关系数据库</p> <p><img src="/assets/img/image-20200320140617360.b855a53f.png" alt="image-20200320140617360"></p> <h2 id="sqoop的工作机制"><a href="#sqoop的工作机制" class="header-anchor">#</a> sqoop的工作机制</h2> <p>将导入和导出的命令翻译成mapreduce程序实现</p> <p>在翻译出的mapreduce中主要是对inputformat和outputformat进行定制</p> <h2 id="sqoop1与sqoop2架构对比"><a href="#sqoop1与sqoop2架构对比" class="header-anchor">#</a> sqoop1与sqoop2架构对比</h2> <p>sqoop在发展中的过程中演进出来了两种不同的架构.<a href="https://blogs.apache.org/sqoop/entry/apache_sqoop_highlights_of_sqoop#comment-1561314193000" target="_blank" rel="noopener noreferrer">架构演变史<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="sqoop1架构-常用"><a href="#sqoop1架构-常用" class="header-anchor">#</a> sqoop1架构(常用)</h4> <p><img src="/assets/img/image-20200320140635558.fb95cd09.png" alt="image-20200320140635558"></p> <p>版本号为1.4.x为sqoop1</p> <p>在架构上：sqoop1使用sqoop客户端直接提交的方式</p> <p>访问方式：CLI控制台方式进行访问</p> <p>安全性：命令或脚本中指定用户数据库名及密码</p> <h4 id="sqoop2架构"><a href="#sqoop2架构" class="header-anchor">#</a> sqoop2架构</h4> <p><img src="/assets/img/image-20200320140644558.bba8bf9e.png" alt="image-20200320140644558"></p> <p>版本号为1.99x为sqoop2</p> <p>在架构上：sqoop2引入了sqoop server，对connector实现了集中的管理</p> <p>访问方式：REST API、 JAVA API、 WEB UI以及CLI控制台方式进行访问</p> <h4 id="sqoop1与sqoop2比较"><a href="#sqoop1与sqoop2比较" class="header-anchor">#</a> sqoop1与sqoop2比较</h4> <table><thead><tr><th>比较</th> <th>Sqoop1</th> <th>Sqoop2</th></tr></thead> <tbody><tr><td>架构</td> <td>仅仅使用一个sqoop客户端</td> <td>引入了sqoop server集中化管理connector,以及rest api，web,UI，并引入安全机制</td></tr> <tr><td>部署</td> <td>部署简单，安装需要root权限，connector必须符合JDBC模型</td> <td>架构稍复杂，配置部署繁琐</td></tr> <tr><td>使用</td> <td>命令行方式容易出错，格式紧耦合，无法支持所有数据类型，安全机制不够完善，例如密码暴露</td> <td>多种交互方式，命令行，WebUI，rest API,connector集中化管理，所有的链接安装在sqoop server上，完善权限管理机制，connector规范化，仅仅负责数据的读写。</td></tr></tbody></table> <h2 id="sqoop安装部署"><a href="#sqoop安装部署" class="header-anchor">#</a> sqoop安装部署</h2> <p>Sqoop安装很简单，解压好进行简单的修改就可以使用.</p> <p>Sqoop是单台机器安装即可。我们以node03为例，进行安装。</p> <h3 id="第一步-下载安装包"><a href="#第一步-下载安装包" class="header-anchor">#</a> 第一步：下载安装包</h3> <p>http://archive.cloudera.com/cdh5/cdh/5/sqoop-1.4.6-cdh5.14.2.tar.gz</p> <h3 id="第二步-上传并解压"><a href="#第二步-上传并解压" class="header-anchor">#</a> 第二步：上传并解压</h3> <p>将我们下载好的安装包上传到node03服务器的/kkb/soft路径下，然后进行解压</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /kkb/soft/
<span class="token punctuation">[</span>hadoop@node03 soft<span class="token punctuation">]</span>$ <span class="token function">tar</span> -zxvf sqoop-1.4.6-cdh5.14.2.tar.gz -C /kkb/install/
</code></pre></div><h3 id="第三步-修改配置文件"><a href="#第三步-修改配置文件" class="header-anchor">#</a> 第三步：修改配置文件</h3> <p>更改sqoop的配置文件</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /kkb/install/sqoop-1.4.6-cdh5.14.2/conf
<span class="token function">mv</span> sqoop-env-template.sh sqoop-env.sh
<span class="token function">vim</span> sqoop-env.sh
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#Set path to where bin/hadoop is available</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_COMMON_HOME</span><span class="token operator">=</span>/kkb/install/hadoop-2.6.0-cdh5.14.2

<span class="token comment">#Set path to where hadoop-*-core.jar is available</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_MAPRED_HOME</span><span class="token operator">=</span>/kkb/install/hadoop-2.6.0-cdh5.14.2

<span class="token comment">#set the path to where bin/hbase is available</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HBASE_HOME</span><span class="token operator">=</span>/kkb/install/hbase-1.2.0-cdh5.14.2

<span class="token comment">#Set the path to where bin/hive is available</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HIVE_HOME</span><span class="token operator">=</span>/kkb/install/hive-1.1.0-cdh5.14.2
</code></pre></div><h3 id="第四步-添加两个必要的jar包"><a href="#第四步-添加两个必要的jar包" class="header-anchor">#</a> 第四步：添加两个必要的jar包</h3> <p>sqoop需要两个额外依赖的jar包，将课件资料当中两个jar包添加到sqoop的lib目录下</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">mv</span> /kkb/soft/mysql-connector-java-5.1.38.jar /kkb/install/sqoop-1.4.6-cdh5.14.2/lib/
<span class="token function">mv</span> /kkb/soft/java-json.jar /kkb/install/sqoop-1.4.6-cdh5.14.2/lib/
</code></pre></div><h3 id="第五步-配置sqoop的环境变量"><a href="#第五步-配置sqoop的环境变量" class="header-anchor">#</a> 第五步：配置sqoop的环境变量</h3> <div class="language- extra-class"><pre class="language-text"><code>sudo vim /etc/profile
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">SQOOP_HOME</span><span class="token operator">=</span>/kkb/install/sqoop-1.4.6-cdh5.14.2
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>:<span class="token variable">$SQOOP_HOME</span>/bin:<span class="token environment constant">$PATH</span>
</code></pre></div><h2 id="sqoop命令"><a href="#sqoop命令" class="header-anchor">#</a> Sqoop命令</h2> <h4 id="查看命令帮助"><a href="#查看命令帮助" class="header-anchor">#</a> 查看命令帮助</h4> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token punctuation">[</span>hadoop<span class="token variable">@node03</span> lib<span class="token punctuation">]</span>$ sqoop help 
usage<span class="token punctuation">:</span> sqoop <span class="token constant">COMMAND</span> <span class="token punctuation">[</span><span class="token constant">ARGS</span><span class="token punctuation">]</span>

<span class="token constant">Available</span> commands<span class="token punctuation">:</span>
  codegen            <span class="token constant">Generate</span> code to interact with database records
  create<span class="token operator">-</span>hive<span class="token operator">-</span>table  <span class="token constant">Import</span> a table definition into <span class="token constant">Hive</span>
  eval               <span class="token constant">Evaluate</span> a <span class="token constant">SQL</span> statement <span class="token keyword">and</span> display the results
  export             <span class="token constant">Export</span> an <span class="token constant">HDFS</span> directory to a database table
  help               <span class="token constant">List</span> available commands
  import             <span class="token constant">Import</span> a table from a database to <span class="token constant">HDFS</span>
  import<span class="token operator">-</span>all<span class="token operator">-</span>tables  <span class="token constant">Import</span> tables from a database to <span class="token constant">HDFS</span>
  import<span class="token operator">-</span>mainframe   <span class="token constant">Import</span> datasets from a mainframe server to <span class="token constant">HDFS</span>
  job                <span class="token constant">Work</span> with saved jobs
  list<span class="token operator">-</span>databases     <span class="token constant">List</span> available databases on a server
  list<span class="token operator">-</span>tables        <span class="token constant">List</span> available tables <span class="token keyword">in</span> a database
  merge              <span class="token constant">Merge</span> results of incremental imports
  metastore          <span class="token constant">Run</span> a standalone <span class="token constant">Sqoop</span> metastore
  version            <span class="token constant">Display</span> version information
</code></pre></div><h4 id="列出所有的数据库"><a href="#列出所有的数据库" class="header-anchor">#</a> 列出所有的数据库</h4> <p>list-databases     List available databases on a server</p> <p>查看该命令的具体帮助：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>sqoop list-databases --help

Generic options supported are
-conf <span class="token operator">&lt;</span>configuration file<span class="token operator">&gt;</span>     specify an application configuration <span class="token function">file</span>

-D <span class="token operator">&lt;</span>property<span class="token operator">=</span>value<span class="token operator">&gt;</span>            use value <span class="token keyword">for</span> given property

-fs <span class="token operator">&lt;</span>local<span class="token operator">|</span>namenode:port<span class="token operator">&gt;</span>      specify a namenode

-jt <span class="token operator">&lt;</span>local<span class="token operator">|</span>resourcemanager:port<span class="token operator">&gt;</span>    specify a ResourceManager

-files <span class="token operator">&lt;</span>comma separated list of files<span class="token operator">&gt;</span>    specify comma separated files to be copied to the map reduce cluster

-libjars <span class="token operator">&lt;</span>comma separated list of jars<span class="token operator">&gt;</span>    specify comma separated jar files to include <span class="token keyword">in</span> the classpath.

-archives <span class="token operator">&lt;</span>comma separated list of archives<span class="token operator">&gt;</span>    specify comma separated archives to be unarchived on the compute machines.

</code></pre></div><p>列出node03主机所有的数据库</p> <div class="language-sh extra-class"><pre class="language-sh"><code>bin/sqoop list-databases --connect jdbc:mysql://node03:3306/ --username root --password <span class="token number">123456</span> 

information_schema
hive
mysql
mysqlsource
performance_schema
sys
</code></pre></div><h4 id="查看某一个数据库下的所有数据表"><a href="#查看某一个数据库下的所有数据表" class="header-anchor">#</a> 查看某一个数据库下的所有数据表</h4> <p>查看mysqlsource database的所有表</p> <div class="language-sh extra-class"><pre class="language-sh"><code>bin/sqoop list-tables --connect jdbc:mysql://node03:3306/mysqlsource --username root --password <span class="token number">123456</span>

flume_meta
student
</code></pre></div><h2 id="sqoop导入数据"><a href="#sqoop导入数据" class="header-anchor">#</a> sqoop导入数据</h2> <p>sqoop的底层原理本质是一个MapReduce job，sqoop是通过一个MapReduce job 从数据库中导入一个表，这个job从表中逐行抽取数据，接着一行行的数据写入HDFS。</p> <p>表中的每一行被视为HDFS的记录。所有记录都存储为文本文件的文本数据（或者Avro、sequence文件等二进制数据）</p> <h4 id="查看导入命令import帮助"><a href="#查看导入命令import帮助" class="header-anchor">#</a> 查看导入命令import帮助</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ sqoop <span class="token function">import</span> --help

Common arguments:
   --connect <span class="token operator">&lt;</span>jdbc-uri<span class="token operator">&gt;</span>                                       Specify JDBC
                                                              connect
                                                              string
   --connection-manager <span class="token operator">&lt;</span>class-name<span class="token operator">&gt;</span>                          Specify
                                                              connection
                                                              manager
                                                              class name
   --connection-param-file <span class="token operator">&lt;</span>properties-file<span class="token operator">&gt;</span>                  Specify
                                                              connection
                                                              parameters
                                                              <span class="token function">file</span>
   --driver <span class="token operator">&lt;</span>class-name<span class="token operator">&gt;</span>                                      Manually
                                                              specify JDBC
                                                              driver class
                                                              to use
   --hadoop-home <span class="token operator">&lt;</span>hdir<span class="token operator">&gt;</span>                                       Override
                                                              <span class="token variable">$HADOOP_MAPR</span>
                                                              ED_HOME_ARG
   --hadoop-mapred-home <span class="token operator">&lt;</span>dir<span class="token operator">&gt;</span>                                 Override
                                                              <span class="token variable">$HADOOP_MAPR</span>
                                                              ED_HOME_ARG
   --help                                                     Print usage
                                                              instructions
   --metadata-transaction-isolation-level <span class="token operator">&lt;</span>isolationlevel<span class="token operator">&gt;</span>    Defines the
                                                              transaction
                                                              isolation
                                                              level <span class="token keyword">for</span>
                                                              metadata
                                                              queries. For
                                                              <span class="token function">more</span> details
                                                              check
                                                              java.sql.Con
                                                              nection
                                                              javadoc or
                                                              the JDBC
                                                              specificaito
                                                              n
   --oracle-escaping-disabled <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>                       Disable the
                                                              escaping
                                                              mechanism of
                                                              the
                                                              Oracle/OraOo
                                                              p connection
                                                              managers
-P                                                            Read
                                                              password
                                                              from console
   --password <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span>                                      Set
                                                              authenticati
                                                              on password
   --password-alias <span class="token operator">&lt;</span>password-alias<span class="token operator">&gt;</span>                          Credential
                                                              provider
                                                              password
                                                              <span class="token builtin class-name">alias</span>
   --password-file <span class="token operator">&lt;</span>password-file<span class="token operator">&gt;</span>                            Set
                                                              authenticati
                                                              on password
                                                              <span class="token function">file</span> path
   --relaxed-isolation                                        Use
                                                              read-uncommi
                                                              tted
                                                              isolation
                                                              <span class="token keyword">for</span> imports
   --skip-dist-cache                                          Skip copying
                                                              jars to
                                                              distributed
                                                              cache
   --temporary-rootdir <span class="token operator">&lt;</span>rootdir<span class="token operator">&gt;</span>                              Defines the
                                                              temporary
                                                              root
                                                              directory
                                                              <span class="token keyword">for</span> the
                                                              <span class="token function">import</span>
   --throw-on-error                                           Rethrow a
                                                              RuntimeExcep
                                                              tion on
                                                              error
                                                              occurred
                                                              during the
                                                              job
   --username <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>                                      Set
                                                              authenticati
                                                              on username
   --verbose                                                  Print <span class="token function">more</span>
                                                              information
                                                              <span class="token keyword">while</span>
                                                              working

Import control arguments:
   --append                                                   Imports data
                                                              <span class="token keyword">in</span> append
                                                              mode
   --as-avrodatafile                                          Imports data
                                                              to Avro data
                                                              files
   --as-parquetfile                                           Imports data
                                                              to Parquet
                                                              files
   --as-sequencefile                                          Imports data
                                                              to
                                                              SequenceFile
                                                              s
   --as-textfile                                              Imports data
                                                              as plain
                                                              text
                                                              <span class="token punctuation">(</span>default<span class="token punctuation">)</span>
   --autoreset-to-one-mapper                                  Reset the
                                                              number of
                                                              mappers to
                                                              one mapper
                                                              <span class="token keyword">if</span> no <span class="token function">split</span>
                                                              key
                                                              available
   --boundary-query <span class="token operator">&lt;</span>statement<span class="token operator">&gt;</span>                               Set boundary
                                                              query <span class="token keyword">for</span>
                                                              retrieving
                                                              max and min
                                                              value of the
                                                              primary key
   --columns <span class="token operator">&lt;</span>col,col,col<span class="token punctuation">..</span>.<span class="token operator">&gt;</span>                                 Columns to
                                                              <span class="token function">import</span> from
                                                              table
   --compression-codec <span class="token operator">&lt;</span>codec<span class="token operator">&gt;</span>                                Compression
                                                              codec to use
                                                              <span class="token keyword">for</span> <span class="token function">import</span>
   --delete-target-dir                                        Imports data
                                                              <span class="token keyword">in</span> delete
                                                              mode
   --direct                                                   Use direct
                                                              <span class="token function">import</span> fast
                                                              path
   --direct-split-size <span class="token operator">&lt;</span>n<span class="token operator">&gt;</span>                                    Split the
                                                              input stream
                                                              every <span class="token string">'n'</span>
                                                              bytes when
                                                              importing <span class="token keyword">in</span>
                                                              direct mode
-e,--query <span class="token operator">&lt;</span>statement<span class="token operator">&gt;</span>                                        Import
                                                              results of
                                                              SQL
                                                              <span class="token string">'statement'</span>
   --fetch-size <span class="token operator">&lt;</span>n<span class="token operator">&gt;</span>                                           Set number
                                                              <span class="token string">'n'</span> of rows
                                                              to fetch
                                                              from the
                                                              database
                                                              when <span class="token function">more</span>
                                                              rows are
                                                              needed
   --inline-lob-limit <span class="token operator">&lt;</span>n<span class="token operator">&gt;</span>                                     Set the
                                                              maximum size
                                                              <span class="token keyword">for</span> an
                                                              inline LOB
-m,--num-mappers <span class="token operator">&lt;</span>n<span class="token operator">&gt;</span>                                          Use <span class="token string">'n'</span> map
                                                              tasks to
                                                              <span class="token function">import</span> <span class="token keyword">in</span>
                                                              parallel
   --mapreduce-job-name <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>                                Set name <span class="token keyword">for</span>
                                                              generated
                                                              mapreduce
                                                              job
   --merge-key <span class="token operator">&lt;</span>column<span class="token operator">&gt;</span>                                       Key <span class="token function">column</span>
                                                              to use to
                                                              <span class="token function">join</span> results
   --split-by <span class="token operator">&lt;</span>column-name<span class="token operator">&gt;</span>                                   Column of
                                                              the table
                                                              used to
                                                              <span class="token function">split</span> work
                                                              <span class="token function">units</span>
   --split-limit <span class="token operator">&lt;</span>size<span class="token operator">&gt;</span>                                       Upper Limit
                                                              of rows per
                                                              <span class="token function">split</span> <span class="token keyword">for</span>
                                                              <span class="token function">split</span>
                                                              columns of
                                                              Date/Time/Ti
                                                              mestamp and
                                                              integer
                                                              types. For
                                                              <span class="token function">date</span> or
                                                              timestamp
                                                              fields it is
                                                              calculated
                                                              <span class="token keyword">in</span> seconds.
                                                              split-limit
                                                              should be
                                                              greater than
                                                              <span class="token number">0</span>
   --table <span class="token operator">&lt;</span>table-name<span class="token operator">&gt;</span>                                       Table to
                                                              <span class="token builtin class-name">read</span>
   --target-dir <span class="token operator">&lt;</span>dir<span class="token operator">&gt;</span>                                         HDFS plain
                                                              table
                                                              destination
   --validate                                                 Validate the
                                                              copy using
                                                              the
                                                              configured
                                                              validator
   --validation-failurehandler <span class="token operator">&lt;</span>validation-failurehandler<span class="token operator">&gt;</span>    Fully
                                                              qualified
                                                              class name
                                                              <span class="token keyword">for</span>
                                                              ValidationFa
                                                              ilureHandler
   --validation-threshold <span class="token operator">&lt;</span>validation-threshold<span class="token operator">&gt;</span>              Fully
                                                              qualified
                                                              class name
                                                              <span class="token keyword">for</span>
                                                              ValidationTh
                                                              reshold
   --validator <span class="token operator">&lt;</span>validator<span class="token operator">&gt;</span>                                    Fully
                                                              qualified
                                                              class name
                                                              <span class="token keyword">for</span> the
                                                              Validator
   --warehouse-dir <span class="token operator">&lt;</span>dir<span class="token operator">&gt;</span>                                      HDFS parent
                                                              <span class="token keyword">for</span> table
                                                              destination
   --where <span class="token operator">&lt;</span>where clause<span class="token operator">&gt;</span>                                     WHERE clause
                                                              to use
                                                              during
                                                              <span class="token function">import</span>
-z,--compress                                                 Enable
                                                              compression

Incremental <span class="token function">import</span> arguments:
   --check-column <span class="token operator">&lt;</span>column<span class="token operator">&gt;</span>        Source <span class="token function">column</span> to check <span class="token keyword">for</span> incremental
                                  change
   --incremental <span class="token operator">&lt;</span>import-type<span class="token operator">&gt;</span>    Define an incremental <span class="token function">import</span> of <span class="token builtin class-name">type</span>
                                  <span class="token string">'append'</span> or <span class="token string">'lastmodified'</span>
   --last-value <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>           Last imported value <span class="token keyword">in</span> the incremental
                                  check <span class="token function">column</span>

Output line formatting arguments:
   --enclosed-by <span class="token operator">&lt;</span>char<span class="token operator">&gt;</span>               Sets a required field enclosing
                                      character
   --escaped-by <span class="token operator">&lt;</span>char<span class="token operator">&gt;</span>                Sets the escape character
   --fields-terminated-by <span class="token operator">&lt;</span>char<span class="token operator">&gt;</span>      Sets the field separator character
   --lines-terminated-by <span class="token operator">&lt;</span>char<span class="token operator">&gt;</span>       Sets the end-of-line character
   --mysql-delimiters                 Uses MySQL<span class="token string">'s default delimiter set:
                                      fields: ,  lines: <span class="token entity" title="\n">\n</span>  escaped-by: \
                                      optionally-enclosed-by: '</span>
   --optionally-enclosed-by <span class="token operator">&lt;</span>char<span class="token operator">&gt;</span>    Sets a field enclosing character

Input parsing arguments:
   --input-enclosed-by <span class="token operator">&lt;</span>char<span class="token operator">&gt;</span>               Sets a required field encloser
   --input-escaped-by <span class="token operator">&lt;</span>char<span class="token operator">&gt;</span>                Sets the input escape
                                            character
   --input-fields-terminated-by <span class="token operator">&lt;</span>char<span class="token operator">&gt;</span>      Sets the input field separator
   --input-lines-terminated-by <span class="token operator">&lt;</span>char<span class="token operator">&gt;</span>       Sets the input end-of-line
                                            char
   --input-optionally-enclosed-by <span class="token operator">&lt;</span>char<span class="token operator">&gt;</span>    Sets a field enclosing
                                            character

Hive arguments:
   --create-hive-table                         Fail <span class="token keyword">if</span> the target hive
                                               table exists
   --hive-database <span class="token operator">&lt;</span>database-name<span class="token operator">&gt;</span>             Sets the database name to
                                               use when importing to hive
   --hive-delims-replacement <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span>             Replace Hive record <span class="token punctuation">\</span>0x01
                                               and row delimiters <span class="token punctuation">(</span><span class="token punctuation">\</span>n<span class="token punctuation">\</span>r<span class="token punctuation">)</span>
                                               from imported string fields
                                               with user-defined string
   --hive-drop-import-delims                   Drop Hive record <span class="token punctuation">\</span>0x01 and
                                               row delimiters <span class="token punctuation">(</span><span class="token punctuation">\</span>n<span class="token punctuation">\</span>r<span class="token punctuation">)</span> from
                                               imported string fields
   --hive-home <span class="token operator">&lt;</span>dir<span class="token operator">&gt;</span>                           Override <span class="token variable">$HIVE_HOME</span>
   --hive-import                               Import tables into Hive
                                               <span class="token punctuation">(</span>Uses Hive's default
                                               delimiters <span class="token keyword">if</span> none are
                                               set.<span class="token punctuation">)</span>
   --hive-overwrite                            Overwrite existing data <span class="token keyword">in</span>
                                               the Hive table
   --hive-partition-key <span class="token operator">&lt;</span>partition-key<span class="token operator">&gt;</span>        Sets the partition key to
                                               use when importing to hive
   --hive-partition-value <span class="token operator">&lt;</span>partition-value<span class="token operator">&gt;</span>    Sets the partition value to
                                               use when importing to hive
   --hive-table <span class="token operator">&lt;</span>table-name<span class="token operator">&gt;</span>                   Sets the table name to use
                                               when importing to hive
   --map-column-hive <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span>                     Override mapping <span class="token keyword">for</span>
                                               specific <span class="token function">column</span> to hive
                                               types.

HBase arguments:
   --column-family <span class="token operator">&lt;</span>family<span class="token operator">&gt;</span>    Sets the target <span class="token function">column</span> family <span class="token keyword">for</span> the
                               <span class="token function">import</span>
   --hbase-bulkload            Enables HBase bulk loading
   --hbase-create-table        If specified, create missing HBase tables
   --hbase-row-key <span class="token operator">&lt;</span>col<span class="token operator">&gt;</span>       Specifies <span class="token function">which</span> input <span class="token function">column</span> to use as the
                               row key
   --hbase-table <span class="token operator">&lt;</span>table<span class="token operator">&gt;</span>       Import to <span class="token operator">&lt;</span>table<span class="token operator">&gt;</span> <span class="token keyword">in</span> HBase

HCatalog arguments:
   --hcatalog-database <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span>                        HCatalog database name
   --hcatalog-home <span class="token operator">&lt;</span>hdir<span class="token operator">&gt;</span>                           Override <span class="token variable">$HCAT_HOME</span>
   --hcatalog-partition-keys <span class="token operator">&lt;</span>partition-key<span class="token operator">&gt;</span>        Sets the partition
                                                    keys to use when
                                                    importing to hive
   --hcatalog-partition-values <span class="token operator">&lt;</span>partition-value<span class="token operator">&gt;</span>    Sets the partition
                                                    values to use when
                                                    importing to hive
   --hcatalog-table <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span>                           HCatalog table name
   --hive-home <span class="token operator">&lt;</span>dir<span class="token operator">&gt;</span>                                Override <span class="token variable">$HIVE_HOME</span>
   --hive-partition-key <span class="token operator">&lt;</span>partition-key<span class="token operator">&gt;</span>             Sets the partition key
                                                    to use when importing
                                                    to hive
   --hive-partition-value <span class="token operator">&lt;</span>partition-value<span class="token operator">&gt;</span>         Sets the partition
                                                    value to use when
                                                    importing to hive
   --map-column-hive <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span>                          Override mapping <span class="token keyword">for</span>
                                                    specific <span class="token function">column</span> to
                                                    hive types.

HCatalog <span class="token function">import</span> specific options:
   --create-hcatalog-table             Create HCatalog before <span class="token function">import</span>
   --drop-and-create-hcatalog-table    Drop and Create HCatalog before
                                       <span class="token function">import</span>
   --hcatalog-storage-stanza <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span>     HCatalog storage stanza <span class="token keyword">for</span> table
                                       creation

Accumulo arguments:
   --accumulo-batch-size <span class="token operator">&lt;</span>size<span class="token operator">&gt;</span>          Batch size <span class="token keyword">in</span> bytes
   --accumulo-column-family <span class="token operator">&lt;</span>family<span class="token operator">&gt;</span>     Sets the target <span class="token function">column</span> family <span class="token keyword">for</span>
                                         the <span class="token function">import</span>
   --accumulo-create-table               If specified, create missing
                                         Accumulo tables
   --accumulo-instance <span class="token operator">&lt;</span>instance<span class="token operator">&gt;</span>        Accumulo instance name.
   --accumulo-max-latency <span class="token operator">&lt;</span>latency<span class="token operator">&gt;</span>      Max <span class="token function">write</span> latency <span class="token keyword">in</span> milliseconds
   --accumulo-password <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span>        Accumulo password.
   --accumulo-row-key <span class="token operator">&lt;</span>col<span class="token operator">&gt;</span>              Specifies <span class="token function">which</span> input <span class="token function">column</span> to
                                         use as the row key
   --accumulo-table <span class="token operator">&lt;</span>table<span class="token operator">&gt;</span>              Import to <span class="token operator">&lt;</span>table<span class="token operator">&gt;</span> <span class="token keyword">in</span> Accumulo
   --accumulo-user <span class="token operator">&lt;</span>user<span class="token operator">&gt;</span>                Accumulo user name.
   --accumulo-visibility <span class="token operator">&lt;</span>vis<span class="token operator">&gt;</span>           Visibility token to be applied to
                                         all rows imported
   --accumulo-zookeepers <span class="token operator">&lt;</span>zookeepers<span class="token operator">&gt;</span>    Comma-separated list of
                                         zookeepers <span class="token punctuation">(</span>host:port<span class="token punctuation">)</span>

Code generation arguments:
   --bindir <span class="token operator">&lt;</span>dir<span class="token operator">&gt;</span>                             Output directory <span class="token keyword">for</span>
                                              compiled objects
   --class-name <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>                        Sets the generated class
                                              name. This overrides
                                              --package-name. When
                                              combined with --jar-file,
                                              sets the input class.
   --escape-mapping-column-names <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>    Disable special characters
                                              escaping <span class="token keyword">in</span> <span class="token function">column</span> names
   --input-null-non-string <span class="token operator">&lt;</span>null-str<span class="token operator">&gt;</span>         Input null non-string
                                              representation
   --input-null-string <span class="token operator">&lt;</span>null-str<span class="token operator">&gt;</span>             Input null string
                                              representation
   --jar-file <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span>                          Disable code generation<span class="token punctuation">;</span> use
                                              specified jar
   --map-column-java <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span>                    Override mapping <span class="token keyword">for</span>
                                              specific columns to java
                                              types
   --null-non-string <span class="token operator">&lt;</span>null-str<span class="token operator">&gt;</span>               Null non-string
                                              representation
   --null-string <span class="token operator">&lt;</span>null-str<span class="token operator">&gt;</span>                   Null string representation
   --outdir <span class="token operator">&lt;</span>dir<span class="token operator">&gt;</span>                             Output directory <span class="token keyword">for</span>
                                              generated code
   --package-name <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>                      Put auto-generated classes
                                              <span class="token keyword">in</span> this package
</code></pre></div><h4 id="第一步-准备表数据"><a href="#第一步-准备表数据" class="header-anchor">#</a> 第一步：准备表数据</h4> <p>在node03的mysql中创建一个userdb database, 其中包含表：emp, emp_add和emp_conn。</p> <p>表emp:</p> <table><thead><tr><th><strong>id</strong></th> <th><strong>name</strong></th> <th><strong>deg</strong></th> <th><strong>salary</strong></th> <th><strong>dept</strong></th></tr></thead> <tbody><tr><td>1201</td> <td>gopal</td> <td>manager</td> <td>50,000</td> <td>TP</td></tr> <tr><td>1202</td> <td>manisha</td> <td>Proof reader</td> <td>50,000</td> <td>TP</td></tr> <tr><td>1203</td> <td>khalil</td> <td>php dev</td> <td>30,000</td> <td>AC</td></tr> <tr><td>1204</td> <td>prasanth</td> <td>php dev</td> <td>30,000</td> <td>AC</td></tr> <tr><td>1205</td> <td>kranthi</td> <td>admin</td> <td>20,000</td> <td>TP</td></tr></tbody></table> <p>表emp_add:</p> <table><thead><tr><th><strong>id</strong></th> <th><strong>hno</strong></th> <th><strong>street</strong></th> <th><strong>city</strong></th></tr></thead> <tbody><tr><td>1201</td> <td>288A</td> <td>vgiri</td> <td>jublee</td></tr> <tr><td>1202</td> <td>108I</td> <td>aoc</td> <td>sec-bad</td></tr> <tr><td>1203</td> <td>144Z</td> <td>pgutta</td> <td>hyd</td></tr> <tr><td>1204</td> <td>78B</td> <td>old city</td> <td>sec-bad</td></tr> <tr><td>1205</td> <td>720X</td> <td>hitec</td> <td>sec-bad</td></tr></tbody></table> <p>表emp_conn:</p> <table><thead><tr><th><strong>id</strong></th> <th><strong>phno</strong></th> <th><strong>email</strong></th></tr></thead> <tbody><tr><td>1201</td> <td>2356742</td> <td>gopal@tp.com</td></tr> <tr><td>1202</td> <td>1661663</td> <td>manisha@tp.com</td></tr> <tr><td>1203</td> <td>8887776</td> <td>khalil@ac.com</td></tr> <tr><td>1204</td> <td>9988774</td> <td>prasanth@ac.com</td></tr> <tr><td>1205</td> <td>1231231</td> <td>kranthi@tp.com</td></tr></tbody></table> <p>建表语句如下：直接复制粘贴到node03的mysql命令行即可。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token comment">/*!32312 IF NOT EXISTS*/</span><span class="token punctuation">`</span>userdb<span class="token punctuation">`</span> <span class="token comment">/*!40100 DEFAULT CHARACTER SET utf8 */</span><span class="token punctuation">;</span>

<span class="token keyword">USE</span> <span class="token punctuation">`</span>userdb<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>emp<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>emp<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>deg<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>salary<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>dept<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">TIMESTAMP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>update_time<span class="token punctuation">`</span> <span class="token keyword">TIMESTAMP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>is_delete<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'1'</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>latin1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span>  <span class="token keyword">INTO</span> <span class="token punctuation">`</span>emp<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>deg<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>salary<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>dept<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1201</span><span class="token punctuation">,</span><span class="token string">'gopal'</span><span class="token punctuation">,</span><span class="token string">'manager'</span><span class="token punctuation">,</span><span class="token number">50000</span><span class="token punctuation">,</span><span class="token string">'TP'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1202</span><span class="token punctuation">,</span><span class="token string">'manisha'</span><span class="token punctuation">,</span><span class="token string">'Proof reader'</span><span class="token punctuation">,</span><span class="token number">50000</span><span class="token punctuation">,</span><span class="token string">'TP'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1203</span><span class="token punctuation">,</span><span class="token string">'khalil'</span><span class="token punctuation">,</span><span class="token string">'php dev'</span><span class="token punctuation">,</span><span class="token number">30000</span><span class="token punctuation">,</span><span class="token string">'AC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1204</span><span class="token punctuation">,</span><span class="token string">'prasanth'</span><span class="token punctuation">,</span><span class="token string">'php dev'</span><span class="token punctuation">,</span><span class="token number">30000</span><span class="token punctuation">,</span><span class="token string">'AC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1205</span><span class="token punctuation">,</span><span class="token string">'kranthi'</span><span class="token punctuation">,</span><span class="token string">'admin'</span><span class="token punctuation">,</span><span class="token number">20000</span><span class="token punctuation">,</span><span class="token string">'TP'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>emp_add<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>emp_add<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>hno<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>street<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>city<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">TIMESTAMP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>update_time<span class="token punctuation">`</span> <span class="token keyword">TIMESTAMP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>is_delete<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'1'</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>latin1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span>  <span class="token keyword">INTO</span> <span class="token punctuation">`</span>emp_add<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>hno<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>street<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>city<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1201</span><span class="token punctuation">,</span><span class="token string">'288A'</span><span class="token punctuation">,</span><span class="token string">'vgiri'</span><span class="token punctuation">,</span><span class="token string">'jublee'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1202</span><span class="token punctuation">,</span><span class="token string">'108I'</span><span class="token punctuation">,</span><span class="token string">'aoc'</span><span class="token punctuation">,</span><span class="token string">'sec-bad'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1203</span><span class="token punctuation">,</span><span class="token string">'144Z'</span><span class="token punctuation">,</span><span class="token string">'pgutta'</span><span class="token punctuation">,</span><span class="token string">'hyd'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1204</span><span class="token punctuation">,</span><span class="token string">'78B'</span><span class="token punctuation">,</span><span class="token string">'old city'</span><span class="token punctuation">,</span><span class="token string">'sec-bad'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1205</span><span class="token punctuation">,</span><span class="token string">'720X'</span><span class="token punctuation">,</span><span class="token string">'hitec'</span><span class="token punctuation">,</span><span class="token string">'sec-bad'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>emp_conn<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>emp_conn<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>phno<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>email<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">TIMESTAMP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>update_time<span class="token punctuation">`</span> <span class="token keyword">TIMESTAMP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>is_delete<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'1'</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>latin1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span>  <span class="token keyword">INTO</span> <span class="token punctuation">`</span>emp_conn<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>phno<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>email<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1201</span><span class="token punctuation">,</span><span class="token string">'2356742'</span><span class="token punctuation">,</span><span class="token string">'gopal@tp.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1202</span><span class="token punctuation">,</span><span class="token string">'1661663'</span><span class="token punctuation">,</span><span class="token string">'manisha@tp.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1203</span><span class="token punctuation">,</span><span class="token string">'8887776'</span><span class="token punctuation">,</span><span class="token string">'khalil@ac.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1204</span><span class="token punctuation">,</span><span class="token string">'9988774'</span><span class="token punctuation">,</span><span class="token string">'prasanth@ac.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1205</span><span class="token punctuation">,</span><span class="token string">'1231231'</span><span class="token punctuation">,</span><span class="token string">'kranthi@tp.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="第二步-导入数据库表数据到hdfs"><a href="#第二步-导入数据库表数据到hdfs" class="header-anchor">#</a> 第二步：导入数据库表数据到HDFS</h4> <p>将MySQL中的emp表导入到HDFS</p> <div class="language-sh extra-class"><pre class="language-sh"><code>bin/sqoop <span class="token function">import</span> --connect jdbc:mysql://node03:3306/userdb --password <span class="token number">123456</span> --username root --table emp --m <span class="token number">1</span>

<span class="token comment">## --m 1  表示使用1个maptask</span>
</code></pre></div><p>如果成功执行，那么会得到下面的输出。</p> <p><img src="/assets/img/image-20200314043443688.7ba0f996.png" alt="image-20200314043443688"></p> <p>使用以下命令查看导入的数据,数据默认存放在了hdfs的/user/hadoop路径下，表的字段间的分隔符默认使用逗号&quot;,&quot;。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 conf<span class="token punctuation">]</span>$ hdfs dfs -cat /user/hadoop/emp/part-m-00000
<span class="token number">1201</span>,gopal,manager,50000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1202</span>,manisha,Proof reader,50000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1203</span>,khalil,php dev,30000,AC,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1204</span>,prasanth,php dev,30000,AC,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1205</span>,kranthi,admin,20000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
</code></pre></div><h4 id="第三步-导入数据库表数据到hdfs指定目录"><a href="#第三步-导入数据库表数据到hdfs指定目录" class="header-anchor">#</a> 第三步：导入数据库表数据到HDFS指定目录</h4> <ol><li><p>使用参数 --target-dir来指定导出目录</p></li> <li><p>使用参数—delete-target-dir来判断导出目录是否存在，如果存在就删掉</p></li></ol> <p>导入数据：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>sqoop <span class="token function">import</span> --connect jdbc:mysql://node03:3306/userdb --username root --password <span class="token number">123456</span> --delete-target-dir --table emp --target-dir /sqoop/emp --m <span class="token number">1</span>
</code></pre></div><p>查看导入的数据：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 conf<span class="token punctuation">]</span>$ hdfs dfs -text /sqoop/emp/part-m-00000 <span class="token comment">#使用cat也行</span>
<span class="token number">1201</span>,gopal,manager,50000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1202</span>,manisha,Proof reader,50000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1203</span>,khalil,php dev,30000,AC,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1204</span>,prasanth,php dev,30000,AC,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1205</span>,kranthi,admin,20000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
</code></pre></div><h4 id="第四步-导入数据库表数据到hdfs指定目录并指定分隔符"><a href="#第四步-导入数据库表数据到hdfs指定目录并指定分隔符" class="header-anchor">#</a> 第四步：导入数据库表数据到HDFS指定目录并指定分隔符</h4> <div class="language-sh extra-class"><pre class="language-sh"><code>sqoop <span class="token function">import</span> --connect jdbc:mysql://node03:3306/userdb --username root --password <span class="token number">123456</span> --delete-target-dir --table emp --target-dir /sqoop/emp2 --m <span class="token number">1</span> --fields-terminated-by <span class="token string">'<span class="token entity" title="\t">\t</span>'</span>
</code></pre></div><p>查看文件内容,是以&quot;\t&quot;作为分隔符的。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 conf<span class="token punctuation">]</span>$ hdfs dfs -text /sqoop/emp2/part-m-00000
<span class="token number">1201</span> gopal   manager <span class="token number">50000</span>        TP <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03.0   <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03.0   <span class="token number">1</span>
<span class="token number">1202</span>  manisha Proof reader <span class="token number">50000</span>  TP <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03.0   <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03.0   <span class="token number">1</span>
<span class="token number">1203</span>  khalil  php dev <span class="token number">30000</span>       AC <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03.0   <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03.0   <span class="token number">1</span>
<span class="token number">1204</span>  prasanth  php dev <span class="token number">30000</span>     AC <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03.0   <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03.0   <span class="token number">1</span>
<span class="token number">1205</span>  kranthi admin   <span class="token number">20000</span>       TP <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03.0   <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03.0   <span class="token number">1</span>
</code></pre></div><h4 id="第五步-导入数据库表数据到hive表-hive表已存在"><a href="#第五步-导入数据库表数据到hive表-hive表已存在" class="header-anchor">#</a> 第五步：导入数据库表数据到Hive表（hive表已存在）</h4> <p>将我们mysql表当中的数据直接导入到hive表中的话，我们需要将hive的一个叫做hive-exec-1.1.0-cdh5.14.0.jar的jar包拷贝到sqoop的lib目录下</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token function">cp</span> /kkb/install/hive-1.1.0-cdh5.14.2/lib/hive-exec-1.1.0-cdh5.14.2.jar /kkb/install/sqoop-1.4.6-cdh5.14.2/lib/
</code></pre></div><p>在hive中创建表：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">database</span> sqooptohive<span class="token punctuation">;</span>

hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">use</span> sqooptohive<span class="token punctuation">;</span>

hive <span class="token punctuation">(</span>sqooptohive<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> external <span class="token keyword">table</span> emp_hive<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>name string<span class="token punctuation">,</span>deg string<span class="token punctuation">,</span>salary <span class="token keyword">int</span> <span class="token punctuation">,</span>dept string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\001'</span><span class="token punctuation">;</span>
</code></pre></div><p>将我们mysql当中的数据导入到hive表当中来：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>sqoop <span class="token function">import</span> --connect jdbc:mysql://node03:3306/userdb --username root --password <span class="token number">123456</span> --table emp --fields-terminated-by <span class="token string">'<span class="token entity" title="\001">\001</span>'</span> --hive-import --hive-table sqooptohive.emp_hive --hive-overwrite --delete-target-dir --m <span class="token number">1</span>
</code></pre></div><ul><li>--hive-overwrite表示，导入的数据会覆盖hive表中原先存在的数据</li></ul> <p>导入成功后，查看hive表数据：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>hive <span class="token punctuation">(</span>sqooptohive<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp_hive<span class="token punctuation">;</span>
OK
emp_hive<span class="token punctuation">.</span>id     emp_hive<span class="token punctuation">.</span>name   emp_hive<span class="token punctuation">.</span>deg    emp_hive<span class="token punctuation">.</span>salary emp_hive<span class="token punctuation">.</span>dept
<span class="token number">1201</span>    gopal   manager <span class="token number">50000</span>   TP
<span class="token number">1202</span>    manisha Proof reader    <span class="token number">50000</span>   TP
<span class="token number">1203</span>    khalil  php dev <span class="token number">30000</span>   AC
<span class="token number">1204</span>    prasanth        php dev <span class="token number">30000</span>   AC
<span class="token number">1205</span>    kranthi admin   <span class="token number">20000</span>   TP
</code></pre></div><h4 id="第六步-导入数据库表数据到hive表-hive表未存在"><a href="#第六步-导入数据库表数据到hive表-hive表未存在" class="header-anchor">#</a> 第六步：导入数据库表数据到Hive表（hive表未存在）</h4> <p>将我们的mysql的表直接导入到hive表当中去</p> <div class="language-sh extra-class"><pre class="language-sh"><code>sqoop <span class="token function">import</span> --connect jdbc:mysql://node03:3306/userdb --username root --password <span class="token number">123456</span> --table emp_conn --hive-import -m <span class="token number">1</span> --hive-database sqooptohive<span class="token punctuation">;</span>
</code></pre></div><p>通过上面这个命令，我们可以直接将我们mysql表当中的数据以及表结构一起倒入到hive当中去,--hive-database sqooptohive表示导入到哪个database。</p> <p>查看效果：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>hive <span class="token punctuation">(</span>sqooptohive<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
OK
tab_name
emp_conn <span class="token comment">#</span>
emp_hivesh
</code></pre></div><h4 id="第七步-导入数据库表数据到hbase"><a href="#第七步-导入数据库表数据到hbase" class="header-anchor">#</a> 第七步：导入数据库表数据到hbase</h4> <p>启动zookeeper和hbase</p> <div class="language-sh extra-class"><pre class="language-sh"><code>zkServer.sh start <span class="token comment">#三台机器都要执行这一行代码</span>
start-hbase.sh <span class="token comment">#node01执行这一行代码</span>
</code></pre></div><p>在mysql当中创建数据库以及数据库表并插入数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> library<span class="token punctuation">;</span>
<span class="token keyword">USE</span> library<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> book<span class="token punctuation">(</span>
    id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span> 
    NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    price <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> price<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Lie Sporting'</span><span class="token punctuation">,</span> <span class="token string">'30'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book <span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> price<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Pride &amp; Prejudice'</span><span class="token punctuation">,</span> <span class="token string">'70'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book <span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> price<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Fall of Giants'</span><span class="token punctuation">,</span> <span class="token string">'50'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> book<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> NAME              <span class="token operator">|</span> price <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> Lie Sporting      <span class="token operator">|</span> <span class="token number">30</span>    <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> Pride <span class="token operator">&amp;</span> Prejudice <span class="token operator">|</span> <span class="token number">70</span>    <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> Fall <span class="token keyword">of</span> Giants    <span class="token operator">|</span> <span class="token number">50</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------------+-------+</span>
</code></pre></div><p>将mysql表当中的数据导入HBase表当中去（只能指定一个列族）:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>sqoop <span class="token function">import</span> <span class="token punctuation">\</span>
--connect jdbc:mysql://node03:3306/library <span class="token punctuation">\</span>
--username root <span class="token punctuation">\</span>
--password <span class="token number">123456</span> <span class="token punctuation">\</span>
--table book <span class="token punctuation">\</span>
--columns <span class="token string">&quot;id,name,price&quot;</span> <span class="token punctuation">\</span>
--column-family <span class="token string">&quot;info&quot;</span> <span class="token punctuation">\</span>
--hbase-create-table <span class="token punctuation">\</span>
--hbase-row-key <span class="token string">&quot;id&quot;</span> <span class="token punctuation">\</span>
--hbase-table <span class="token string">&quot;hbase_book&quot;</span> <span class="token punctuation">\</span>
--num-mappers <span class="token number">1</span> <span class="token punctuation">\</span>
--split-by <span class="token function">id</span>
</code></pre></div><p>在HBase当中查看表数据</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 install<span class="token punctuation">]</span>$ hbase shell
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:002:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'hbase_book'</span>
ROW           COLUMN+CELL                           
 <span class="token number">1</span>            <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1584163926211</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>Lie Sporting     
 <span class="token number">1</span>            <span class="token assign-left variable">column</span><span class="token operator">=</span>info:price, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1584163926211</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">30</span>              
 <span class="token number">2</span>            <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1584163926211</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>Pride <span class="token operator">&amp;</span> Prejudice
 <span class="token number">2</span>            <span class="token assign-left variable">column</span><span class="token operator">=</span>info:price, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1584163926211</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">70</span>              
 <span class="token number">3</span>            <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1584163926211</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>Fall of Giants   
 <span class="token number">3</span>            <span class="token assign-left variable">column</span><span class="token operator">=</span>info:price, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1584163926211</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">50</span>              
</code></pre></div><h4 id="业务系统中表的分类"><a href="#业务系统中表的分类" class="header-anchor">#</a> 业务系统中表的分类</h4> <p>我们上面的七步都是进行了全表导入，但是有时候我们是不需要进行全表导入的，先来了解一下实际应用中，业务系统中表的分类：</p> <p>第一大类：业务表</p> <ul><li>需要做增删改查的操作，如user表</li></ul> <p>第二大类：记录表</p> <ul><li>比如日志记录表  这个表只会一直增加，不会修改，删除</li></ul> <p>第三类：码表 字典表</p> <ul><li>省市区县  一般数据量不大，而且不会变动</li></ul> <p>从上面三类表的描述可知：</p> <ol><li>对于业务表，新添加的数据以及修改的数据都要导入过来，导入变化的数据，没变化的数据，导入之后再不要导入了</li> <li>对于记录表，新插入的数据需要导入过来，导入新增加的数据即可，导入过的数据再不要导入了</li> <li>对于码表，一般导入一次即可，有变更再及时导入即可</li></ol> <p>因此，可以看到全表导入的情况并不多，下面，我们就来讲讲如何进行非全表导入。</p> <h4 id="第八步-导入数据库表的子集-where"><a href="#第八步-导入数据库表的子集-where" class="header-anchor">#</a> 第八步：导入数据库表的子集--where</h4> <p>sqoop可导入sql where语句的查询结果到hadoop的数据存储系统中。</p> <p>例子：</p> <p>查找表emp_add当中city字段的值为sec-bad的所有数据,并将这些数据导入到hdfs上面去</p> <div class="language-sh extra-class"><pre class="language-sh"><code>sqoop <span class="token function">import</span> --connect jdbc:mysql://node03:3306/userdb --username root --password <span class="token number">123456</span> --table emp_add --target-dir /sqoop/emp_add -m <span class="token number">1</span> --delete-target-dir --where <span class="token string">&quot;city = 'sec-bad'&quot;</span>

<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hdfs dfs -ls /sqoop/emp_add/ 
Found <span class="token number">2</span> items
-rw-r--r--   <span class="token number">3</span> hadoop supergroup     <span class="token number">0</span> <span class="token number">2020</span>-03-14 <span class="token number">23</span>:28 /sqoop/emp_add/_SUCCESS
-rw-r--r--   <span class="token number">3</span> hadoop supergroup     <span class="token number">210</span> <span class="token number">2020</span>-03-14 <span class="token number">23</span>:28 /sqoop/emp_add/part-m-00000

<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hdfs dfs -cat /sqoop/emp_add/part-m-00000
<span class="token number">1202</span>,108I,aoc,sec-bad,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1204</span>,78B,old city,sec-bad,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1205</span>,720X,hitec,sec-bad,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token comment">#从上面结果可以看到，只存储了&quot;city = 'sec-bad'&quot;的数据</span>
</code></pre></div><h4 id="第九步-导入数据库表的子集-query"><a href="#第九步-导入数据库表的子集-query" class="header-anchor">#</a> 第九步：导入数据库表的子集--query</h4> <p>我们还可以通过 –query参数来指定我们的sql语句，通过sql语句来过滤我们的数据进行导入。</p> <p>注意事项：</p> <ol><li>使用sql语句来进行查找是不能加参数--table</li> <li>并且必须要添加--where条件，</li> <li>并且--where条件后面必须带一个$CONDITIONS 这个字符串，</li> <li>并且这个sql语句必须用单引号，不能用双引号</li></ol> <p>例子：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from emp_conn<span class="token punctuation">;</span>
+------+---------+-----------------+---------------------+---------------------+--
<span class="token operator">|</span> <span class="token function">id</span>   <span class="token operator">|</span> phno    <span class="token operator">|</span> email        <span class="token operator">|</span> create_time         <span class="token operator">|</span> update_time  <span class="token operator">|</span> is_delete <span class="token operator">|</span>
+------+---------+-----------------+---------------------+---------------------+--
<span class="token operator">|</span> <span class="token number">1201</span> <span class="token operator">|</span> <span class="token number">2356742</span> <span class="token operator">|</span>gopal@tp.com  <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1202</span> <span class="token operator">|</span> <span class="token number">1661663</span> <span class="token operator">|</span>manisha@tp.com<span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1203</span> <span class="token operator">|</span> <span class="token number">8887776</span> <span class="token operator">|</span>khalil@ac.com  <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1204</span> <span class="token operator">|</span> <span class="token number">9988774</span> <span class="token operator">|</span>prasanth@ac.com<span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1205</span> <span class="token operator">|</span> <span class="token number">1231231</span> <span class="token operator">|</span>kranthi@tp.com <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span>
+------+---------+-----------------+---------------------+---------------------+--


sqoop <span class="token function">import</span> --connect jdbc:mysql://node03:3306/userdb --username root --password <span class="token number">123456</span> --delete-target-dir -m <span class="token number">1</span> --query <span class="token string">'select phno from emp_conn where 1=1 and <span class="token variable">$CONDITIONS</span>'</span> --target-dir /sqoop/emp_conn 

<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hdfs dfs -ls /sqoop/emp_query/
Found <span class="token number">2</span> items
-rw-r--r--   <span class="token number">3</span> hadoop supergroup     <span class="token number">0</span> <span class="token number">2020</span>-03-14 <span class="token number">23</span>:37 /sqoop/emp_query/_SUCCESS
-rw-r--r--   <span class="token number">3</span> hadoop supergroup     <span class="token number">40</span> <span class="token number">2020</span>-03-14 <span class="token number">23</span>:37 /sqoop/emp_query/part-m-00000

<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hdfs dfs -cat /sqoop/emp_query/part-m-00000
<span class="token number">2356742</span>
<span class="token number">1661663</span>
<span class="token number">8887776</span>
<span class="token number">9988774</span>
<span class="token number">1231231</span>
</code></pre></div><h4 id="第十步-增量导入数据库表数据到hdfs"><a href="#第十步-增量导入数据库表数据到hdfs" class="header-anchor">#</a> 第十步：增量导入数据库表数据到HDFS</h4> <p>在实际工作当中，数据的导入，很多时候都是只需要导入增量数据即可，并不需要将表中的数据全部导入到hive或者hdfs当中去，肯定会出现重复的数据的状况，所以我们一般都是选用一些字段进行增量的导入，为了支持增量的导入，sqoop也给我们考虑到了这种情况并且支持增量的导入数据</p> <p>增量导入是仅导入新添加的表中的行的技术。</p> <p>下面的语法用于Sqoop导入命令增量选项。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>--incremental <span class="token operator">&lt;</span>mode<span class="token operator">&gt;</span>  --check-column <span class="token operator">&lt;</span>column name<span class="token operator">&gt;</span>  --last value <span class="token operator">&lt;</span>last check <span class="token function">column</span> value<span class="token operator">&gt;</span> 
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>Incremental <span class="token function">import</span> arguments:
   --check-column <span class="token operator">&lt;</span>column<span class="token operator">&gt;</span>        Source <span class="token function">column</span> to check <span class="token keyword">for</span> incremental
                                  change 
                                  <span class="token comment">#通过哪一列来检查新增的改变（检查的列）</span>
   --incremental <span class="token operator">&lt;</span>import-type<span class="token operator">&gt;</span>    Define an incremental <span class="token function">import</span> of <span class="token builtin class-name">type</span>
                                  <span class="token string">'append'</span> or <span class="token string">'lastmodified'</span>
                                  <span class="token comment">#指定导入类型，append为追加</span>
   --last-value <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>           Last imported value <span class="token keyword">in</span> the incremental
                                  check <span class="token function">column</span>
                                  <span class="token comment">#最后一个导入的检查的列的值</span>
</code></pre></div><h6 id="例子1-这种做法很鸡肋"><a href="#例子1-这种做法很鸡肋" class="header-anchor">#</a> 例子1（这种做法很鸡肋）：</h6> <p>假如我以id这一列作为判断是否有新增数据的列(--check-column)，上一次导入数据导到了id列值为1203那里，而且表中仅仅会有新增数据的操作，没有更新update数据的操作。</p> <p>那么，我们可以进行如下导入新增数据的操作：</p> <p>注意：增量导入的时候，一定不能加参数--delete-target-dir否则会报错</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+----------+--------------+--------+------+---------------------+--------------</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> name     <span class="token operator">|</span> deg          <span class="token operator">|</span> salary <span class="token operator">|</span> dept <span class="token operator">|</span> create_time         <span class="token operator">|</span> update_time         <span class="token operator">|</span> is_delete <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+----------+--------------+--------+------+---------------------+--------------</span>
<span class="token operator">|</span> <span class="token number">1201</span> <span class="token operator">|</span> gopal    <span class="token operator">|</span> manager      <span class="token operator">|</span>  <span class="token number">50000</span> <span class="token operator">|</span> TP   <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">12</span>:<span class="token number">21</span>:<span class="token number">03</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">12</span>:<span class="token number">21</span>:<span class="token number">03</span> <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1202</span> <span class="token operator">|</span> manisha  <span class="token operator">|</span> Proof reader <span class="token operator">|</span>  <span class="token number">50000</span> <span class="token operator">|</span> TP   <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">12</span>:<span class="token number">21</span>:<span class="token number">03</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">12</span>:<span class="token number">21</span>:<span class="token number">03</span> <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1203</span> <span class="token operator">|</span> khalil   <span class="token operator">|</span> php dev      <span class="token operator">|</span>  <span class="token number">30000</span> <span class="token operator">|</span> AC   <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">12</span>:<span class="token number">21</span>:<span class="token number">03</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">12</span>:<span class="token number">21</span>:<span class="token number">03</span> <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1204</span> <span class="token operator">|</span> prasanth <span class="token operator">|</span> php dev      <span class="token operator">|</span>  <span class="token number">30000</span> <span class="token operator">|</span> AC   <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">12</span>:<span class="token number">21</span>:<span class="token number">03</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">12</span>:<span class="token number">21</span>:<span class="token number">03</span> <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1205</span> <span class="token operator">|</span> kranthi  <span class="token operator">|</span> admin        <span class="token operator">|</span>  <span class="token number">20000</span> <span class="token operator">|</span> TP   <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">12</span>:<span class="token number">21</span>:<span class="token number">03</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">12</span>:<span class="token number">21</span>:<span class="token number">03</span> <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+----------+--------------+--------+------+---------------------+-------------</span>
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>sqoop <span class="token function">import</span> --connect jdbc:mysql://node03:3306/userdb --username root --password <span class="token number">123456</span> --table emp --incremental append --check-column <span class="token function">id</span> --last-value <span class="token number">1203</span> --m <span class="token number">1</span> --target-dir /sqoop/increment

<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hdfs dfs -cat /sqoop/increment/part-m-00000    
<span class="token number">1204</span>,prasanth,php dev,30000,AC,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1205</span>,kranthi,admin,20000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
</code></pre></div><p>这种方法虽然实现了增量导入，但是很鸡肋，因为我们怎么上一次导入的id列的最后一个值是什么？而且这种增量导入还是在没有update操作的基础上实现的，实际中很可能是有update数据操作的，有update的话，又要怎么实现增量导入，这时候就用到了sql的TIMESTAMP属性了。</p> <h6 id="例子2"><a href="#例子2" class="header-anchor">#</a> 例子2：</h6> <p>我们在创建emp表的时候，添加了下列两个字段，</p> <p>create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,</p> <p>update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE</p> <p>分别用来记录insert时间以及update时间，我们可以利用--where来设定查询的时间范围，从而实现更强大的增量导入，同时导入insert新增的数据和更新update过的数据。</p> <p>下面的代码块可以实现导入新增以及更新过的数据：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>sqoop <span class="token function">import</span> --connect jdbc:mysql://node03:3306/userdb --username root --password <span class="token number">123456</span> --table emp --incremental append --where <span class="token string">&quot;update_time &gt; '2020-03-14 12:21:02' and is_delete='1' and update_time &lt; '2020-03-14 12:21:05'&quot;</span> --target-dir /sqoop/incement2 --check-column <span class="token function">id</span> --m <span class="token number">1</span>

<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hdfs dfs -cat /sqoop/incement2/part-m-00000
<span class="token number">1201</span>,gopal,manager,50000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1202</span>,manisha,Proof reader,50000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1203</span>,khalil,php dev,30000,AC,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1204</span>,prasanth,php dev,30000,AC,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1205</span>,kranthi,admin,20000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
</code></pre></div><p>下面的代码块可以实现导入新增数据(不包括更新过的数据）：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>sqoop <span class="token keyword">import</span> <span class="token comment">--connect jdbc:mysql://node03:3306/userdb --username root --password 123456 --table emp --incremental append --where &quot;create_time &gt; '2020-03-14 12:21:02' and is_delete='1' and create_time &lt; '2020-03-14 12:21:05'&quot; --target-dir /sqoop/incement2 --check-column id --m 1</span>
</code></pre></div><h4 id="作业-增量导入数据到hive表中该如何实现-todo"><a href="#作业-增量导入数据到hive表中该如何实现-todo" class="header-anchor">#</a> 作业：增量导入数据到hive表中该如何实现？(TODO)</h4> <h4 id="面试题-如何解决减量数据"><a href="#面试题-如何解决减量数据" class="header-anchor">#</a> 面试题：如何解决减量数据？？？</h4> <p>假设我们已经将数据库表的数据导入到hdfs了，那么如果数据库表又删除某些数据，如何解决？我们要删掉导入到hdfs的对应部分数据吗？</p> <p>当然不是。在业务库表中，一般都是做假删除的，比如说添加一个is_delete字段来判断某个记录（行）是不是已被删除的，并不是真的删除。那么若数据库表的数据被删了，那么对应的is_delete字段的对应值就会发生变化，比如说从1变成了0，那么update_time就会发生变化。既然update_time就会发生了变化，我们就可以把减量数据当成更新的数据来处理就行了，只不过是做了删除标记的更新数据罢了。</p> <h4 id="思考问题"><a href="#思考问题" class="header-anchor">#</a> 思考问题</h4> <p>问题：一行数据被update前，导入到hdfs过一次，后来这行数据被update了，然后该行数据又被导入hdfs了，那么我们就导入了两条同一行的数据（虽然部分值可能不一样）。我们要怎么更新我们的hdfs中的这行数据，怎么找到这两条数据？</p> <p>解决：使用数据仓库的拉链表来解决。</p> <h2 id="sqoop导出数据"><a href="#sqoop导出数据" class="header-anchor">#</a> Sqoop导出数据</h2> <h4 id="从hdfs文件导出数据到mysql"><a href="#从hdfs文件导出数据到mysql" class="header-anchor">#</a> 从HDFS文件导出数据到mysql</h4> <p>导出前，目标表必须存在于目标数据库中。要导出到数据库的数据内容及路径如下</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hdfs dfs -ls /sqoop/emp
Found <span class="token number">2</span> items
-rw-r--r--   <span class="token number">3</span> hadoop supergroup          <span class="token number">0</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:49 /sqoop/emp/_SUCCESS
-rw-r--r--   <span class="token number">3</span> hadoop supergroup        <span class="token number">381</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:49 /sqoop/emp/part-m-00000

<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hdfs dfs -cat /sqoop/emp/part-m-00000
<span class="token number">1201</span>,gopal,manager,50000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1202</span>,manisha,Proof reader,50000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1203</span>,khalil,php dev,30000,AC,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1204</span>,prasanth,php dev,30000,AC,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1205</span>,kranthi,admin,20000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
</code></pre></div><p>node03创建mysql表。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>emp_out<span class="token punctuation">`</span> <span class="token punctuation">(</span>
    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>deg<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>salary<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>dept<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">TIMESTAMP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>update_time<span class="token punctuation">`</span> <span class="token keyword">TIMESTAMP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>is_delete<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'1'</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre></div><p>通过kkb来实现数据的导出，将hdfs的数据导出到mysql当中去</p> <div class="language-sh extra-class"><pre class="language-sh"><code>sqoop <span class="token builtin class-name">export</span> --connect jdbc:mysql://node03:3306/userdb --username root --password <span class="token number">123456</span> --table emp_out --export-dir /sqoop/emp --input-fields-terminated-by <span class="token string">&quot;,&quot;</span>
</code></pre></div><p>查看emp_out表是否确实存在数据：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from emp_out<span class="token punctuation">;</span>
+------+----------+--------------+--------+------+---------------------+----------
<span class="token operator">|</span> <span class="token function">id</span>   <span class="token operator">|</span> name     <span class="token operator">|</span> deg          <span class="token operator">|</span> salary <span class="token operator">|</span> dept <span class="token operator">|</span> create_time         <span class="token operator">|</span> update_ti
+------+----------+--------------+--------+------+---------------------+----------
<span class="token operator">|</span> <span class="token number">1205</span> <span class="token operator">|</span> kranthi  <span class="token operator">|</span> admin        <span class="token operator">|</span>  <span class="token number">20000</span> <span class="token operator">|</span> TP   <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span> <span class="token number">2020</span>-03-1
<span class="token operator">|</span> <span class="token number">1201</span> <span class="token operator">|</span> gopal    <span class="token operator">|</span> manager      <span class="token operator">|</span>  <span class="token number">50000</span> <span class="token operator">|</span> TP   <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span> <span class="token number">2020</span>-03-1
<span class="token operator">|</span> <span class="token number">1202</span> <span class="token operator">|</span> manisha  <span class="token operator">|</span> Proof reader <span class="token operator">|</span>  <span class="token number">50000</span> <span class="token operator">|</span> TP   <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span> <span class="token number">2020</span>-03-1
<span class="token operator">|</span> <span class="token number">1203</span> <span class="token operator">|</span> khalil   <span class="token operator">|</span> php dev      <span class="token operator">|</span>  <span class="token number">30000</span> <span class="token operator">|</span> AC   <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span> <span class="token number">2020</span>-03-1
<span class="token operator">|</span> <span class="token number">1204</span> <span class="token operator">|</span> prasanth <span class="token operator">|</span> php dev      <span class="token operator">|</span>  <span class="token number">30000</span> <span class="token operator">|</span> AC   <span class="token operator">|</span> <span class="token number">2020</span>-03-14 <span class="token number">12</span>:21:03 <span class="token operator">|</span> <span class="token number">2020</span>-03-1
+------+----------+--------------+--------+------+---------------------+----------

<span class="token comment">#数据还有一部分没有复制粘贴过来</span>
</code></pre></div><h4 id="从hbase表导出数据到mysql"><a href="#从hbase表导出数据到mysql" class="header-anchor">#</a> 从Hbase表导出数据到mysql</h4> <p>注意：sqoop不支持我们直接将HBase当中的数据导出，所以我们可以通过以下的转换进行导出。</p> <p>Hbase→hive外部表→hive内部表→通过sqoop→mysql</p> <p>需求：将hbase_book这张表当中的数据导出到mysql当中来</p> <p>**第一步：**创建hive外部表，映射hbase当中的hbase_book表</p> <div class="language-sql extra-class"><pre class="language-sql"><code>nohup hive <span class="token comment">--service hiveserver2 2&gt;&amp;1 &amp;</span>
beeline
<span class="token operator">!</span><span class="token keyword">connect</span> jdbc:hive2:<span class="token comment">//node03:10000</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; create database course;</span>

<span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> course<span class="token punctuation">.</span>hbase2mysql <span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>name string<span class="token punctuation">,</span>price <span class="token keyword">int</span><span class="token punctuation">)</span>
STORED <span class="token keyword">BY</span> <span class="token string">'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span>
<span class="token keyword">WITH</span> SERDEPROPERTIES <span class="token punctuation">(</span><span class="token string">&quot;hbase.columns.mapping&quot;</span> <span class="token operator">=</span><span class="token string">&quot;:key,info:name, info:price&quot;</span><span class="token punctuation">)</span>
TBLPROPERTIES<span class="token punctuation">(</span> <span class="token string">&quot;hbase.table.name&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;hbase_book&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;hbase.mapred.output.outputtable&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;hbase2mysql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from hbase2mysql;</span>
<span class="token operator">+</span><span class="token comment">-----------------+--------------------+--------------------+--+</span>
<span class="token operator">|</span> hbase2mysql<span class="token punctuation">.</span>id  <span class="token operator">|</span>  hbase2mysql<span class="token punctuation">.</span>name  <span class="token operator">|</span> hbase2mysql<span class="token punctuation">.</span>price  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+--------------------+--------------------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>               <span class="token operator">|</span> Lie Sporting       <span class="token operator">|</span> <span class="token number">30</span>                 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>               <span class="token operator">|</span> Pride <span class="token operator">&amp;</span> Prejudice  <span class="token operator">|</span> <span class="token number">70</span>                 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>               <span class="token operator">|</span> Fall <span class="token keyword">of</span> Giants     <span class="token operator">|</span> <span class="token number">50</span>                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+--------------------+--------------------+--+</span>
</code></pre></div><p>**第二步：**创建hive内部表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; CREATE TABLE course.hbase2mysqlin(id int,name string,price int);</span>
</code></pre></div><p>**第三步：**将外部表数据插入到内部表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; insert overwrite table course.hbase2mysqlin select * from course.hbase2mysql;</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from hbase2mysqlin;</span>
<span class="token operator">+</span><span class="token comment">-------------------+---------------------+----------------------+--+</span>
<span class="token operator">|</span> hbase2mysqlin<span class="token punctuation">.</span>id  <span class="token operator">|</span> hbase2mysqlin<span class="token punctuation">.</span>name  <span class="token operator">|</span> hbase2mysqlin<span class="token punctuation">.</span>price  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+---------------------+----------------------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>                 <span class="token operator">|</span> Lie Sporting        <span class="token operator">|</span> <span class="token number">30</span>                   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>                 <span class="token operator">|</span> Pride <span class="token operator">&amp;</span> Prejudice   <span class="token operator">|</span> <span class="token number">70</span>                   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>                 <span class="token operator">|</span> Fall <span class="token keyword">of</span> Giants      <span class="token operator">|</span> <span class="token number">50</span>                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+---------------------+----------------------+--+</span>
</code></pre></div><p>**第四步：**清空mysql表数据,将book表数据清空</p> <p>清空book是为了做前后对比，等下要将hive内部表的数据导出到mysql的book表中，清空可以验证是否导出成功。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> library<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> book<span class="token punctuation">;</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> book<span class="token punctuation">;</span> 
Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>**第五步：**获得内部表的数据存放在hdfs的路径</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; desc formatted  hbase2mysqlin;</span>

Location: hdfs:<span class="token comment">//node01:8020/user/hive/warehouse/course.db/hbase2mysqlin</span>
</code></pre></div><p>**第六步：**执行sqoop导出hive内部表数据到mysql</p> <div class="language-sh extra-class"><pre class="language-sh"><code>sqoop <span class="token builtin class-name">export</span> -connect jdbc:mysql://node03:3306/library -username root -password <span class="token number">123456</span> -table book -export-dir /user/hive/warehouse/course.db/hbase2mysqlin --input-fields-terminated-by <span class="token string">'<span class="token entity" title="\001">\001</span>'</span> --input-null-string <span class="token string">'<span class="token entity" title="\\">\\</span>N'</span> --input-null-non-string <span class="token string">'<span class="token entity" title="\\">\\</span>N'</span><span class="token punctuation">;</span>
</code></pre></div><p>--input-null-string '\\N' 表示如果导入的数据是空值，而且是字符串类型的空值，则使用\N来表示。</p> <p>--input-null-non-string '\\N' 表示如果导入的数据是空值，且不是字符串类型，则使用\N来表示。</p> <p>**第七步：**查看效果：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> book<span class="token punctuation">;</span> 
<span class="token operator">+</span><span class="token comment">----+-------------------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> NAME              <span class="token operator">|</span> price <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> Lie Sporting      <span class="token operator">|</span> <span class="token number">30</span>    <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> Pride <span class="token operator">&amp;</span> Prejudice <span class="token operator">|</span> <span class="token number">70</span>    <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> Fall <span class="token keyword">of</span> Giants    <span class="token operator">|</span> <span class="token number">50</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------------+-------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><h2 id="sqoop-job作业-了解即可"><a href="#sqoop-job作业-了解即可" class="header-anchor">#</a> Sqoop job作业（了解即可）</h2> <p>Sqoop作业：将事先定义好的数据导入导出任务按照指定流程运行。Sqoop作业不太常用，了解即可，一般使用Linux shell脚本（将sqoop语句写入脚本中，然后运行脚本）。</p> <p>创建Sqoop作业的语法：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ sqoop job <span class="token punctuation">(</span>generic-args<span class="token punctuation">)</span>  <span class="token punctuation">(</span>job-args<span class="token punctuation">)</span>    <span class="token punctuation">[</span>-- <span class="token punctuation">[</span>subtool-name<span class="token punctuation">]</span> <span class="token punctuation">(</span>subtool-args<span class="token punctuation">)</span><span class="token punctuation">]</span>     
$ sqoop-job <span class="token punctuation">(</span>generic-args<span class="token punctuation">)</span>  <span class="token punctuation">(</span>job-args<span class="token punctuation">)</span>    <span class="token punctuation">[</span>-- <span class="token punctuation">[</span>subtool-name<span class="token punctuation">]</span> <span class="token punctuation">(</span>subtool-args<span class="token punctuation">)</span><span class="token punctuation">]</span>      
</code></pre></div><p>创建Sqoop作业示例：</p> <p>在这里，我们创建一个名为myjob，将RDBMS表的数据导入到HDFS中。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ sqoop job --create myjob -- <span class="token function">import</span> --connect jdbc:mysql://node03:3306/userdb --username root --password <span class="token number">123456</span> --table emp --target-dir /sqoopJob/myjob --delete-target-dir --m <span class="token number">1</span>
</code></pre></div><p>注意：</p> <ul><li>创建job时，-- import是不连在一起的，一定要分开，不能写成--import</li> <li>要加上--m 1，否则等会运行job时会报错：ERROR tool.ImportTool: Import failed: No primary key could be found for table emp. Please specify one with --split-by or perform a sequential import with '-m 1'. 可能是因为没有primary key才需要加--m 1</li></ul> <p>显示存在的作业 (--list)</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ sqoop job --list

Available jobs:
  myjob
</code></pre></div><p>检查作业(--show)</p> <p><strong>‘--show’</strong> 参数用于检查或验证特定的工作，及其详细信息。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ sqoop job --show myjob
Enter password:  <span class="token comment">#需要输入密码(hadoop用户的密码)才能查看job详细信息</span>
Job: myjob
Tool: <span class="token function">import</span>
Options:  
----------------------------  <span class="token comment">#显示了工具Tool和参数options</span>
reset.onemapper <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">..</span>. <span class="token comment">#中间省略了</span>
hbase.create.table <span class="token operator">=</span> <span class="token boolean">false</span>
codegen.compile.dir <span class="token operator">=</span> /tmp/sqoop-hadoop/compile/2a2a6614296865eedd8f26a8d8ea0636
codegen.output.delimiters.escape <span class="token operator">=</span> <span class="token number">0</span>
db.connect.string <span class="token operator">=</span> jdbc:mysql://node03:3306/userdb
</code></pre></div><p>执行作业 (--exec)</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ sqoop job --exec myjob  

<span class="token comment">#查看运行作业后的效果。</span>
<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ hdfs dfs -cat /sqoopJob/myjob/part-m-00000
<span class="token number">1201</span>,gopal,manager,50000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1202</span>,manisha,Proof reader,50000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1203</span>,khalil,php dev,30000,AC,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1204</span>,prasanth,php dev,30000,AC,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-14 <span class="token number">12</span>:21:03.0,1
<span class="token number">1205</span>,jimmy,admin,20000,TP,2020-03-14 <span class="token number">12</span>:21:03.0,2020-03-15 01:27:17.0,1
</code></pre></div><h2 id="sqoop常用命令及参数-todo"><a href="#sqoop常用命令及参数-todo" class="header-anchor">#</a> Sqoop常用命令及参数(TODO)</h2> <h3 id="常用命令列举"><a href="#常用命令列举" class="header-anchor">#</a> 常用命令列举</h3> <p>这里给大家列出来了一部分Sqoop操作时的常用参数，以供参考，需要深入学习的可以参看对应类的源代码。</p> <table><thead><tr><th><strong>序号</strong></th> <th><strong>命令</strong></th> <th><strong>类</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>import</td> <td>ImportTool</td> <td>将数据导入到集群</td></tr> <tr><td>2</td> <td>export</td> <td>ExportTool</td> <td>将集群数据导出</td></tr> <tr><td>3</td> <td>codegen</td> <td>CodeGenTool</td> <td>获取数据库中某张表数据生成Java并打包Jar</td></tr> <tr><td>4</td> <td>create-hive-table</td> <td>CreateHiveTableTool</td> <td>创建Hive表</td></tr> <tr><td>5</td> <td>eval</td> <td>EvalSqlTool</td> <td>查看SQL执行结果</td></tr> <tr><td>6</td> <td>import-all-tables</td> <td>ImportAllTablesTool</td> <td>导入某个数据库下所有表到HDFS中</td></tr> <tr><td>7</td> <td>job</td> <td>JobTool</td> <td>用来生成一个sqoop的任务，生成后，该任务并不执行，除非使用命令执行该任务。</td></tr> <tr><td>8</td> <td>list-databases</td> <td>ListDatabasesTool</td> <td>列出所有数据库名</td></tr> <tr><td>9</td> <td>list-tables</td> <td>ListTablesTool</td> <td>列出某个数据库下所有表</td></tr> <tr><td>10</td> <td>merge</td> <td>MergeTool</td> <td>将HDFS中不同目录下面的数据合在一起，并存放在指定的目录中</td></tr> <tr><td>11</td> <td>metastore</td> <td>MetastoreTool</td> <td>记录sqoop job的元数据信息，如果不启动metastore实例，则默认的元数据存储目录为：~/.sqoop，如果要更改存储目录，可以在配置文件sqoop-site.xml中进行更改。</td></tr> <tr><td>12</td> <td>help</td> <td>HelpTool</td> <td>打印sqoop帮助信息</td></tr> <tr><td>13</td> <td>version</td> <td>VersionTool</td> <td>打印sqoop版本信息</td></tr></tbody></table> <h3 id="命令-参数详解"><a href="#命令-参数详解" class="header-anchor">#</a> 命令&amp;参数详解</h3> <p>刚才列举了一些Sqoop的常用命令，对于不同的命令，有不同的参数，让我们来一一列举说明。</p> <p>首先来我们来介绍一下公用的参数，所谓公用参数，就是大多数命令都支持的参数。</p> <h5 id="_1、公用参数-数据库连接"><a href="#_1、公用参数-数据库连接" class="header-anchor">#</a> 1、公用参数：数据库连接</h5> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--connect</td> <td>连接关系型数据库的URL</td></tr> <tr><td>2</td> <td>--connection-manager</td> <td>指定要使用的连接管理类</td></tr> <tr><td>3</td> <td>--driver</td> <td>JDBC的driver class</td></tr> <tr><td>4</td> <td>--help</td> <td>打印帮助信息</td></tr> <tr><td>5</td> <td>--password</td> <td>连接数据库的密码</td></tr> <tr><td>6</td> <td>--username</td> <td>连接数据库的用户名</td></tr> <tr><td>7</td> <td>--verbose</td> <td>在控制台打印出详细信息</td></tr></tbody></table> <h5 id="_2、公用参数-import"><a href="#_2、公用参数-import" class="header-anchor">#</a> 2、公用参数：import</h5> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--enclosed-by  <code>&lt;char&gt;</code></td> <td>给字段值前后加上指定的字符</td></tr> <tr><td>2</td> <td>--escaped-by  <code>&lt;char&gt;</code></td> <td>对字段中的双引号加转义符</td></tr> <tr><td>3</td> <td>--fields-terminated-by  <code>&lt;char&gt;</code></td> <td>设定每个字段是以什么符号作为结束，默认为逗号</td></tr> <tr><td>4</td> <td>--lines-terminated-by  <code>&lt;char&gt;</code></td> <td>设定每行记录之间的分隔符，默认是\n</td></tr> <tr><td>5</td> <td>--mysql-delimiters</td> <td>Mysql默认的分隔符设置，字段之间以逗号分隔，行之间以\n分隔，默认转义符是\，字段值以单引号包裹。</td></tr> <tr><td>6</td> <td>--optionally-enclosed-by  <code>&lt;char&gt;</code></td> <td>给带有双引号或单引号的字段值前后加上指定字符。</td></tr></tbody></table> <h5 id="_3、公用参数-export"><a href="#_3、公用参数-export" class="header-anchor">#</a> 3、公用参数：export</h5> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--input-enclosed-by  <code>&lt;char&gt;</code></td> <td>对字段值前后加上指定字符</td></tr> <tr><td>2</td> <td>--input-escaped-by  <code>&lt;char&gt;</code></td> <td>对含有转移符的字段做转义处理</td></tr> <tr><td>3</td> <td>--input-fields-terminated-by  <code>&lt;char&gt;</code></td> <td>字段之间的分隔符</td></tr> <tr><td>4</td> <td>--input-lines-terminated-by  <code>&lt;char&gt;</code></td> <td>行之间的分隔符</td></tr> <tr><td>5</td> <td>--input-optionally-enclosed-by  <code>&lt;char&gt;</code></td> <td>给带有双引号或单引号的字段前后加上指定字符</td></tr></tbody></table> <h5 id="_4、公用参数-hive"><a href="#_4、公用参数-hive" class="header-anchor">#</a> 4、公用参数：hive</h5> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--hive-delims-replacement  <code>&lt;arg&gt;</code></td> <td>用自定义的字符串替换掉数据中的\r\n和\013 \010等字符</td></tr> <tr><td>2</td> <td>--hive-drop-import-delims</td> <td>在导入数据到hive时，去掉数据中的\r\n\013\010这样的字符</td></tr> <tr><td>3</td> <td>--map-column-hive  <code>&lt;map&gt;</code></td> <td>生成hive表时，可以更改生成字段的数据类型</td></tr> <tr><td>4</td> <td>--hive-partition-key</td> <td>创建分区，后面直接跟分区名，分区字段的默认类型为string</td></tr> <tr><td>5</td> <td>--hive-partition-value  <code>&lt;v&gt;</code></td> <td>导入数据时，指定某个分区的值</td></tr> <tr><td>6</td> <td>--hive-home  <code>&lt;dir&gt;</code></td> <td>hive的安装目录，可以通过该参数覆盖之前默认配置的目录</td></tr> <tr><td>7</td> <td>--hive-import</td> <td>将数据从关系数据库中导入到hive表中</td></tr> <tr><td>8</td> <td>--hive-overwrite</td> <td>覆盖掉在hive表中已经存在的数据</td></tr> <tr><td>9</td> <td>--create-hive-table</td> <td>默认是false，即，如果目标表已经存在了，那么创建任务失败。</td></tr> <tr><td>10</td> <td>--hive-table</td> <td>后面接要创建的hive表,默认使用MySQL的表名</td></tr> <tr><td>11</td> <td>--table</td> <td>指定关系数据库的表名</td></tr></tbody></table> <p>公用参数介绍完之后，我们来按照命令介绍命令对应的特有参数。</p> <h5 id="_5、命令-参数-import"><a href="#_5、命令-参数-import" class="header-anchor">#</a> 5、命令&amp;参数：import</h5> <p>将关系型数据库中的数据导入到HDFS（包括Hive，HBase）中，如果导入的是Hive，那么当Hive中没有对应表时，则自动创建。</p> <p><strong>1)</strong> <strong>命令：</strong></p> <p>如：导入数据到hive中</p> <p>$ bin/sqoop import \  --connect jdbc:mysql://node03:3306/userdb  \  --username root \  --password 123456 \  --table emp \  --hive-import</p> <p>如：增量导入数据到hive中，mode=append</p> <p>append导入：  $  bin/sqoop import \  --connect  jdbc:mysql://node03:3306/userdb \  --username  root \  --password  123456 \  --table  emp \  --num-mappers  1 \  --fields-terminated-by  &quot;\t&quot; \  --target-dir  /user/hive/warehouse/emp \  --check-column  id \  --incremental  append \  --last-value  3</p> <p>易错提醒：append不能与--hive-等参数同时使用（Append mode for hive imports is not yet supported. Please remove the parameter --append-mode）</p> <p>如：增量导入数据到hdfs中，mode=lastmodified</p> <p>先在mysql中建表并插入几条数据：</p> <div class="language-sql extra-class"><pre class="language-sql"><code> mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span>  company<span class="token punctuation">.</span>staff_timestamp<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  last_modified <span class="token keyword">timestamp</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span>  <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span>  company<span class="token punctuation">.</span>staff_timestamp <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'AAA'</span><span class="token punctuation">,</span> <span class="token string">'female'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
 
 mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span>  company<span class="token punctuation">.</span>staff_timestamp <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'BBB'</span><span class="token punctuation">,</span> <span class="token string">'female'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
 
 <span class="token comment">#先导入一部分数据：  </span>
 bin<span class="token operator">/</span>sqoop <span class="token keyword">import</span>  <span class="token comment">--connect  jdbc:mysql://node03:3306/userdb  --username  root --password  123456   --table  emp_conn  --delete-target-dir    --m  1  </span>
 <span class="token comment">#再增量导入一部分数据：  </span>
 
 mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span>  company<span class="token punctuation">.</span>staff_timestamp <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'CCC'</span><span class="token punctuation">,</span> <span class="token string">'female'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
 
 bin<span class="token operator">/</span>sqoop <span class="token keyword">import</span>  <span class="token comment">--connect  jdbc:mysql://node03:3306/userdb --username  root --password  123456  --table  emp_conn  --check-column  last_modified --incremental  lastmodified --last-value  &quot;2018-0-28 22:20:38&quot;  --m  1  --append  </span>
</code></pre></div><p>易错提醒：使用lastmodified方式导入数据要指定增量数据是要--append（追加）还是要--merge-key（合并）</p> <p>易错提醒：--incremental lastmodified模式下，last-value指定的值是会包含于增量导入的数据中。</p> <p><strong>2)</strong> <strong>参数：</strong></p> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--append</td> <td>将数据追加到HDFS中已经存在的DataSet中，如果使用该参数，sqoop会把数据先导入到临时文件目录，再合并。</td></tr> <tr><td>2</td> <td>--as-avrodatafile</td> <td>将数据导入到一个Avro数据文件中</td></tr> <tr><td>3</td> <td>--as-sequencefile</td> <td>将数据导入到一个sequence文件中</td></tr> <tr><td>4</td> <td>--as-textfile</td> <td>将数据导入到一个普通文本文件中</td></tr> <tr><td>5</td> <td>--boundary-query  <code>&lt;statement&gt;</code></td> <td>边界查询，导入的数据为该参数的值（一条sql语句）所执行的结果区间内的数据。</td></tr> <tr><td>6</td> <td>--columns <code>&lt;col1, col2, col3&gt;</code></td> <td>指定要导入的字段</td></tr> <tr><td>7</td> <td>--direct</td> <td>直接导入模式，使用的是关系数据库自带的导入导出工具，以便加快导入导出过程。</td></tr> <tr><td>8</td> <td>--direct-split-size</td> <td>在使用上面direct直接导入的基础上，对导入的流按字节分块，即达到该阈值就产生一个新的文件</td></tr> <tr><td>9</td> <td>--inline-lob-limit</td> <td>设定大对象数据类型的最大值</td></tr> <tr><td>10</td> <td>--m或–num-mappers</td> <td>启动N个map来并行导入数据，默认4个。</td></tr> <tr><td>11</td> <td>--query或--e <code>&lt;statement&gt;</code></td> <td>将查询结果的数据导入，使用时必须伴随参--target-dir，--hive-table，如果查询中有where条件，则条件后必须加上$CONDITIONS关键字</td></tr> <tr><td>12</td> <td>--split-by <code>&lt;column-name&gt;</code></td> <td>按照某一列来切分表的工作单元，不能与--autoreset-to-one-mapper连用（请参考官方文档）</td></tr> <tr><td>13</td> <td>--table <code>&lt;table-name&gt;</code></td> <td>关系数据库的表名</td></tr> <tr><td>14</td> <td>--target-dir <code>&lt;dir&gt;</code></td> <td>指定HDFS路径</td></tr> <tr><td>15</td> <td>--warehouse-dir <code>&lt;dir&gt;</code></td> <td>与14参数不能同时使用，导入数据到HDFS时指定的目录</td></tr> <tr><td>16</td> <td>--where</td> <td>从关系数据库导入数据时的查询条件</td></tr> <tr><td>17</td> <td>--z或--compress</td> <td>允许压缩</td></tr> <tr><td>18</td> <td>--compression-codec</td> <td>指定hadoop压缩编码类，默认为gzip(Use Hadoop codec  default gzip)</td></tr> <tr><td>19</td> <td>--null-string  <code>&lt;null-string</code>&gt;</td> <td>string类型的列如果null，替换为指定字符串</td></tr> <tr><td>20</td> <td>--null-non-string  <code>&lt;null-string&gt;</code></td> <td>非string类型的列如果null，替换为指定字符串</td></tr> <tr><td>21</td> <td>--check-column <code>&lt;col&gt;</code></td> <td>作为增量导入判断的列名</td></tr> <tr><td>22</td> <td>--incremental <code>&lt;mode&gt;</code></td> <td>mode：append或lastmodified</td></tr> <tr><td>23</td> <td>--last-value <code>&lt;value&gt;</code></td> <td>指定某一个值，用于标记增量导入的位置</td></tr></tbody></table> <h5 id="_6、命令-参数-export"><a href="#_6、命令-参数-export" class="header-anchor">#</a> 6、命令&amp;参数：export</h5> <p>从HDFS（包括Hive和HBase）中奖数据导出到关系型数据库中。</p> <p><strong>1)</strong> <strong>命令：</strong></p> <p><strong>如：</strong></p> <p>$ bin/sqoop export \  --connect jdbc:mysql://node03:3306/userdb  \  --username root \  --password 123456 \  --table emp_add \  --export-dir /user/company \  --input-fields-terminated-by  &quot;\t&quot; \  --num-mappers 1</p> <p><strong>2)</strong> <strong>参数：</strong></p> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--direct</td> <td>利用数据库自带的导入导出工具，以便于提高效率</td></tr> <tr><td>2</td> <td>--export-dir  <code>&lt;dir&gt;</code></td> <td>存放数据的HDFS的源目录</td></tr> <tr><td>3</td> <td>-m或--num-mappers  <code>&lt;n&gt;</code></td> <td>启动N个map来并行导入数据，默认4个</td></tr> <tr><td>4</td> <td>--table  <code>&lt;table-name&gt;</code></td> <td>指定导出到哪个RDBMS中的表</td></tr> <tr><td>5</td> <td>--update-key  <code>&lt;col-name&gt;</code></td> <td>对某一列的字段进行更新操作</td></tr> <tr><td>6</td> <td>--update-mode  <code>&lt;mode&gt;</code></td> <td>updateonly  allowinsert(默认)</td></tr> <tr><td>7</td> <td>--input-null-string  <code>&lt;null-string&gt;</code></td> <td>请参考import该类似参数说明</td></tr> <tr><td>8</td> <td>--input-null-non-string  <code>&lt;null-string&gt;</code></td> <td>请参考import该类似参数说明</td></tr> <tr><td>9</td> <td>--staging-table  <code>&lt;staging-table-name&gt;</code></td> <td>创建一张临时表，用于存放所有事务的结果，然后将所有事务结果一次性导入到目标表中，防止错误。</td></tr> <tr><td>10</td> <td>--clear-staging-table</td> <td>如果第9个参数非空，则可以在导出操作执行前，清空临时事务结果表</td></tr></tbody></table> <h5 id="_7、命令-参数-codegen"><a href="#_7、命令-参数-codegen" class="header-anchor">#</a> 7、命令&amp;参数：codegen</h5> <p>将关系型数据库中的表映射为一个Java类，在该类中有各列对应的各个字段。</p> <p>如：</p> <p>$ bin/sqoop codegen \  --connect jdbc:mysql://node03:3306/userdb  \  --username root \  --password 123456 \  --table emp_add \  --bindir /home/admin/Desktop/staff  \  --class-name Staff \  --fields-terminated-by  &quot;\t&quot;</p> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--bindir  <code>&lt;dir&gt;</code></td> <td>指定生成的Java文件、编译成的class文件及将生成文件打包为jar的文件输出路径</td></tr> <tr><td>2</td> <td>--class-name  <code>&lt;name&gt;</code></td> <td>设定生成的Java文件指定的名称</td></tr> <tr><td>3</td> <td>--outdir  <code>&lt;dir&gt;</code></td> <td>生成Java文件存放的路径</td></tr> <tr><td>4</td> <td>--package-name <code>&lt;name&gt;</code></td> <td>包名，如com.z，就会生成com和z两级目录</td></tr> <tr><td>5</td> <td>--input-null-non-string  <code>&lt;null-str&gt;</code></td> <td>在生成的Java文件中，可以将null字符串或者不存在的字符串设置为想要设定的值（例如空字符串）</td></tr> <tr><td>6</td> <td>--input-null-string  <code>&lt;null-str&gt;</code></td> <td>将null字符串替换成想要替换的值（一般与5同时使用）</td></tr> <tr><td>7</td> <td>--map-column-java <code>&lt;arg&gt;</code></td> <td>数据库字段在生成的Java文件中会映射成各种属性，且默认的数据类型与数据库类型保持对应关系。该参数可以改变默认类型，例如：--map-column-java  id=long, name=String</td></tr> <tr><td>8</td> <td>--null-non-string  <code>&lt;null-str&gt;</code></td> <td>在生成Java文件时，可以将不存在或者null的字符串设置为其他值</td></tr> <tr><td>9</td> <td>--null-string <code>&lt;null-str&gt;</code></td> <td>在生成Java文件时，将null字符串设置为其他值（一般与8同时使用）</td></tr> <tr><td>10</td> <td>--table <code>&lt;table-name&gt;</code></td> <td>对应关系数据库中的表名，生成的Java文件中的各个属性与该表的各个字段一一对应</td></tr></tbody></table> <h5 id="_8、命令-参数-create-hive-table"><a href="#_8、命令-参数-create-hive-table" class="header-anchor">#</a> 8、命令&amp;参数：create-hive-table</h5> <p>生成与关系数据库表结构对应的hive表结构。</p> <p><strong>命令：</strong></p> <p>如：</p> <p>$  bin/sqoop create-hive-table \  --connect jdbc:mysql://node03:3306/userdb  \  --username root \  --password 123456 \  --table emp_add \  --hive-table emp_add</p> <p><strong>参数：</strong></p> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--hive-home  <code>&lt;dir&gt;</code></td> <td>Hive的安装目录，可以通过该参数覆盖掉默认的Hive目录</td></tr> <tr><td>2</td> <td>--hive-overwrite</td> <td>覆盖掉在Hive表中已经存在的数据</td></tr> <tr><td>3</td> <td>--create-hive-table</td> <td>默认是false，如果目标表已经存在了，那么创建任务会失败</td></tr> <tr><td>4</td> <td>--hive-table</td> <td>后面接要创建的hive表</td></tr> <tr><td>5</td> <td>--table</td> <td>指定关系数据库的表名</td></tr></tbody></table> <h5 id="_9、命令-参数-eval"><a href="#_9、命令-参数-eval" class="header-anchor">#</a> 9、命令&amp;参数：eval</h5> <p>可以快速的使用SQL语句对关系型数据库进行操作，经常用于在import数据之前，了解一下SQL语句是否正确，数据是否正常，并可以将结果显示在控制台。</p> <p><strong>命令：</strong></p> <p>如：</p> <p>$  bin/sqoop eval \  --connect jdbc:mysql://node03:3306/userdb  \  --username root \  --password 123456 \  --query &quot;SELECT * FROM  emp&quot;</p> <p><strong>参数：</strong></p> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--query或--e</td> <td>后跟查询的SQL语句</td></tr></tbody></table> <h5 id="_10、命令-参数-import-all-tables"><a href="#_10、命令-参数-import-all-tables" class="header-anchor">#</a> 10、命令&amp;参数：import-all-tables</h5> <p>可以将RDBMS中的所有表导入到HDFS中，每一个表都对应一个HDFS目录</p> <p><strong>命令：</strong></p> <p>如：</p> <p>$  bin/sqoop import-all-tables \  --connect jdbc:mysql://node03:3306/userdb  \  --username root \  --password 123456 \  --warehouse-dir /all_tables</p> <p><strong>参数：</strong></p> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--as-avrodatafile</td> <td>这些参数的含义均和import对应的含义一致</td></tr> <tr><td>2</td> <td>--as-sequencefile</td> <td></td></tr> <tr><td>3</td> <td>--as-textfile</td> <td></td></tr> <tr><td>4</td> <td>--direct</td> <td></td></tr> <tr><td>5</td> <td>--direct-split-size  <code>&lt;n&gt;</code></td> <td></td></tr> <tr><td>6</td> <td>--inline-lob-limit  <code>&lt;n&gt;</code></td> <td></td></tr> <tr><td>7</td> <td>--m或—num-mappers  <code>&lt;n&gt;</code></td> <td></td></tr> <tr><td>8</td> <td>--warehouse-dir  <code>&lt;dir&gt;</code></td> <td></td></tr> <tr><td>9</td> <td>-z或--compress</td> <td></td></tr> <tr><td>10</td> <td>--compression-codec</td> <td></td></tr></tbody></table> <h5 id="_11、命令-参数-job"><a href="#_11、命令-参数-job" class="header-anchor">#</a> 11、命令&amp;参数：job</h5> <p>用来生成一个sqoop任务，生成后不会立即执行，需要手动执行。</p> <p><strong>命令：</strong></p> <p>如：</p> <p>$ bin/sqoop job \   --create myjob -- import-all-tables \   --connect jdbc:mysql://node03:3306/userdb \   --username root \   --password 123456  $ bin/sqoop job \  --list  $ bin/sqoop job \  --exec myjob</p> <p>易错提醒：注意import-all-tables和它左边的--之间有一个空格</p> <p>易错提醒：如果需要连接metastore，则--meta-connect jdbc:hsqldb:hsql://node03:16000/sqoop</p> <p>参数：</p> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--create  <code>&lt;job-id&gt;</code></td> <td>创建job参数</td></tr> <tr><td>2</td> <td>--delete  <code>&lt;job-id&gt;</code></td> <td>删除一个job</td></tr> <tr><td>3</td> <td>--exec  <code>&lt;job-id&gt;</code></td> <td>执行一个job</td></tr> <tr><td>4</td> <td>--help</td> <td>显示job帮助</td></tr> <tr><td>5</td> <td>--list</td> <td>显示job列表</td></tr> <tr><td>6</td> <td>--meta-connect  <code>&lt;jdbc-uri&gt;</code></td> <td>用来连接metastore服务</td></tr> <tr><td>7</td> <td>--show  <code>&lt;job-id&gt;</code></td> <td>显示一个job的信息</td></tr> <tr><td>8</td> <td>--verbose</td> <td>打印命令运行时的详细信息</td></tr></tbody></table> <p>易错提醒：在执行一个job时，如果需要手动输入数据库密码，可以做如下优化</p> <p><code>&lt;property&gt; &lt;name&gt;sqoop.metastore.client.record.password&lt;/name&gt; &lt;value&gt;true&lt;/value&gt; &lt;description&gt;If true, allow saved passwords in the metastore.&lt;/description&gt; &lt;/property&gt;</code></p> <h5 id="_12、命令-参数-list-databases"><a href="#_12、命令-参数-list-databases" class="header-anchor">#</a> 12、命令&amp;参数：list-databases</h5> <p><strong>命令：</strong></p> <p>如：</p> <p>$  bin/sqoop list-databases \  --connect jdbc:mysql://node03:3306/userdb  \  --username root \  --password 123456</p> <p>**参数：**与公用参数一样</p> <h5 id="_13、命令-参数-list-tables"><a href="#_13、命令-参数-list-tables" class="header-anchor">#</a> 13、命令&amp;参数：list-tables</h5> <p><strong>命令：</strong></p> <p>如：</p> <p>$ bin/sqoop list-tables \  --connect jdbc:mysql://node03:3306/userdb  \  --username root \  --password 123456</p> <p>**参数：**与公用参数一样</p> <h5 id="_14、命令-参数-merge"><a href="#_14、命令-参数-merge" class="header-anchor">#</a> 14、命令&amp;参数：merge</h5> <p>将HDFS中不同目录下面的数据合并在一起并放入指定目录中</p> <p>数据环境：</p> <p>new_staff  1    AAA    male  2    BBB    male  3    CCC    male  4    DDD    male  old_staff  1    AAA    female  2    CCC    female  3    BBB    female  6    DDD    female</p> <p>易错提醒：上边数据的列之间的分隔符应该为\t，行与行之间的分割符为\n，如果直接复制，请检查之。</p> <p><strong>命令：</strong></p> <p>如：</p> <p>创建JavaBean：  $  bin/sqoop codegen \  --connect  jdbc:mysql://node03:3306/userdb \  --username  root \  --password  123456 \  --table  emp_conn \  --bindir  /home/admin/Desktop/staff \  --class-name  EmpConn \  --fields-terminated-by  &quot;\t&quot;     开始合并：  $  bin/sqoop merge \  --new-data  /test/new/ \  --onto  /test/old/ \  --target-dir  /test/merged \  --jar-file  /home/admin/Desktop/staff/EmpConn.jar \  --class-name  Staff \  --merge-key  id  结果：  1    AAA MALE  2    BBB MALE  3    CCC MALE  4    DDD MALE  6    DDD FEMALE</p> <p>参数：</p> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--new-data  <code>&lt;path&gt;</code></td> <td>HDFS  待合并的数据目录，合并后在新的数据集中保留</td></tr> <tr><td>2</td> <td>--onto  <code>&lt;path&gt;</code></td> <td>HDFS合并后，重复的部分在新的数据集中被覆盖</td></tr> <tr><td>3</td> <td>--merge-key  <code>&lt;col&gt;</code></td> <td>合并键，一般是主键ID</td></tr> <tr><td>4</td> <td>--jar-file  <code>&lt;file&gt;</code></td> <td>合并时引入的jar包，该jar包是通过Codegen工具生成的jar包</td></tr> <tr><td>5</td> <td>--class-name  <code>&lt;class&gt;</code></td> <td>对应的表名或对象名，该class类是包含在jar包中的</td></tr> <tr><td>6</td> <td>--target-dir  <code>&lt;path&gt;</code></td> <td>合并后的数据在HDFS里存放的目录</td></tr></tbody></table> <h5 id="_15、命令-参数-metastore"><a href="#_15、命令-参数-metastore" class="header-anchor">#</a> 15、命令&amp;参数：metastore</h5> <p>记录了Sqoop job的元数据信息，如果不启动该服务，那么默认job元数据的存储目录为~/.sqoop，可在sqoop-site.xml中修改。</p> <p><strong>命令：</strong></p> <p>如：启动sqoop的metastore服务</p> <p>$ bin/sqoop metastore</p> <p><strong>参数：</strong></p> <table><thead><tr><th><strong>序号</strong></th> <th><strong>参数</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>1</td> <td>--shutdown</td> <td>关闭metastore</td></tr></tbody></table> <hr> <p>[<a href="#_msoanchor_1">a1]</a>使用sql语句来进行查找是不能加参数--table</p> <p>并且必须要添加where条件，</p> <p>并且where条件后面必须带一个$CONDITIONS 这个字符串，</p> <p>并且这个sql语句必须用单引号，不能用双引号</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MaLunan/press/edit/dev-mln/docs/sqoop/sqoop.md" target="_blank" rel="noopener noreferrer">在GitHub 上编辑此页！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">1/19/2021, 1:41:59 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fdd7a502.js" defer></script><script src="/assets/js/16.375b747e.js" defer></script><script src="/assets/js/36.45f11923.js" defer></script>
  </body>
</html>
