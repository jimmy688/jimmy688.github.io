<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HBase集群安装部署 | 个人博客 | JiiiiG</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="自是年少，韶华倾负">
    
    <link rel="preload" href="/assets/css/0.styles.420b7c1f.css" as="style"><link rel="preload" href="/assets/js/app.fdd7a502.js" as="script"><link rel="preload" href="/assets/js/16.375b747e.js" as="script"><link rel="preload" href="/assets/js/13.426d0224.js" as="script"><link rel="prefetch" href="/assets/js/10.bbd38b9e.js"><link rel="prefetch" href="/assets/js/11.f49fc7d3.js"><link rel="prefetch" href="/assets/js/12.c5d97aa1.js"><link rel="prefetch" href="/assets/js/14.1f257a58.js"><link rel="prefetch" href="/assets/js/15.be29bb6a.js"><link rel="prefetch" href="/assets/js/17.d02cdd8b.js"><link rel="prefetch" href="/assets/js/18.5d2371a4.js"><link rel="prefetch" href="/assets/js/19.038919a3.js"><link rel="prefetch" href="/assets/js/2.d6257727.js"><link rel="prefetch" href="/assets/js/20.b3582e09.js"><link rel="prefetch" href="/assets/js/21.0c1e826b.js"><link rel="prefetch" href="/assets/js/22.91bff1a5.js"><link rel="prefetch" href="/assets/js/23.faacea60.js"><link rel="prefetch" href="/assets/js/24.69816497.js"><link rel="prefetch" href="/assets/js/25.c9fcaa62.js"><link rel="prefetch" href="/assets/js/26.d28c3abe.js"><link rel="prefetch" href="/assets/js/27.1518da7d.js"><link rel="prefetch" href="/assets/js/28.748a5581.js"><link rel="prefetch" href="/assets/js/29.775019f1.js"><link rel="prefetch" href="/assets/js/3.141002a4.js"><link rel="prefetch" href="/assets/js/30.74e7c570.js"><link rel="prefetch" href="/assets/js/31.190b11f2.js"><link rel="prefetch" href="/assets/js/32.d8f4f116.js"><link rel="prefetch" href="/assets/js/33.c489bc81.js"><link rel="prefetch" href="/assets/js/34.db609d51.js"><link rel="prefetch" href="/assets/js/35.ad3402e6.js"><link rel="prefetch" href="/assets/js/36.45f11923.js"><link rel="prefetch" href="/assets/js/37.b47e0576.js"><link rel="prefetch" href="/assets/js/38.58b934a2.js"><link rel="prefetch" href="/assets/js/39.e4d6bcdf.js"><link rel="prefetch" href="/assets/js/4.e9b44388.js"><link rel="prefetch" href="/assets/js/40.555106bc.js"><link rel="prefetch" href="/assets/js/41.4387ceb1.js"><link rel="prefetch" href="/assets/js/42.9bd4aea0.js"><link rel="prefetch" href="/assets/js/43.587e7966.js"><link rel="prefetch" href="/assets/js/44.80285763.js"><link rel="prefetch" href="/assets/js/45.f978da77.js"><link rel="prefetch" href="/assets/js/46.d93e3f2e.js"><link rel="prefetch" href="/assets/js/47.c15bd2aa.js"><link rel="prefetch" href="/assets/js/48.cb55fa72.js"><link rel="prefetch" href="/assets/js/49.d0f4e454.js"><link rel="prefetch" href="/assets/js/5.b90b80cb.js"><link rel="prefetch" href="/assets/js/50.112e8260.js"><link rel="prefetch" href="/assets/js/51.a66bcd03.js"><link rel="prefetch" href="/assets/js/52.0c7cbfb1.js"><link rel="prefetch" href="/assets/js/53.67ef240b.js"><link rel="prefetch" href="/assets/js/54.2c2d082d.js"><link rel="prefetch" href="/assets/js/55.88f19a20.js"><link rel="prefetch" href="/assets/js/56.c726e920.js"><link rel="prefetch" href="/assets/js/57.eaee47c5.js"><link rel="prefetch" href="/assets/js/58.ac15a3ac.js"><link rel="prefetch" href="/assets/js/59.64bdc849.js"><link rel="prefetch" href="/assets/js/6.7eea74ff.js"><link rel="prefetch" href="/assets/js/7.a1370e98.js"><link rel="prefetch" href="/assets/js/8.2e898240.js"><link rel="prefetch" href="/assets/js/9.a2439994.js">
    <link rel="stylesheet" href="/assets/css/0.styles.420b7c1f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人博客 | JiiiiG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/linux/linux常用命令/01linux常用命令01.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hadoop/01hadoop环境搭建/01搭建hadoop集群.html" class="nav-link">
  hadoop
</a></li><li class="dropdown-item"><!----> <a href="/hbase/hbase.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  hbase
</a></li><li class="dropdown-item"><!----> <a href="/flink/flink.html" class="nav-link">
  flink
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hbase/.html" class="nav-link">
  java
</a></li></ul></div></div> <a href="https://github.com/MaLunan/press" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/linux/linux常用命令/01linux常用命令01.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hadoop/01hadoop环境搭建/01搭建hadoop集群.html" class="nav-link">
  hadoop
</a></li><li class="dropdown-item"><!----> <a href="/hbase/hbase.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  hbase
</a></li><li class="dropdown-item"><!----> <a href="/flink/flink.html" class="nav-link">
  flink
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hbase/.html" class="nav-link">
  java
</a></li></ul></div></div> <a href="https://github.com/MaLunan/press" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="hbase集群安装部署"><a href="#hbase集群安装部署" class="header-anchor">#</a> HBase集群安装部署</h2> <p>事先要安装好3节点的hadoop和zookeeper集群</p> <h4 id="准备安装包"><a href="#准备安装包" class="header-anchor">#</a> 准备安装包</h4> <ul><li><p>下载安装包并上传到<strong>node01服务器</strong></p></li> <li><p>安装包下载地址：</p> <p>http://archive.cloudera.com/cdh5/cdh/5/hbase-1.2.0-cdh5.14.2.tar.gz</p> <p><img src="/assets/img/image-20200228025204531.4aba8a76.png" alt="image-20200228025204531"></p></li> <li><p>将安装包上传到node01服务器/kkb/soft路径下，并进行解压</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node01 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /kkb/soft/
<span class="token punctuation">[</span>hadoop@node01 soft<span class="token punctuation">]</span>$ <span class="token function">tar</span> -xzvf hbase-1.2.0-cdh5.14.2.tar.gz -C /kkb/install/
</code></pre></div><h4 id="修改hbase配置文件"><a href="#修改hbase配置文件" class="header-anchor">#</a> 修改HBase配置文件</h4> <h5 id="hbase-env-sh"><a href="#hbase-env-sh" class="header-anchor">#</a> hbase-env.sh</h5> <ul><li>修改文件</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node01 soft<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /kkb/install/hbase-1.2.0-cdh5.14.2/conf/
<span class="token punctuation">[</span>hadoop@node01 conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> hbase-env.sh
</code></pre></div><ul><li>修改如下两项内容，值如下</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/kkb/install/jdk1.8.0_141
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HBASE_MANAGES_ZK</span><span class="token operator">=</span>false
<span class="token comment">## 修改为false的原因是hbase运行过程中，元数据存储在zookeeper中，而我们需要使用自己搭建的外部zookeeper集群。</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt=""></p> <p><img src="data:image/png;base64,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" alt=""></p> <h5 id="hbase-site-xml"><a href="#hbase-site-xml" class="header-anchor">#</a> hbase-site.xml</h5> <ul><li>修改文件</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node01 conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> hbase-site.xml
</code></pre></div><ul><li>内容如下</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hbase数据，最终存储在hdfs的路径--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.rootdir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hdfs://node01:8020/hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--以分布式模式来运行hbase--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.cluster.distributed<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- 0.98后的新变动，之前版本没有.port,hbase的master默认端口为60000 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.master.port<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>16000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hbase运行要与zookeeper集群配合，这里指定zookeeper的服务器--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.zookeeper.quorum<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>node01,node02,node03<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 客户端与zk集群通信的端口，此属性可省略，默认值就是2181 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.zookeeper.property.clientPort<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>2181<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.zookeeper.property.dataDir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/kkb/install/zookeeper-3.4.5-cdh5.14.2/zkdatas<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 此属性可省略，默认值就是/hbase --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hbase的元数据存储在zookeeper集群的节点位置--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>zookeeper.znode.parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="regionservers"><a href="#regionservers" class="header-anchor">#</a> regionservers</h5> <ul><li>修改文件</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node01 conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> regionservers
</code></pre></div><ul><li>指定HBase集群的从节点；原内容清空，添加如下三行</li></ul> <div class="language-properties extra-class"><pre class="language-properties"><code>node01
node02
node03
</code></pre></div><h5 id="back-masters"><a href="#back-masters" class="header-anchor">#</a> back-masters</h5> <ul><li>创建back-masters配置文件，里边包含备份HMaster节点的主机名，每个机器独占一行，实现HMaster的高可用</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node01 conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> backup-masters
</code></pre></div><ul><li>将node02作为备份的HMaster节点，问价内容如下</li></ul> <div class="language-properties extra-class"><pre class="language-properties"><code>node02
</code></pre></div><h4 id="分发安装包"><a href="#分发安装包" class="header-anchor">#</a> 分发安装包</h4> <ul><li>将node01上的HBase安装包，拷贝到其他机器上</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node01 conf<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /kkb/install
<span class="token punctuation">[</span>hadoop@node01 install<span class="token punctuation">]</span>$ <span class="token function">scp</span> -r hbase-1.2.0-cdh5.14.2/ node02:<span class="token environment constant">$PWD</span>
<span class="token punctuation">[</span>hadoop@node01 install<span class="token punctuation">]</span>$ <span class="token function">scp</span> -r hbase-1.2.0-cdh5.14.2/ node03:<span class="token environment constant">$PWD</span>
</code></pre></div><h4 id="创建软连接"><a href="#创建软连接" class="header-anchor">#</a> 创建软连接</h4> <ul><li><p><strong>注意：三台机器</strong>均做如下操作</p></li> <li><p>因为HBase集群需要读取hadoop的core-site.xml、hdfs-site.xml的配置文件信息，所以我们==三台机器==都要执行以下命令，在相应的目录创建这两个配置文件的软连接</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">ln</span> -s /kkb/install/hadoop-2.6.0-cdh5.14.2/etc/hadoop/core-site.xml  /kkb/install/hbase-1.2.0-cdh5.14.2/conf/core-site.xml

<span class="token function">ln</span> -s /kkb/install/hadoop-2.6.0-cdh5.14.2/etc/hadoop/hdfs-site.xml  /kkb/install/hbase-1.2.0-cdh5.14.2/conf/hdfs-site.xml
</code></pre></div><ul><li>执行完后，出现如下效果，以node01为例</li></ul> <p><img src="/assets/img/Image201911071738.c33af8a5.png" alt=""></p> <h4 id="添加hbase环境变量"><a href="#添加hbase环境变量" class="header-anchor">#</a> 添加HBase环境变量</h4> <ul><li><strong>注意：三台机器</strong>均执行以下命令，添加环境变量</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/profile
</code></pre></div><ul><li>文件末尾添加如下内容</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">HBASE_HOME</span><span class="token operator">=</span>/kkb/install/hbase-1.2.0-cdh5.14.2
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HBASE_HOME</span>/bin
</code></pre></div><ul><li>重新编译/etc/profile，让环境变量生效</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">source</span> /etc/profile
</code></pre></div><h4 id="hbase的启动与停止"><a href="#hbase的启动与停止" class="header-anchor">#</a> HBase的启动与停止</h4> <ul><li><p><strong>需要提前启动HDFS及ZooKeeper集群</strong></p></li> <li><p>第一台机器node01（HBase主节点）执行以下命令，启动HBase集群</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node01 ~<span class="token punctuation">]</span>$ start-hbase.sh
</code></pre></div><ul><li><p>启动完后，jps查看HBase相关进程</p> <p>node01、node02上有进程HMaster、HRegionServer</p> <p>node03上有进程HRegionServer</p></li> <li><p>警告提示：HBase启动的时候会产生一个警告，这是因为jdk7与jdk8的问题导致的，如果linux服务器安装jdk8就会产生这样的一个警告</p></li></ul> <p><img src="/assets/img/xx.20bec7ae.png" alt="xx"></p> <ul><li><p>可以注释掉<strong>所有机器</strong>的hbase-env.sh当中的</p> <p>“HBASE_MASTER_OPTS”和“HBASE_REGIONSERVER_OPTS”配置 来解决这个问题。</p> <p>不过警告不影响我们正常运行，可以不用解决</p></li> <li><p>我们也可以执行以下命令，单节点启动相关进程</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#HMaster节点上启动HMaster命令</span>
hbase-daemon.sh start master

<span class="token comment">#启动HRegionServer命令</span>
hbase-daemon.sh start regionserver
</code></pre></div><h4 id="访问web页面"><a href="#访问web页面" class="header-anchor">#</a> 访问WEB页面</h4> <ul><li><p>浏览器页面访问</p> <p>http://node01:60010</p></li></ul> <p><img src="/assets/img/Image201911071810.f42366df.png" alt=""></p> <h4 id="停止hbase集群"><a href="#停止hbase集群" class="header-anchor">#</a> 停止HBase集群</h4> <ul><li>停止HBase集群的正确顺序</li> <li>node01上运行</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node01 ~<span class="token punctuation">]</span>$ stop-hbase.sh
</code></pre></div><ul><li>若需要关闭虚拟机，则还需要关闭ZooKeeper、Hadoop集群</li></ul> <h2 id="hbase是什么"><a href="#hbase是什么" class="header-anchor">#</a> HBase是什么</h2> <ul><li><a href="http://developer.51cto.com/art/201904/595698.htm" target="_blank" rel="noopener noreferrer">漫画学习HBase----最易懂的Hbase架构原理解析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>HBase学习的推荐书籍1：《HBase企业应用开发实战》 稍微有点老，比较基础</li> <li>HBase学习的推荐书籍2：《HBase原理与实战》 比较深，hbase committer写的书</li></ul> <h4 id="hbase的概念"><a href="#hbase的概念" class="header-anchor">#</a> HBase的概念</h4> <ul><li>通俗理解：HBase--&gt;H+Base--&gt;Hadoop+database--&gt;hbase是Hadoop的数据库系统。</li></ul> <ul><li>HBase基于Google的BigTable论文，是建立的==HDFS==之上，提供<strong>高可靠性</strong>、<strong>高性能</strong>、<strong>列存储</strong>、<strong>可伸缩</strong>、<strong>实时读写</strong>的分布式数据库系统（非关系型）。</li> <li>hbase的数据存储在hdfs上。</li> <li>在需要实时读写随机访问超大规模数据集时，可以使用HBase。</li></ul> <h4 id="回顾hdfs的优缺点"><a href="#回顾hdfs的优缺点" class="header-anchor">#</a> 回顾hdfs的优缺点</h4> <h5 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h5> <p>(1) 高容错性</p> <p>(2) 适合批处理</p> <p>(3) 适合大数据处理</p> <p>(4) 流式数据访问</p> <p>(5) 可构建在廉价机器上</p> <h5 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h5> <p>(1) 不适合低延时数据访问</p> <p>(2) 无法高效的对大量小文件进行存储</p> <p>(3) 不支持并发写入、不支持文件随机修改(不擅长随机读写)</p> <h4 id="hbase的特点"><a href="#hbase的特点" class="header-anchor">#</a> HBase的特点</h4> <ul><li>==<strong>低时延</strong>==
<ul><li>支持低时延数据访问，ms级响应</li></ul></li></ul> <ul><li>==<strong>海量存储</strong>==
<ul><li>可以存储大批量的数据</li></ul></li> <li>==<strong>列式存储</strong>==
<ul><li>HBase表的数据是基于列族进行存储的，列族是在列的方向上的划分。null的数据，不占据磁盘空间。</li></ul></li> <li>==<strong>极易扩展</strong>==
<ul><li>底层依赖HDFS，当磁盘空间不足的时候，只需要动态增加datanode节点就可以了</li> <li>可以通过增加服务器来对集群的存储进行扩容</li></ul></li> <li>==<strong>高并发</strong>==
<ul><li>支持高并发的读写请求，有很高的写数据吞吐量，写数据很快。</li></ul></li> <li>==<strong>存储稀疏表</strong>==
<ul><li>稀疏主要是针对HBase列的灵活性，在列族中，你可以指定任意多的列，在列数据为空的情况下，是不会占用存储空间的。</li></ul></li> <li>==<strong>数据的多版本</strong>==
<ul><li>HBase表中的数据可以有多个版本值，默认情况下是根据版本号去区分，版本号就是插入数据的时间戳</li></ul></li> <li>==<strong>数据类型单一</strong>==
<ul><li>所有的数据在HBase中是以==字节数组==进行存储</li></ul></li></ul> <h2 id="hbase表的数据模型-重点"><a href="#hbase表的数据模型-重点" class="header-anchor">#</a> HBase表的数据模型（重点）</h2> <p><img src="/assets/img/image-20200227170919531.47c2b645.png" alt="image-20200227170919531"></p> <h4 id="_2-1-rowkey行键"><a href="#_2-1-rowkey行键" class="header-anchor">#</a> 2.1 rowkey行键</h4> <ul><li>table的主键，table中的记录(行）存储在hbase后，按照rowkey 的字典顺序进行排序。</li> <li>Row key行键可以是任意字符串(最大长度是 64KB，实际应用中长度一般为 10-100bytes)</li></ul> <h4 id="_2-2-column-family列族"><a href="#_2-2-column-family列族" class="header-anchor">#</a> 2.2 Column Family列族</h4> <ul><li>列族或列簇</li> <li>HBase表中的每个列，都归属与某个列族</li> <li>列族是表的schema(纲要) 的一部分(而列不是)，即建表时至少指定一个列族。一般一个表不超过2个列族。</li> <li>比如创建一张表，名为<code>user</code>，有两个列族，分别是<code>info</code>和<code>data</code>，建表语句<code>create 'user', 'info', 'data'</code></li></ul> <h4 id="_2-3-column列"><a href="#_2-3-column列" class="header-anchor">#</a> 2.3 Column列</h4> <ul><li>列肯定是表的某一列族下的一个列，用<code>列族名:列名</code>表示，如<code>info</code>列族下的<code>name</code>列，表示为<code>info:name</code></li> <li>属于某一个ColumnFamily,类似于我们mysql当中创建的具体的列</li> <li>创建表的时候，不需要指定列族有哪些列，在表中添加数据的时候，再自定义列及对应的值。</li></ul> <h4 id="_2-4-cell单元格"><a href="#_2-4-cell单元格" class="header-anchor">#</a> 2.4 cell单元格</h4> <ul><li><p>指定row key行键、列族、列，就可以确定的一个cell单元格</p></li> <li><p>cell中的数据是没有类型的，全部是以字节数组进行存储</p></li></ul> <p><img src="/assets/img/Image201911072218.5cd7d012.png" alt=""></p> <h4 id="_2-5-timestamp时间戳"><a href="#_2-5-timestamp时间戳" class="header-anchor">#</a> 2.5 Timestamp时间戳</h4> <ul><li>可以对表中的Cell多次赋值，每次赋值操作时的时间戳timestamp，可看成Cell值的版本号version number</li> <li>即一个Cell可以有多个版本的值</li></ul> <h2 id="hbase整体架构"><a href="#hbase整体架构" class="header-anchor">#</a> HBase整体架构</h2> <p><img src="/assets/img/image-20200227173753006.0ae49d0b.png" alt="image-20200227173753006"></p> <h4 id="client客户端"><a href="#client客户端" class="header-anchor">#</a> Client客户端</h4> <ul><li>Client是操作HBase集群的入口
<ul><li>对于管理类的操作，如表的增、删、改操纵，Client通过RPC与HMaster通信完成</li> <li>对于表数据的读写操作，Client通过RPC与RegionServer交互，读写数据</li></ul></li> <li>Client类型：
<ul><li>HBase shell</li> <li>Java编程接口</li> <li>Thrift、Avro、Rest等等</li></ul></li></ul> <h4 id="zookeeper集群"><a href="#zookeeper集群" class="header-anchor">#</a> ZooKeeper集群</h4> <ul><li>作用
<ul><li><p>实现了HMaster的高可用，多HMaster间进行主备选举</p></li> <li><p>保存了HBase的元数据信息meta表，提供了HBase表中region的寻址入口的线索数据</p></li> <li><p>对HMaster和HRegionServer实现了监控</p></li></ul></li></ul> <h4 id="hmaster"><a href="#hmaster" class="header-anchor">#</a> HMaster</h4> <ul><li>HBase集群也是主从架构，HMaster是主的角色，是老大</li> <li>主要负责Table表和Region的相关管理工作：</li> <li>管理Client对Table的增删改的操作，如CREATE、ALTER、DROP等
<ul><li>在Region分裂后，负责新Region分配到指定的HRegionServer上</li> <li>管理HRegionServer间的负载均衡，迁移region分布。（当某个HRegionServer节点的Region过多时，迁移部分region到其它HRegionServer节点上）</li> <li>当HRegionServer宕机后，负责其上的region的迁移</li></ul></li></ul> <h4 id="hregionserver"><a href="#hregionserver" class="header-anchor">#</a> HRegionServer</h4> <ul><li><p>HBase集群中从的角色，是小弟</p></li> <li><p>HRegionServer节点可以存储HBase的数据，以Region为单元进行存储。(当然，数据存储的底层是在hdfs上)</p></li> <li><p>作用</p> <ul><li>响应客户端的读写数据请求,如SELECT、UPDATE、INSERT、DELETE等。</li> <li>负责管理一系列的Region</li> <li>切分在运行过程中变大的region</li></ul></li></ul> <h4 id="region"><a href="#region" class="header-anchor">#</a> Region</h4> <ul><li>HBase集群中分布式存储的最小单元</li> <li>一个Region对应一个Table表的部分数据</li> <li>Region会进行分裂，因为往一个Region写数据过程中，如果写的数据过多，导致Region过大，不方便以后的数据读写。</li> <li>企业生产中，建议一个HregionServer有20-200个region,每个region在5-30G区间。</li></ul> <h2 id="hbase-shell-命令-基本操作"><a href="#hbase-shell-命令-基本操作" class="header-anchor">#</a> HBase shell 命令--基本操作</h2> <h4 id="查看hbase的命令"><a href="#查看hbase的命令" class="header-anchor">#</a> 查看Hbase的命令</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">## 查看hbase拥有的命令</span>
<span class="token punctuation">[</span>hadoop@node01 install<span class="token punctuation">]</span>$ hbase
Usage: hbase <span class="token punctuation">[</span><span class="token operator">&lt;</span>options<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>args<span class="token operator">&gt;</span><span class="token punctuation">]</span>
Options:
  --config DIR    Configuration direction to use. Default: ./conf
  --hosts HOSTS   Override the list <span class="token keyword">in</span> <span class="token string">'regionservers'</span> <span class="token function">file</span>
  --auth-as-server Authenticate to ZooKeeper using servers configuration

Commands:
Some commands take arguments. Pass no args or -h <span class="token keyword">for</span> usage.
  shell           Run the HBase shell
  hbck            Run the hbase <span class="token string">'fsck'</span> tool
  snapshot        Create a new snapshot of a table
  snapshotinfo    Tool <span class="token keyword">for</span> dumping snapshot information
  wal             Write-ahead-log analyzer
  hfile           Store <span class="token function">file</span> analyzer
  zkcli           Run the ZooKeeper shell
  upgrade         Upgrade hbase
  master          Run an HBase HMaster node
  regionserver    Run an HBase HRegionServer node
  zookeeper       Run a Zookeeper server
  rest            Run an HBase REST server
  thrift          Run the HBase Thrift server
  thrift2         Run the HBase Thrift2 server
  clean           Run the HBase clean up script
  classpath       Dump hbase CLASSPATH
  mapredcp        Dump CLASSPATH entries required by mapreduce
  pe              Run PerformanceEvaluation
  ltt             Run LoadTestTool
  version         Print the version
  CLASSNAME       Run the class named CLASSNAME
</code></pre></div><h4 id="进入hbase客户端命令操作界面"><a href="#进入hbase客户端命令操作界面" class="header-anchor">#</a> 进入HBase客户端命令操作界面</h4> <ul><li>node01(任意一个节点都可以）执行以下命令，进入HBase的shell客户端</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hbase-1.2.0-cdh5.14.2/
bin/hbase shell

<span class="token comment">#如果配置了hbase环境变量，直接使用以下方式即可：</span>
hbase shell
<span class="token comment">#我们已经配了</span>
</code></pre></div><h4 id="help-帮助命令"><a href="#help-帮助命令" class="header-anchor">#</a> help 帮助命令</h4> <h6 id="使用help查看hbase包含的命令"><a href="#使用help查看hbase包含的命令" class="header-anchor">#</a> 使用help查看hbase包含的命令</h6> <div class="language-sh extra-class"><pre class="language-sh"><code>HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:001:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token builtin class-name">help</span>
HBase Shell, version <span class="token number">1.2</span>.0-cdh5.14.2, rUnknown, Tue Mar <span class="token number">27</span> <span class="token number">13</span>:31:54 PDT <span class="token number">2018</span>
Type <span class="token string">'help &quot;COMMAND&quot;'</span>, <span class="token punctuation">(</span>e.g. <span class="token string">'help &quot;get&quot;'</span> -- the quotes are necessary<span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span> on a specific command.
Commands are grouped. Type <span class="token string">'help &quot;COMMAND_GROUP&quot;'</span>, <span class="token punctuation">(</span>e.g. <span class="token string">'help &quot;general&quot;'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span> on a <span class="token builtin class-name">command</span> group.

COMMAND <span class="token environment constant">GROUPS</span><span class="token builtin class-name">:</span> 
  Group name: general  <span class="token comment">#基本操作命令</span>
  Commands: status, table_help, version, <span class="token function">whoami</span>

  Group name: ddl  <span class="token comment">#ddl相关操作命令</span>
  Commands: alter, alter_async, alter_status, create, describe, disable, disable_all, drop, drop_all, enable, enable_all, exists, get_table, is_disabled, is_enabled, list, locate_region, show_filters

  Group name: namespace
  Commands: alter_namespace, create_namespace, describe_namespace, drop_namespace, list_namespace, list_namespace_tables

  Group name: dml <span class="token comment">#dml相关操作命令</span>
  Commands: append, count, delete, deleteall, get, get_counter, get_splits, incr, put, scan, truncate, truncate_preserve

  Group name: tools  <span class="token comment">#工具相关操作命令</span>
  Commands: assign, balance_switch, balancer, balancer_enabled, catalogjanitor_enabled, catalogjanitor_run, catalogjanitor_switch, close_region, compact, compact_mob, compact_rs, flush, major_compact, major_compact_mob, merge_region, move, normalize, normalizer_enabled, normalizer_switch, split, trace, unassign, wal_roll, zk_dump

  Group name: replication  <span class="token comment">## 副本相关操作命令</span>
  Commands: add_peer, append_peer_tableCFs, disable_peer, disable_table_replication, enable_peer, enable_table_replication, get_peer_config, list_peer_configs, list_peers, list_replicated_tables, remove_peer, remove_peer_tableCFs, set_peer_tableCFs, show_peer_tableCFs, update_peer_config

  Group name: snapshots <span class="token comment">#快照相关操作命令</span>
  Commands: clone_snapshot, delete_all_snapshot, delete_snapshot, list_snapshots, restore_snapshot, snapshot

  Group name: configuration
  Commands: update_all_config, update_config

  Group name: quotas
  Commands: list_quotas, set_quota

  Group name: security <span class="token comment">#安全相关操作命令</span>
  Commands: grant, list_security_capabilities, revoke, user_permission

  Group name: procedures
  Commands: abort_procedure, list_procedures

  Group name: visibility labels
  Commands: add_labels, clear_auths, get_auths, list_labels, set_auths, set_visibility

  Group name: rsgroup
  Commands: add_rsgroup, balance_rsgroup, get_rsgroup, get_server_rsgroup, get_table_rsgroup, list_rsgroups, move_servers_rsgroup, move_tables_rsgroup, remove_rsgroup
</code></pre></div><h6 id="使用help查看具体命令的使用方法"><a href="#使用help查看具体命令的使用方法" class="header-anchor">#</a> 使用help查看具体命令的使用方法</h6> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:072:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token builtin class-name">help</span> <span class="token string">'put'</span>
Put a cell <span class="token string">'value'</span> at specified table/row/column and optionally
timestamp coordinates.  To put a cell value into table <span class="token string">'ns1:t1'</span> or <span class="token string">'t1'</span>
at row <span class="token string">'r1'</span> under <span class="token function">column</span> <span class="token string">'c1'</span> marked with the <span class="token function">time</span> <span class="token string">'ts1'</span>, do:

  hbase<span class="token operator">&gt;</span> put <span class="token string">'ns1:t1'</span>, <span class="token string">'r1'</span>, <span class="token string">'c1'</span>, <span class="token string">'value'</span>
  hbase<span class="token operator">&gt;</span> put <span class="token string">'t1'</span>, <span class="token string">'r1'</span>, <span class="token string">'c1'</span>, <span class="token string">'value'</span>
  hbase<span class="token operator">&gt;</span> put <span class="token string">'t1'</span>, <span class="token string">'r1'</span>, <span class="token string">'c1'</span>, <span class="token string">'value'</span>, ts1
  hbase<span class="token operator">&gt;</span> put <span class="token string">'t1'</span>, <span class="token string">'r1'</span>, <span class="token string">'c1'</span>, <span class="token string">'value'</span>, <span class="token punctuation">{</span>ATTRIBUTES<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token string">'mykey'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'myvalue'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
  hbase<span class="token operator">&gt;</span> put <span class="token string">'t1'</span>, <span class="token string">'r1'</span>, <span class="token string">'c1'</span>, <span class="token string">'value'</span>, ts1, <span class="token punctuation">{</span>ATTRIBUTES<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token string">'mykey'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'myvalue'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
  hbase<span class="token operator">&gt;</span> put <span class="token string">'t1'</span>, <span class="token string">'r1'</span>, <span class="token string">'c1'</span>, <span class="token string">'value'</span>, ts1, <span class="token punctuation">{</span>VISIBILITY<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'PRIVATE|SECRET'</span><span class="token punctuation">}</span>

The same commands also can be run on a table reference. Suppose you had a reference
t to table <span class="token string">'t1'</span>, the corresponding <span class="token builtin class-name">command</span> would be:

  hbase<span class="token operator">&gt;</span> t.put <span class="token string">'r1'</span>, <span class="token string">'c1'</span>, <span class="token string">'value'</span>, ts1, <span class="token punctuation">{</span>ATTRIBUTES<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token string">'mykey'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'myvalue'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="create-创建表"><a href="#create-创建表" class="header-anchor">#</a> create 创建表</h4> <ul><li>创建user表，包含info、data两个列族</li> <li>使用create命令</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">## 第一种方式:</span>
HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:010:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> create <span class="token string">'user'</span>, <span class="token string">'info'</span>, <span class="token string">'data'</span>
<span class="token comment">#user是表名，info和data是列族名称。</span>

<span class="token comment">#第二种方式:</span>
HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:010:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> create <span class="token string">'user'</span>, <span class="token punctuation">{</span>NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'info'</span>, VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'3'</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span>NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'data'</span><span class="token punctuation">}</span>
<span class="token comment">## user是表名</span>
<span class="token comment">## {NAME =&gt; 'info', VERSIONS =&gt; '3'}是一个名称为info，数据的版本个数为3的列族</span>
<span class="token comment">## {NAME =&gt; 'data'}也是一个列族</span>
<span class="token comment">## NAME和VERSION必须写成大写！！！！！！！否则报错。</span>
</code></pre></div><h4 id="list-查看有哪些表"><a href="#list-查看有哪些表" class="header-anchor">#</a> list 查看有哪些表</h4> <ul><li>查看当前数据库中有哪些表</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:001:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> list
TABLE                                                                                 user                                                                                   <span class="token number">1</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.2340</span> seconds

<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h4 id="put-插入数据操作"><a href="#put-插入数据操作" class="header-anchor">#</a> put 插入数据操作</h4> <ul><li>向表中插入数据</li> <li>使用put命令，语法格式：put 表 行键 列族:列 值</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#向user表中插入信息，row key为rk0001，列族info中添加名为name的列，值为zhangsan</span>
HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:011:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> put <span class="token string">'user'</span>, <span class="token string">'rk0001'</span>, <span class="token string">'info:name'</span>, <span class="token string">'zhangsan'</span>

<span class="token comment">#向user表中插入信息，row key为rk0001，列族info中添加名为gender的列，值为female</span>
HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:012:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> put <span class="token string">'user'</span>, <span class="token string">'rk0001'</span>, <span class="token string">'info:gender'</span>, <span class="token string">'female'</span>

<span class="token comment">#向user表中插入信息，row key为rk0001，列族info中添加名为age的列，值为20</span>
HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:013:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> put <span class="token string">'user'</span>, <span class="token string">'rk0001'</span>, <span class="token string">'info:age'</span>, <span class="token number">20</span>

<span class="token comment">#向user表中插入信息，row key为rk0001，列族info中添加名为pic的列，值为picture</span>
HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:014:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> put <span class="token string">'user'</span>, <span class="token string">'rk0001'</span>, <span class="token string">'info:pic'</span>, <span class="token string">'picture'</span>

<span class="token comment">#向user表中插入信息，row key为rk0001，列族data中添加名为passwd的列，值为123456</span>
HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:015:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> put <span class="token string">'user'</span>, <span class="token string">'rk0001'</span>, <span class="token string">'data:passwd'</span>, <span class="token string">'123456'</span>
</code></pre></div><h2 id="hbase-shell命令-查询数据操作"><a href="#hbase-shell命令-查询数据操作" class="header-anchor">#</a> Hbase shell命令--查询数据操作</h2> <h4 id="使用get命令-按指定rowkey获取唯一一条记录"><a href="#使用get命令-按指定rowkey获取唯一一条记录" class="header-anchor">#</a> 使用get命令（按指定RowKey获取唯一一条记录)</h4> <h5 id="通过rowkey进行查询一整行"><a href="#通过rowkey进行查询一整行" class="header-anchor">#</a> 通过rowkey进行查询一整行</h5> <ul><li>获取user表中row key为rk0001的所有信息（即所有cell的数据）</li> <li>使用get命令</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:014:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'user'</span>, <span class="token string">'rk0001'</span>
COLUMN                                         CELL                                   
 data:passwd                                   <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805625140</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">123456</span> 
 info:age                                      <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805615189</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>     
 info:gender                                   <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805610807</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>female 
 info:name                                     <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan
 info:pic                                      <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805619167</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>picture 

<span class="token comment">## 可以看到，以下数据是按字典顺序排序的</span>
 data:passwd
 info:age
 info:gender
 info:name
 info:pic
<span class="token comment">## 以下是时间戳</span>
<span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805625140</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">123456</span> 
<span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805615189</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>     
<span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805610807</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>female 
<span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan
<span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805619167</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>picture
</code></pre></div><h5 id="查看rowkey下某个列族的信息"><a href="#查看rowkey下某个列族的信息" class="header-anchor">#</a> 查看rowkey下某个列族的信息</h5> <ul><li>获取user表中row key为rk0001，info列族的所有信息</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:015:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'user'</span>,<span class="token string">'rk0001'</span>,<span class="token string">'info'</span>
COLUMN                                         CELL                                   
 info:age                                      <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805615189</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>     
 info:gender                                   <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805610807</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>female 
 info:name                                     <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan
 info:pic                                      <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805619167</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>picture 
</code></pre></div><h5 id="查看rowkey指定列族指定字段的值"><a href="#查看rowkey指定列族指定字段的值" class="header-anchor">#</a> 查看rowkey指定列族指定字段的值</h5> <ul><li>获取user表中row key为rk0001，info列族的name、age列的信息</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:016:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'user'</span>,<span class="token string">'rk0001'</span>,<span class="token string">'info:name'</span>
COLUMN                                         CELL                                   
 info:name                                     <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan
</code></pre></div><h5 id="查看rowkey指定多个列族的信息"><a href="#查看rowkey指定多个列族的信息" class="header-anchor">#</a> 查看rowkey指定多个列族的信息</h5> <ul><li>获取user表中row key为rk0001，info、data列族的信息</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:018:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'user'</span>, <span class="token string">'rk0001'</span>, <span class="token string">'info'</span>, <span class="token string">'data'</span>
COLUMN                                         CELL                                   
 data:passwd                                   <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805625140</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">123456</span> 
 info:age                                      <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805615189</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>     
 info:gender                                   <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805610807</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>female 
 info:name                                     <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan
 info:pic                                      <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805619167</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>picture 

<span class="token comment">#或者你也可以这样写</span>
HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:019:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'user'</span>, <span class="token string">'rk0001'</span>, <span class="token punctuation">{</span>COLUMN <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">'info'</span>, <span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>


<span class="token comment">#或者你也可以这样写，也行</span>
hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:019:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'user'</span>, <span class="token string">'rk0001'</span>, <span class="token punctuation">{</span>COLUMN <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">'info:name'</span>, <span class="token string">'data:passwd'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
COLUMN                                         CELL                                   
 data:passwd                                   <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805625140</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">123456</span> 
 info:name                                     <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan
</code></pre></div><h5 id="指定rowkey与列值过滤器查询"><a href="#指定rowkey与列值过滤器查询" class="header-anchor">#</a> 指定rowkey与列值过滤器查询</h5> <ul><li>获取user表中row key为rk0001，cell的值为zhangsan的信息</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:026:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'user'</span>,<span class="token string">'rk0001'</span>,<span class="token punctuation">{</span>FILTER <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;ValueFilter(=,'binary:zhangsan')&quot;</span><span class="token punctuation">}</span>
COLUMN                  CELL                                                           
 info:name              <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan    

<span class="token comment">## 特别注意ValueFilter的V是大写的！！！</span>
</code></pre></div><h5 id="指定rowkey与列名模糊查询"><a href="#指定rowkey与列名模糊查询" class="header-anchor">#</a> 指定rowkey与列名模糊查询</h5> <ul><li>获取user表中row key为rk0001，列标识符中含有a的信息</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:028:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'user'</span>,<span class="token string">'rk0001'</span>,<span class="token punctuation">{</span>FILTER <span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">&quot;QualifierFilter(=,'substring:a')&quot;</span><span class="token punctuation">}</span>
COLUMN                  CELL                                                        
 data:passwd            <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805625140</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">123456</span>                       
 info:age               <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805615189</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>                           
 info:name              <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan                     


<span class="token comment">## 继续插入一批数据</span>
HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:032:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> put <span class="token string">'user'</span>, <span class="token string">'rk0002'</span>, <span class="token string">'info:name'</span>, <span class="token string">'fanbingbing'</span>
HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:033:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> put <span class="token string">'user'</span>, <span class="token string">'rk0002'</span>, <span class="token string">'info:gender'</span>, <span class="token string">'female'</span>
HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:034:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> put <span class="token string">'user'</span>, <span class="token string">'rk0002'</span>, <span class="token string">'info:nationality'</span>, <span class="token string">'中国'</span>
hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:035:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'user'</span>, <span class="token string">'rk0002'</span>, <span class="token punctuation">{</span>FILTER <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;ValueFilter(=, 'binary:中国')&quot;</span><span class="token punctuation">}</span>
COLUMN                  CELL                                                        
 info:nationality       <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582809090676</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>xAD<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xBD    
</code></pre></div><h5 id="查看指定第几个版本的数据"><a href="#查看指定第几个版本的数据" class="header-anchor">#</a> 查看指定第几个版本的数据</h5> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#查看第5个版本的数据</span>
hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:025:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'versionTTL_test'</span>,<span class="token string">'rk001'</span>,<span class="token punctuation">{</span>COLUMN<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'f1:age'</span>,VERSION<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token number">5</span><span class="token punctuation">}</span>
COLUMN                           CELL                                                 f1:age                          <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583522558368</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal5                                                                                                   
<span class="token number">1</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.0220</span> seconds
</code></pre></div><h5 id="查看多个版本的数据"><a href="#查看多个版本的数据" class="header-anchor">#</a> 查看多个版本的数据</h5> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#查看最新5个版本的数据</span>
hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:026:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'versionTTL_test'</span>,<span class="token string">'rk001'</span>,<span class="token punctuation">{</span>COLUMN<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'f1:age'</span>,VERSIONS<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token number">5</span><span class="token punctuation">}</span>
COLUMN                          CELL                                   
f1:age                          <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583522558368</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal5              f1:age                          <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583522558362</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal4 
f1:age                          <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583522558346</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal3               f1:age                          <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583522558341</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal2             
f1:age                          <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583522558335</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal1 
</code></pre></div><p>修改版本个数的方法：</p> <div class="language- extra-class"><pre class="language-text"><code>hbase是一个多版本的管理系统，在0.96的版本之前默认每个列是3个version，在hbase 0.96之后每个列是1个version
alter 'hbase1',{NAME=&gt;'cf',VERSIONS=&gt;3}
</code></pre></div><h4 id="使用scan命令-按指定的条件获取一批记录"><a href="#使用scan命令-按指定的条件获取一批记录" class="header-anchor">#</a> 使用scan命令（按指定的条件获取一批记录）</h4> <h5 id="查询所有行的数据"><a href="#查询所有行的数据" class="header-anchor">#</a> 查询所有行的数据</h5> <ul><li>查询user表中的所有信息</li> <li>使用scan命令</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:032:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>  scan <span class="token string">'user'</span>
ROW                     COLUMN+CELL                                              
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>data:passwd, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805625140</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">123456</span>
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805615189</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>       
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:gender, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805610807</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>female
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:pic, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805619167</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>picture  
</code></pre></div><h5 id="列族查询"><a href="#列族查询" class="header-anchor">#</a> 列族查询</h5> <ul><li>查询user表中列族为info的信息</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>scan <span class="token string">'user'</span>, <span class="token punctuation">{</span><span class="token environment constant">COLUMNS</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'info'</span><span class="token punctuation">}</span>
ROW                     COLUMN+CELL                                                   
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>data:passwd, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805625140</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">123456</span>  

<span class="token comment">#当某些列的值删除后，具体的数据并不会马上从存储文件中删除,查询的时候，不显示被删除的数据,如果要查询已经被删除的数据，添加RAW=&gt;true</span>
scan <span class="token string">'user'</span>, <span class="token punctuation">{</span><span class="token environment constant">COLUMNS</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'info'</span>, RAW <span class="token operator">=</span><span class="token operator">&gt;</span> true, VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">}</span>
scan <span class="token string">'user'</span>, <span class="token punctuation">{</span><span class="token environment constant">COLUMNS</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'info'</span>, RAW <span class="token operator">=</span><span class="token operator">&gt;</span> true, VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">}</span>
</code></pre></div><h5 id="多列族查询"><a href="#多列族查询" class="header-anchor">#</a> 多列族查询</h5> <ul><li>查询user表中列族为info和data的信息</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:038:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'user'</span>, <span class="token punctuation">{</span><span class="token environment constant">COLUMNS</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">'info'</span>, <span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
ROW                 COLUMN+CELL                                                   
 rk0001             <span class="token assign-left variable">column</span><span class="token operator">=</span>data:passwd, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805625140</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">123456</span>     
 rk0001             <span class="token assign-left variable">column</span><span class="token operator">=</span>info:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805615189</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>             
 rk0001             <span class="token assign-left variable">column</span><span class="token operator">=</span>info:gender, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805610807</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>female     
 rk0001             <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan     
 rk0001             <span class="token assign-left variable">column</span><span class="token operator">=</span>info:pic, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805619167</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>picture       
 rk0002             <span class="token assign-left variable">column</span><span class="token operator">=</span>info:gender, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582809086308</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>female     
 rk0002             <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582809082232</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>fanbingbing   
 rk0002             <span class="token assign-left variable">column</span><span class="token operator">=</span>info:nationality, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582809090676</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>x
                        AD<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xBD  
</code></pre></div><h5 id="指定列族与某个列名查询"><a href="#指定列族与某个列名查询" class="header-anchor">#</a> 指定列族与某个列名查询</h5> <ul><li>查询user表中列族为info、列标示符为name的信息</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>scan <span class="token string">'user'</span>,<span class="token punctuation">{</span><span class="token environment constant">COLUMNS</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'info:name'</span><span class="token punctuation">}</span>
ROW                     COLUMN+CELL                                                   
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan     
 rk0002                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582809082232</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>fanbingbing  
</code></pre></div><ul><li>查询info:name列、data:passwd列的数据</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>scan <span class="token string">'user'</span>,<span class="token punctuation">{</span><span class="token environment constant">COLUMNS</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token string">'info:name'</span>,<span class="token string">'data:passwd'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
ROW                     COLUMN+CELL                                                   
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>data:passwd, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805625140</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">123456</span>    
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan     
 rk0002                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582809082232</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>fanbingbing 
</code></pre></div><ul><li>查询user表中列族为info、列标示符为name的信息,并且版本最新的5个</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>scan <span class="token string">'user'</span>,<span class="token punctuation">{</span><span class="token environment constant">COLUMNS</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'info:name'</span>,VERSION<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token number">5</span><span class="token punctuation">}</span>
ROW                     COLUMN+CELL                                                   
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan     
 rk0002                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582809082232</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>fanbingbing   
</code></pre></div><h5 id="指定多个列族与按照数据值模糊查询"><a href="#指定多个列族与按照数据值模糊查询" class="header-anchor">#</a> 指定多个列族与按照数据值模糊查询</h5> <ul><li>查询user表中列族为info和data且列标示符中含有ag字符的信息</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>scan <span class="token string">'user'</span>,<span class="token punctuation">{</span><span class="token environment constant">COLUMNS</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'info'</span>,FILTER<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">&quot;(QualifierFilter(=,'substring:ag'))&quot;</span><span class="token punctuation">}</span>
ROW                     COLUMN+CELL                                                   
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805615189</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>     
</code></pre></div><h5 id="指定rowkey的范围查询"><a href="#指定rowkey的范围查询" class="header-anchor">#</a> 指定rowkey的范围查询</h5> <ul><li>查询user表中列族为info，rk范围是[rk0001, rk0002)的数据,注意是左闭右开。</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>scan <span class="token string">'user'</span>,<span class="token punctuation">{</span><span class="token environment constant">COLUMNS</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'info'</span>,STARTROW<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'rk0001'</span>,ENDROW<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'rk0002'</span><span class="token punctuation">}</span>
ROW                     COLUMN+CELL                                                   
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805615189</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>             
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:gender, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805610807</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>female     
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan     
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:pic, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805619167</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>picture      
</code></pre></div><h5 id="指定rowkey模糊查询"><a href="#指定rowkey模糊查询" class="header-anchor">#</a> 指定rowkey模糊查询</h5> <ul><li>查询user表中row key以rk字符开头的数据</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:001:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'user'</span>,<span class="token punctuation">{</span>FILTER<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">&quot;PrefixFilter('rk')&quot;</span><span class="token punctuation">}</span>
ROW                     COLUMN+CELL                                                   
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>data:passwd, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805625140</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">123456</span>     
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805615189</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>             
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:gender, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805610807</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>female     
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan     
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:pic, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805619167</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>picture       
 rk0002                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:gender, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582809086308</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>female     
 rk0002                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582809082232</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>fanbingbing   
 rk0002                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:nationality, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582809090676</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>x
                        AD<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xBD  
</code></pre></div><h5 id="指定数据版本的范围查询"><a href="#指定数据版本的范围查询" class="header-anchor">#</a> 指定数据版本的范围查询</h5> <ul><li>查询user表中指定范围的数据,左闭右开。</li></ul> <div class="language-SH extra-class"><pre class="language-sh"><code>scan <span class="token string">'user'</span>,<span class="token punctuation">{</span>TIMERANGE<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token number">1582805606706,1582805619167</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
ROW                     COLUMN+CELL                                                   
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805615189</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>             
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:gender, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805610807</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>female     
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582805606706</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan  
</code></pre></div><h2 id="更新数据操作"><a href="#更新数据操作" class="header-anchor">#</a> 更新数据操作</h2> <h5 id="更新数据值"><a href="#更新数据值" class="header-anchor">#</a> 更新数据值</h5> <ul><li>更新操作同插入操作一模一样，只不过有数据就更新，没数据就添加</li> <li>使用put命令</li></ul> <h5 id="更新版本号"><a href="#更新版本号" class="header-anchor">#</a> 更新版本号</h5> <ul><li>将user表的f1列族版本数改为5</li></ul> <div class="language- extra-class"><pre class="language-text"><code>HBase(main):050:0&gt; alter 'user', NAME =&gt; 'info', VERSIONS =&gt; 5
</code></pre></div><h2 id="删除数据以及删除表操作"><a href="#删除数据以及删除表操作" class="header-anchor">#</a> 删除数据以及删除表操作</h2> <h5 id="指定rowkey以及列名进行删除"><a href="#指定rowkey以及列名进行删除" class="header-anchor">#</a> 指定rowkey以及列名进行删除</h5> <ul><li>删除user表row key为rk0001，列标示符为info:name的数据</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:045:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> delete <span class="token string">'user'</span>, <span class="token string">'rk0001'</span>, <span class="token string">'info:name'</span>
</code></pre></div><h5 id="指定rowkey-列名以及版本号进行删除"><a href="#指定rowkey-列名以及版本号进行删除" class="header-anchor">#</a> 指定rowkey，列名以及版本号进行删除</h5> <ul><li>删除user表row key为rk0001，列标示符为info:name，timestamp为1392383705316的数据</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>delete <span class="token string">'user'</span>, <span class="token string">'rk0001'</span>, <span class="token string">'info:name'</span>, <span class="token number">1582809082232</span>
</code></pre></div><h5 id="删除一个列族"><a href="#删除一个列族" class="header-anchor">#</a> 删除一个列族</h5> <ul><li>删除一个列族：</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>alter <span class="token string">'user'</span>, NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'info'</span>, METHOD <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'delete'</span> 

<span class="token comment">## 或 </span>

alter <span class="token string">'user'</span>, <span class="token string">'delete'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'info'</span>
</code></pre></div><h5 id="清空表数据"><a href="#清空表数据" class="header-anchor">#</a> 清空表数据</h5> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">HBase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">017</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> truncate <span class="token string">'user'</span>
</code></pre></div><h5 id="删除表"><a href="#删除表" class="header-anchor">#</a> 删除表</h5> <ul><li>首先需要先让该表为disable状态，使用命令：</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:049:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> disable <span class="token string">'user'</span>
</code></pre></div><ul><li>然后使用drop命令删除这个表</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code> HBase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:050:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> drop <span class="token string">'user'</span>
</code></pre></div><p>注意：如果直接drop表，会报错：Drop the named table. Table must first be disabled</p> <h2 id="hbase的高级shell管理命令"><a href="#hbase的高级shell管理命令" class="header-anchor">#</a> HBase的高级shell管理命令</h2> <h4 id="status-显示服务器状态"><a href="#status-显示服务器状态" class="header-anchor">#</a> status--显示服务器状态</h4> <ul><li>例如：显示服务器状态</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:028:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> status <span class="token string">'node01'</span>
<span class="token number">1</span> active master, <span class="token number">1</span> backup masters, <span class="token number">3</span> servers, <span class="token number">0</span> dead, <span class="token number">1.0000</span> average load
</code></pre></div><h4 id="whoami-显示hbase用户"><a href="#whoami-显示hbase用户" class="header-anchor">#</a> whoami--显示hbase用户</h4> <ul><li>显示HBase当前用户，例如：</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:029:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token function">whoami</span>
hadoop <span class="token punctuation">(</span>auth:SIMPLE<span class="token punctuation">)</span>
    groups: hadoop
</code></pre></div><h4 id="list-显示所有表"><a href="#list-显示所有表" class="header-anchor">#</a> list--显示所有表</h4> <ul><li>显示当前所有的表</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:030:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> list
TABLE                                                                                
user                                                                                   
<span class="token number">1</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.0140</span> seconds

<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h4 id="count-统计记录数"><a href="#count-统计记录数" class="header-anchor">#</a> count--统计记录数</h4> <ul><li>统计指定表的记录数，例如：</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:050:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'user'</span>
ROW                     COLUMN+CELL                                                   
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>data:d1, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582825327219</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">520</span>             
 rk0001                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582825159368</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>jimmy         
 rk0002                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582825183959</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal       
 rk0003                 <span class="token assign-left variable">column</span><span class="token operator">=</span>data:d1, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582825350048</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">1314</span>           
 rk0003                 <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582825254931</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>god           


hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:051:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> count <span class="token string">'user'</span>
<span class="token number">3</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.0210</span> seconds

<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">3</span>
</code></pre></div><h4 id="describe-显示表结构"><a href="#describe-显示表结构" class="header-anchor">#</a> describe--显示表结构</h4> <ul><li>展示表结构信息</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:054:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> describe <span class="token string">'user'</span>
Table user is ENABLED                                                                     
user                                                                                      
COLUMN FAMILIES DESCRIPTION                                                               
<span class="token punctuation">{</span>NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'data'</span>, BLOOMFILTER <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'ROW'</span>, VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'1'</span>, IN_MEMORY <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'false'</span>, KEEP_DELETED
_CELLS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FALSE'</span>, DATA_BLOCK_ENCODING <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span>, TTL <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FOREVER'</span>, COMPRESSION <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span>,
 MIN_VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span>, BLOCKCACHE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'true'</span>, BLOCKSIZE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'65536'</span>, REPLICATION_SCOPE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span>
<span class="token punctuation">}</span>                                                                                         
<span class="token punctuation">{</span>NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'info'</span>, BLOOMFILTER <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'ROW'</span>, VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'1'</span>, IN_MEMORY <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'false'</span>, KEEP_DELETED
_CELLS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FALSE'</span>, DATA_BLOCK_ENCODING <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span>, TTL <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FOREVER'</span>, COMPRESSION <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span>,
 MIN_VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span>, BLOCKCACHE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'true'</span>, BLOCKSIZE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'65536'</span>, REPLICATION_SCOPE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span>
<span class="token punctuation">}</span>                
</code></pre></div><h4 id="exists-判断表是否存在"><a href="#exists-判断表是否存在" class="header-anchor">#</a> exists--判断表是否存在</h4> <ul><li>检查表是否存在，适用于表量特别多的情况</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:056:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> exists <span class="token string">'user'</span>
Table user does exist     
</code></pre></div><h4 id="is-enabled-is-disabled-判断是否启用-禁用表"><a href="#is-enabled-is-disabled-判断是否启用-禁用表" class="header-anchor">#</a> is_enabled/is_disabled--判断是否启用/禁用表</h4> <ul><li>检查表是否启用或禁用</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:060:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> is_enabled <span class="token string">'user'</span>
<span class="token boolean">true</span>                                                                                   
<span class="token number">0</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.0220</span> seconds

hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:062:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> is_disabled <span class="token string">'user'</span>
<span class="token boolean">false</span>                                                                                 
<span class="token number">0</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.0090</span> seconds
</code></pre></div><h4 id="alter-增加-删除列族"><a href="#alter-增加-删除列族" class="header-anchor">#</a> alter--增加/删除列族</h4> <ul><li><strong>为当前表增加列族：</strong></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:064:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> alter <span class="token string">'user'</span>, NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'CF2'</span>, VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2</span>

hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:065:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> describe <span class="token string">'user'</span>
Table user is ENABLED                                                                     
user                                                                                      
COLUMN FAMILIES DESCRIPTION                                                               
<span class="token punctuation">{</span>NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'CF2'</span>, BLOOMFILTER <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'ROW'</span>, VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'1'</span>, IN_MEMORY <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'false'</span>, KEEP_DELETED_
CELLS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FALSE'</span>, DATA_BLOCK_ENCODING <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span>, TTL <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FOREVER'</span>, COMPRESSION <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span>, 
MIN_VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span>, BLOCKCACHE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'true'</span>, BLOCKSIZE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'65536'</span>, REPLICATION_SCOPE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span>NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'data'</span>, BLOOMFILTER <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'ROW'</span>, VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'1'</span>, IN_MEMORY <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'false'</span>, KEEP_DELETED
_CELLS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FALSE'</span>, DATA_BLOCK_ENCODING <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span>, TTL <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FOREVER'</span>, COMPRESSION <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span>,
 MIN_VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span>, BLOCKCACHE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'true'</span>, BLOCKSIZE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'65536'</span>, REPLICATION_SCOPE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span>
<span class="token punctuation">}</span>                                                                                         
<span class="token punctuation">{</span>NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'info'</span>, BLOOMFILTER <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'ROW'</span>, VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'1'</span>, IN_MEMORY <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'false'</span>, KEEP_DELETED
_CELLS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FALSE'</span>, DATA_BLOCK_ENCODING <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span>, TTL <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FOREVER'</span>, COMPRESSION <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span>,
 MIN_VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span>, BLOCKCACHE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'true'</span>, BLOCKSIZE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'65536'</span>, REPLICATION_SCOPE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span>
<span class="token punctuation">}</span>                         
</code></pre></div><ul><li><strong>为当前表删除列族：</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>HBase(main):002:0&gt;  alter 'user', 'delete' =&gt; 'CF2'
</code></pre></div><h4 id="disable-enable-启动-禁用表"><a href="#disable-enable-启动-禁用表" class="header-anchor">#</a> disable/enable--启动/禁用表</h4> <ul><li>禁用一张表/启用一张表</li></ul> <div class="language- extra-class"><pre class="language-text"><code>HBase&gt; disable 'user'
HBase&gt; enable 'user'
</code></pre></div><h4 id="drop-删除表"><a href="#drop-删除表" class="header-anchor">#</a> drop--删除表</h4> <ul><li>删除一张表，记得在删除表之前必须先禁用</li></ul> <h4 id="truncate"><a href="#truncate" class="header-anchor">#</a> truncate</h4> <ul><li>禁用表-删除表-创建表</li></ul> <h2 id="hbase的javaapi操作-重点"><a href="#hbase的javaapi操作-重点" class="header-anchor">#</a> HBase的JavaAPI操作（重点）</h2> <ul><li>HBase是一个分布式的NoSql数据库，在实际工作当中，我们一般都可以通过JavaAPI来进行各种数据的操作，包括创建表，以及数据的增删改查等等。在工作当中，大多数情况是使用编程，而不是使用hbase shell命令，但是，在做一些快速测试的时候，还是shell命令更高效点。</li></ul> <h4 id="创建maven工程"><a href="#创建maven工程" class="header-anchor">#</a> 创建maven工程</h4> <ul><li>讲如下内容作为maven工程中pom.xml的repositories的内容</li> <li>自动导包（需要从cloudera仓库下载，耗时较长，耐心等待)</li> <li>创建一个测试类，路径：src/test/java/MyTestClass.java</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cloudera<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-mr1-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hbase-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hbase-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.14.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-shade-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>shade<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filters</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifact</span><span class="token punctuation">&gt;</span></span>*:*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifact</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*.SF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*.DSA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*/RSA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filters</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="创建myuser表"><a href="#创建myuser表" class="header-anchor">#</a> 创建myuser表</h4> <ul><li>创建myuser表，此表有两个列族f1和f2</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HColumnDescriptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HTableDescriptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Admin</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTestClass</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//连接HBase集群不需要指定HBase主节点的ip地址和端口号:</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//指定hbase对应的zookeeper集群,2181是客户端与zookeeper集群连接的端口号</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建客户端与hbase的连接对象</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取admin对象</span>
        <span class="token class-name">Admin</span> am<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//指定表名</span>
        <span class="token class-name">TableName</span> tName<span class="token operator">=</span> <span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;myuser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HTableDescriptor</span> htds<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HTableDescriptor</span><span class="token punctuation">(</span>tName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//指定表的列族</span>
        <span class="token comment">//public HColumnDescriptor(final String familyName)</span>
        htds<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HColumnDescriptor</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        htds<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HColumnDescriptor</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//使用admin对象创建表</span>
        am<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span>htds<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//释放资源</span>
        am<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>补充说明：</p> <div class="language- extra-class"><pre class="language-text"><code>    //查看源码后发现:
    //void createTable(HTableDescriptor desc) throws IOException; 此方法需要HTableDescriptor对象作为参数
    //HTableDescriptor类有构造方法: public HTableDescriptor(final TableName name),此构造方法需要TableName对象
    //TableName类有生成TableName对象的方法：public static TableName valueOf(String name)
    //运行过程中出现了小报错，因为之前不小心移动了windows上的hadoop安装文件夹，导致出现winutils错误，把文件弄回来就解决了，然后重新启动一下IDEA，参考连接：https://blog.csdn.net/abc50319/article/details/80284741
</code></pre></div><img src="hbase.assets/image-20200624230846544.png" alt="image-20200624230846544" style="zoom:50%;"> <p>查看创建表的相关源码的方法（关联hbase源码包,将课件中的hbase-1.2.0-cdh5.14.2-src.tar.gz文件解压即可得到源码包）</p> <video src="E:\LearningAll\8-HadoopEcosystem-Video\md视频\createTable.mp4"></video>
#### 向表中添加数据(一行)
<div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Put</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Table</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTestClass2</span> <span class="token punctuation">{</span>
   <span class="token comment">//创建实例变量</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> cone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Table</span> table1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> tName<span class="token operator">=</span><span class="token string">&quot;myuser&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//建立连接,并获取要添加数据的表的Table对象</span>
    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone<span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        table1<span class="token operator">=</span>cone<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>tName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">/*创建Put对象
        Put没有无参构造,有参构造传入的参数可是字节数组
        数组内容是要修改的数据的行键rowkey的值*/</span>
        <span class="token class-name">Put</span> put1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token string">&quot;00001&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*添加数据：
        public Put addColumn(byte [] family, byte [] qualifier, byte [] value) */</span>
        put1<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put1<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;krystal&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put1<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put1<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;adress&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;地球人&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        table1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>put1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token comment">//关闭资源</span>
    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        table1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>观察效果:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:010:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'myuser'</span>
ROW                 COLUMN+CELL                                                   
 00001              <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:adress, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582836163648</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x9C<span class="token punctuation">\</span>xB0<span class="token punctuation">\</span>xE7<span class="token punctuation">\</span>
                        x90<span class="token punctuation">\</span>x83<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xBA                                           
 00001              <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582836163648</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x12 
 00001              <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:id, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582836163648</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x19 
 00001              <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582836163648</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal  
</code></pre></div><h4 id="向表中批量添加数据-多行"><a href="#向表中批量添加数据-多行" class="header-anchor">#</a> 向表中批量添加数据（多行）</h4> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token comment">/**
     * hbase的批量插入数据
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">batchInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建put对象，并指定rowkey</span>
        <span class="token class-name">Put</span> put <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token string">&quot;0002&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//f1</span>
        put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;曹操&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//f2</span>
        put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;sex&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;沛国谯县&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;16888888888&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;say&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Put</span> put2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token string">&quot;0003&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put2<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put2<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;刘备&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put2<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put2<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;sex&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put2<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;幽州涿郡涿县&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put2<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;17888888888&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put2<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;say&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;talk is cheap , show me the code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Put</span> put3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token string">&quot;0004&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put3<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put3<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;孙权&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put3<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put3<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;sex&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put3<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;下邳&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put3<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;12888888888&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put3<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;say&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;what are you 弄啥嘞！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Put</span> put4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token string">&quot;0005&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put4<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put4<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;诸葛亮&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put4<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put4<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;sex&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put4<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;四川隆中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put4<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;14888888888&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put4<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;say&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;出师表你背了嘛&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Put</span> put5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token string">&quot;0006&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put5<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put5<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;司马懿&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put5<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put5<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;sex&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put5<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;哪里人有待考究&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put5<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;15888888888&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put5<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;say&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;跟诸葛亮死掐&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">Put</span> put6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token string">&quot;0007&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put6<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put6<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;xiaobubu—吕布&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put6<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put6<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;sex&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put6<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;内蒙人&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put6<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;15788888888&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put6<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;say&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;貂蝉去哪了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Put</span><span class="token punctuation">&gt;</span></span> listPut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Put</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        listPut<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>put<span class="token punctuation">)</span><span class="token punctuation">;</span>
        listPut<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>put2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        listPut<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>put3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        listPut<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>put4<span class="token punctuation">)</span><span class="token punctuation">;</span>
        listPut<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>put5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        listPut<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>put6<span class="token punctuation">)</span><span class="token punctuation">;</span>

        table<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>listPut<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>查看效果：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:011:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'myuser'</span>
ROW                     COLUMN+CELL                                                       
 00001                  <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:adress, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582836163648</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x9C<span class="token punctuation">\</span>xB0<span class="token punctuation">\</span>xE7<span class="token punctuation">\</span>
                        x90<span class="token punctuation">\</span>x83<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xBA                                               
 00001                  <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582836163648</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x12    
 00001                  <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:id, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582836163648</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x19     
 00001                  <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582836163648</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal            
 0002                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x1E    
 0002                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:id, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x01     
 0002                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xB9<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x9
                        <span class="token number">3</span><span class="token punctuation">\</span>x8D                                                             
 0002                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:address, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>xB2<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xE5
                        <span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xBD<span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>xB0<span class="token punctuation">\</span>xAF<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x8E<span class="token punctuation">\</span>xBF                                  
 0002                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:phone, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">16888888888</span>       
 0002                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:say, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>helloworld          
 0002                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:sex, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">1</span>                   
 0003                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00        
 0003                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:id, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x02     
 0003                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x88<span class="token punctuation">\</span>x98<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>xA
                        <span class="token number">4</span><span class="token punctuation">\</span>x87                                                             
 0003                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:address, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>xB9<span class="token punctuation">\</span>xBD<span class="token punctuation">\</span>xE5
                        <span class="token punctuation">\</span>xB7<span class="token punctuation">\</span>x9E<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>xB6<span class="token punctuation">\</span>xBF<span class="token punctuation">\</span>xE9<span class="token punctuation">\</span>x83<span class="token punctuation">\</span>xA1<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>xB6<span class="token punctuation">\</span>xBF<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x8E<span class="token punctuation">\</span>xBF          
 0003                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:phone, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">17888888888</span>       
 0003                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:say, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>talk is cheap , show
                         me the code                                                      
 0003                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:sex, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">1</span>                   
 0004                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token comment">##       </span>
 0004                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:id, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x03     
 0004                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>xAD<span class="token punctuation">\</span>x99<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x9
                        D<span class="token punctuation">\</span>x83                                                             
 0004                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:address, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>x8B<span class="token punctuation">\</span>xE9
                        <span class="token punctuation">\</span>x82<span class="token punctuation">\</span>xB3                                                          
 0004                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:phone, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">12888888888</span>       
 0004                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:say, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>what are you <span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>xB
                        C<span class="token punctuation">\</span>x84<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x95<span class="token punctuation">\</span>xA5<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x98<span class="token punctuation">\</span>x9E<span class="token punctuation">\</span>xEF<span class="token punctuation">\</span>xBC<span class="token punctuation">\</span>x81                         
 0004                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:sex, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">1</span>                   
 0005                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x1C    
 0005                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:id, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x04     
 0005                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>xAF<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>x9
                        <span class="token number">1</span><span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xAE                                                 
 0005                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:address, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xE5
                        <span class="token punctuation">\</span>xB7<span class="token punctuation">\</span>x9D<span class="token punctuation">\</span>xE9<span class="token punctuation">\</span>x9A<span class="token punctuation">\</span>x86<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>xAD                                  
 0005                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:phone, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">14888888888</span>       
 0005                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:say, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x87<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>xB8
                        <span class="token punctuation">\</span>x88<span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>xA1<span class="token punctuation">\</span>xA8<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBD<span class="token punctuation">\</span>xA0<span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>x83<span class="token punctuation">\</span>x8C<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>x86<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x98<span class="token punctuation">\</span>x9B  
 0005                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:sex, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">1</span>                   
 0006                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x1B    
 0006                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:id, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x05     
 0006                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x8F<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>xE9<span class="token punctuation">\</span>xA
                        <span class="token number">9</span><span class="token punctuation">\</span>xAC<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x87<span class="token punctuation">\</span>xBF                                                 
 0006                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:address, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x93<span class="token punctuation">\</span>xAA<span class="token punctuation">\</span>xE9
                        <span class="token punctuation">\</span>x87<span class="token punctuation">\</span>x8C<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x9C<span class="token punctuation">\</span>x89<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>xBE<span class="token punctuation">\</span>x85<span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>x80<span class="token punctuation">\</span>x83<span class="token punctuation">\</span>xE7<span class="token punctuation">\</span>xA9<span class="token punctuation">\</span>x
                        B6                                                                
 0006                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:phone, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">15888888888</span>       
 0006                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:say, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>xB7<span class="token punctuation">\</span>x9F<span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>xAF
                        <span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>x91<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xAE<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>xAD<span class="token punctuation">\</span>xBB<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x8E<span class="token punctuation">\</span>x90              
 0006                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:sex, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">1</span>                   
 0007                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x1C    
 0007                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:id, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x05     
 0007                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>xiaobubu<span class="token punctuation">\</span>xE2<span class="token punctuation">\</span>x80<span class="token punctuation">\</span>x9
                        <span class="token number">4</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x90<span class="token punctuation">\</span>x95<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>x83                                         
 0007                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:address, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x86<span class="token punctuation">\</span>x85<span class="token punctuation">\</span>xE8
                        <span class="token punctuation">\</span>x92<span class="token punctuation">\</span>x99<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xBA                                              
 0007                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:phone, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">15788888888</span>       
 0007                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:say, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>xB2<span class="token punctuation">\</span>x82<span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>x9D
                        <span class="token punctuation">\</span>x89<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x8E<span class="token punctuation">\</span>xBB<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x93<span class="token punctuation">\</span>xAA<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>x86                          
 0007                   <span class="token assign-left variable">column</span><span class="token operator">=</span>f2:sex, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">1</span>                   
</code></pre></div><h4 id="get查询"><a href="#get查询" class="header-anchor">#</a> Get查询</h4> <ul><li>按照rowkey进行查询，获取所有列的所有值</li> <li>查询主键rowkey为0003的人</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTestClass3</span> <span class="token punctuation">{</span>
    <span class="token comment">//创建实例变量</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> cone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Table</span> table1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> tName<span class="token operator">=</span><span class="token string">&quot;myuser&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//建立连接,并获取要添加数据的表的Table对象</span>
    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone<span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        table1<span class="token operator">=</span>cone<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>tName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取Get对象，指定要查询的rowkey（行范围）</span>
        <span class="token class-name">Get</span> get1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Get</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;0003&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//指定查询的列范围：</span>
        get1<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//查询f1列族的所有列</span>
        get1<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//查询f2列族的phone字段</span>

        <span class="token comment">//获取Result对象</span>
        <span class="token class-name">Result</span> rs<span class="token operator">=</span>table1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>get1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取查询结果的集合（每个单元格的集合）</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cell</span><span class="token punctuation">&gt;</span></span> cells<span class="token operator">=</span>rs<span class="token punctuation">.</span><span class="token function">listCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//遍历cells</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Cell</span> c<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//获取某单元格的信息（所属列族，所属字段，所属行键，单元格的值）</span>
            <span class="token comment">//这些信息通过CellUtil类的静态方法来获得</span>
            <span class="token comment">//用字节数组把这些信息存起来，用于等下打印</span>
            <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> family_name<span class="token operator">=</span> <span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneFamily</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//列族</span>
            <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> col_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneQualifier</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//列名</span>
            <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> rowkey_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneRow</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//行键</span>
            <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> cell_value<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//值</span>

            <span class="token comment">//打印该单元格的信息</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>family_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>col_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>rowkey_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//对字段名（列名）是的进行判断,age和id的值是int类型</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>col_name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span>equals
               <span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>col_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span>cell_value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>cell_value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        table1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行输出结果如下：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>f1	age	0003	<span class="token number">32</span>
f1	<span class="token function">id</span>	0003	<span class="token number">2</span>
f1	name	0003	刘备
f2	phone	0003	<span class="token number">17888888888</span>
</code></pre></div><h4 id="scan查询1-没控制数据量"><a href="#scan查询1-没控制数据量" class="header-anchor">#</a> Scan查询1--没控制数据量</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTestClass3</span> <span class="token punctuation">{</span>
    <span class="token comment">//创建实例变量</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> cone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Table</span> table1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> tName<span class="token operator">=</span><span class="token string">&quot;myuser&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//建立连接,并获取要添加数据的表的Table对象</span>
    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone<span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        table1<span class="token operator">=</span>cone<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>tName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">scanData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取Scan对象，没有指定startRow和stopRow,进行全表扫描</span>
        <span class="token class-name">Scan</span> scan1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//指定查询的列范围：</span>
        scan1<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//查询f1列族的所有列</span>
        scan1<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//查询f2列族的phone字段</span>

        <span class="token comment">//获取ResultScanner对象,该对象有着表里所有的数据，是多条数据</span>
        <span class="token class-name">ResultScanner</span> rsc<span class="token operator">=</span>table1<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>scan1<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">//遍历ResultScanner的每一条数据(一行)，每一条数据都都是封装在Result对象里了</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Result</span> rs<span class="token operator">:</span>rsc<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//获取一条数据的单元格集合</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cell</span><span class="token punctuation">&gt;</span></span> cells<span class="token operator">=</span>rs<span class="token punctuation">.</span><span class="token function">listCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//遍历单元格集合</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Cell</span> c<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> family_name<span class="token operator">=</span> <span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneFamily</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//列族</span>
                <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> col_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneQualifier</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//列名</span>
                <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> rowkey_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneRow</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//行键</span>
                <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> cell_value<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//值</span>

                <span class="token comment">//打印该单元格的信息</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>family_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>col_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>rowkey_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//对字段名（列名）是的进行判断,age和id的值是int类型</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>col_name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span>equals
                   <span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>col_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span>cell_value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>cell_value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        table1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行输出结果如下：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>f1	adress	00001	地球人
f1	age	00001	<span class="token number">18</span>
f1	<span class="token function">id</span>	00001	<span class="token number">25</span>
f1	name	00001	krystal
f1	age	0002	<span class="token number">30</span>
f1	<span class="token function">id</span>	0002	<span class="token number">1</span>
f1	name	0002	曹操
f2	phone	0002	<span class="token number">16888888888</span>
f1	age	0003	<span class="token number">32</span>
f1	<span class="token function">id</span>	0003	<span class="token number">2</span>
f1	name	0003	刘备
f2	phone	0003	<span class="token number">17888888888</span>
f1	age	0004	<span class="token number">35</span>
f1	<span class="token function">id</span>	0004	<span class="token number">3</span>
f1	name	0004	孙权
f2	phone	0004	<span class="token number">12888888888</span>
f1	age	0005	<span class="token number">28</span>
f1	<span class="token function">id</span>	0005	<span class="token number">4</span>
f1	name	0005	诸葛亮
f2	phone	0005	<span class="token number">14888888888</span>
f1	age	0006	<span class="token number">27</span>
f1	<span class="token function">id</span>	0006	<span class="token number">5</span>
f1	name	0006	司马懿
f2	phone	0006	<span class="token number">15888888888</span>
f1	age	0007	<span class="token number">28</span>
f1	<span class="token function">id</span>	0007	<span class="token number">5</span>
f1	name	0007	xiaobubu—吕布
f2	phone	0007	<span class="token number">15788888888</span>
</code></pre></div><h4 id="scan查询2-控制数据量"><a href="#scan查询2-控制数据量" class="header-anchor">#</a> Scan查询2--控制数据量</h4> <p>控制参数解释：</p> <ol><li><p>scan1.setCacheBlocks(true);如果该参数为true，表明我们客户端从HBase拉取数据过来后，会将这些数据放到缓存里，下一次客户端再次查询时，如果缓存里有需要的数据就不从HBase拉取数据了，缓存里没有才会去HBase拿数据</p></li> <li><p>scan1.setCaching(3); 一次读取的最大数据量，以Result为单位</p></li> <li><p>scan1.setBatch(2);控制一个Result中包含cell(单元格)的最大数量</p> <p><img src="/assets/img/image-20200228064430264.c85ece85.png" alt="image-20200228064430264"></p></li> <li><p>scan1.setMaxResultSize(1024);控制单次RPC操作拿到的结果集(Result集)的最大字节数。（客户端缓存的最大字节数）</p></li> <li><p>scan1.setMaxVersions(2);获得每个cell的最新n个版本的值</p></li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTestClass3</span> <span class="token punctuation">{</span>
    <span class="token comment">//创建实例变量</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> cone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Table</span> table1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> tName<span class="token operator">=</span><span class="token string">&quot;myuser&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//建立连接,并获取要添加数据的表的Table对象</span>
    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone<span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        table1<span class="token operator">=</span>cone<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>tName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">scanData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取Scan对象，没有指定startRow和stopRow,进行全表扫描</span>
        <span class="token class-name">Scan</span> scan1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//指定查询的列范围：</span>
        scan1<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//查询f1列族的所有列</span>
        scan1<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//查询f2列族的phone字段</span>

        <span class="token comment">//指定查询的行范围：</span>
        scan1<span class="token punctuation">.</span><span class="token function">setStartRow</span><span class="token punctuation">(</span><span class="token string">&quot;0003&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scan1<span class="token punctuation">.</span><span class="token function">setStopRow</span><span class="token punctuation">(</span><span class="token string">&quot;0007&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//控制一次读取的数据量为3个result</span>
        scan1<span class="token punctuation">.</span><span class="token function">setCaching</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//控制一个Result中包含cell(单元格)的最大数量</span>
        scan1<span class="token punctuation">.</span><span class="token function">setBatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将结果缓存</span>
        scan1<span class="token punctuation">.</span><span class="token function">setCacheBlocks</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//控制单次RPC操作拿到的结果集(Result集)的最大大小</span>
        scan1<span class="token punctuation">.</span><span class="token function">setMaxResultSize</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获得每个cell的最新n个版本的值</span>
        scan1<span class="token punctuation">.</span><span class="token function">setMaxVersions</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取ResultScanner对象,该对象有着表里所有的数据，是多条数据</span>
        <span class="token class-name">ResultScanner</span> rsc<span class="token operator">=</span>table1<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>scan1<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">//遍历ResultScanner的每一条数据(一行)，每一条数据都都是封装在Result对象里了</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Result</span> rs<span class="token operator">:</span>rsc<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//获取一条数据的单元格集合</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cell</span><span class="token punctuation">&gt;</span></span> cells<span class="token operator">=</span>rs<span class="token punctuation">.</span><span class="token function">listCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//遍历单元格集合</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Cell</span> c<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> family_name<span class="token operator">=</span> <span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneFamily</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//列族</span>
                <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> col_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneQualifier</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//列名</span>
                <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> rowkey_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneRow</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//行键</span>
                <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> cell_value<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//值</span>

                <span class="token comment">//打印该单元格的信息</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>family_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>col_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>rowkey_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//对字段名（列名）是的进行判断,age和id的值是int类型</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>col_name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span>equals
                   <span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>col_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span>cell_value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>cell_value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        table1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>运行输出结果如下：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>f1	age	0003	<span class="token number">32</span>
f1	<span class="token function">id</span>	0003	<span class="token number">2</span>
f1	name	0003	刘备
f2	phone	0003	<span class="token number">17888888888</span>
f1	age	0004	<span class="token number">35</span>
f1	<span class="token function">id</span>	0004	<span class="token number">3</span>
f1	name	0004	孙权
f2	phone	0004	<span class="token number">12888888888</span>
f1	age	0005	<span class="token number">28</span>
f1	<span class="token function">id</span>	0005	<span class="token number">4</span>
f1	name	0005	诸葛亮
f2	phone	0005	<span class="token number">14888888888</span>
f1	age	0006	<span class="token number">27</span>
f1	<span class="token function">id</span>	0006	<span class="token number">5</span>
f1	name	0006	司马懿
f2	phone	0006	<span class="token number">15888888888</span>
</code></pre></div><h4 id="拓展-java比较器"><a href="#拓展-java比较器" class="header-anchor">#</a> 拓展：JAVA比较器</h4> <p>java的比较器主要分为两种，第一种是实现Comparable接口的内部比较器，第二种是实现Comparator接口的外部比较器。</p> <p>Comparabel接口的部分源码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">T</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Comparator接口的部分源码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">T</span> o1<span class="token punctuation">,</span> <span class="token class-name">T</span> o2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h6 id="内部比较器-comparable接口"><a href="#内部比较器-comparable接口" class="header-anchor">#</a> 内部比较器--Comparable接口</h6> <p>Comparable接口位于java.lang包下。</p> <p>当需要对某个类(可以是自己定义的)的对象进行排序时候，则需要实现Comparable这个接口，然后重写compareTo方法。我们的类实现这个接口和重写方法后，就可以使用Array.sort()对这个类的实例对象数组进行排序，或者使用Collection.sort对这个类的对象List集合进行排序。我们需要在compareTo方法里定义我们的排序规则。注意：自定义类的时候最好重写顶级父类Object的toString()方法。</p> <p>案例1：内部比较器</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span> <span class="token comment">//这里记得要指定泛型</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> salary<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token keyword">long</span> salary<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> salary<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">&gt;</span> o<span class="token punctuation">.</span>salary<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">&lt;</span> o<span class="token punctuation">.</span>salary<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//默认的toString()方法，调用顶级父类Object的toString()方法</span>
<span class="token comment">//    @Override</span>
<span class="token comment">//    public String toString() {</span>
<span class="token comment">//        return super.toString();</span>
<span class="token comment">//    }</span>

    <span class="token comment">//super.toString()，父类Object的toString源码如下，该方法默认返回类名和hashCode相关信息</span>
<span class="token comment">//    public String toString() {</span>
<span class="token comment">//        return getClass().getName() + &quot;@&quot; + Integer.toHexString(hashCode());</span>
<span class="token comment">//    }</span>

    <span class="token comment">//重写toString()方法</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">RunClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Employee</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ems <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;zhansan&quot;</span><span class="token punctuation">,</span> <span class="token number">23522</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token number">23436</span><span class="token punctuation">,</span> <span class="token number">24000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;laowang&quot;</span><span class="token punctuation">,</span> <span class="token number">235634</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===============使用Arrays.sort()来进行排序&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//排序前</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e<span class="token operator">:</span>ems<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>ems<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//排序后</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e<span class="token operator">:</span>ems<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===============使用Arrays.sort()来进行排序&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> myList<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;zhansan&quot;</span><span class="token punctuation">,</span> <span class="token number">23522</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token number">23436</span><span class="token punctuation">,</span> <span class="token number">24000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token number">23436</span><span class="token punctuation">,</span> <span class="token number">24000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//排序前</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e<span class="token operator">:</span>ems<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>myList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//排序后</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e<span class="token operator">:</span>ems<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行输出结果如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>使用<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>来进行排序
zhansan	<span class="token number">23522</span>	<span class="token number">20000</span>
lisi	<span class="token number">23436</span>	<span class="token number">24000</span>
laowang	<span class="token number">235634</span>	<span class="token number">10000</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
laowang	<span class="token number">235634</span>	<span class="token number">10000</span>
zhansan	<span class="token number">23522</span>	<span class="token number">20000</span>
lisi	<span class="token number">23436</span>	<span class="token number">24000</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>使用<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>来进行排序
laowang	<span class="token number">235634</span>	<span class="token number">10000</span>
zhansan	<span class="token number">23522</span>	<span class="token number">20000</span>
lisi	<span class="token number">23436</span>	<span class="token number">24000</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
laowang	<span class="token number">235634</span>	<span class="token number">10000</span>
zhansan	<span class="token number">23522</span>	<span class="token number">20000</span>
lisi	<span class="token number">23436</span>	<span class="token number">24000</span>
</code></pre></div><h6 id="外部比较器-comparator接口"><a href="#外部比较器-comparator接口" class="header-anchor">#</a> 外部比较器--Comparator接口</h6> <p>Comparatro接口位于java.util包下。</p> <p>Comparator接口是一个跟Comparable接口功能很相近的比较器。比较大的区别是，实现该接口的类一般是一个独立的类。详情看代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> salary<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token keyword">int</span> age<span class="token punctuation">,</span><span class="token keyword">long</span> salary<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>salary<span class="token operator">=</span>salary<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token operator">=</span>age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> salary<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>salary<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//创建年龄比较器：</span>
<span class="token keyword">class</span> <span class="token class-name">AgeComparator</span> <span class="token keyword">implements</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> o1<span class="token punctuation">,</span> <span class="token class-name">Employee</span> o2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o1<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>o2<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>o1<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>o2<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//创建薪水比较器：</span>
<span class="token keyword">class</span> <span class="token class-name">SalaryComparator</span> <span class="token keyword">implements</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> o1<span class="token punctuation">,</span> <span class="token class-name">Employee</span> o2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o1<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> o2<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>o1<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> o2<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">RunClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Employee</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ems <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;zhansan&quot;</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">24000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;laowang&quot;</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===============使用薪水比较器来进行排序&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//排序前</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e<span class="token operator">:</span>ems<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>ems<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">SalaryComparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//使用薪水比较器进行排序</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//排序后</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e<span class="token operator">:</span>ems<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===============使用年龄比较器来进行排序&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> myList<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;zhansan&quot;</span><span class="token punctuation">,</span> <span class="token number">23522</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token number">23436</span><span class="token punctuation">,</span> <span class="token number">24000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token number">23436</span><span class="token punctuation">,</span> <span class="token number">24000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//排序前</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e<span class="token operator">:</span>ems<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>myList<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">AgeComparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//使用年龄比较器进行排序</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//排序后</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e<span class="token operator">:</span>ems<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行输出结果如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>使用薪水比较器来进行排序
zhansan	<span class="token number">26</span>	<span class="token number">30000</span>
lisi	<span class="token number">14</span>	<span class="token number">24000</span>
laowang	<span class="token number">40</span>	<span class="token number">10000</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
laowang	<span class="token number">40</span>	<span class="token number">10000</span>
lisi	<span class="token number">14</span>	<span class="token number">24000</span>
zhansan	<span class="token number">26</span>	<span class="token number">30000</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>使用年龄比较器来进行排序
laowang	<span class="token number">40</span>	<span class="token number">10000</span>
lisi	<span class="token number">14</span>	<span class="token number">24000</span>
zhansan	<span class="token number">26</span>	<span class="token number">30000</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
laowang	<span class="token number">40</span>	<span class="token number">10000</span>
lisi	<span class="token number">14</span>	<span class="token number">24000</span>
zhansan	<span class="token number">26</span>	<span class="token number">30000</span>
</code></pre></div><h6 id="内部与外部比较器的区别"><a href="#内部与外部比较器的区别" class="header-anchor">#</a> 内部与外部比较器的区别：</h6> <p>如果定义一个类的时候，没有考虑到排序的问题，即没有实现Comparable接口,那么就可以通过实现Comparator接口来来进行自定义排序。Comparator可以方便使用不同的排序规则，更加灵活一点。</p> <h4 id="hbase过滤器查询-难点"><a href="#hbase过滤器查询-难点" class="header-anchor">#</a> HBase过滤器查询（难点）</h4> <h5 id="hbase过滤器filter"><a href="#hbase过滤器filter" class="header-anchor">#</a> HBase过滤器Filter</h5> <ul><li><p>过滤器的作用是在服务端判断数据是否满足条件，然后只将满足条件的数据返回给客户端</p></li> <li><p>过滤器的类型很多，但是可以分为两大类</p> <ul><li>==比较过滤器==</li> <li>==专用过滤器==</li></ul></li></ul> <h5 id="hbase比较过滤器的比较器-指定比较机制"><a href="#hbase比较过滤器的比较器-指定比较机制" class="header-anchor">#</a> Hbase比较过滤器的比较器（指定比较机制）：</h5> <p>从上面的java比较器学习中，可以发现，比较器就是一个提供排序和比较规则的东西。那么HBase的比较器搭配HBase过滤器使用，就是一个HBase的比较过滤器。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">BinaryComparator</span>  按字节索引顺序比较指定字节数组，采用<span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">BinaryPrefixComparator</span> 跟前面相同，只是比较左端前缀的数据是否相同
<span class="token class-name">NullComparator</span> 判断给定的是否为空
<span class="token class-name">BitComparator</span> 按位比较
<span class="token class-name">RegexStringComparator</span> 提供一个正则的比较器，仅支持 EQUAL 和非EQUAL
<span class="token class-name">SubstringComparator</span> 判断提供的子串是否出现在中
</code></pre></div><p>上面代码块中的比较器的父类都是ByteArrayComparable类，ByteArrayComparable类的包的位置信息：org.apache.hadoop.hbase.filter.ByteArrayComparable。</p> <p>ByteArrayComparable类实现了来自java的java.lang.Comparable接口。</p> <p><img src="/assets/img/Image201911111059.b868cfee.png" alt=""></p> <h5 id="hbase过滤器的比较运算符"><a href="#hbase过滤器的比较运算符" class="header-anchor">#</a> HBase过滤器的比较运算符：</h5> <p>通过比较器，我们就指定了过滤器的比较机制，有可能还欠一样东西，那就是比较运行符。比如说如果过滤器的比较器是BinaryComparator，那么过滤器就会通过字节索引顺序比较指定字节数组，然后我们的比较运算符是LESS，我们HBase就会查询到符合小于条件的那部分数据。</p> <div class="language-java extra-class"><pre class="language-java"><code>LESS  <span class="token operator">&lt;</span>
LESS_OR_EQUAL <span class="token operator">&lt;=</span>
EQUAL <span class="token operator">=</span>
NOT_EQUAL <span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span>
GREATER_OR_EQUAL <span class="token operator">&gt;=</span>
GREATER <span class="token operator">&gt;</span>
NO_OP 排除所有
</code></pre></div><h5 id="比较过滤器comparefilter"><a href="#比较过滤器comparefilter" class="header-anchor">#</a> 比较过滤器CompareFilter</h5> <p>CompareFilter是一个比较过滤器，它的子类有：</p> <ol><li>ValueFilter  （列值过滤器）</li> <li>QualifierFilter  （列过滤器）</li> <li>DependentColunmFilter</li> <li>FamilyFilter  （列族过滤器）</li> <li>RowFilter (rowkey过滤器)</li></ol> <h5 id="rowfilter-rowkey过滤器"><a href="#rowfilter-rowkey过滤器" class="header-anchor">#</a> RowFilter--rowkey过滤器</h5> <p>案例需求：通过RowFilter过滤比rowKey 0003小的所有值出来。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>hbase01</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">BinaryComparator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">CompareFilter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">RowFilter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRowFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> cone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Table</span> t1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> t_name <span class="token operator">=</span> <span class="token string">&quot;myuser&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTablel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone <span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1 <span class="token operator">=</span> cone<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rowFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Scan</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建比较器对象</span>
        <span class="token class-name">BinaryComparator</span> bComp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinaryComparator</span><span class="token punctuation">(</span><span class="token string">&quot;0003&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建rowkey比较过滤器对象，并把比较器对象作为参数传进去</span>
        <span class="token comment">//过滤掉rowkey比0003小的数据</span>
        <span class="token class-name">RowFilter</span> rF <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RowFilter</span><span class="token punctuation">(</span><span class="token class-name">CompareFilter<span class="token punctuation">.</span>CompareOp</span><span class="token punctuation">.</span>LESS<span class="token punctuation">,</span> bComp<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//为Scan对象设置过滤器</span>
        sc<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>rF<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取ResultScanner对象</span>
        <span class="token class-name">ResultScanner</span> resultSc <span class="token operator">=</span> t1<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历ResultScanner对象(对象里面是一个个的Result)</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;family_name\t\tqualifier_name\t\trowkey\t\tvalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Result</span> i <span class="token operator">:</span> resultSc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cell</span><span class="token punctuation">&gt;</span></span> cells <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">listCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//遍历cells</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cell</span> j<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> family_name<span class="token operator">=</span> <span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneFamily</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> qualifier_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneQualifier</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rowkey<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneRow</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>family_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>rowkey<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span>equals
                   <span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		t1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行输出结果如下：</p> <div class="language-java extra-class"><pre class="language-java"><code>family_name		qualifier_name		rowkey		value
f1				adress				<span class="token number">00001</span>				地球人
f1				age				<span class="token number">00001</span>				<span class="token number">18</span>
f1				id				<span class="token number">00001</span>				<span class="token number">25</span>
f1				name				<span class="token number">00001</span>				krystal
f1				age				<span class="token number">0002</span>				<span class="token number">30</span>
f1				id				<span class="token number">0002</span>				<span class="token number">1</span>
f1				name				<span class="token number">0002</span>				曹操
f2				address				<span class="token number">0002</span>				沛国谯县
f2				phone				<span class="token number">0002</span>				<span class="token number">16888888888</span>
f2				say				<span class="token number">0002</span>				helloworld
f2				sex				<span class="token number">0002</span>				<span class="token number">1</span>
</code></pre></div><h5 id="familyfilter-列族过滤器"><a href="#familyfilter-列族过滤器" class="header-anchor">#</a> FamilyFilter--列族过滤器</h5> <p>案例需求：查询列族名包含f2的所有列族下面的数据</p> <div class="language-JAVA extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>hbase01</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> cone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Table</span> t1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> t_name <span class="token operator">=</span> <span class="token string">&quot;myuser&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTablel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone <span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1 <span class="token operator">=</span> cone<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Scan</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建比较器对象</span>
        <span class="token class-name">SubstringComparator</span> subC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubstringComparator</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建FamilyFilter比较过滤器对象，并把比较器对象作为参数传进去</span>
        <span class="token comment">//查询包含子字符串f2的列族</span>
        <span class="token class-name">FamilyFilter</span> fF <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FamilyFilter</span><span class="token punctuation">(</span><span class="token class-name">CompareFilter<span class="token punctuation">.</span>CompareOp</span><span class="token punctuation">.</span>EQUAL<span class="token punctuation">,</span> subC<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//为Scan对象设置过滤器</span>
        sc<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>fF<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取ResultScanner对象</span>
        <span class="token class-name">ResultScanner</span> resultSc <span class="token operator">=</span> t1<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历ResultScanner对象(对象里面是一个个的Result)</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;family_name\t\tqualifier_name\t\trowkey\t\tvalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Result</span> i <span class="token operator">:</span> resultSc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cell</span><span class="token punctuation">&gt;</span></span> cells <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">listCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//遍历cells</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cell</span> j<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> family_name<span class="token operator">=</span> <span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneFamily</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> qualifier_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneQualifier</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rowkey<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneRow</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>family_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>rowkey<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span>equals
                   <span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行输出结果如下：</p> <div class="language-java extra-class"><pre class="language-java"><code>family_name		qualifier_name		rowkey		value
f2				address				<span class="token number">0002</span>				沛国谯县
f2				phone				<span class="token number">0002</span>				<span class="token number">16888888888</span>
f2				say				<span class="token number">0002</span>				helloworld
f2				sex				<span class="token number">0002</span>				<span class="token number">1</span>
f2				address				<span class="token number">0003</span>				幽州涿郡涿县
f2				phone				<span class="token number">0003</span>				<span class="token number">17888888888</span>
f2				say				<span class="token number">0003</span>				talk is cheap <span class="token punctuation">,</span> show me the code
f2				sex				<span class="token number">0003</span>				<span class="token number">1</span>
f2				address				<span class="token number">0004</span>				下邳
f2				phone				<span class="token number">0004</span>				<span class="token number">12888888888</span>
f2				say				<span class="token number">0004</span>				what are you 弄啥嘞！
f2				sex				<span class="token number">0004</span>				<span class="token number">1</span>
f2				address				<span class="token number">0005</span>				四川隆中
f2				phone				<span class="token number">0005</span>				<span class="token number">14888888888</span>
f2				say				<span class="token number">0005</span>				出师表你背了嘛
f2				sex				<span class="token number">0005</span>				<span class="token number">1</span>
f2				address				<span class="token number">0006</span>				哪里人有待考究
f2				phone				<span class="token number">0006</span>				<span class="token number">15888888888</span>
f2				say				<span class="token number">0006</span>				跟诸葛亮死掐
f2				sex				<span class="token number">0006</span>				<span class="token number">1</span>
f2				address				<span class="token number">0007</span>				内蒙人
f2				phone				<span class="token number">0007</span>				<span class="token number">15788888888</span>
f2				say				<span class="token number">0007</span>				貂蝉去哪了
f2				sex				<span class="token number">0007</span>				<span class="token number">1</span>
</code></pre></div><h5 id="qualifierfilter-列过滤器"><a href="#qualifierfilter-列过滤器" class="header-anchor">#</a> QualifierFilter--列过滤器</h5> <p>案例需求：只查询列名包含<code>name</code>的列的值</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>hbase01</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> cone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Table</span> t1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> t_name <span class="token operator">=</span> <span class="token string">&quot;myuser&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTablel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone <span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1 <span class="token operator">=</span> cone<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">qFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Scan</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建比较器对象</span>
        <span class="token class-name">SubstringComparator</span> subC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubstringComparator</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建QualifierFilter比较过滤器对象，并把比较器对象作为参数传进去</span>
        <span class="token class-name">QualifierFilter</span> qF <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QualifierFilter</span><span class="token punctuation">(</span><span class="token class-name">CompareFilter<span class="token punctuation">.</span>CompareOp</span><span class="token punctuation">.</span>EQUAL<span class="token punctuation">,</span> subC<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//为Scan对象设置过滤器</span>
        sc<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>qF<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取ResultScanner对象</span>
        <span class="token class-name">ResultScanner</span> resultSc <span class="token operator">=</span> t1<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历ResultScanner对象(对象里面是一个个的Result)</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;family_name\t\tqualifier_name\t\trowkey\t\tvalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Result</span> i <span class="token operator">:</span> resultSc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cell</span><span class="token punctuation">&gt;</span></span> cells <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">listCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//遍历cells</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cell</span> j<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> family_name<span class="token operator">=</span> <span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneFamily</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> qualifier_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneQualifier</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rowkey<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneRow</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>family_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>rowkey<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span>
                   <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>运行输出结果如下：</p> <div class="language-java extra-class"><pre class="language-java"><code>family_name		qualifier_name		rowkey		value
f1				name				<span class="token number">00001</span>				krystal
f1				name				<span class="token number">0002</span>				曹操
f1				name				<span class="token number">0003</span>				刘备
f1				name				<span class="token number">0004</span>				孙权
f1				name				<span class="token number">0005</span>				诸葛亮
f1				name				<span class="token number">0006</span>				司马懿
f1				name				<span class="token number">0007</span>				xiaobubu—吕布
</code></pre></div><h5 id="valuefilter-列值过滤器"><a href="#valuefilter-列值过滤器" class="header-anchor">#</a> ValueFilter--列值过滤器</h5> <p>案例需求：查询所有列当中包含8的数据</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>hbase01</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> cone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Table</span> t1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> t_name <span class="token operator">=</span> <span class="token string">&quot;myuser&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTablel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone <span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1 <span class="token operator">=</span> cone<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">vFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Scan</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建比较器对象</span>
        <span class="token class-name">SubstringComparator</span> subC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubstringComparator</span><span class="token punctuation">(</span><span class="token string">&quot;8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建ValueFilter比较过滤器对象，并把比较器对象作为参数传进去</span>
        <span class="token class-name">ValueFilter</span> vF<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ValueFilter</span><span class="token punctuation">(</span><span class="token class-name">CompareFilter<span class="token punctuation">.</span>CompareOp</span><span class="token punctuation">.</span>EQUAL<span class="token punctuation">,</span> subC<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//为Scan对象设置过滤器</span>
        sc<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>vF<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取ResultScanner对象</span>
        <span class="token class-name">ResultScanner</span> resultSc <span class="token operator">=</span> t1<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历ResultScanner对象(对象里面是一个个的Result)</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;family_name\t\tqualifier_name\t\trowkey\t\tvalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Result</span> i <span class="token operator">:</span> resultSc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cell</span><span class="token punctuation">&gt;</span></span> cells <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">listCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//遍历cells</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cell</span> j<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> family_name<span class="token operator">=</span> <span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneFamily</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> qualifier_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneQualifier</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rowkey<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneRow</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>family_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>rowkey<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span>
                   <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>运行输出结果如下：</p> <div class="language-java extra-class"><pre class="language-java"><code>family_name		qualifier_name		rowkey		value
f2				phone				<span class="token number">0002</span>				<span class="token number">16888888888</span>
f2				phone				<span class="token number">0003</span>				<span class="token number">17888888888</span>
f2				phone				<span class="token number">0004</span>				<span class="token number">12888888888</span>
f2				phone				<span class="token number">0005</span>				<span class="token number">14888888888</span>
f2				phone				<span class="token number">0006</span>				<span class="token number">15888888888</span>
f2				phone				<span class="token number">0007</span>				<span class="token number">15788888888</span>
</code></pre></div><h5 id="专用过滤器使用"><a href="#专用过滤器使用" class="header-anchor">#</a> 专用过滤器使用</h5> <h6 id="singlecolumnvaluefilter-单列值过滤器"><a href="#singlecolumnvaluefilter-单列值过滤器" class="header-anchor">#</a> SingleColumnValueFilter--单列值过滤器</h6> <p>SingleColumnValueFilter会返回满足条件的cell的所在行的所有cell的值。经测试，貌似如果没有满足条件的cell就会返回所有行每一个cell的值。</p> <p>案例需求：查询名字为刘备的数据</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>hbase01</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> cone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Table</span> t1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> t_name <span class="token operator">=</span> <span class="token string">&quot;myuser&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTablel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone <span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1 <span class="token operator">=</span> cone<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">singleFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Scan</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SingleColumnValueFilter</span> scvF<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SingleColumnValueFilter</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   <span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CompareFilter<span class="token punctuation">.</span>CompareOp</span><span class="token punctuation">.</span>EQUAL<span class="token punctuation">,</span><span class="token string">&quot;刘备&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//为Scan对象设置过滤器</span>
        sc<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>scvF<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取ResultScanner对象</span>
        <span class="token class-name">ResultScanner</span> resultSc <span class="token operator">=</span> t1<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历ResultScanner对象(对象里面是一个个的Result)</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;family_name\t\tqualifier_name\t\trowkey\t\tvalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Result</span> i <span class="token operator">:</span> resultSc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cell</span><span class="token punctuation">&gt;</span></span> cells <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">listCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//遍历cells</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cell</span> j<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> family_name<span class="token operator">=</span> <span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneFamily</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> qualifier_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneQualifier</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rowkey<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneRow</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>family_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>rowkey<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span>
                   <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>运行输出结果如下：</p> <div class="language-java extra-class"><pre class="language-java"><code>family_name		qualifier_name		rowkey		value
f1				age				<span class="token number">0003</span>				<span class="token number">32</span>
f1				id				<span class="token number">0003</span>				<span class="token number">2</span>
f1				name				<span class="token number">0003</span>				刘备
f2				address				<span class="token number">0003</span>				幽州涿郡涿县
f2				phone				<span class="token number">0003</span>				<span class="token number">17888888888</span>
f2				say				<span class="token number">0003</span>				talk is cheap <span class="token punctuation">,</span> show me the code
f2				sex				<span class="token number">0003</span>				<span class="token number">1</span>
</code></pre></div><h6 id="singlecolumnvalueexcludefilter"><a href="#singlecolumnvalueexcludefilter" class="header-anchor">#</a> SingleColumnValueExcludeFilter</h6> <p>SingleColumnValueExcludeFilter<strong>与</strong>SingleColumnValueFilter相反，会排除掉指定的列，其他的列全部返回</p> <h6 id="prefixfilter-rowkey前缀过滤器"><a href="#prefixfilter-rowkey前缀过滤器" class="header-anchor">#</a> PrefixFilter--rowkey前缀过滤器</h6> <ul><li>查询以00开头的所有前缀的rowkey</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>hbase01</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> cone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Table</span> t1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> t_name <span class="token operator">=</span> <span class="token string">&quot;myuser&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTablel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone <span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1 <span class="token operator">=</span> cone<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preRowFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Scan</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrefixFilter</span> pF<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PrefixFilter</span><span class="token punctuation">(</span><span class="token string">&quot;00&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//为Scan对象设置过滤器</span>
        sc<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>pF<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取ResultScanner对象</span>
        <span class="token class-name">ResultScanner</span> resultSc <span class="token operator">=</span> t1<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历ResultScanner对象(对象里面是一个个的Result)</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;family_name\t\tqualifier_name\t\trowkey\t\tvalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Result</span> i <span class="token operator">:</span> resultSc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cell</span><span class="token punctuation">&gt;</span></span> cells <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">listCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//遍历cells</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cell</span> j<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> family_name<span class="token operator">=</span> <span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneFamily</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> qualifier_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneQualifier</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rowkey<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneRow</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>family_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>rowkey<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span>
                   <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>运行输出结果如下:</p> <div class="language-java extra-class"><pre class="language-java"><code>family_name		qualifier_name		rowkey		value
f1				adress				<span class="token number">00001</span>				地球人
f1				age				<span class="token number">00001</span>				<span class="token number">18</span>
f1				id				<span class="token number">00001</span>				<span class="token number">25</span>
f1				name				<span class="token number">00001</span>				krystal
f1				age				<span class="token number">0002</span>				<span class="token number">30</span>
f1				id				<span class="token number">0002</span>				<span class="token number">1</span>
f1				name				<span class="token number">0002</span>				曹操
f2				address				<span class="token number">0002</span>				沛国谯县
f2				phone				<span class="token number">0002</span>				<span class="token number">16888888888</span>
f2				say				<span class="token number">0002</span>				helloworld
f2				sex				<span class="token number">0002</span>				<span class="token number">1</span>
f1				age				<span class="token number">0003</span>				<span class="token number">32</span>
f1				id				<span class="token number">0003</span>				<span class="token number">2</span>
f1				name				<span class="token number">0003</span>				刘备
f2				address				<span class="token number">0003</span>				幽州涿郡涿县
f2				phone				<span class="token number">0003</span>				<span class="token number">17888888888</span>
f2				say				<span class="token number">0003</span>				talk is cheap <span class="token punctuation">,</span> show me the code
f2				sex				<span class="token number">0003</span>				<span class="token number">1</span>
f1				age				<span class="token number">0004</span>				<span class="token number">35</span>
f1				id				<span class="token number">0004</span>				<span class="token number">3</span>
f1				name				<span class="token number">0004</span>				孙权
f2				address				<span class="token number">0004</span>				下邳
f2				phone				<span class="token number">0004</span>				<span class="token number">12888888888</span>
f2				say				<span class="token number">0004</span>				what are you 弄啥嘞！
f2				sex				<span class="token number">0004</span>				<span class="token number">1</span>
f1				age				<span class="token number">0005</span>				<span class="token number">28</span>
f1				id				<span class="token number">0005</span>				<span class="token number">4</span>
f1				name				<span class="token number">0005</span>				诸葛亮
f2				address				<span class="token number">0005</span>				四川隆中
f2				phone				<span class="token number">0005</span>				<span class="token number">14888888888</span>
f2				say				<span class="token number">0005</span>				出师表你背了嘛
f2				sex				<span class="token number">0005</span>				<span class="token number">1</span>
f1				age				<span class="token number">0006</span>				<span class="token number">27</span>
f1				id				<span class="token number">0006</span>				<span class="token number">5</span>
f1				name				<span class="token number">0006</span>				司马懿
f2				address				<span class="token number">0006</span>				哪里人有待考究
f2				phone				<span class="token number">0006</span>				<span class="token number">15888888888</span>
f2				say				<span class="token number">0006</span>				跟诸葛亮死掐
f2				sex				<span class="token number">0006</span>				<span class="token number">1</span>
f1				age				<span class="token number">0007</span>				<span class="token number">28</span>
f1				id				<span class="token number">0007</span>				<span class="token number">5</span>
f1				name				<span class="token number">0007</span>				xiaobubu—吕布
f2				address				<span class="token number">0007</span>				内蒙人
f2				phone				<span class="token number">0007</span>				<span class="token number">15788888888</span>
f2				say				<span class="token number">0007</span>				貂蝉去哪了
f2				sex				<span class="token number">0007</span>				<span class="token number">1</span>
</code></pre></div><h6 id="pagefilter-分页过滤器"><a href="#pagefilter-分页过滤器" class="header-anchor">#</a> PageFilter--分页过滤器</h6> <p>什么叫分页？我们先来看一下百度的分页：</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAtwAAACNCAYAAACE5K0SAAAehElEQVR4nO3dbZAd1Z3f8e/p7vs4986dGY00IzQChIV5sFljC2MEhdemsmu/WEKMwBWkSrze9YtUnEoqLlfyAsQLBLVvtqhNUpuqpGqTqi0jYivI67XX9tplXGtiifUiFoNBYAvGiyQ0ehrNw50796n75MW5o5lBMyBArXu75/epmirpzgw6h9On+9/n4X/MPffcY6MoQkRERERELp0dO3bwpS99CU/BtoiIiIjIpbd//34AgoUP7rvvPu6++24GBwe7VigRERERkSR76aWXePDBBwGw1gJLAu4dO3bQ19fXnZKJiIiIiKTATTfddMFn3sIfFGyLiIiIiFx63rv/iIiIiIiIvF8KuEVEREREYqSAW0REREQkRgq4RURERERipIBbRERERCRGCrhFRERERGKkgFtEREREJEYKuEVEREREYqSAW0REREQkRgq4RURERERipIBbRERERCRGCrhFRERERGKkgFtEREREJEYKuEVEREREYqSAW0REREQkRgq4RURERERipIBbRERERCRGCrhFRERERGKkgFtEREREJEYKuEVEREREYqSAW0REREQkRgq4RURERERipIBbRERERCRGCrhFRERERGKkgFtEREREJEYKuEVEREREYqSAW0REREQkRgq4RURERERipIBbRERERCRGCrhFRERERGIUdLsAcWi1LC8fbvLWiZDBdR5bP5Rl/eDyd4tG0zI9GzE86OPptUNEREREYpK6gLs2bxn/bYu/+u4ch3/dYuMVPp/9TJG77shT6vOYr1uOv9Vm/LctTp4J+fA1Ga69NstAxcMz3S69iIiIiKRN6gLuExNtnvpOle/9cI5azfLSr+DkRMimEZ/f+UiW3x5t883/O8sPflij3rBcc3WGf/dvK9x2a55SQRG3iIiIiFxaqVtMcfp0yN89U6fRsOc/m5ho88MfzVGvW55+usYvftFgrhbRblve+G2L7/3NHC/+stHFUouIiIhIWqVuhLvRtJw5GxJFSz5rWCYmQsbfbPPKa00mTrWxnXi83bYcPdbmzGTYnQLLMpGFdgSBB8aAASwQRjA3b5mrRdgI8jlDf9kj8N3PSG8II9eGvsf5JVrWwnwT5moR9YYl40Gl4pHLGi3j6iHqe8mmvifS21IXcBsDgQ/t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" alt="image-20200301054024321"></p> <p>在HBase当中，也是存在着分页的。</p> <p>示例：假如每2行作为一页，那么就会按照下图进行分页。如果要访问第一页的数据，那么直接设置过滤器，从表的第一行开始访问，访问一个页的大小（2行）的数据即可。但是如果要访问中间页数的数据，比如说第3页的数据，那么首先要获取第3页的起始行键（即第5行），然后设置过滤器进行访问一个页大小的数据。</p> <p>怎么知道第5行是第3页的其实行键？5=（3-1）*2+1，3是第几页，2是每页的行数。</p> <img src="hbase.assets/image-20200302145240373.png" alt="image-20200302145240373" style="zoom:67%;"> <p>案例：通过pageFilter实现分页过滤器</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>hbase01</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> cone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Table</span> t1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> t_name <span class="token operator">=</span> <span class="token string">&quot;myuser&quot;</span><span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTablel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone <span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1 <span class="token operator">=</span> cone<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> pageNum<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">//设置要读取第几页的数据</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> pageSize<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">//设置每页有多少条数据</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rowFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Scan</span> sc<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>pageNum<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//设置一次RPC拿到的最大数据量</span>
            sc<span class="token punctuation">.</span><span class="token function">setMaxResultSize</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置第一页的起始行键,hbase的默认开始行键是&quot;&quot;</span>
            sc<span class="token punctuation">.</span><span class="token function">setStartRow</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//获取过滤器对象，并设置要读取的行数（pageSize)</span>
            <span class="token comment">// public PageFilter(final long pageSize)</span>
            <span class="token class-name">PageFilter</span> pageF<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PageFilter</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置过滤器</span>
            sc<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>pageF<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//打印</span>
            hbaseU<span class="token punctuation">.</span><span class="token function">printResult</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token comment">//假如访问第3页，知道了要从第5行开始读取数据</span>
            <span class="token comment">//但是我们还不知道第5行的行键名称，这时候就要获取行键信息</span>
            <span class="token class-name">String</span> startRow<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//          sc.setStartRow(&quot;&quot;.getBytes()); </span>
            <span class="token comment">//上面这行可以不用写，如果不指定startRow， 默认从第一行开始读取</span>
            <span class="token keyword">int</span> scanDatas<span class="token operator">=</span><span class="token punctuation">(</span>pageNum<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pageSize<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
            sc<span class="token punctuation">.</span><span class="token function">setMaxResultSize</span><span class="token punctuation">(</span>scanDatas<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">PageFilter</span> pageF<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PageFilter</span><span class="token punctuation">(</span>scanDatas<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sc<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>pageF<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ResultScanner</span> rScanner<span class="token operator">=</span>t1<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Result</span> rs<span class="token operator">:</span>rScanner<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span>row<span class="token operator">=</span>rs<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取rowkey数组</span>
                startRow<span class="token operator">=</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//循环遍历获取的数组，最后一条数据的rowkey就是我们需要的起始rowkey</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//获取rowkey名称后，开始读取第三页的数据</span>
            sc<span class="token punctuation">.</span><span class="token function">setStartRow</span><span class="token punctuation">(</span>startRow<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sc<span class="token punctuation">.</span><span class="token function">setMaxResultSize</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置我们要扫描多少条数据</span>
            <span class="token class-name">PageFilter</span> pageF2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PageFilter</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sc<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>pageF2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            hbaseU<span class="token punctuation">.</span><span class="token function">printResult</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>hbase01</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ResultScanner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Scan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Table</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> hbaseU<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printResult</span><span class="token punctuation">(</span><span class="token class-name">Table</span> t1<span class="token punctuation">,</span> <span class="token class-name">Scan</span> sc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取ResultScanner对象</span>
        <span class="token class-name">ResultScanner</span> resultSc <span class="token operator">=</span> t1<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历ResultScanner对象(对象里面是一个个的Result)</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;family_name\t\tqualifier_name\t\trowkey\t\tvalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Result</span> i <span class="token operator">:</span> resultSc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cell</span><span class="token punctuation">&gt;</span></span> cells <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">listCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//遍历cells</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cell</span> j<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> family_name<span class="token operator">=</span> <span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneFamily</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> qualifier_name<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneQualifier</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rowkey<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneRow</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>family_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>rowkey<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t\t\t\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span>
                        <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><p>运行输出结果如下：</p> <div class="language-java extra-class"><pre class="language-java"><code>family_name		qualifier_name		rowkey		value
f1				age				<span class="token number">0005</span>				<span class="token number">28</span>
f1				id				<span class="token number">0005</span>				<span class="token number">4</span>
f1				name				<span class="token number">0005</span>				诸葛亮
f2				address				<span class="token number">0005</span>				四川隆中
f2				phone				<span class="token number">0005</span>				<span class="token number">14888888888</span>
f2				say				<span class="token number">0005</span>				出师表你背了嘛
f2				sex				<span class="token number">0005</span>				<span class="token number">1</span>
f1				age				<span class="token number">0006</span>				<span class="token number">27</span>
f1				id				<span class="token number">0006</span>				<span class="token number">5</span>
f1				name				<span class="token number">0006</span>				司马懿
f2				address				<span class="token number">0006</span>				哪里人有待考究
f2				phone				<span class="token number">0006</span>				<span class="token number">15888888888</span>
f2				say				<span class="token number">0006</span>				跟诸葛亮死掐
f2				sex				<span class="token number">0006</span>				<span class="token number">1</span>
</code></pre></div><h5 id="多过滤器综合查询filterlist"><a href="#多过滤器综合查询filterlist" class="header-anchor">#</a> 多过滤器综合查询FilterList</h5> <p>需求：使用SingleColumnValueFilter查询f1列族，name为刘备的数据，并且同时满足rowkey的前缀以00开头的数据（PrefixFilter）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//创建过滤器列表FilterList即可实现多个过滤器综合查询</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">filterList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Scan</span> scan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SingleColumnValueFilter</span> singleColumnValueFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SingleColumnValueFilter</span>
<span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CompareFilter<span class="token punctuation">.</span>CompareOp</span><span class="token punctuation">.</span>EQUAL<span class="token punctuation">,</span> <span class="token string">&quot;刘备&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PrefixFilter</span> prefixFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrefixFilter</span><span class="token punctuation">(</span><span class="token string">&quot;00&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FilterList</span> filterList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filterList<span class="token punctuation">.</span><span class="token function">addFilter</span><span class="token punctuation">(</span>singleColumnValueFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    filterList<span class="token punctuation">.</span><span class="token function">addFilter</span><span class="token punctuation">(</span>prefixFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    scan<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>filterList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ResultScanner</span> scanner <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>scan<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printlReult</span><span class="token punctuation">(</span>scanner<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="hbase的删除操作"><a href="#hbase的删除操作" class="header-anchor">#</a> HBase的删除操作</h4> <h5 id="根据rowkey删除数据"><a href="#根据rowkey删除数据" class="header-anchor">#</a> 根据rowkey删除数据</h5> <ul><li>删除rowkey为003的数据</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">DeleteData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Delete</span> d1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Delete</span><span class="token punctuation">(</span><span class="token string">&quot;0003&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h5 id="删除表-2"><a href="#删除表-2" class="header-anchor">#</a> 删除表</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>hbase01</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> cone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Table</span> t1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> t_name <span class="token operator">=</span> <span class="token string">&quot;myuser&quot;</span><span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTablel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone <span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1 <span class="token operator">=</span> cone<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">DeleteData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取admin对象，用于表的删除</span>
        <span class="token class-name">Admin</span> am<span class="token operator">=</span>cone<span class="token punctuation">.</span><span class="token function">getAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//禁用表</span>
        am<span class="token punctuation">.</span><span class="token function">disableTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//删除表</span>
        am<span class="token punctuation">.</span><span class="token function">deleteTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        t1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cone<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="hbase的数据存储原理"><a href="#hbase的数据存储原理" class="header-anchor">#</a> HBase的数据存储原理</h2> <p><img src="/assets/img/image-20200303015726371.57ef3928.png" alt="image-20200303015726371"></p> <ol><li>Hbase有多个Hregionserver，是专门用于保存数据的节点。每个regionserver主要由3部分组成：Hlog,bockcache,region。region可以有多个，用于保存表的部分数据，并且一个region只会保存一个表的数据。</li> <li>假如client进行操作：create 'user','info','data',有两个列族。那么会在Hlog上记录操作信息，并在这个表对应的region就会产生两个store文件，分别用来存储两个不同列族的数据。有多少个列族就会有多少个store。</li> <li>每一个store里面都有一个memstore，memstore是一块内存区域，写入的数据会写入里面进行缓冲，再把数据刷到磁盘。</li> <li>当client进行写入数据时，比如进行 put 'user','rk0001','info:age',18等操作。首先会在Hlog记录操作，然后往对应的memstore写入数据。每当memstore写满128m，都会将数据溢写到storeFile中。因此可能会产生多个storeFile。storeFile最终存储到HDFS文件系统中，作为HFile文件。StoreFile其实是HFile的抽象对象，可说store等于HFile。每次memstore刷写数据到磁盘，都会生成对应的一个新的HFile文件。</li></ol> <p><img src="/assets/img/region.3d333c1d.png" alt="region"></p> <h2 id="hbase建表流程"><a href="#hbase建表流程" class="header-anchor">#</a> HBase建表流程</h2> <img src="hbase.assets/image-20200303133100858.png" alt="image-20200303133100858" style="zoom:67%;"> <ol><li>client进行RPC调用HMaster，说要创建表'myuser'。</li> <li>HMaster收到信息后，根据HRegionServer的心跳汇报的磁盘使用等情况，决定表的第一个region放在哪个HRegionServer节点，然后告知该节点创建region。</li> <li>HBase有个叫做hbase:meta的表，这个表专门用于存储整个hbase集群中有哪些表，每个表有哪些region,每个region的rowkey范围（region中的数据是按照rowkey进行排序的），这些region存在哪些HRegionServer节点上。</li> <li>既然hbase meta表存储着每个表和region的相关信息，那么HMaster在刚才'myuser'表的region创建好后，就会跟zookeeper进行通信，获得hbase meta表在哪个HregionServer节点的信息，HMaster收到响应后，就往hbase meta表写入'myuser'的表和region的相关元数据信息。</li> <li>------------上面就是建表的主要流程，接下来简单看一下client查询表的流程。-------------</li> <li>client要查询数据，如进行get操作。那么client先与zookeeper进行通信，获得Hbase meta表的位置，然后跟hbase meta表所在的HregionServer节点进行通信，HregionServer返回要查询的表的元数据信息给客户端。</li> <li>客户端收到表的region位置等信息后，开始跟从对应的HregionServer查询数据。</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>zk: node01:2181,node02:2181,node03:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token function">ls</span> /hbase
<span class="token punctuation">[</span>replication, meta-region-server, rs, splitWAL, backup-masters, table-lock, flush-table-proc, region-in-transition, online-snapshot, master, running, recovering-regions, draining, namespace, hbaseid, table<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: node01:2181,node02:2181,node03:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span> get /hbase/meta-region-server
�regionserver:60020͇����ĬPBUF

node03�������.
cZxid <span class="token operator">=</span> 0xb0000009b
ctime <span class="token operator">=</span> Tue Mar 03 <span class="token number">13</span>:35:42 CST <span class="token number">2020</span>
mZxid <span class="token operator">=</span> 0xb0000009b
mtime <span class="token operator">=</span> Tue Mar 03 <span class="token number">13</span>:35:42 CST <span class="token number">2020</span>
pZxid <span class="token operator">=</span> 0xb0000009b
cversion <span class="token operator">=</span> <span class="token number">0</span>
dataVersion <span class="token operator">=</span> <span class="token number">0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
dataLength <span class="token operator">=</span> <span class="token number">60</span>
numChildren <span class="token operator">=</span> <span class="token number">0</span>
</code></pre></div><h2 id="hbase读数据流程"><a href="#hbase读数据流程" class="header-anchor">#</a> HBase读数据流程</h2> <p><img src="/assets/img/image-20200303153349193.69364e02.png" alt="image-20200303153349193"></p> <blockquote><p>说明：HBase集群，只有一张meta表，此表只有一个region，该region数据保存在一个HRegionServer上</p></blockquote> <p>HBase读数据详细流程:</p> <p>1、客户端首先与zk进行连接；从zk找到meta表的region位置，即meta表的数据存储在某一HRegionServer上；客户端与此HRegionServer建立连接，然后读取meta表中的数据；meta表中存储了所有用户表的region信息，我们可以通过scan 'hbase:meta'来查看meta表信息</p> <p>2、根据要查询的namespace、表名和rowkey信息。找到写入数据对应的region信息</p> <p>3、找到这个region对应的regionServer，然后发送请求</p> <p>4、查找并定位到对应的region</p> <p>5、先从memstore查找数据，如果没有，再从BlockCache上读取。</p> <p>6、如果BlockCache中也没有找到，再到StoreFile(HFile)上进行读取</p> <p>7、从storeFile中读取到数据之后，不是直接把结果数据返回给客户端，而是把数据先写入到BlockCache中，目的是为了加快后续的查询；然后在返回结果给客户端。</p> <p>补充：</p> <p>HBase上Regionserver的内存分为两个部分</p> <ul><li>一部分作为Memstore，主要用来写；</li> <li>另一部分作为BlockCache，主要用于读数据；</li></ul> <h2 id="hbase写数据流程"><a href="#hbase写数据流程" class="header-anchor">#</a> HBase写数据流程</h2> <p><img src="/assets/img/image-20200303140520209.e947baa4.png" alt="image-20200303140520209"></p> <p><img src="/assets/img/image-20200303015726371-1610882044630.57ef3928.png" alt="image-20200303015726371"></p> <p>Hbase写数据详细流程：</p> <ol><li>假如客户端进行写操作：put 'user', 'rk0001', 'data:passwd', '123456'。client首先与zookeeper通信找到meta表的region位置。</li> <li>client从对应的HregionServer节点读取meta表中的数据，根据namespace、表名和rowkey信息获得要往哪个region写入数据，这个region存在在哪个HregionServer节点等信息。</li> <li>找到这个region对应的regionServer，然后发送请求</li> <li>把数据分别写到HLog（write ahead log）和memstore各一份</li> <li>memstore达到阈值后把数据刷到磁盘，生成storeFile文件。storeFile文件数目达到一定阈值后，会发出一个操作，将多个小的storeFile合并成一个大的storeFile。</li> <li>storeFile作为HFile存到hdfs中，默认情况下，每隔7天，会将store下的HFile合并成一个达到HFile。</li> <li>删除HLog中的历史数据</li></ol> <p>补充：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token number">1</span>、HLog（write ahead log）：
	也称为WAL意为Write ahead log，即预写日志，类似mysql中的binlog,用来做灾难恢复时用，
	HLog记录数据的所有变更,一旦数据修改，就可以从log中进行恢复。
<span class="token number">2</span>、触发大合并的时候会对数据进行溢写清理:
	delete的数据会被删除
	cell存在最大版本数，超过最大版本数的老数据会被删除
	建表的时候可以指定列族和列的数据有效期ttl<span class="token punctuation">(</span>time to live<span class="token punctuation">)</span>,超过有效期的数据会被删除
	
<span class="token number">3</span>、如果管理员想要释放磁盘空间的话，可以执行大文件合并。
	大文件合并，会占用的资源很多，会影响线上的正常业务的执行。
	一般会将大文件合并的自动启动关闭。
	一般是进行人为的文件大合并，并且是找一个空闲的时间来触发，比如午夜。
<span class="token number">4</span>、在合并之前，删除的数据、ttl到期的数据、超过版本数的数据都还存储在文件中
	这些待定删除的数据被打了一个墓碑标记tomb,查询的时候，这些数据默认是不会被查询出来
	如果要查询这些待删除的数据，可使用get<span class="token punctuation">..</span>.<span class="token punctuation">{</span>RAW<span class="token operator">=</span><span class="token operator">&gt;</span>true<span class="token punctuation">}</span>方法
<span class="token number">5</span>、删除、更新等操作也看出是写操作
	如delete <span class="token string">'user'</span>,<span class="token string">'rk0001'</span>,<span class="token string">'info:age'</span>，流程跟上面的写流程基本一样。
	也会向Hlog和memstore写数据，并做了标记，如type<span class="token operator">=</span><span class="token string">'delete'</span><span class="token builtin class-name">.</span>
	删除和更新的操作在大合并的时候才会正式生效。
<span class="token number">6</span>、往memstore写入数据的时候，是异步的。
	当数据写入memstore完成后，会立即向客户端响应完成，并不需要等待flush到storeFile。
<span class="token number">7</span>、不断写入数据，那么region也会不断变大。
	当region达到一定大小时，region会下线，然后一分为二<span class="token punctuation">(</span>如region01,region02<span class="token punctuation">)</span>，再上线。
	HMaster控制着region的迁移，可能会将region02迁移到其它的HregionServer节点。
	region迁移后，对应的HFile也会指向新的位置。
<span class="token number">8</span>、blockcache是一个内存空间，用于缓存block数据，加快查询速度
</code></pre></div><h2 id="hbase的flush机制"><a href="#hbase的flush机制" class="header-anchor">#</a> HBase的flush机制</h2> <p><img src="/assets/img/hbase-split-compaction.7b3ceabb.png" alt=""></p> <h4 id="flush触发条件"><a href="#flush触发条件" class="header-anchor">#</a> Flush触发条件</h4> <h5 id="memstore级别限制"><a href="#memstore级别限制" class="header-anchor">#</a> memstore级别限制</h5> <p>当Region中任意一个MemStore的大小达到了上限（hbase.hregion.memstore.flush.size，默认128MB），会触发Memstore刷新。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.hregion.memstore.flush.size<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>134217728<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="region级别限制"><a href="#region级别限制" class="header-anchor">#</a> region级别限制</h5> <p>当Region中所有Memstore的大小总和达到了上限（hbase.hregion.memstore.block.multiplier * hbase.hregion.memstore.flush.size，默认 2* 128M = 256M），会触发memstore刷新。</p> <p>因此，企业中，一张表一般不适用过多的列族，通常使用一两个列族，如果列族过多会导致Memstore过多，从而Memstore的大小总和过快达到上限，从而频繁flush。</p> <p>比如说某个表有5个列族，那么该表的region就会有5个对应的memstore,假如memstore1大小为40M，memstore2大小为50M，memstore3大小为40M，memstore4为80M，memstore5为50M，那么5个memstore已经超过256M，会触发flush，但是可看到很多Memstore还远没有达到128M就会开始进行flush，这样会导致flush过于频繁。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.hregion.memstore.flush.size<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>134217728<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.hregion.memstore.block.multiplier<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>   
</code></pre></div><h5 id="region-server级别限制"><a href="#region-server级别限制" class="header-anchor">#</a> Region Server级别限制</h5> <img src="hbase.assets/image-20200303175749870.png" alt="image-20200303175749870" style="zoom:67%;"> <ol><li>低水位阈值：hbase.regionserver.global.memstore.size.lower.limit*hbase.regionserver.global.memstore.size</li> <li>高水位阈值：hbase.regionserver.global.memstore.size</li> <li>当一个Region Server中所有Memstore的大小总和超过低水位阈值,RegionServer开始强制flush。先Flush Memstore最大的Region，再执行次大的，依次执行；</li> <li>如果写入速度大于flush写出的速度，导致总MemStore大小超过高水位阈值（默认为JVM内存的40%），此时RegionServer会阻塞更新并强制执行flush，直到总MemStore大小低于低水位阈值</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.regionserver.global.memstore.size.lower.limit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>0.95<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--默认为0.95--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.regionserver.global.memstore.size<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>0.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--默认为JVM内存的40%--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="hlog数量上限"><a href="#hlog数量上限" class="header-anchor">#</a> HLog数量上限</h5> <p>当一个Region Server中HLog数量达到上限（可通过参数hbase.regionserver.maxlogs配置）时，系统会选取最早的一个HLog对应的一个或多个Region进行flush</p> <h5 id="定期刷新memstore"><a href="#定期刷新memstore" class="header-anchor">#</a> 定期刷新Memstore</h5> <p>默认周期为1小时，确保Memstore不会长时间没有持久化。为避免所有的MemStore在同一时间都进行flush导致的问题，定期的flush操作有20000左右的随机延时。</p> <h5 id="手动flush"><a href="#手动flush" class="header-anchor">#</a> 手动flush</h5> <p>用户可以通过shell命令flush ‘tablename’或者flush ‘region name’分别对一个表或者一个Region进行flush。</p> <h4 id="flush的流程"><a href="#flush的流程" class="header-anchor">#</a> flush的流程</h4> <img src="hbase.assets/image-20200303193630021.png" alt="image-20200303193630021" style="zoom:67%;"> <p>为了减少flush过程对读写的影响，将整个flush过程分为三个阶段：</p> <ul><li><p>prepare阶段：遍历当前Region中所有的Memstore，将Memstore中当前数据集CellSkipListSet做一个<strong>快照snapshot</strong>；然后再新建一个CellSkipListSet。后期写入的数据都会写入新的CellSkipListSet中。prepare阶段需要加一把updateLock对<strong>写请求阻塞</strong>，结束之后会释放该锁。因为此阶段没有任何费时操作，因此持锁时间很短。</p></li> <li><p>flush阶段：遍历所有Memstore，将prepare阶段生成的snapshot持久化为<strong>临时文件</strong>，临时文件会统一放到目录.tmp下。这个过程因为涉及到磁盘IO操作，因此相对比较耗时。</p></li> <li><p>commit阶段：遍历所有Memstore，将flush阶段生成的临时文件移到指定的ColumnFamily列族目录下，针对HFile生成对应的storefile和Reader，把storefile添加到HStore的storefiles列表中，最后再<strong>清空</strong>prepare阶段生成的snapshot。</p></li></ul> <h2 id="hbase的compact合并机制"><a href="#hbase的compact合并机制" class="header-anchor">#</a> HBase的Compact合并机制</h2> <p>hbase为了==防止小文件过多==，以保证查询效率，hbase需要在必要的时候将这些小的store file合并成相对较大的store file，这个过程就称之为compaction。</p> <p>在hbase中主要存在两种类型的compaction合并</p> <ul><li><strong>==minor compaction 小合并==</strong></li> <li><strong>==major compaction 大合并==</strong></li></ul> <h5 id="minor-compaction-小合并"><a href="#minor-compaction-小合并" class="header-anchor">#</a> minor compaction 小合并</h5> <ul><li><p>在将Store中多个HFile合并为一个HFile</p> <p>在这个过程中会选取一些小的、相邻的StoreFile将他们合并成一个更大的StoreFile，对于超过了TTL的数据、更新的数据、删除的数据仅仅只是做了标记。并没有进行物理删除，一次Minor Compaction的结果是更少并且更大的StoreFile。这种合并的触发频率很高。</p></li> <li><p>minor compaction触发条件由以下几个参数共同决定：</p></li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--表示至少需要三个满足条件的store file时，minor compaction才会启动--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.hstore.compactionThreshold<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--表示一次minor compaction中最多选取10个store file--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.hstore.compaction.max<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--默认值为128m,
表示文件大小小于该值的store file 一定会加入到minor compaction的合并队列中
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.hstore.compaction.min.size<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>134217728<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--默认值为LONG.MAX_VALUE，
表示文件大小大于该值的store file 一定会被minor compaction排除--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.hstore.compaction.max.size<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>9223372036854775807<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="major-compaction-大合并"><a href="#major-compaction-大合并" class="header-anchor">#</a> major compaction 大合并</h5> <ul><li><p>合并Store中所有的HFile为一个HFile</p> <p>将所有的StoreFile合并成一个StoreFile，这个过程还会清理三类无意义数据：被删除的数据、TTL过期数据、版本号超过设定版本号的数据。合并频率比较低，默认<strong>7天</strong>执行一次，并且性能消耗非常大，建议生产关闭(设置为0)，在应用空闲时间手动触发。一般可以是手动控制进行合并，防止出现在业务高峰期。</p></li> <li><p>major compaction触发时间条件</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--默认值为7天进行一次大合并，--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.hregion.majorcompaction<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>604800000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>手动触发</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment">##使用major_compact命令</span>
major_compact tableName
</code></pre></div></li></ul> <h2 id="hbase表的预分区"><a href="#hbase表的预分区" class="header-anchor">#</a> HBase表的预分区</h2> <p>当一个table刚被创建的时候，Hbase默认的分配一个region给table。也就是说这个时候，所有的读写请求都会访问到同一个regionServer的同一个region中，这个时候就达不到负载均衡的效果了，集群中的其他regionServer就可能会处于比较空闲的状态。</p> <p>解决这个问题可以用<strong>pre-splitting</strong>,在创建table的时候就配置好，生成多个region。</p> <h4 id="为何要预分区"><a href="#为何要预分区" class="header-anchor">#</a> 为何要预分区？</h4> <ul><li>增加数据读写效率</li> <li>负载均衡，防止数据倾斜</li> <li>方便集群容灾调度region</li> <li>优化Map数量</li></ul> <h4 id="预分区原理"><a href="#预分区原理" class="header-anchor">#</a> 预分区原理</h4> <p>每一个region维护着startRow与endRowKey，如果加入的数据符合某个region维护的rowKey范围，则该数据交给这个region维护。</p> <h4 id="手动指定预分区"><a href="#手动指定预分区" class="header-anchor">#</a> 手动指定预分区</h4> <h6 id="第一种方式"><a href="#第一种方式" class="header-anchor">#</a> 第一种方式</h6> <div class="language-ruby extra-class"><pre class="language-ruby"><code>create <span class="token string">'person4'</span><span class="token punctuation">,</span><span class="token string">'info1'</span><span class="token punctuation">,</span><span class="token string">'info2'</span><span class="token punctuation">,</span><span class="token constant">SPLITS</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">'1000'</span><span class="token punctuation">,</span><span class="token string">'2000'</span><span class="token punctuation">,</span><span class="token string">'3000'</span><span class="token punctuation">,</span><span class="token string">'4000'</span><span class="token punctuation">]</span>
</code></pre></div><p><img src="/assets/img/image-20200303234203452.04080cd3.png" alt="image-20200303234203452"></p> <h6 id="第二种方式"><a href="#第二种方式" class="header-anchor">#</a> 第二种方式</h6> <p>把分区规则创建于文 件中</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install

<span class="token function">vim</span> split.txt
aaa
bbb
ccc
ddd
</code></pre></div><div class="language-ruby extra-class"><pre class="language-ruby"><code>create <span class="token string">'student'</span><span class="token punctuation">,</span><span class="token string">'info'</span><span class="token punctuation">,</span><span class="token constant">SPLITS_FILE</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'/kkb/install/split.txt'</span>
</code></pre></div><p><img src="/assets/img/image-20200304004041457.cb65f6de.png" alt="image-20200304004041457"></p> <h6 id="第二种方式-hexstringsplit-算法"><a href="#第二种方式-hexstringsplit-算法" class="header-anchor">#</a> 第二种方式：HexStringSplit 算法</h6> <p>HexStringSplit会将数据从“00000000”到“FFFFFFFF”之间的数据长度按照<strong>n等分</strong>之后算出每一段的其实rowkey和结束rowkey，以此作为拆分点。F代表16。</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>create <span class="token string">'mytable'</span><span class="token punctuation">,</span> <span class="token string">'base_info'</span><span class="token punctuation">,</span><span class="token string">' extra_info'</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token constant">NUMREGIONS</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token constant">SPLITALGO</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'HexStringSplit'</span><span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/image-20200304004604791.c6af57d0.png" alt="image-20200304004604791"></p> <h2 id="region-合并"><a href="#region-合并" class="header-anchor">#</a> region 合并</h2> <p>Region的合并不是为了性能,  而是出于维护的目的。比如删除了大量的数据 ,这个时候每个Region都变得很小 ,存储多个Region就浪费了 ,这个时候可以把Region合并起来，进而可以减少一些Region服务器节点</p> <h5 id="通过merge类冷合并region"><a href="#通过merge类冷合并region" class="header-anchor">#</a> 通过Merge类冷合并Region</h5> <p>执行冷合并前，需要先关闭hbase集群</p> <img src="hbase.assets/image-20200304005038768.png" alt="image-20200304005038768" style="zoom:67%;"> <p>需求：把上图的mytable表中的红色圈中的2个region数据进行合并：</p> <div class="language- extra-class"><pre class="language-text"><code>mytable,33333333,1583253866373.f85b459590423c9e9d5f29ea5fb23330.
mytable,66666666,1583253866373.6af63a7d0706f8e769ddeb71c7cea5a2.
</code></pre></div><p>这里通过org.apache.hadoop.hbase.util.Merge类来实现，<strong>不需要</strong>进入hbase shell（需关闭hbase)</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node01 ~<span class="token punctuation">]</span>$ hbase org.apache.hadoop.hbase.util.Merge 
	mytable mytable,33333333,1583253866373.f85b459590423c9e9d5f29ea5fb23330. 
	mytable,66666666,1583253866373.6af63a7d0706f8e769ddeb71c7cea5a2.
</code></pre></div><p>查看Web界面</p> <p><img src="/assets/img/image-20200304010107932.66f73fc5.png" alt="image-20200304010107932"></p> <h5 id="通过online-merge热合并region"><a href="#通过online-merge热合并region" class="header-anchor">#</a> 通过online_merge热合并Region</h5> <p>热合并不需要关闭hbase集群，在线进行合并</p> <p>与冷合并不同的是，online_merge的传参是Region的hash值，而Region的hash值就是Region名称的最后那段在两个.之间的字符串部分。</p> <img src="hbase.assets/image-20200304010452038.png" alt="image-20200304010452038" style="zoom:100%;"> <p>需求：需要上图student表中的2个region数据进行合并</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">002</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> merge_region <span class="token string">'dcd55c9012c34576d3174b3330f9fbd5'</span><span class="token punctuation">,</span>
	<span class="token string">'e7266b717cbaa203da9bd69462db625b'</span>
</code></pre></div><p>查看Web界面</p> <p><img src="/assets/img/image-20200304010837262.51cb740a.png" alt="image-20200304010837262"></p> <h2 id="region的切分策略"><a href="#region的切分策略" class="header-anchor">#</a> region的切分策略</h2> <ul><li>region中存储的是一张表的数据，当region中的数据条数过多的时候，会直接影响查询效率.</li> <li>当region过大的时候，hbase会将region拆分为两个region , 这也是Hbase的一个优点 .</li> <li>HBase的region split策略一共有以下6种：</li></ul> <h4 id="constantsizeregionsplitpolicy"><a href="#constantsizeregionsplitpolicy" class="header-anchor">#</a> ConstantSizeRegionSplitPolicy</h4> <ul><li><p>0.94版本前，HBase region的默认切分策略</p></li> <li><p>当region中<strong>最大的store</strong>大小超过某个阈值(hbase.hregion.max.filesize=10G)之后就会触发切分，一个region等分为2个region。</p></li> <li><p>但是在生产线上这种切分策略却有相当大的弊端：</p> <ul><li>切分策略对于大表和小表没有明显的区分。</li> <li>阈值(hbase.hregion.max.filesize)设置较大对大表比较友好，但是小表就有可能不会触发分裂，极端情况下可能就1个，形成热点，这对业务来说并不是什么好事。</li> <li>如果设置较小则对小表友好，但一个大表就会在整个集群产生大量的region，这对于集群的管理、资源使用、failover来说都不是一件好事。</li></ul></li></ul> <h4 id="increasingtoupperboundregionsplitpolicy"><a href="#increasingtoupperboundregionsplitpolicy" class="header-anchor">#</a> IncreasingToUpperBoundRegionSplitPolicy</h4> <ul><li><p>0.94版本~2.0版本默认切分策略</p></li> <li><p>总体看和ConstantSizeRegionSplitPolicy思路相同</p> <ul><li>一个region中最大的store大小大于设置阈值就会触发切分。</li> <li>但是这个阈值并不像ConstantSizeRegionSplitPolicy是一个固定的值，而是会在一定条件下不断调整，调整规则和region所属表在当前regionserver上的region个数有关系.</li></ul></li> <li><p>region split阈值的计算公式是：</p> <ul><li><p>设regioncount：是region所属表在当前regionserver上的region的个数</p></li> <li><p>阈值 = regioncount^3 * 128M * 2，当然阈值并不会无限增长，最大不超过MaxRegionFileSize（10G）；当region中最大的store的大小达到该阈值的时候进行region split</p></li> <li><p>例如：
第一次split阈值 = 1^3 * 256 = 256MB
第二次split阈值 = 2^3 * 256 = 2048MB
第三次split阈值 = 3^3 * 256 = 6912MB
第四次split阈值 = 4^3 * 256 = 16384MB &gt; 10GB，因此取较小的值10GB
后面每次split的size都是10GB了</p></li> <li><p>特点</p> <ul><li>相比ConstantSizeRegionSplitPolicy，可以自适应大表、小表；</li> <li>在集群规模比较大的情况下，对大表的表现比较优秀</li> <li>但是，它并不完美，小表可能产生大量的小region，分散在各regionserver上</li></ul></li></ul></li></ul> <h4 id="steppingsplitpolicy"><a href="#steppingsplitpolicy" class="header-anchor">#</a> SteppingSplitPolicy</h4> <ul><li>2.0版本默认切分策略</li> <li>相比 IncreasingToUpperBoundRegionSplitPolicy 简单了一些</li> <li>region切分的阈值依然和待分裂region所属表在当前regionserver上的region个数有关系
<ul><li>如果region个数等于1，切分阈值为flush size 128M * 2</li> <li>否则为MaxRegionFileSize。</li></ul></li> <li>这种切分策略对于大集群中的大表、小表会比 IncreasingToUpperBoundRegionSplitPolicy 更加友好，小表不会再产生大量的小region，而是适可而止。</li></ul> <h4 id="keyprefixregionsplitpolicy"><a href="#keyprefixregionsplitpolicy" class="header-anchor">#</a> KeyPrefixRegionSplitPolicy</h4> <ul><li>根据rowKey的前缀对数据进行分区，这里是指定rowKey的前多少位作为前缀，比如rowKey都是16位的，指定前5位是前缀，那么前5位相同的rowKey在相同的region中。</li></ul> <h4 id="delimitedkeyprefixregionsplitpolicy"><a href="#delimitedkeyprefixregionsplitpolicy" class="header-anchor">#</a> DelimitedKeyPrefixRegionSplitPolicy</h4> <ul><li>保证相同前缀的数据在同一个region中，例如rowKey的格式为：userid_eventtype_eventid，指定的分隔符delimiter为 _ ，则split的的时候会确保userid相同的数据在同一个region中。</li></ul> <h4 id="disabledregionsplitpolicy"><a href="#disabledregionsplitpolicy" class="header-anchor">#</a> DisabledRegionSplitPolicy</h4> <ul><li>不启用自动拆分, 需要指定手动拆分</li></ul> <h2 id="hbase集成mapreduce-重点-难点"><a href="#hbase集成mapreduce-重点-难点" class="header-anchor">#</a> HBase集成MapReduce（重点 难点）</h2> <p>HBase表中的数据最终都是存储在HDFS上，HBase天生的支持MR的操作，我们可以通过MR直接处理HBase表中的数据，并且MR可以将处理后的结果直接存储到HBase表中。</p> <p>参考地址：<a href="http://hbase.apache.org/book.html#mapreduce" target="_blank" rel="noopener noreferrer">http://hbase.apache.org/book.html#mapreduce<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="实战一-hbase表-hbase表"><a href="#实战一-hbase表-hbase表" class="header-anchor">#</a> 实战一：HBase表--&gt;HBase表</h4> <h5 id="实战需求"><a href="#实战需求" class="header-anchor">#</a> 实战需求</h5> <p>读取HBase当中myuser这张表的f1:name、f1:age数据，将数据写入到另外一张myuser2表的f1列族里面去。</p> <img src="hbase.assets/image-20200304023432342.png" alt="image-20200304023432342" style="zoom:67%;"> <h5 id="第一步-创建myuser2表"><a href="#第一步-创建myuser2表" class="header-anchor">#</a> 第一步：创建myuser2表</h5> <p>**注意：**列族的名字要与myuser表的列族名字相同</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">010</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> create <span class="token string">'myuser2'</span><span class="token punctuation">,</span><span class="token string">'f1'</span>
</code></pre></div><h5 id="第二步-创建maven工程"><a href="#第二步-创建maven工程" class="header-anchor">#</a> 第二步：创建maven工程</h5> <div class="language-xml extra-class"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cloudera<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-mr1-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hbase-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hbase-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.14.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!--    &lt;verbal&gt;true&lt;/verbal&gt;--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-shade-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>shade<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filters</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifact</span><span class="token punctuation">&gt;</span></span>*:*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifact</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*.SF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*.DSA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*/RSA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filters</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="第三步-自定义map类"><a href="#第三步-自定义map类" class="header-anchor">#</a> 第三步：自定义map类</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span></span><span class="token class-name">HBase</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Put</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ImmutableBytesWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">TableMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Text</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token comment">//KOUT,VOUT是Text(行键),Put(一行中除了行键的单元格)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HBaseReadMapper</span> <span class="token keyword">extends</span> <span class="token class-name">TableMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Put</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    <span class="token comment">//ImmutableBytesWritable key是读取的表的一行数据的行键，一行数据调用一次map()方法</span>
    <span class="token comment">//Result value是一行中除了行键的值</span>
    <span class="token comment">//Context context是输出KOUT，VOUT</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">ImmutableBytesWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Result</span> value<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">//获得rowkey的字节数组</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span>rowByteArr<span class="token operator">=</span>key<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//字节数组转为字符串，得到行键</span>
        <span class="token class-name">String</span> rowStr<span class="token operator">=</span> <span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>rowByteArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将行键作为KOUT</span>
        <span class="token class-name">Text</span> text_kout<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>rowStr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//利用行键字节数组构建Put对象</span>
        <span class="token comment">//Put对象是用来装一行中除了行键的其它单元格</span>
        <span class="token class-name">Put</span> put<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span>rowByteArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取一行的其它Cell</span>
        <span class="token class-name">Cell</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cells<span class="token operator">=</span>value<span class="token punctuation">.</span><span class="token function">rawCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//循环遍历Cell,输出f1列族的name和age列的Cell</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Cell</span> c<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//获取当前Cell的列族</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span>family_byte<span class="token operator">=</span> <span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneFamily</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> family_Str<span class="token operator">=</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>family_byte<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//判断当前列族是否是f1</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>family_Str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//获取当前列名</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span>qualifier_byte<span class="token operator">=</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneQualifier</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> qualifier_Str<span class="token operator">=</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>qualifier_byte<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//判断当前Cell的列是否是name或者age</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>qualifier_Str<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>qualifier_Str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">//把Cell对象装到Put对象里</span>
                    put<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>text_kout<span class="token punctuation">,</span>put<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h5 id="第四步-自定义reduce类"><a href="#第四步-自定义reduce类" class="header-anchor">#</a> 第四步：自定义reduce类</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span></span><span class="token class-name">HBase</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Put</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ImmutableBytesWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">TableReducer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Text</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HBaseWriteReducer</span> <span class="token keyword">extends</span> <span class="token class-name">TableReducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Put</span><span class="token punctuation">,</span> <span class="token class-name">ImmutableBytesWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Put</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取rowkey,将Text对象转为ImmutableBytesWritable对象</span>
        <span class="token class-name">ImmutableBytesWritable</span> immtbw<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ImmutableBytesWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        immtbw<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//遍历Put对象，输出KOUT,VOUT</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Put</span> put<span class="token operator">:</span>values<span class="token punctuation">)</span><span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>immtbw<span class="token punctuation">,</span>put<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="第五步-自定义main入口类"><a href="#第五步-自定义main入口类" class="header-anchor">#</a> 第五步：自定义main入口类</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span></span><span class="token class-name">HBase</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configured</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Put</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Scan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">TableMapReduceUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Text</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">Job</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Tool</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ToolRunner</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HBaseMR</span> <span class="token keyword">extends</span> <span class="token class-name">Configured</span> <span class="token keyword">implements</span> <span class="token class-name">Tool</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Job</span> job<span class="token operator">=</span><span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getConf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">HBaseMR</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//设置使用的TableMapper类</span>
        <span class="token class-name">TableMapReduceUtil</span><span class="token punctuation">.</span><span class="token function">initTableMapperJob</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;myuser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">HBaseReadMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Put</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置使用的TableReducer类</span>
        <span class="token class-name">TableMapReduceUtil</span><span class="token punctuation">.</span><span class="token function">initTableReducerJob</span><span class="token punctuation">(</span><span class="token string">&quot;myuser2&quot;</span><span class="token punctuation">,</span><span class="token class-name">HBaseWriteReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">boolean</span> b<span class="token operator">=</span>job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> b<span class="token operator">?</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> exitCode<span class="token operator">=</span> <span class="token class-name">ToolRunner</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">HBaseMR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>exitCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="第六步-本地运行或打成jar包提交到集群中运行"><a href="#第六步-本地运行或打成jar包提交到集群中运行" class="header-anchor">#</a> 第六步：本地运行或打成jar包提交到集群中运行</h5> <div class="language-shell extra-class"><pre class="language-shell"><code>hadoop jar hbase_day03-1.0-SNAPSHOT.jar com.kaikeba.hbase.demo01.HBaseMR
</code></pre></div><h5 id="查看效果"><a href="#查看效果" class="header-anchor">#</a> 查看效果</h5> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:006:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'myuser2'</span>
ROW                                             COLUMN+CELL                                                                                                                               
 00001                                          <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582836163648</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x12                                                                            
 00001                                          <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582836163648</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal                                                                                    
 0002                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x1E                                                                            
 0002                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xB9<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x93<span class="token punctuation">\</span>x8D                                                                   
 0004                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token comment">##                                                                               </span>
 0004                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>xAD<span class="token punctuation">\</span>x99<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x9D<span class="token punctuation">\</span>x83                                                                   
 0005                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x1C                                                                            
 0005                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>xAF<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>x91<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xAE                                                       
 0006                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x1B                                                                            
 0006                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x8F<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>xE9<span class="token punctuation">\</span>xA9<span class="token punctuation">\</span>xAC<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x87<span class="token punctuation">\</span>xBF                                                       
 0007                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x1C                                                                            
 0007                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>xiaobubu<span class="token punctuation">\</span>xE2<span class="token punctuation">\</span>x80<span class="token punctuation">\</span>x94<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x90<span class="token punctuation">\</span>x95<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>x83                                               
<span class="token number">6</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.1110</span> seconds

</code></pre></div><h4 id="实战二-hdfs-hbase"><a href="#实战二-hdfs-hbase" class="header-anchor">#</a> 实战二：hdfs--&gt;HBase</h4> <h5 id="实战需求-2"><a href="#实战需求-2" class="header-anchor">#</a> 实战需求</h5> <p>读取hdfs上面某个文件的的数据，写入到hbase的myuser2表里面去。</p> <p><img src="/assets/img/image-20200304024124478.7d7684a9.png" alt="image-20200304024124478"></p> <h5 id="第一步-准备数据文件"><a href="#第一步-准备数据文件" class="header-anchor">#</a> 第一步：准备数据文件</h5> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /tmp/
<span class="token function">vim</span> user.txt
0007	zhangsan	<span class="token number">18</span>
0008	lisi	<span class="token number">25</span>
0009	wangwu	<span class="token number">20</span>
</code></pre></div><p>将文件上传到hdfs的路径下面去</p> <div class="language-shell extra-class"><pre class="language-shell"><code>hdfs dfs -mkdir /hbase_input_data
hdfs dfs -put /tmp/user.txt /hbase_input_data
</code></pre></div><h5 id="第二步-定义mapreduce逻辑、组装类和main方法"><a href="#第二步-定义mapreduce逻辑、组装类和main方法" class="header-anchor">#</a> 第二步：定义MapReduce逻辑、组装类和main方法</h5> <p>使用创建内部类的方法，定义reduce逻辑、组装类、main()方法。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span></span><span class="token class-name">HBase</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configured</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>fs<span class="token punctuation">.</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Put</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ImmutableBytesWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">TableMapReduceUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">TableMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">TableReducer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">LongWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">NullWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Text</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">Job</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>input<span class="token punctuation">.</span></span><span class="token class-name">FileInputFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Tool</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ToolRunner</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HbaseCombat</span> <span class="token punctuation">{</span>
   <span class="token comment">//Mapper类作为内部类时，一定要声明为static</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span><span class="token class-name">Text</span><span class="token punctuation">,</span><span class="token class-name">Text</span><span class="token punctuation">,</span><span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
           context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token comment">//作为内部类时，一定要声明为static</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyTableReducer</span> <span class="token keyword">extends</span> <span class="token class-name">TableReducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span><span class="token class-name">NullWritable</span><span class="token punctuation">,</span><span class="token class-name">ImmutableBytesWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
           <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> strArr<span class="token operator">=</span>key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">Put</span> put<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span>strArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>strArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>strArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ImmutableBytesWritable</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span>strArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>put<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Assem</span> <span class="token keyword">extends</span> <span class="token class-name">Configured</span> <span class="token keyword">implements</span> <span class="token class-name">Tool</span><span class="token punctuation">{</span>
       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
           <span class="token class-name">Job</span> job<span class="token operator">=</span><span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getConf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">HbaseCombat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//设置输入类的输入文件路径</span>
           <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">addInputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://node01:8020/hbase_input_data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//设置要使用的Mapper类以及输出键值对类型</span>
           job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">MyMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//设置要使用的TableReducer类,设置的表必须是已经存在的表</span>
           <span class="token class-name">TableMapReduceUtil</span><span class="token punctuation">.</span><span class="token function">initTableReducerJob</span><span class="token punctuation">(</span><span class="token string">&quot;myuser2&quot;</span><span class="token punctuation">,</span><span class="token class-name">MyTableReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//设置ReduceTask个数为1</span>
           job<span class="token punctuation">.</span><span class="token function">setNumReduceTasks</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">boolean</span> b<span class="token operator">=</span>job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> b<span class="token operator">?</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">int</span> exitCode<span class="token operator">=</span> <span class="token class-name">ToolRunner</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Assem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:019:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'myuser2'</span>
ROW                                             COLUMN+CELL                                                                                                                               
 00001                                          <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582836163648</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x12                                                                            
 00001                                          <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582836163648</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal                                                                                    
 0002                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x1E                                                                            
 0002                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xB9<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x93<span class="token punctuation">\</span>x8D                                                                   
 0004                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token comment">##                                                                               </span>
 0004                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>xAD<span class="token punctuation">\</span>x99<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x9D<span class="token punctuation">\</span>x83                                                                   
 0005                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x1C                                                                            
 0005                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>xAF<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>x91<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xAE                                                       
 0006                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x00<span class="token punctuation">\</span>x1B                                                                            
 0006                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1582837532912</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>x8F<span class="token punctuation">\</span>xB8<span class="token punctuation">\</span>xE9<span class="token punctuation">\</span>xA9<span class="token punctuation">\</span>xAC<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>x87<span class="token punctuation">\</span>xBF                                                       
 0007                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583310181335</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">18</span>                                                                                          
 0007                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583310181335</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan                                                                                   
 0008                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583310181335</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">25</span>                                                                                          
 0008                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583310181335</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>lisi                                                                                       
 0009                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583310181335</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>                                                                                          
 0009                                           <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583310181335</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>wangwu                                                                                     
</code></pre></div><h5 id="第三步-打成jar包提交到集群中运行"><a href="#第三步-打成jar包提交到集群中运行" class="header-anchor">#</a> 第三步：打成jar包提交到集群中运行</h5> <div class="language-shell extra-class"><pre class="language-shell"><code>hadoop jar hbase_day03-1.0-SNAPSHOT.jar com.kaikeba.hbase.demo02.HDFS2HBase
</code></pre></div><h4 id="实战三-hdfs-hbase-bulkload"><a href="#实战三-hdfs-hbase-bulkload" class="header-anchor">#</a> 实战三：hdfs--&gt;HBase (bulkload)</h4> <p>加载hdfs的数据到HBase表当中去的方式多种多样，我们可以使用实战2中的HBase的javaAPI或者使用sqoop将我们的数据写入或者导入到HBase当中去，但是这些方式慢且导入的过程的占用Region资源，导致效率低下。这时候我们可以使用bulkload的方式来加载数据,这种方式可以提高加载大量数据的速度。</p> <p>bulkload方式就是通过MR的程序，将hdfs中的数据直接转换成HBase的最终存储格式HFile，然后直接load数据到HBase当中去即可。</p> <p>bulk[bʌlk] --&gt;主体; 大部分; (大) 体积; 大(量); 巨大的体重(或重量、形状、身体等);</p> <img src="hbase.assets/image-20200304202840242.png" alt="image-20200304202840242" style="zoom:67%;"> <p>HBase数据正常写流程回顾</p> <p><img src="/assets/img/image-20200304182702175.a7263c53.png" alt="image-20200304182702175"></p> <p>bulkload方式的处理示意图</p> <p><img src="/assets/img/image-20200304202418195.69918268.png" alt="image-20200304202418195"></p> <h5 id="实战需求-3"><a href="#实战需求-3" class="header-anchor">#</a> 实战需求</h5> <p>通过bulkload的方式批量加载数据到HBase表中，将我们hdfs的/hbase_input_data路径的数据文件，转换成HFile格式，然后load到myuser2这张表里面去。</p> <h5 id="第一步-自定义map类"><a href="#第一步-自定义map类" class="header-anchor">#</a> 第一步：自定义map类</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span></span><span class="token class-name">HBase03</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Put</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ImmutableBytesWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">LongWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Text</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BulkLoadMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span><span class="token class-name">ImmutableBytesWritable</span><span class="token punctuation">,</span><span class="token class-name">Put</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span>strArr<span class="token operator">=</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ImmutableBytesWritable</span> immtbw<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ImmutableBytesWritable</span><span class="token punctuation">(</span>strArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Put</span> put<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span>strArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>strArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>strArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>immtbw<span class="token punctuation">,</span>put<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="第二部-定义组装类和main-方法"><a href="#第二部-定义组装类和main-方法" class="header-anchor">#</a> 第二部：定义组装类和Main()方法</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span></span><span class="token class-name">HBase03</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configured</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>fs<span class="token punctuation">.</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Put</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Table</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ImmutableBytesWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">HFileOutputFormat2</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">Job</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>input<span class="token punctuation">.</span></span><span class="token class-name">FileInputFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Tool</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ToolRunner</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HBaseBulkLoad</span> <span class="token keyword">extends</span> <span class="token class-name">Configured</span> <span class="token keyword">implements</span> <span class="token class-name">Tool</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Job</span> job<span class="token operator">=</span><span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getConf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">HBaseBulkLoad</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//设置Map逻辑的输入路径（默认输入类为TextInputFormat)</span>
        <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">addInputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://node01:8020/hbase_input_data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">BulkLoadMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">ImmutableBytesWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">Put</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//设置输出类</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputFormatClass</span><span class="token punctuation">(</span><span class="token class-name">HFileOutputFormat2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置输出路径</span>
        <span class="token class-name">HFileOutputFormat2</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://node01:8020/hbase_out_data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//配置MapReduce作业，以执行增量加载到给定表中</span>
        <span class="token comment">//使得MapReduce可以向myuser2表中增量增加数据：</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getConf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Table</span> myTable<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;myuser2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HFileOutputFormat2</span><span class="token punctuation">.</span><span class="token function">configureIncrementalLoad</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span>myTable<span class="token punctuation">,</span>conne<span class="token punctuation">.</span><span class="token function">getRegionLocator</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;myuser2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">boolean</span> b<span class="token operator">=</span>job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> b<span class="token operator">?</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> exitCode<span class="token operator">=</span> <span class="token class-name">ToolRunner</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">HBaseBulkLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>exitCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="第三步-本地运行或jar包提交到集群中运行"><a href="#第三步-本地运行或jar包提交到集群中运行" class="header-anchor">#</a> 第三步：本地运行或jar包提交到集群中运行</h5> <div class="language-shell extra-class"><pre class="language-shell"><code>hadoop jar hbase_day03-1.0-SNAPSHOT.jar com.kaikeba.hbase.demo03.HBaseBulkLoad
</code></pre></div><h5 id="第四步-查看生成的hfile文件"><a href="#第四步-查看生成的hfile文件" class="header-anchor">#</a> 第四步：查看生成的HFile文件</h5> <p><img src="/assets/img/image-20200304212926221.47b3abb6.png" alt="image-20200304212926221"></p> <h5 id="第五步-加载hfile文件到hbase表中"><a href="#第五步-加载hfile文件到hbase表中" class="header-anchor">#</a> 第五步：加载HFile文件到hbase表中</h5> <p>####### 方式1：代码加载</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span></span><span class="token class-name">HBase03</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>fs<span class="token punctuation">.</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Admin</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Table</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">LoadIncrementalHFiles</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoadData</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建Connection对象</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取Admin管理对象</span>
        <span class="token class-name">Admin</span> am<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取Table对象</span>
        <span class="token class-name">Table</span> myTable<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;myuser2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取LoadIncrementalHFiles对象</span>
        <span class="token class-name">LoadIncrementalHFiles</span> load<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">LoadIncrementalHFiles</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//加载HFile文件中数据到表</span>
        load<span class="token punctuation">.</span><span class="token function">doBulkLoad</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://node01:8020/hbase_out_data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>am<span class="token punctuation">,</span>myTable<span class="token punctuation">,</span>conne<span class="token punctuation">.</span><span class="token function">getRegionLocator</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;myuser2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>####### 方式2：命令加载</p> <p>先将hbase的jar包添加到hadoop的classpath路径下</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node01 tmp<span class="token punctuation">]</span>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">HBASE_HOME</span><span class="token operator">=</span>/kkb/install/hbase-1.2.0-cdh5.14.2/
<span class="token punctuation">[</span>hadoop@node01 tmp<span class="token punctuation">]</span>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/kkb/install/hadoop-2.6.0-cdh5.14.2/
<span class="token punctuation">[</span>hadoop@node01 tmp<span class="token punctuation">]</span>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_CLASSPATH</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$<span class="token punctuation">{</span>HBASE_HOME<span class="token punctuation">}</span>/bin/hbase mapredcp<span class="token variable">`</span></span>
</code></pre></div><p>运行命令</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> jar /kkb/install/hbase-1.2.0-cdh5.14.2/lib/hbase-server-1.2.0-cdh5.14.2.jar   
completebulkload /hbase_out_data myuser2

<span class="token comment">#/kkb/install/hbase-1.2.0-cdh5.14.2/lib/hbase-server-1.2.0-cdh5.14.2.jar是系统自带的jar包</span>
<span class="token comment">#completebulkload是jar包的主类</span>
<span class="token comment">#/hbase_out_data是HFile文件路径</span>
<span class="token comment">#myuser2是要加载HFile数据的表名</span>
</code></pre></div><h5 id="第六步-查看加载的效果"><a href="#第六步-查看加载的效果" class="header-anchor">#</a> 第六步：查看加载的效果</h5> <p>可以看到时间戳发生了变化。</p> <p><img src="/assets/img/image-20200304214754596.e88e145b.png" alt="image-20200304214754596"></p> <h2 id="hbase集成hive-重点"><a href="#hbase集成hive-重点" class="header-anchor">#</a> HBase集成Hive（重点）</h2> <p>Hive提供了与HBase的集成，使得能够在HBase表上使用hive sql 语句进行查询、插入操作以及进行Join和Union等复杂查询，同时也可以将hive表中的数据映射到Hbase中</p> <h4 id="hbase与hive的对比"><a href="#hbase与hive的对比" class="header-anchor">#</a> HBase与Hive的对比</h4> <h5 id="hive"><a href="#hive" class="header-anchor">#</a> Hive</h5> <ul><li><p>数据仓库</p> <p>Hive的本质其实就相当于将HDFS中已经存储的文件在Mysql中做了一个双射关系，以方便使用HQL去管理查询。</p></li> <li><p>用于数据分析、清洗</p> <p>Hive适用于离线的数据分析和清洗，延迟较高</p></li> <li><p>基于HDFS、MapReduce</p> <p>Hive存储的数据依旧在DataNode上，编写的HQL语句终将是转换为MapReduce代码执行。（不要钻不需要执行MapReduce代码的情况的牛角尖）</p></li></ul> <h5 id="hbase"><a href="#hbase" class="header-anchor">#</a> HBase</h5> <ul><li><p>数据库</p> <p>是一种面向列存储的非关系型数据库。</p></li> <li><p>用于存储结构化和非结构话的数据</p> <p>适用于单表非关系型数据的存储，不适合做关联查询，类似JOIN等操作。</p></li> <li><p>基于HDFS</p> <p>数据持久化存储的体现形式是Hfile，存放于DataNode中，被ResionServer以region的形式进行管理。</p></li> <li><p>延迟较低，接入在线业务使用</p> <p>面对大量的企业数据，HBase可以直线单表大量数据的存储，同时提供了高效的数据访问速度。</p></li></ul> <h6 id="总结-hive与hbase"><a href="#总结-hive与hbase" class="header-anchor">#</a> 总结：Hive与HBase</h6> <ul><li>Hive和Hbase是两种基于Hadoop的不同技术，Hive是一种类SQL的引擎，并且运行MapReduce任务，Hbase是一种在Hadoop之上的NoSQL 的Key/vale数据库。这两种工具是可以同时使用的。就像用Google来搜索，用FaceBook进行社交一样，Hive可以用来进行统计查询，HBase可以用来进行实时查询，数据也可以从Hive写到HBase，或者从HBase写回Hive。</li></ul> <h4 id="hbase与hive的整合配置"><a href="#hbase与hive的整合配置" class="header-anchor">#</a> HBase与Hive的整合配置</h4> <p>为什么要进行整合配置？看下图：</p> <img src="hbase.assets/image-20200304235841132.png" alt="image-20200304235841132" style="zoom:67%;"> <h5 id="第一步-拷贝jar包-创建软链接"><a href="#第一步-拷贝jar包-创建软链接" class="header-anchor">#</a> 第一步：拷贝jar包(创建软链接)</h5> <p>在Hive的lib目录下创建HBase的五个jar包的软链接</p> <p>hbase的jar包都在/kkb/install/hbase-1.2.0-cdh5.14.2/lib目录下，我们需要拷贝五个jar包名字如下：</p> <div class="language- extra-class"><pre class="language-text"><code>hbase-client-1.2.0-cdh5.14.2.jar                  
hbase-hadoop2-compat-1.2.0-cdh5.14.2.jar 
hbase-hadoop-compat-1.2.0-cdh5.14.2.jar  
hbase-it-1.2.0-cdh5.14.2.jar    
hbase-server-1.2.0-cdh5.14.2.jar
</code></pre></div><p>直接在node03执行以下命令，通过创建软连接的方式来进行jar包的依赖</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">ln</span> -s /kkb/install/hbase-1.2.0-cdh5.14.2/lib/hbase-client-1.2.0-cdh5.14.2.jar /kkb/install/hive-1.1.0-cdh5.14.2/lib/hbase-client-1.2.0-cdh5.14.2.jar   
<span class="token function">ln</span> -s /kkb/install/hbase-1.2.0-cdh5.14.2/lib/hbase-hadoop2-compat-1.2.0-cdh5.14.2.jar /kkb/install/hive-1.1.0-cdh5.14.2/lib/hbase-hadoop2-compat-1.2.0-cdh5.14.2.jar             
<span class="token function">ln</span> -s /kkb/install/hbase-1.2.0-cdh5.14.2/lib/hbase-hadoop-compat-1.2.0-cdh5.14.2.jar  /kkb/install/hive-1.1.0-cdh5.14.2/lib/hbase-hadoop-compat-1.2.0-cdh5.14.2.jar            
<span class="token function">ln</span> -s /kkb/install/hbase-1.2.0-cdh5.14.2/lib/hbase-it-1.2.0-cdh5.14.2.jar /kkb/install/hive-1.1.0-cdh5.14.2/lib/hbase-it-1.2.0-cdh5.14.2.jar    
<span class="token function">ln</span> -s /kkb/install/hbase-1.2.0-cdh5.14.2/lib/hbase-server-1.2.0-cdh5.14.2.jar   /kkb/install/hive-1.1.0-cdh5.14.2/lib/hbase-server-1.2.0-cdh5.14.2.jar  
</code></pre></div><h5 id="第二步-修改hive的配置文件"><a href="#第二步-修改hive的配置文件" class="header-anchor">#</a> 第二步：修改hive的配置文件</h5> <p>编辑node03服务器上面的hive的配置文件hive-site.xml</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hive-1.1.0-cdh5.14.2/conf
<span class="token function">vim</span> hive-site.xml
</code></pre></div><p>添加以下两个属性的配置</p> <div class="language-xml extra-class"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.zookeeper.quorum<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>node01,node02,node03<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.zookeeper.quorum<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>node01,node02,node03<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="第三步-修改hive-env-sh配置文件"><a href="#第三步-修改hive-env-sh配置文件" class="header-anchor">#</a> 第三步：修改hive-env.sh配置文件</h5> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hive-1.1.0-cdh5.14.2/conf
<span class="token function">vim</span> hive-env.sh
</code></pre></div><p>添加以下配置</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/kkb/install/hadoop-2.6.0-cdh5.14.2/
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HBASE_HOME</span><span class="token operator">=</span>/kkb/install/hbase-1.2.0-cdh5.14.2
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HIVE_CONF_DIR</span><span class="token operator">=</span>/kkb/install/hive-1.1.0-cdh5.14.2/conf
</code></pre></div><img src="hbase.assets/image-20200305000557525.png" alt="image-20200305000557525" style="zoom:80%;"> <h4 id="hive与hbase整合案例1"><a href="#hive与hbase整合案例1" class="header-anchor">#</a> Hive与HBase整合案例1</h4> <h5 id="案例需求"><a href="#案例需求" class="header-anchor">#</a> 案例需求</h5> <p>将hive表分析结果保存到hbase表当中去。</p> <h5 id="案例分析"><a href="#案例分析" class="header-anchor">#</a> 案例分析</h5> <p>实现思路如下：</p> <img src="hbase.assets/image-20200305020558336.png" alt="image-20200305020558336" style="zoom:67%;"> <h5 id="第一步-hive当中建表"><a href="#第一步-hive当中建表" class="header-anchor">#</a> 第一步：hive当中建表</h5> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ <span class="token function">nohup</span> hive -service hiveserver2 <span class="token operator">&amp;</span>
<span class="token punctuation">[</span>hadoop@node03 ~<span class="token punctuation">]</span>$ beeline
beeline<span class="token operator">&gt;</span> <span class="token operator">!</span>connect jdbc:hive2://node03:10000<span class="token operator">!</span>connect

<span class="token comment">#或者进入hive shell来进行以下操作也是可以的</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> hive_hbase_test<span class="token punctuation">;</span>
<span class="token keyword">use</span> hive_hbase_test<span class="token punctuation">;</span>

<span class="token keyword">create</span> external <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> score<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>cname string<span class="token punctuation">,</span>score <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span> stored <span class="token keyword">as</span> textfile<span class="token punctuation">;</span>
</code></pre></div><h5 id="第二步-准备数据并加载到hive表"><a href="#第二步-准备数据并加载到hive表" class="header-anchor">#</a> 第二步：准备数据并加载到hive表</h5> <p>node03执行以下命令，创建数据文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hivedatas
<span class="token function">vim</span> hive-hbase.txt
</code></pre></div><p>文件内容如下</p> <div class="language- extra-class"><pre class="language-text"><code>1	zhangsan	80
2	lisi	60
3	wangwu	30
4	zhaoliu	70
</code></pre></div><p>加载数据到hive表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#加载数据:</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; load data local inpath '/kkb/install/hivedatas/hive-hbase.txt' into table score;</span>

<span class="token comment">#查看表数据:</span>
<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from course_score;</span>
<span class="token operator">+</span><span class="token comment">------------------+---------------------+---------------------+--+</span>
<span class="token operator">|</span> course_score<span class="token punctuation">.</span>id  <span class="token operator">|</span> course_score<span class="token punctuation">.</span>cname  <span class="token operator">|</span> course_score<span class="token punctuation">.</span>score  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+---------------------+---------------------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>                <span class="token operator">|</span> zhangsan            <span class="token operator">|</span> <span class="token number">80</span>                  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>                <span class="token operator">|</span> lisi                <span class="token operator">|</span> <span class="token number">60</span>                  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>                <span class="token operator">|</span> wangwu              <span class="token operator">|</span> <span class="token number">30</span>                  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">4</span>                <span class="token operator">|</span> zhaoliu             <span class="token operator">|</span> <span class="token number">70</span>                  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+---------------------+---------------------+--+</span>
</code></pre></div><h5 id="第三步-创建hive管理表与hbase进行映射"><a href="#第三步-创建hive管理表与hbase进行映射" class="header-anchor">#</a> 第三步：创建hive管理表与HBase进行映射</h5> <p>我们可以创建一个hive的管理表与hbase当中的表进行映射，hive管理表当中的数据，都会存储到hbase上面去。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> score2<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>cname string<span class="token punctuation">,</span>score <span class="token keyword">int</span><span class="token punctuation">)</span> 
stored <span class="token keyword">by</span> <span class="token string">'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span>  
<span class="token keyword">with</span> serdeproperties<span class="token punctuation">(</span><span class="token string">&quot;hbase.columns.mapping&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;cf:name,cf:score&quot;</span><span class="token punctuation">)</span> tblproperties<span class="token punctuation">(</span><span class="token string">&quot;hbase.table.name&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;hbase_score&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 通过HBaseStorageHandler方式来进行存储</span>
<span class="token comment">-- &quot;hbase.columns.mapping&quot; = &quot;cf:name,cf:score&quot;  代表hive表中的cname和score列分别对应hbase表中的name和score列</span>
<span class="token comment">-- &quot;hbase.table.name&quot; = &quot;hbase_score&quot; 代表hive的这张表映射到hbase中的hbase_score表。</span>
<span class="token comment">-- id默认缺省对应hbase表中的rowkey</span>

<span class="token comment">#期间，出现了一些问题:FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. org/apache/hadoop/hive/hbase/HiveHBaseTableInputFormat,</span>
最终是关闭hadoop\zk\hbase\hive，然后重启解决了
</code></pre></div><p>通过insert  overwrite select  插入数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> overwrite <span class="token keyword">table</span> course<span class="token punctuation">.</span>hbase_score <span class="token keyword">select</span> id<span class="token punctuation">,</span>cname<span class="token punctuation">,</span>score <span class="token keyword">from</span> course<span class="token punctuation">.</span>score<span class="token punctuation">;</span>
</code></pre></div><h5 id="第四步-查看效果"><a href="#第四步-查看效果" class="header-anchor">#</a> 第四步：查看效果</h5> <p>查看Hive中的表score2</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; show tables;</span>
<span class="token operator">+</span><span class="token comment">-----------+--+</span>
<span class="token operator">|</span> tab_name  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+--+</span>
<span class="token operator">|</span> score     <span class="token operator">|</span>
<span class="token operator">|</span> score2    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+--+</span>

<span class="token number">0</span>: jdbc:hive2:<span class="token comment">//node03:10000&gt; select * from score2;</span>
<span class="token operator">+</span><span class="token comment">------------+---------------+---------------+--+</span>
<span class="token operator">|</span> score2<span class="token punctuation">.</span>id  <span class="token operator">|</span> score2<span class="token punctuation">.</span>cname  <span class="token operator">|</span> score2<span class="token punctuation">.</span>score  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+---------------+---------------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>          <span class="token operator">|</span> zhangsan      <span class="token operator">|</span> <span class="token number">80</span>            <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>          <span class="token operator">|</span> lisi          <span class="token operator">|</span> <span class="token number">60</span>            <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>          <span class="token operator">|</span> wangwu        <span class="token operator">|</span> <span class="token number">30</span>            <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">4</span>          <span class="token operator">|</span> zhaoliu       <span class="token operator">|</span> <span class="token number">70</span>            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+---------------+---------------+--+</span>
</code></pre></div><p>进入hbase的客户端查看表hbase_score，并查看当中的数据</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">001</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> list
<span class="token constant">TABLE</span>                      
hbase_score                
mytable                    
myuser                     
myuser2                    
person2                    
person3                    
person4                    
student                    
t1                         
t2                         
t5                         
test01                     
user                       
<span class="token number">13</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.2800</span> seconds

<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;hbase_score&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mytable&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;myuser&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;myuser2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;person2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;person3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;person4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;student&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;t5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test01&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">]</span>

hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">003</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> scan <span class="token string">'hbase_score'</span>
<span class="token constant">ROW</span>                           <span class="token constant">COLUMN</span><span class="token operator">+</span><span class="token constant">CELL</span>                                     
 <span class="token number">1</span>                            column<span class="token operator">=</span>cf<span class="token symbol">:name</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1583373496020</span><span class="token punctuation">,</span> value<span class="token operator">=</span>zhangsan
 <span class="token number">1</span>                            column<span class="token operator">=</span>cf<span class="token symbol">:score</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1583373496020</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token number">80</span>     
 <span class="token number">2</span>                            column<span class="token operator">=</span>cf<span class="token symbol">:name</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1583373496020</span><span class="token punctuation">,</span> value<span class="token operator">=</span>lisi    
 <span class="token number">2</span>                            column<span class="token operator">=</span>cf<span class="token symbol">:score</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1583373496020</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token number">60</span>     
 <span class="token number">3</span>                            column<span class="token operator">=</span>cf<span class="token symbol">:name</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1583373496020</span><span class="token punctuation">,</span> value<span class="token operator">=</span>wangwu  
 <span class="token number">3</span>                            column<span class="token operator">=</span>cf<span class="token symbol">:score</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1583373496020</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token number">30</span>     
 <span class="token number">4</span>                            column<span class="token operator">=</span>cf<span class="token symbol">:name</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1583373496020</span><span class="token punctuation">,</span> value<span class="token operator">=</span>zhaoliu 
 <span class="token number">4</span>                            column<span class="token operator">=</span>cf<span class="token symbol">:score</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1583373496020</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token number">70</span>     
</code></pre></div><h4 id="hive与hbase整合案例2"><a href="#hive与hbase整合案例2" class="header-anchor">#</a> Hive与HBase整合案例2</h4> <h5 id="案例需求-2"><a href="#案例需求-2" class="header-anchor">#</a> 案例需求</h5> <p>创建hive外部表，映射HBase当中已有的表模型</p> <h5 id="第一步-hbase中建表并加载数据"><a href="#第一步-hbase中建表并加载数据" class="header-anchor">#</a> 第一步：HBase中建表并加载数据</h5> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase shell

<span class="token comment">## 创建一张表</span>
create <span class="token string">'hbase_hive_score'</span><span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token constant">NAME</span> <span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'cf'</span><span class="token punctuation">}</span>
<span class="token comment">## 通过put插入数据到hbase表</span>
put <span class="token string">'hbase_hive_score'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'cf:name'</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span>
put <span class="token string">'hbase_hive_score'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'cf:score'</span><span class="token punctuation">,</span> <span class="token string">'95'</span>
put <span class="token string">'hbase_hive_score'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'cf:name'</span><span class="token punctuation">,</span><span class="token string">'lisi'</span>
put <span class="token string">'hbase_hive_score'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'cf:score'</span><span class="token punctuation">,</span> <span class="token string">'96'</span>
put <span class="token string">'hbase_hive_score'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'cf:name'</span><span class="token punctuation">,</span><span class="token string">'wangwu'</span>
put <span class="token string">'hbase_hive_score'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'cf:score'</span><span class="token punctuation">,</span> <span class="token string">'97'</span>
</code></pre></div><h5 id="第二步-hive中建外部表-映射hbase中的表及字段"><a href="#第二步-hive中建外部表-映射hbase中的表及字段" class="header-anchor">#</a> 第二步：Hive中建外部表，映射HBase中的表及字段</h5> <p>创建Hive表，与hbase的hbase_hive_score表进行映射。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> external <span class="token keyword">TABLE</span> hbase2hive<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span> name string<span class="token punctuation">,</span> score <span class="token keyword">int</span><span class="token punctuation">)</span> 
STORED <span class="token keyword">BY</span> <span class="token string">'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span> 
<span class="token keyword">WITH</span> SERDEPROPERTIES <span class="token punctuation">(</span><span class="token string">&quot;hbase.columns.mapping&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;:key,cf:name,cf:score&quot;</span><span class="token punctuation">)</span> TBLPROPERTIES<span class="token punctuation">(</span><span class="token string">&quot;hbase.table.name&quot;</span> <span class="token operator">=</span><span class="token string">&quot;hbase_hive_score&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>查看hive表hbase2hive</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> hbase2hive<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+------------------+-------------------+--+</span>
<span class="token operator">|</span> hbase2hive<span class="token punctuation">.</span>id  <span class="token operator">|</span> hbase2hive<span class="token punctuation">.</span>name  <span class="token operator">|</span> hbase2hive<span class="token punctuation">.</span>score  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+------------------+-------------------+--+</span>
<span class="token operator">|</span> <span class="token number">1</span>              <span class="token operator">|</span> zhangsan         <span class="token operator">|</span> <span class="token number">95</span>                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>              <span class="token operator">|</span> lisi             <span class="token operator">|</span> <span class="token number">96</span>                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>              <span class="token operator">|</span> wangwu           <span class="token operator">|</span> <span class="token number">97</span>                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+------------------+-------------------+--+</span>
</code></pre></div><h2 id="hbase表的rowkey设计-重点"><a href="#hbase表的rowkey设计-重点" class="header-anchor">#</a> HBase表的rowkey设计（重点）</h2> <p>rowkey设计有三大原则。长度以及散列原则都是为了解决热点问题。</p> <h4 id="rowkey长度原则"><a href="#rowkey长度原则" class="header-anchor">#</a> rowkey长度原则</h4> <ul><li>rowkey是一个二进制码流，可以是任意字符串，最大长度64kb，实际应用中一般为10-100bytes，以byte[]形式保存，一般设计成定长。</li></ul> <ul><li>建议尽可能短；但是也不能太短，否则rowkey前缀重复的概率增大，会出现热点问题。</li> <li>设计过长会降低memstore内存的利用率和HFile存储数据的效率。</li></ul> <h4 id="rowkey散列原则"><a href="#rowkey散列原则" class="header-anchor">#</a> rowkey散列原则</h4> <ul><li>建议将rowkey的高位作为<strong>散列字段</strong>，这样将提高数据均衡分布在每个RegionServer，以实现负载均衡的几率。</li> <li>如果没有散列字段，首字段直接是时间信息。所有的数据都会集中在一个RegionServer上，这样在数据检索的时候负载会集中在个别的RegionServer上，造成热点问题，会降低查询效率。</li></ul> <h4 id="rowkey唯一原则"><a href="#rowkey唯一原则" class="header-anchor">#</a> rowkey唯一原则</h4> <ul><li>必须在设计上保证其唯一性，rowkey是按照字典顺序排序存储的</li> <li>因此，设计rowkey的时候，要充分利用这个排序的特点，可以将经常读取的数据存储到一块，将最近可能会被访问的数据放到一块</li></ul> <h4 id="应用场景实例"><a href="#应用场景实例" class="header-anchor">#</a> 应用场景实例</h4> <p>下图为电信上网详单数据，保存在HBase的一个应用场景,HBase能胜任快速响应的任务。</p> <p><img src="/assets/img/2019-10-16_112336.59c5d797.png" alt="2019-10-16_112336"></p> <p><img src="/assets/img/2019-10-16_112157.3388c21b.png" alt="2019-10-16_112157"></p> <p><img src="/assets/img/2019-10-16_112529.2adec574.png" alt="2019-10-16_112529"></p> <h2 id="hbase表的热点-重点"><a href="#hbase表的热点-重点" class="header-anchor">#</a> HBase表的热点（重点）</h2> <h4 id="什么是热点"><a href="#什么是热点" class="header-anchor">#</a> 什么是热点</h4> <p>hbase的数据是按照row key进行排序后存储的，而检索habse的记录首先要通过row key来定位数据行。当大量的client访问hbase集群的一个或少数几个节点，造成少数region server的读/写请求过多、负载过大，而其他region server负载却很小，就造成了“热点”现象。</p> <h4 id="热点的解决方案"><a href="#热点的解决方案" class="header-anchor">#</a> 热点的解决方案</h4> <h5 id="预分区"><a href="#预分区" class="header-anchor">#</a> 预分区</h5> <p>预分区的目的让表的数据可以均衡的分散在集群中，而不是默认只有一个region分布在集群的一个节点上。</p> <h5 id="加盐"><a href="#加盐" class="header-anchor">#</a> 加盐</h5> <p>这里所说的加盐不是密码学中的加盐，而是在rowkey的前面增加随机数，具体就是给rowkey分配一个随机前缀以使得它和之前的rowkey的开头不同</p> <h5 id="哈希"><a href="#哈希" class="header-anchor">#</a> 哈希</h5> <p>哈希会使同一行永远用一个前缀加盐。哈希也可以使负载分散到整个集群，但是读却是可以预测的。使用确定的哈希可以让客户端重构完整的rowkey，可以使用get操作准确获取某一个行数据。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token assign-left variable">rowkey</span><span class="token operator">=</span>MD5<span class="token punctuation">(</span>username<span class="token punctuation">)</span>.subString<span class="token punctuation">(</span><span class="token number">0,10</span><span class="token punctuation">)</span>+时间戳	
</code></pre></div><h5 id="反转"><a href="#反转" class="header-anchor">#</a> 反转</h5> <p>反转固定长度或者数字格式的rowkey。这样可以使得rowkey中经常改变的部分（最没有意义的部分）放在前面。</p> <p>这样可以有效的随机rowkey，但是牺牲了rowkey的有序性。</p> <div class="language- extra-class"><pre class="language-text"><code>电信公司：
移动-----------&gt; 136xxxx9301  -----&gt;1039xxxx631
				136xxxx1234  
				136xxxx2341 
电信
联通

user表
rowkey    name    age   sex    address
		  lisi1    21     m       beijing
		  lisi2    22     m       beijing
		  lisi3    25     m       beijing
		  lisi4    30     m       beijing
		  lisi5    40     f       shanghai
		  lisi6    50     f       tianjin
	          
需求：后期想经常按照居住地和年龄进行查询？	
rowkey= address+age+随机数
        beijing21+随机数
        beijing22+随机数
        beijing25+随机数
        beijing30+随机数
   
rowkey= address+age+随机数
</code></pre></div><h2 id="phoenix安装部署"><a href="#phoenix安装部署" class="header-anchor">#</a> Phoenix安装部署</h2> <h5 id="安装准备"><a href="#安装准备" class="header-anchor">#</a> 安装准备</h5> <p>需要先安装好hbase集群，phoenix只是一个工具，只需要在一台机器上安装就可以了，这里我们选择node02服务器来进行安装一台即可</p> <h5 id="下载安装包"><a href="#下载安装包" class="header-anchor">#</a> 下载安装包</h5> <p>下载地址：http://archive.apache.org/dist/phoenix/</p> <p>这里我们使用的版本是：apache-phoenix-4.14.0-cdh5.14.2-bin.tar.gz</p> <h5 id="上传解压"><a href="#上传解压" class="header-anchor">#</a> 上传解压</h5> <p>将安装包上传到node02服务器的/kkb/soft路径下，然后进行解压</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/soft/
<span class="token function">tar</span> -zxf apache-phoenix-4.14.0-cdh5.14.2-bin.tar.gz  -C /kkb/install/
</code></pre></div><h5 id="修改配置"><a href="#修改配置" class="header-anchor">#</a> 修改配置</h5> <p>####### 拷贝jar包到各节点的hbase的lib目录下</p> <p>将phoenix目录下的phoenix-4.8.2-HBase-1.2-server.jar、phoenix-core-4.8.2-HBase-1.2.jar拷贝到各个 hbase的lib目录下。</p> <p>node02执行以下命令，将两个jar包拷贝到hbase的lib目录下</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/apache-phoenix-4.14.0-cdh5.14.2-bin

<span class="token function">scp</span> phoenix-4.14.0-cdh5.14.2-server.jar phoenix-core-4.14.0-cdh5.14.2.jar node01:/kkb/install/hbase-1.2.0-cdh5.14.2/lib/ 

<span class="token function">scp</span> phoenix-4.14.0-cdh5.14.2-server.jar phoenix-core-4.14.0-cdh5.14.2.jar node02:/kkb/install/hbase-1.2.0-cdh5.14.2/lib/ 

<span class="token function">scp</span> phoenix-4.14.0-cdh5.14.2-server.jar phoenix-core-4.14.0-cdh5.14.2.jar node03:/kkb/install/hbase-1.2.0-cdh5.14.2/lib/ 
</code></pre></div><p>####### 拷贝hbase、hadoop配置文件到phoenix/ing目录下</p> <p>将hbase的配置文件hbase-site.xml、 hadoop下的配置文件core-site.xml、hdfs-site.xml放到phoenix/bin/下，替换phoenix原来的配置文件。</p> <p>只在node02执行以下命令，进行拷贝配置文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cp</span> /kkb/install/hadoop-2.6.0-cdh5.14.2/etc/hadoop/core-site.xml  /kkb/install/apache-phoenix-4.14.0-cdh5.14.2-bin/bin/

<span class="token function">cp</span> /kkb/install/hadoop-2.6.0-cdh5.14.2/etc/hadoop/hdfs-site.xml  /kkb/install/apache-phoenix-4.14.0-cdh5.14.2-bin/bin/

<span class="token function">cp</span> /kkb/install/hbase-1.2.0-cdh5.14.2/conf/hbase-site.xml  /kkb/install/apache-phoenix-4.14.0-cdh5.14.2-bin/bin/
</code></pre></div><p>####### 重启hbase集群，使Phoenix的jar包生效。</p> <p>记得要先启动hadoop集群、zookeeper集群</p> <p>node01执行以下命令来重启hbase的集群</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /kkb/install/hbase-1.2.0-cdh5.14.2/
bin/stop-hbase.sh 
bin/start-hbase.sh 
</code></pre></div><h5 id="验证是否成功"><a href="#验证是否成功" class="header-anchor">#</a> 验证是否成功</h5> <p>在phoenix/bin下输入命令, 进入到命令行，接下来就可以操作了</p> <p>==node02执行==以下命令，进入phoenix客户端</p> <div class="language-sh extra-class"><pre class="language-sh"><code> <span class="token builtin class-name">cd</span> /kkb/install/apache-phoenix-4.14.0-cdh5.14.2-bin/
 
 <span class="token punctuation">[</span>hadoop@node02 apache-phoenix-4.14.0-cdh5.14.2-bin<span class="token punctuation">]</span>$ bin/sqlline.py node01:2181
Setting property: <span class="token punctuation">[</span>incremental, false<span class="token punctuation">]</span>
Setting property: <span class="token punctuation">[</span>isolation, TRANSACTION_READ_COMMITTED<span class="token punctuation">]</span>
issuing: <span class="token operator">!</span>connect jdbc:phoenix:node01:2181 none none org.apache.phoenix.jdbc.PhoenixDriver
Connecting to jdbc:phoenix:node01:2181
SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding <span class="token keyword">in</span> <span class="token punctuation">[</span>jar:file:/kkb/install/apache-phoenix-4.14.0-cdh5.14.2-bin/phoenix-4.14.0-cdh5.14.2-client.jar<span class="token operator">!</span>/org/slf4j/impl/StaticLoggerBinder.class<span class="token punctuation">]</span>
SLF4J: Found binding <span class="token keyword">in</span> <span class="token punctuation">[</span>jar:file:/kkb/install/hadoop-2.6.0-cdh5.14.2/share/hadoop/common/lib/slf4j-log4j12-1.7.5.jar<span class="token operator">!</span>/org/slf4j/impl/StaticLoggerBinder.class<span class="token punctuation">]</span>
SLF4J: See http://www.slf4j.org/codes.html<span class="token comment">#multiple_bindings for an explanation.</span>
SLF4J: Actual binding is of <span class="token builtin class-name">type</span> <span class="token punctuation">[</span>org.slf4j.impl.Log4jLoggerFactory<span class="token punctuation">]</span>
<span class="token number">20</span>/03/05 <span class="token number">12</span>:04:53 WARN util.NativeCodeLoader: Unable to load native-hadoop library <span class="token keyword">for</span> your platform<span class="token punctuation">..</span>. using builtin-java classes where applicable
Connected to: Phoenix <span class="token punctuation">(</span>version <span class="token number">4.14</span><span class="token punctuation">)</span>
Driver: PhoenixEmbeddedDriver <span class="token punctuation">(</span>version <span class="token number">4.14</span><span class="token punctuation">)</span>
Autocommit status: <span class="token boolean">true</span>
Transaction isolation: TRANSACTION_READ_COMMITTED
Building list of tables and columns <span class="token keyword">for</span> tab-completion <span class="token punctuation">(</span>set fastconnect to <span class="token boolean">true</span> to skip<span class="token punctuation">)</span><span class="token punctuation">..</span>.
<span class="token number">133</span>/133 <span class="token punctuation">(</span><span class="token number">100</span>%<span class="token punctuation">)</span> Done
Done
sqlline version <span class="token number">1.2</span>.0
<span class="token number">0</span>: jdbc:phoenix:node01:218<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> 
</code></pre></div><h2 id="phoenix使用"><a href="#phoenix使用" class="header-anchor">#</a> Phoenix使用</h2> <p>Phoenix是一个HBase框架，可以通过SQL的方式来操作HBase。</p> <p>Phoenix是构建在HBase上的一个SQL层，是内嵌在HBase中的JDBC驱动，能够让用户使用标准的JDBC来操作HBase。</p> <p>Phoenix使用JAVA语言进行编写，其查询引擎 会将SQL查询语句转换成一个或多个HBase Scanner，且并行执行生成标准的JDBC结果集</p> <h3 id="批处理方式"><a href="#批处理方式" class="header-anchor">#</a> 批处理方式</h3> <p>通过/bin/psql.py命令批量加载csv数据到表中，这是单线程加载的。psql方式适合几十MB的数据量。如果有更大的数据量，使用HBase与MapReduce的整合方式更好。</p> <p>表本身存在时，语法格式：bin/psql.py -t EXAMPLE localhost data.csv，-t后面是表名，localhost是HBase的所在主节点。</p> <p>表不存在时，语法格式：./psql.py localhost:2222 XXX.sql(建表) XXX.csv(数据) XXX.sql(查询）</p> <h5 id="实例1-表不存在情况"><a href="#实例1-表不存在情况" class="header-anchor">#</a> 实例1：表不存在情况</h5> <p>node02执行以下命令创建create_user_phoenix.sql文件，内容如下</p> <div class="language-mysql extra-class"><pre class="language-text"><code>mkdir -p /tmp/phoenixsql
cd /tmp/phoenixsql/
vim user_phoenix.sql

create table if not exists user_phoenix (state varchar(10) NOT NULL,  city varchar(20) NOT NULL, population BIGINT  CONSTRAINT my_pk PRIMARY KEY (state, city));

#CONSTRAINT是联合主键的意思，一般命名带pk
#主键不能有空值，且是唯一的不重复的。
#使用联合主键是因为使用单个字段作为主键时，有可能会重复。
</code></pre></div><p>node02执行以下命令，创建user_phoenix.csv数据文件。</p> <p>csv文件的命名一定要跟上面create语句中的表名(user_phoenix)一致！！！！！！！！</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /tmp/phoenixsql/
<span class="token function">vim</span> user_phoenix.csv  

NY,New York,8143197
CA,Los Angeles,3844829
IL,Chicago,2842518
TX,Houston,2016582
PA,Philadelphia,1463281
AZ,Phoenix,1461575
TX,San Antonio,1256509
CA,San Diego,1255540
TX,Dallas,1213825
CA,San Jose,912332
</code></pre></div><p>创建user_phoenix_query.sql文件</p> <div class="language-sql extra-class"><pre class="language-sql"><code>cd <span class="token operator">/</span>kkb<span class="token operator">/</span>install<span class="token operator">/</span>phoenixsql
vim user_phoenix_query<span class="token punctuation">.</span><span class="token keyword">sql</span>

<span class="token keyword">select</span> state <span class="token keyword">as</span> <span class="token string">&quot;userState&quot;</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&quot;City Count&quot;</span><span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>population<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&quot;Population Sum&quot;</span> <span class="token keyword">FROM</span> user_phoenix <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> state<span class="token punctuation">;</span> 
</code></pre></div><p>执行sql语句</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /kkb/install/phoenixsql

<span class="token punctuation">[</span>hadoop@node02 phoenixsql<span class="token punctuation">]</span>$ /kkb/install/apache-phoenix-4.14.0-cdh5.14.2-bin/bin/psql.py  node01:2181 create_user_phoenix.sql user_phoenix.csv  user_phoenix_query.sql

userState           City Count                           Population <span class="token function">sum</span> 
---------- ------------------- ------------------------------------------- 
AZ                       <span class="token number">1</span>                                  <span class="token number">1461575</span> 
CA                       <span class="token number">3</span>                                  <span class="token number">6012701</span> 
IL                       <span class="token number">1</span>                                  <span class="token number">2842518</span> 
NY                       <span class="token number">1</span>                                  <span class="token number">8143197</span> 
PA                       <span class="token number">1</span>                                  <span class="token number">1463281</span> 
TX                       <span class="token number">3</span>                                  <span class="token number">4486916</span> 
</code></pre></div><p>到hbase查看，是否建立了user_phoenix表。</p> <p>从下图可以看到，hbase上多了一个user_phoenix表，而且表名是大写的。这是因为Phoenix是大小写敏感的，并且所有命令都是大写,如果你建的表名没有用双引号括起来，那么无论你输入的是大写还是小写，建立出来的表名都是大写的。若想建立出包含小写的表名和字段名，请把表名或者字段名用双引号括起来。</p> <img src="hbase.assets/image-20200305152748223.png" alt="image-20200305152748223" style="zoom:80%;"> <h3 id="命令行方式"><a href="#命令行方式" class="header-anchor">#</a> 命令行方式</h3> <h5 id="进入命令行"><a href="#进入命令行" class="header-anchor">#</a> 进入命令行</h5> <div class="language-sh extra-class"><pre class="language-sh"><code>/kkb/install/apache-phoenix-4.14.0-cdh5.14.2-bin/bin/sqlline.py node01:2181
sqlline version <span class="token number">1.2</span>.0
<span class="token number">0</span>: jdbc:phoenix:node01:218<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> 
</code></pre></div><h5 id="退出命令行"><a href="#退出命令行" class="header-anchor">#</a> 退出命令行</h5> <p>phoenix的命令都需要一个感叹号。</p> <div class="language- extra-class"><pre class="language-text"><code>!quit
</code></pre></div><h5 id="查看phoenix的所有命令"><a href="#查看phoenix的所有命令" class="header-anchor">#</a> 查看phoenix的所有命令</h5> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token number">0</span><span class="token punctuation">:</span> jdbc<span class="token symbol">:phoenix</span><span class="token symbol">:node01</span><span class="token punctuation">:</span><span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token operator">!</span>help
<span class="token operator">!</span>all                <span class="token constant">Execute</span> the specified <span class="token constant">SQL</span> against all the current
                    connections
<span class="token operator">!</span>autocommit         <span class="token constant">Set</span> autocommit mode on <span class="token keyword">or</span> off
<span class="token operator">!</span>batch              <span class="token constant">Start</span> <span class="token keyword">or</span> execute a batch of statements
<span class="token operator">!</span>brief              <span class="token constant">Set</span> verbose mode off
<span class="token operator">!</span>call               <span class="token constant">Execute</span> a callable statement
<span class="token operator">!</span>close              <span class="token constant">Close</span> the current connection to the database
<span class="token operator">!</span>closeall           <span class="token constant">Close</span> all current open connections
<span class="token operator">!</span>columns            <span class="token constant">List</span> all the columns <span class="token keyword">for</span> the specified table
<span class="token operator">!</span>commit             <span class="token constant">Commit</span> the current transaction <span class="token punctuation">(</span><span class="token keyword">if</span> autocommit is off<span class="token punctuation">)</span>
<span class="token operator">!</span>connect            <span class="token constant">Open</span> a <span class="token keyword">new</span> connection to the database<span class="token punctuation">.</span>
<span class="token operator">!</span>dbinfo             <span class="token constant">Give</span> metadata information about the database
<span class="token operator">!</span>describe           <span class="token constant">Describe</span> a table
<span class="token operator">!</span>dropall            <span class="token constant">Drop</span> all tables <span class="token keyword">in</span> the current database
<span class="token operator">!</span>exportedkeys       <span class="token constant">List</span> all the exported keys <span class="token keyword">for</span> the specified table
<span class="token operator">!</span>go                 <span class="token constant">Select</span> the current connection
<span class="token operator">!</span>help               <span class="token constant">Print</span> a summary of command usage
<span class="token operator">!</span>history            <span class="token constant">Display</span> the command history
<span class="token operator">!</span>importedkeys       <span class="token constant">List</span> all the imported keys <span class="token keyword">for</span> the specified table
<span class="token operator">!</span>indexes            <span class="token constant">List</span> all the indexes <span class="token keyword">for</span> the specified table
<span class="token operator">!</span>isolation          <span class="token constant">Set</span> the transaction isolation <span class="token keyword">for</span> this connection
<span class="token operator">!</span>list               <span class="token constant">List</span> the current connections
<span class="token operator">!</span>manual             <span class="token constant">Display</span> the <span class="token constant">SQLLine</span> manual
<span class="token operator">!</span>metadata           <span class="token constant">Obtain</span> metadata information
<span class="token operator">!</span>nativesql          <span class="token constant">Show</span> the native <span class="token constant">SQL</span> <span class="token keyword">for</span> the specified statement
<span class="token operator">!</span>outputformat       <span class="token constant">Set</span> the output format <span class="token keyword">for</span> displaying results
                    <span class="token punctuation">(</span>table<span class="token punctuation">,</span>vertical<span class="token punctuation">,</span>csv<span class="token punctuation">,</span>tsv<span class="token punctuation">,</span>xmlattrs<span class="token punctuation">,</span>xmlelements<span class="token punctuation">)</span>
<span class="token operator">!</span>primarykeys        <span class="token constant">List</span> all the primary keys <span class="token keyword">for</span> the specified table
<span class="token operator">!</span>procedures         <span class="token constant">List</span> all the procedures
<span class="token operator">!</span>properties         <span class="token constant">Connect</span> to the database specified <span class="token keyword">in</span> the properties file<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token operator">!</span>quit               <span class="token constant">Exits</span> the program
<span class="token operator">!</span>reconnect          <span class="token constant">Reconnect</span> to the database
<span class="token operator">!</span>record             <span class="token constant">Record</span> all output to the specified file
<span class="token operator">!</span>rehash             <span class="token constant">Fetch</span> table <span class="token keyword">and</span> column names <span class="token keyword">for</span> command completion
<span class="token operator">!</span>rollback           <span class="token constant">Roll</span> back the current transaction <span class="token punctuation">(</span><span class="token keyword">if</span> autocommit is off<span class="token punctuation">)</span>
<span class="token operator">!</span>run                <span class="token constant">Run</span> a script from the specified file
<span class="token operator">!</span>save               <span class="token constant">Save</span> the current variabes <span class="token keyword">and</span> aliases
<span class="token operator">!</span>scan               <span class="token constant">Scan</span> <span class="token keyword">for</span> installed <span class="token constant">JDBC</span> drivers
<span class="token operator">!</span>script             <span class="token constant">Start</span> saving a script to a file
<span class="token operator">!</span>set                <span class="token constant">Set</span> a sqlline variable

<span class="token constant">Variable</span>        <span class="token constant">Value</span>      <span class="token constant">Description</span>
<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span> <span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span> <span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">==</span>
autoCommit      <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Enable</span><span class="token operator">/</span>disable automatic
                           transaction commit
autoSave        <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Automatically</span> save preferences
color           <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Control</span> whether color is used
                           <span class="token keyword">for</span> display
fastConnect     <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Skip</span> building table<span class="token operator">/</span>column list
                           <span class="token keyword">for</span> tab<span class="token operator">-</span>completion
force           <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Continue</span> running script even
                           after errors
headerInterval  integer    <span class="token constant">The</span> interval between which
                           headers are displayed
historyFile     path       <span class="token builtin">File</span> <span class="token keyword">in</span> which to save command
                           history<span class="token punctuation">.</span> <span class="token constant">Default</span> is
                           <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>sqlline<span class="token operator">/</span>history <span class="token punctuation">(</span><span class="token constant">UNIX</span><span class="token punctuation">,</span>
                           <span class="token constant">Linux</span><span class="token punctuation">,</span> <span class="token constant">Mac</span> <span class="token constant">OS</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                           <span class="token variable">$HOME</span><span class="token operator">/</span>sqlline<span class="token operator">/</span>history <span class="token punctuation">(</span><span class="token constant">Windows</span><span class="token punctuation">)</span>
incremental     <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Do</span> <span class="token keyword">not</span> receive all rows from
                           server before printing the first
                           row<span class="token punctuation">.</span> <span class="token constant">Uses</span> fewer resources<span class="token punctuation">,</span>
                           especially <span class="token keyword">for</span> long<span class="token operator">-</span>running
                           queries<span class="token punctuation">,</span> but column widths may
                           be incorrect<span class="token punctuation">.</span>
isolation       <span class="token constant">LEVEL</span>      <span class="token constant">Set</span> transaction isolation level
maxColumnWidth  integer    <span class="token constant">The</span> maximum width to use <span class="token keyword">when</span>
                           displaying columns
maxHeight       integer    <span class="token constant">The</span> maximum height of the
                           terminal
maxWidth        integer    <span class="token constant">The</span> maximum width of the
                           terminal
numberFormat    pattern    <span class="token constant">Format</span> numbers using
                           <span class="token constant">DecimalFormat</span> pattern
outputFormat    table<span class="token operator">/</span>vertical<span class="token operator">/</span>csv<span class="token operator">/</span>tsv <span class="token constant">Format</span> mode <span class="token keyword">for</span>
                           result display
propertiesFile  path       <span class="token builtin">File</span> from which <span class="token constant">SqlLine</span> reads
                           properties on startup<span class="token punctuation">;</span> default is
                           <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>sqlline<span class="token operator">/</span>sqlline<span class="token punctuation">.</span>properties
                           <span class="token punctuation">(</span><span class="token constant">UNIX</span><span class="token punctuation">,</span> <span class="token constant">Linux</span><span class="token punctuation">,</span> <span class="token constant">Mac</span> <span class="token constant">OS</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                           <span class="token variable">$HOME</span><span class="token operator">/</span>sqlline<span class="token operator">/</span>sqlline<span class="token punctuation">.</span>properties
                           <span class="token punctuation">(</span><span class="token constant">Windows</span><span class="token punctuation">)</span>
rowLimit        integer    <span class="token constant">Maximum</span> number of rows returned
                           from a query<span class="token punctuation">;</span> zero means no
                           limit
showElapsedTime <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Display</span> execution time <span class="token keyword">when</span>
                           verbose
showHeader      <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Show</span> column names <span class="token keyword">in</span> query
                           results
showNestedErrs  <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Display</span> nested errorssh
showWarnings    <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Display</span> connection warnings
silent          <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Be</span> more silent
timeout         integer    <span class="token constant">Query</span> timeout <span class="token keyword">in</span> seconds<span class="token punctuation">;</span> less
                           than zero means no timeout
trimScripts     <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Remove</span> trailing spaces from
                           lines read from script files
verbose         <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token constant">Show</span> verbose error messages <span class="token keyword">and</span>
                           debug info
<span class="token operator">!</span>sql                <span class="token constant">Execute</span> a <span class="token constant">SQL</span> command
<span class="token operator">!</span>tables             <span class="token constant">List</span> all the tables <span class="token keyword">in</span> the database
<span class="token operator">!</span>typeinfo           <span class="token constant">Display</span> the type map <span class="token keyword">for</span> the current connection
<span class="token operator">!</span>verbose            <span class="token constant">Set</span> verbose mode on
</code></pre></div><h5 id="实例-在phoenix建立hbase的映射表"><a href="#实例-在phoenix建立hbase的映射表" class="header-anchor">#</a> 实例：在Phoenix建立HBase的映射表</h5> <p>通过Phoenix创建一个表之后，HBase端会自动存在该表，因为Phoenix就是用来操控HBase的。但是在Hbase端创建一个表，在Phoenix端是找不到该表的。因此，我们这里演示一下，在Hbase创建表后，如何在phoenix端建立映射表。</p> <p>在node01进入hbase客户端，创建一个普通表employee，并且有两个列族 company 和family。</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">001</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> create <span class="token string">'employee'</span><span class="token punctuation">,</span><span class="token string">'company'</span><span class="token punctuation">,</span><span class="token string">'family'</span>
</code></pre></div><p>数据准备</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>put <span class="token string">'employee'</span><span class="token punctuation">,</span><span class="token string">'row1'</span><span class="token punctuation">,</span><span class="token string">'company:name'</span><span class="token punctuation">,</span><span class="token string">'ted'</span>
put <span class="token string">'employee'</span><span class="token punctuation">,</span><span class="token string">'row1'</span><span class="token punctuation">,</span><span class="token string">'company:position'</span><span class="token punctuation">,</span><span class="token string">'worker'</span>
put <span class="token string">'employee'</span><span class="token punctuation">,</span><span class="token string">'row1'</span><span class="token punctuation">,</span><span class="token string">'family:tel'</span><span class="token punctuation">,</span><span class="token string">'13600912345'</span>
put <span class="token string">'employee'</span><span class="token punctuation">,</span><span class="token string">'row1'</span><span class="token punctuation">,</span><span class="token string">'family:age'</span><span class="token punctuation">,</span><span class="token string">'18'</span>
put <span class="token string">'employee'</span><span class="token punctuation">,</span><span class="token string">'row2'</span><span class="token punctuation">,</span><span class="token string">'company:name'</span><span class="token punctuation">,</span><span class="token string">'michael'</span>
put <span class="token string">'employee'</span><span class="token punctuation">,</span><span class="token string">'row2'</span><span class="token punctuation">,</span><span class="token string">'company:position'</span><span class="token punctuation">,</span><span class="token string">'manager'</span>
put <span class="token string">'employee'</span><span class="token punctuation">,</span><span class="token string">'row2'</span><span class="token punctuation">,</span><span class="token string">'family:tel'</span><span class="token punctuation">,</span><span class="token string">'1894225698'</span>
put <span class="token string">'employee'</span><span class="token punctuation">,</span><span class="token string">'row2'</span><span class="token punctuation">,</span><span class="token string">'family:age'</span><span class="token punctuation">,</span><span class="token string">'20'</span>
</code></pre></div><p>node02进入到phoenix的客户端，然后创建映射表。创建映射表的时候，要特别注意大小写关系。因为在HBase中创建映射表的时候，使用了小写，因此下面的sql语句的表名和字段名等大部分都使用了双引号。</p> <div class="language-mysql extra-class"><pre class="language-text"><code>/kkb/install/apache-phoenix-4.14.0-cdh5.14.2-bin/bin/sqlline.py node01:2181

0: jdbc:phoenix:node01:2181&gt; CREATE TABLE IF NOT EXISTS &quot;employee&quot; (&quot;no&quot; VARCHAR(10) NOT NULL PRIMARY KEY, &quot;company&quot;.&quot;name&quot; VARCHAR(30),&quot;company&quot;.&quot;position&quot; VARCHAR(20), &quot;family&quot;.&quot;tel&quot; VARCHAR(20), &quot;family&quot;.&quot;age&quot; VARCHAR(20)) column_encoded_bytes=0;

0: jdbc:phoenix:node01:2181&gt; select * from &quot;employee&quot;;
+-------+----------+-----------+--------------+------+
|  no   |   name   | position  |     tel      | age  |
+-------+----------+-----------+--------------+------+
| row1  | ted      | worker    | 13600912345  | 18   |
| row2  | michael  | manager   | 1894225698   | 20   |
+-------+----------+-----------+--------------+------+

0: jdbc:phoenix:node01:2181&gt; select * from &quot;employee&quot; where &quot;tel&quot; = '13600912345';
+-------+-------+-----------+--------------+------+
|  no   | name  | position  |     tel      | age  |
+-------+-------+-----------+--------------+------+
| row1  | ted   | worker    | 13600912345  | 18   |
+-------+-------+-----------+--------------+------+
## '13600912345'要使用单引号

0: jdbc:phoenix:node01:2181&gt; select * from &quot;employee&quot; where &quot;age&quot; = '18';
+-------+-------+-----------+--------------+------+
|  no   | name  | position  |     tel      | age  |
+-------+-------+-----------+--------------+------+
| row1  | ted   | worker    | 13600912345  | 18   |
+-------+-------+-----------+--------------+------+
## '18'要使用单引号
</code></pre></div><h3 id="gui方式-todo"><a href="#gui方式-todo" class="header-anchor">#</a> GUI方式(TODO)</h3> <p>通过dbeaver来连接phoenix。dbeaver下载地址：https://dbeaver.io/download/</p> <h4 id="第一步-下载hbase配置文件和phoenix的jar包"><a href="#第一步-下载hbase配置文件和phoenix的jar包" class="header-anchor">#</a> 第一步：下载HBase配置文件和phoenix的jar包</h4> <p>通过dbeaver来连接phoenix需要两个文件，phoenix-4.14.0-cdh5.14.2-client.jar和hbase-site.xml</p> <p>从node02的phoenix的安装目录，获取第一个文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node02 ~<span class="token punctuation">]</span>$ sz /kkb/install/apache-phoenix-4.14.0-cdh5.14.2-bin/phoenix-4.14.0-cdh5.14.2-client.jar
<span class="token comment">## 自动下载到了windows的C:\Users\97464\Downloads目录下</span>
</code></pre></div><p>从hbase的安装配置文件路径，获取hbase-site.xml这个文件</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node02 ~<span class="token punctuation">]</span>$ sz /kkb/install/hbase-1.2.0-cdh5.14.2/conf/hbase-site.xml 
</code></pre></div><h4 id="第二步-拷贝hbase配置文件到jar包"><a href="#第二步-拷贝hbase配置文件到jar包" class="header-anchor">#</a> 第二步：拷贝HBase配置文件到jar包</h4> <p>双击phoenix-4.14.0-cdh5.14.2-client.jar这个文件，使用win rar解压软件打开。</p> <p>将hbase-site.xml放到phoenix-4.14.0-cdh5.14.2-client.jar这个jar包里面去</p> <p><img src="/assets/img/image-20200305163948645.878eecdb.png" alt="image-20200305163948645"></p> <h4 id="第三步-通过dbeaver去连接phoenix"><a href="#第三步-通过dbeaver去连接phoenix" class="header-anchor">#</a> 第三步：通过dbeaver去连接phoenix</h4> <p><img src="/assets/img/1571282405612.7b64465b.png" alt="1571282405612"></p> <p><img src="/assets/img/1571282452922.cf829207.png" alt="1571282452922"></p> <p><img src="/assets/img/1571282684917.eaf133f7.png" alt="1571282684917"></p> <ul><li>注意：如果连接不上，可能不是操作配置的问题，有可能是因为dbeaver软件的问题，将dbeaver软件重启几次试试看</li></ul> <h4 id="第四步-创建数据库表-并实现sql进行操作"><a href="#第四步-创建数据库表-并实现sql进行操作" class="header-anchor">#</a> 第四步：创建数据库表，并实现sql进行操作</h4> <p>直接在phoenix当中通过sql语句的方式来创建表。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> US_POPULATION <span class="token punctuation">(</span>
      state <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      city <span class="token keyword">VARCHAR</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      population <span class="token keyword">BIGINT</span>
      <span class="token keyword">CONSTRAINT</span> my_pk <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

UPSERT <span class="token keyword">INTO</span> US_POPULATION <span class="token punctuation">(</span>state<span class="token punctuation">,</span> city<span class="token punctuation">,</span> population<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'NY'</span><span class="token punctuation">,</span><span class="token string">'New York'</span><span class="token punctuation">,</span><span class="token number">8143197</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
UPSERT <span class="token keyword">INTO</span> US_POPULATION <span class="token punctuation">(</span>state<span class="token punctuation">,</span> city<span class="token punctuation">,</span> population<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'CA'</span><span class="token punctuation">,</span><span class="token string">'Los Angeles'</span><span class="token punctuation">,</span><span class="token number">3844829</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> US_POPULATION <span class="token keyword">WHERE</span> population <span class="token operator">&gt;</span> <span class="token number">8000000</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="jdbc调用方式-todo"><a href="#jdbc调用方式-todo" class="header-anchor">#</a> JDBC调用方式(TODO)</h3> <p>创建maven工程并导入jar包</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.phoenix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>phoenix-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.14.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.14.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 限制jdk版本插件 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>代码开发</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>testng<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">BeforeTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>testng<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhoenixSearch</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> connection<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Statement</span> statement<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ResultSet</span> rs<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@BeforeTest</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token comment">//定义phoenix的连接url地址</span>
        <span class="token class-name">String</span> url<span class="token operator">=</span><span class="token string">&quot;jdbc:phoenix:node01:2181&quot;</span><span class="token punctuation">;</span>
        connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//构建Statement对象</span>
        statement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token comment">//定义查询的sql语句，注意大小写</span>
        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;select * from US_POPULATION&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql语句</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            rs<span class="token operator">=</span>statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;state:&quot;</span><span class="token operator">+</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;state&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;city:&quot;</span><span class="token operator">+</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;city&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;population:&quot;</span><span class="token operator">+</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;population&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------------------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>connection<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="phoenix构建二级索引"><a href="#phoenix构建二级索引" class="header-anchor">#</a> Phoenix构建二级索引</h2> <h4 id="为什么需要用二级索引"><a href="#为什么需要用二级索引" class="header-anchor">#</a> 为什么需要用二级索引？</h4> <p>对于HBase而言，如果想精确地定位到某行记录，唯一的办法是通过rowkey来查询。如果不通过rowkey来查找数据，就必须逐行地比较每一列的值，即全表扫瞄。</p> <p>对于较大的表，全表扫描的代价是不可接受的。但是，很多情况下，需要从多个角度查询数据。</p> <ul><li>例如，在定位某个人的时候，可以通过姓名、身份证号、学籍号等不同的角度来查询</li> <li>要想把这么多角度的数据都放到rowkey中几乎不可能（业务的灵活性不允许，对rowkey长度的要求也不允许）。</li> <li>所以需要secondary index（二级索引）来完成这件事。secondary index的原理很简单,就是把要查询的字段作为rowkey,把原先的rowkey作为value,形成一个索引表，查询该字段的某个值数据的时候首先去索引表查询该字段，因为该字段是索引表的rowkey，因此查询很快，查询到之后，就获得了原先的表的对应rowkey,再重新定位到原表的该rowkey，从而达到快速查询的目的。但是如果自己维护的话则会麻烦一些。</li> <li>现在，Phoenix已经提供了对HBase secondary index的支持。</li></ul> <p><img src="/assets/img/二级索引思想.c1d5dbe3.png" alt=""></p> <h4 id="全局索引与本地索引"><a href="#全局索引与本地索引" class="header-anchor">#</a> 全局索引与本地索引</h4> <h5 id="global-indexing全局索引"><a href="#global-indexing全局索引" class="header-anchor">#</a> Global Indexing全局索引</h5> <ul><li>Global indexing，全局索引，适用于读多写少的业务场景。</li> <li>使用Global indexing在写数据的时候开销很大，因为所有对数据表的更新操作（DELETE, UPSERT VALUES and UPSERT SELECT），都会引起索引表的更新，而索引表是分布在不同的数据节点上的，跨节点的数据传输带来了较大的性能消耗。</li> <li>在读数据的时候Phoenix会选择索引表来降低查询消耗的时间。</li> <li>在默认情况下如果想查询的字段不是索引字段的话索引表不会被使用，也就是说不会带来查询速度的提升。</li></ul> <h5 id="local-indexing本地索引"><a href="#local-indexing本地索引" class="header-anchor">#</a> Local Indexing本地索引</h5> <ul><li>Local indexing，本地索引，适用于写操作频繁以及空间受限制的场景。</li> <li>与Global indexing一样，Phoenix会自动判定在进行查询的时候是否使用索引。</li> <li>使用Local indexing时，索引表的数据和数据表的数据存放在相同的服务器中，这样避免了在写操作的时候往不同服务器的索引表中写索引带来的额外开销。</li> <li>使用Local indexing的时候即使查询的字段不是索引字段索引表也会被使用，这会带来查询速度的提升，这点跟Global indexing不同。对于Local Indexing，一个数据表的所有索引数据都存储在一个单一的独立的可共享的表中。</li></ul> <h4 id="不可变索引与可变索引"><a href="#不可变索引与可变索引" class="header-anchor">#</a> 不可变索引与可变索引</h4> <h5 id="immutable-index不可变索引"><a href="#immutable-index不可变索引" class="header-anchor">#</a> immutable index不可变索引</h5> <ul><li>immutable index，不可变索引，适用于数据只增加不更新并且按照时间先后顺序存储（time-series data）的场景，如保存日志数据或者事件数据等。</li> <li>不可变索引的存储方式是write one，append only。</li> <li>当在Phoenix使用create table语句时指定IMMUTABLE_ROWS = true表示该表上创建的索引将被设置为不可变索引。</li> <li>不可变索引分为Global immutable index和Local immutable index两种。</li> <li>Phoenix默认情况下如果在create table时不指定IMMUTABLE_ROW = true时，表示该表为mutable。</li></ul> <h5 id="mutable-index可变索引-默认"><a href="#mutable-index可变索引-默认" class="header-anchor">#</a> mutable index可变索引(默认)</h5> <ul><li>mutable index，可变索引，适用于数据有增删改的场景。</li> <li>Phoenix默认情况创建的索引都是可变索引，除非在create table的时候显式地指定IMMUTABLE_ROWS = true。</li> <li>可变索引同样分为Global mutable index和Local mutable index两种。</li></ul> <h4 id="配置hbase支持phoenix二级索引"><a href="#配置hbase支持phoenix二级索引" class="header-anchor">#</a> 配置HBase支持Phoenix二级索引</h4> <h5 id="修改配置文件"><a href="#修改配置文件" class="header-anchor">#</a> 修改配置文件</h5> <p>如果要启用phoenix的二级索引功能，需要修改配置文件hbase-site.xml。（每一个节点都要修改）</p> <div class="language- extra-class"><pre class="language-text"><code>vim /kkb/install/hbase-1.2.0-cdh5.14.2/conf/hbase-site.xml
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 添加配置 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.regionserver.wal.codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.hbase.regionserver.wal.IndexedWALEditCodec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.region.server.rpc.scheduler.factory.class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.hbase.ipc.PhoenixRpcSchedulerFactory<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.rpc.controllerfactory.class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.hbase.ipc.controller.ServerRpcControllerFactory<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="重启hbase"><a href="#重启hbase" class="header-anchor">#</a> 重启hbase</h5> <p>完成上述修改后重启hbase集群使配置生效。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>stop-hbase.sh
start-hbase.sh
</code></pre></div><h4 id="准备实战数据"><a href="#准备实战数据" class="header-anchor">#</a> 准备实战数据</h4> <h5 id="在phoenix中创建表"><a href="#在phoenix中创建表" class="header-anchor">#</a> 在phoenix中创建表</h5> <p>首先，在phoenix中创建一个user表。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token punctuation">[</span>hadoop<span class="token variable">@node02</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ <span class="token operator">/</span>kkb<span class="token operator">/</span>install<span class="token operator">/</span>apache<span class="token operator">-</span>phoenix<span class="token operator">-</span><span class="token number">4.14</span><span class="token number">.0</span><span class="token operator">-</span>cdh5<span class="token punctuation">.</span><span class="token number">14.2</span><span class="token operator">-</span>bin<span class="token operator">/</span>bin<span class="token operator">/</span>sqlline<span class="token punctuation">.</span>py node01:<span class="token number">2181</span>

<span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">create</span>  <span class="token keyword">table</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>
<span class="token string">&quot;session_id&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> 
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;cookie_id&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;visit_time&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;user_id&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;age&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;sex&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;visit_url&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;visit_os&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;browser_name&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;visit_ip&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;province&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;city&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;page_id&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;goods_id&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;shop_id&quot;</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> column_encoded_bytes<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="导入测试数据"><a href="#导入测试数据" class="header-anchor">#</a> 导入测试数据</h5> <p>将资料当中的user50w.csv 这个文件上传到node02的/tmp/ 这个路径下, 该CSV文件中有50万条记录。</p> <p>在node02执行以下命令，导入这50W条的测试数据。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node02 tmp<span class="token punctuation">]</span>$ /kkb/install/apache-phoenix-4.14.0-cdh5.14.2-bin/bin/psql.py -t <span class="token environment constant">USER</span> node01:2181 /tmp/user50w.csv
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">USER</span> <span class="token keyword">limit</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------+---------------------+--------------------</span>
<span class="token operator">|</span>              session_id               <span class="token operator">|</span>      cookie_id      <span class="token operator">|</span>      visit_time    
<span class="token operator">+</span><span class="token comment">---------------------------------------+---------------------+--------------------</span>
<span class="token operator">|</span> <span class="token number">000036</span>bd<span class="token operator">-</span><span class="token number">9</span>ede<span class="token operator">-</span><span class="token number">4</span>d2e<span class="token operator">-</span>aac4<span class="token operator">-</span><span class="token number">110</span>b1924c35d  <span class="token operator">|</span> <span class="token number">000036</span>bd<span class="token operator">-</span><span class="token number">9</span>ede<span class="token operator">-</span><span class="token number">4</span>d2e  <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">07</span>:<span class="token number">59</span>:<span class="token number">14</span>
<span class="token operator">|</span> <span class="token number">00003</span>aa1<span class="token operator">-</span>aacd<span class="token operator">-</span><span class="token number">4</span>f48<span class="token operator">-</span><span class="token number">8057</span><span class="token operator">-</span><span class="token number">148</span>d8012abcf  <span class="token operator">|</span> <span class="token number">00003</span>aa1<span class="token operator">-</span>aacd<span class="token operator">-</span><span class="token number">4</span>f48  <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">08</span>:<span class="token number">25</span>:<span class="token number">57</span>
<span class="token operator">|</span> <span class="token number">0000417</span>b<span class="token operator">-</span><span class="token number">4412</span><span class="token operator">-</span><span class="token number">445</span>e<span class="token operator">-</span><span class="token number">8431</span><span class="token operator">-</span><span class="token number">4</span>d9d7459ff40  <span class="token operator">|</span> <span class="token number">0000417</span>b<span class="token operator">-</span><span class="token number">4412</span><span class="token operator">-</span><span class="token number">445</span>e  <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">09</span>:<span class="token number">57</span>:<span class="token number">18</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------+---------------------+--------------------</span>

<span class="token comment">--+--------------------+------+---------+------------+-----------+-----------</span>
  <span class="token operator">|</span>      user_id       <span class="token operator">|</span> age  <span class="token operator">|</span>   sex   <span class="token operator">|</span> visit_url  <span class="token operator">|</span> visit_os  <span class="token operator">|</span> browser_na
<span class="token comment">--+--------------------+------+---------+------------+-----------+-----------</span>
  <span class="token operator">|</span> <span class="token number">06</span>fefc79<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">415367</span>  <span class="token operator">|</span> <span class="token number">24</span>   <span class="token operator">|</span> female  <span class="token operator">|</span> i<span class="token punctuation">.</span>jsp      <span class="token operator">|</span> Unix      <span class="token operator">|</span> Safari    
  <span class="token operator">|</span> <span class="token number">6</span>ef12440<span class="token operator">-</span>c<span class="token operator">-</span><span class="token number">392389</span>  <span class="token operator">|</span> <span class="token number">13</span>   <span class="token operator">|</span> male    <span class="token operator">|</span> g<span class="token punctuation">.</span>jsp      <span class="token operator">|</span> Unix      <span class="token operator">|</span> Firefox   
  <span class="token operator">|</span> b705afce<span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">147636</span>  <span class="token operator">|</span> <span class="token number">66</span>   <span class="token operator">|</span> female  <span class="token operator">|</span> b<span class="token punctuation">.</span>jsp      <span class="token operator">|</span> Linux     <span class="token operator">|</span> IE        
<span class="token comment">--+--------------------+------+---------+------------+-----------+-----------</span>


<span class="token comment">----+------------------+-+</span>
me  <span class="token operator">|</span>     visit_ip     <span class="token operator">|</span> <span class="token operator">|</span>
<span class="token comment">----+------------------+-+</span>
    <span class="token operator">|</span> <span class="token number">123.233</span><span class="token number">.112</span><span class="token number">.235</span>  <span class="token operator">|</span> <span class="token operator">|</span>
    <span class="token operator">|</span> <span class="token number">36.62</span><span class="token number">.27</span><span class="token number">.138</span>     <span class="token operator">|</span> <span class="token operator">|</span>
    <span class="token operator">|</span> <span class="token number">210.27</span><span class="token number">.13</span><span class="token number">.6</span>      <span class="token operator">|</span> <span class="token operator">|</span>
<span class="token comment">----+------------------+-+</span>
</code></pre></div><h4 id="实战1-global-indexing测试"><a href="#实战1-global-indexing测试" class="header-anchor">#</a> 实战1:Global Indexing测试</h4> <h5 id="添加二级索引前"><a href="#添加二级索引前" class="header-anchor">#</a> 添加二级索引前：</h5> <p>在为表USER创建secondary index之前，先看看查询一条数据所需的时间。在node02服务器，进入phoenix的客户端，然后执行以下sql语句，查询数据，查看耗费时间。</p> <p>从下面可以看到，耗时8.157s。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">0</span>: jdbc:phoenix:node01:218<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token keyword">select</span> * from user where <span class="token string">&quot;cookie_id&quot;</span> <span class="token operator">=</span> <span class="token string">'99738fd1-2084-44e9'</span><span class="token punctuation">;</span>
+---------------------------------------+---------------------+----------------------+
<span class="token operator">|</span>              session_id               <span class="token operator">|</span>      cookie_id      <span class="token operator">|</span>      visit_time      <span class="token operator">|</span>
+---------------------------------------+---------------------+----------------------+
<span class="token operator">|</span> 99738fd1-2084-44e9-90b7-3cd43d36d0f0  <span class="token operator">|</span> 99738fd1-2084-44e9  <span class="token operator">|</span> <span class="token number">2016</span>-12-10 08:51:11  <span class="token operator">|</span>
+---------------------------------------+---------------------+----------------------+

--------------------+------+---------+------------+-----------+
      user_id       <span class="token operator">|</span> age  <span class="token operator">|</span>   sex   <span class="token operator">|</span> visit_url  <span class="token operator">|</span> visit_os  <span class="token operator">|</span>
--------------------+------+---------+------------+-----------+
 371e963d-c-487065  <span class="token operator">|</span> <span class="token number">47</span>   <span class="token operator">|</span> female  <span class="token operator">|</span> i.jsp      <span class="token operator">|</span> Linux     <span class="token operator">|</span>
--------------------+------+---------+------------+-----------+

---------------+-----------------+--+
 browser_name  <span class="token operator">|</span>    visit_ip     <span class="token operator">|</span>  <span class="token operator">|</span>
---------------+-----------------+--+
 Chrome        <span class="token operator">|</span> <span class="token number">106.86</span>.176.113  <span class="token operator">|</span>  <span class="token operator">|</span>
---------------+-----------------+--+
<span class="token number">1</span> row selected <span class="token punctuation">(</span><span class="token number">8.157</span> seconds<span class="token punctuation">)</span>
</code></pre></div><p>我们可以通过explain来查看执行逻辑计划,从下图可以看到，先进行了全表扫描再通过过滤器来筛选出目标数据，显示这种查询方式效率是很低的。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">## 语法格式：EXPLAIN sql语句。</span>
<span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;cookie_id&quot;</span> <span class="token operator">=</span> <span class="token string">'99738fd1-2084-44e9'</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/assets/img/image-20200305181311235.d9adc153.png" alt="image-20200305181311235"></p> <h5 id="添加二级索引后"><a href="#添加二级索引后" class="header-anchor">#</a> 添加二级索引后：</h5> <p>进入到phoenix的客户端，然后执行以下命令对cookie_id列创建索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">index</span> USER_COOKIE_ID_INDEX <span class="token keyword">on</span> <span class="token keyword">USER</span> <span class="token punctuation">(</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;cookie_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">## USER_COOKIE_ID_INDEX是用来作为索引表的名称，自己随便定义</span>

<span class="token comment">#可以看到，多了一个索引表 USER_COOKIE_ID_INDEX</span>
<span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token operator">!</span><span class="token keyword">tables</span>
<span class="token operator">+</span><span class="token comment">------------+--------------+-----------------------+---------------+----------+</span>
<span class="token operator">|</span> TABLE_CAT  <span class="token operator">|</span> TABLE_SCHEM  <span class="token operator">|</span>      TABLE_NAME       <span class="token operator">|</span>  TABLE_TYPE   <span class="token operator">|</span> REMARKS  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+--------------+-----------------------+---------------+----------+</span>
<span class="token operator">|</span>            <span class="token operator">|</span>              <span class="token operator">|</span> USER_COOKIE_ID_INDEX  <span class="token operator">|</span> <span class="token keyword">INDEX</span>         <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span>            <span class="token operator">|</span> SYSTEM       <span class="token operator">|</span> CATALOG               <span class="token operator">|</span> SYSTEM <span class="token keyword">TABLE</span>  <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span>            <span class="token operator">|</span> SYSTEM       <span class="token operator">|</span> <span class="token keyword">FUNCTION</span>              <span class="token operator">|</span> SYSTEM <span class="token keyword">TABLE</span>  <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span>            <span class="token operator">|</span> SYSTEM       <span class="token operator">|</span> LOG                   <span class="token operator">|</span> SYSTEM <span class="token keyword">TABLE</span>  <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span>            <span class="token operator">|</span> SYSTEM       <span class="token operator">|</span> SEQUENCE              <span class="token operator">|</span> SYSTEM <span class="token keyword">TABLE</span>  <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span>            <span class="token operator">|</span> SYSTEM       <span class="token operator">|</span> STATS                 <span class="token operator">|</span> SYSTEM <span class="token keyword">TABLE</span>  <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span>            <span class="token operator">|</span>              <span class="token operator">|</span> <span class="token keyword">USER</span>                  <span class="token operator">|</span> <span class="token keyword">TABLE</span>         <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span>            <span class="token operator">|</span>              <span class="token operator">|</span> USER_PHOENIX          <span class="token operator">|</span> <span class="token keyword">TABLE</span>         <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span>            <span class="token operator">|</span>              <span class="token operator">|</span> employee              <span class="token operator">|</span> <span class="token keyword">TABLE</span>         <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+--------------+-----------------------+---------------+----------+</span>

<span class="token comment">#查看索引表数据:</span>
<span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> USER_COOKIE_ID_INDEX <span class="token keyword">limit</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+---------------------------------------+</span>
<span class="token operator">|</span>     f:cookie_id     <span class="token operator">|</span>              :session_id              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+---------------------------------------+</span>
<span class="token operator">|</span> <span class="token number">000036</span>bd<span class="token operator">-</span><span class="token number">9</span>ede<span class="token operator">-</span><span class="token number">4</span>d2e  <span class="token operator">|</span> <span class="token number">000036</span>bd<span class="token operator">-</span><span class="token number">9</span>ede<span class="token operator">-</span><span class="token number">4</span>d2e<span class="token operator">-</span>aac4<span class="token operator">-</span><span class="token number">110</span>b1924c35d  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">00003</span>aa1<span class="token operator">-</span>aacd<span class="token operator">-</span><span class="token number">4</span>f48  <span class="token operator">|</span> <span class="token number">00003</span>aa1<span class="token operator">-</span>aacd<span class="token operator">-</span><span class="token number">4</span>f48<span class="token operator">-</span><span class="token number">8057</span><span class="token operator">-</span><span class="token number">148</span>d8012abcf  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">0000417</span>b<span class="token operator">-</span><span class="token number">4412</span><span class="token operator">-</span><span class="token number">445</span>e  <span class="token operator">|</span> <span class="token number">0000417</span>b<span class="token operator">-</span><span class="token number">4412</span><span class="token operator">-</span><span class="token number">445</span>e<span class="token operator">-</span><span class="token number">8431</span><span class="token operator">-</span><span class="token number">4</span>d9d7459ff40  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">0000</span>a391<span class="token operator">-</span><span class="token number">4</span>fd8<span class="token operator">-</span><span class="token number">44</span>bd  <span class="token operator">|</span> <span class="token number">0000</span>a391<span class="token operator">-</span><span class="token number">4</span>fd8<span class="token operator">-</span><span class="token number">44</span>bd<span class="token operator">-</span><span class="token number">9970</span><span class="token operator">-</span>da721fbe860d  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">0000</span>ce5e<span class="token operator">-</span><span class="token number">3121</span><span class="token operator">-</span><span class="token number">4</span>da9  <span class="token operator">|</span> <span class="token number">0000</span>ce5e<span class="token operator">-</span><span class="token number">3121</span><span class="token operator">-</span><span class="token number">4</span>da9<span class="token operator">-</span><span class="token number">8</span>ffb<span class="token operator">-</span><span class="token number">19</span>c9a3621548  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+---------------------------------------+</span>
</code></pre></div><p>再次执行查询&quot;cookie_id&quot;='99738fd1-2084-44e9'的数据记录</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token string">&quot;cookie_id&quot;</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;cookie_id&quot;</span> <span class="token operator">=</span> <span class="token string">'99738fd1-2084-44e9'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span>      cookie_id      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token number">99738</span>fd1<span class="token operator">-</span><span class="token number">2084</span><span class="token operator">-</span><span class="token number">44</span>e9  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">0.031</span> seconds<span class="token punctuation">)</span>
</code></pre></div><p>从上面代码块可以看到，同样的查询语句，但是创建了二级索引后，查询时间由8.157秒左右减少到了0.031s，达到毫秒级别。</p> <p>查看执行计划,可以看到SCAN OVER USER_COOKIE_ID_IND的字眼，表明先扫描了索引表。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token string">&quot;cookie_id&quot;</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;cookie_id&quot;</span> <span class="token operator">=</span> <span class="token string">'99738fd1-2084-44e9'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------+</span>
<span class="token operator">|</span>                                                  <span class="token keyword">PLAN</span>                        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> CLIENT <span class="token number">1</span><span class="token operator">-</span>CHUNK PARALLEL <span class="token number">1</span><span class="token operator">-</span>WAY ROUND ROBIN RANGE SCAN <span class="token keyword">OVER</span> USER_COOKIE_ID_IND <span class="token operator">|</span>
<span class="token operator">|</span>     SERVER FILTER <span class="token keyword">BY</span> <span class="token keyword">FIRST</span> <span class="token keyword">KEY</span> ONLY                                          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------+</span>
</code></pre></div><h5 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h5> <p>对于全局索引，select语句所带的字段必须包含在覆盖索引内，否则查询不会用到索引表。如下：</p> <p>例子1：虽然cookie_id是索引字段，但age不是索引字段，所以不会使用到索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token string">&quot;cookie_id&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;cookie_id&quot;</span><span class="token operator">=</span><span class="token string">'99738fd1-2084-44e9'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+------+</span>
<span class="token operator">|</span>      cookie_id      <span class="token operator">|</span> age  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+------+</span>
<span class="token operator">|</span> <span class="token number">99738</span>fd1<span class="token operator">-</span><span class="token number">2084</span><span class="token operator">-</span><span class="token number">44</span>e9  <span class="token operator">|</span> <span class="token number">47</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">2.909</span> seconds<span class="token punctuation">)</span>


<span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token string">&quot;cookie_id&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;cookie_id&quot;</span><span class="token operator">=</span><span class="token string">'99738fd1-2084-44e9'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------+</span>
<span class="token operator">|</span>                                            <span class="token keyword">PLAN</span>                              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> CLIENT <span class="token number">2</span><span class="token operator">-</span>CHUNK <span class="token number">289067</span> <span class="token keyword">ROWS</span> <span class="token number">314572810</span> BYTES PARALLEL <span class="token number">1</span><span class="token operator">-</span>WAY ROUND ROBIN <span class="token keyword">FULL</span> S <span class="token operator">|</span>
<span class="token operator">|</span>     SERVER FILTER <span class="token keyword">BY</span> f<span class="token punctuation">.</span><span class="token string">&quot;cookie_id&quot;</span> <span class="token operator">=</span> <span class="token string">'99738fd1-2084-44e9'</span>                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> selected <span class="token punctuation">(</span><span class="token number">0.024</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h4 id="实战2-local-indexing测试"><a href="#实战2-local-indexing测试" class="header-anchor">#</a> 实战2:Local Indexing测试</h4> <h5 id="添加二级索引前-2"><a href="#添加二级索引前-2" class="header-anchor">#</a> 添加二级索引前：</h5> <p>查看普通查询时间，3.569 seconds,再看到执行计划，是FULL SCAN,先进行了全表扫描再通过过滤器来筛选出目标数据。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;user_id&quot;</span><span class="token operator">=</span><span class="token string">'371e963d-c-487065'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------+---------------------+----------------+</span>
<span class="token operator">|</span>              session_id               <span class="token operator">|</span>      cookie_id      <span class="token operator">|</span>      visit_tim <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------+---------------------+----------------+</span>
<span class="token operator">|</span> <span class="token number">99738</span>fd1<span class="token operator">-</span><span class="token number">2084</span><span class="token operator">-</span><span class="token number">44</span>e9<span class="token operator">-</span><span class="token number">90</span>b7<span class="token operator">-</span><span class="token number">3</span>cd43d36d0f0  <span class="token operator">|</span> <span class="token number">99738</span>fd1<span class="token operator">-</span><span class="token number">2084</span><span class="token operator">-</span><span class="token number">44</span>e9  <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">08</span>: <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------+---------------------+----------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">3.569</span> seconds<span class="token punctuation">)</span>


<span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;user_id&quot;</span><span class="token operator">=</span><span class="token string">'371e963d-c-4
+------------------------------------------------------------------------------------
|                                          PLAN                                      
+------------------------------------------------------------------------------------
| CLIENT 1-CHUNK PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER USER [1,'</span><span class="token number">371</span>e963d<span class="token operator">-</span>c<span class="token operator">-</span><span class="token number">48706</span>
<span class="token operator">|</span>     SERVER FILTER <span class="token keyword">BY</span> <span class="token keyword">FIRST</span> <span class="token keyword">KEY</span> ONLY                                                
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------------</span>
</code></pre></div><h5 id="添加二级索引后-2"><a href="#添加二级索引后-2" class="header-anchor">#</a> 添加二级索引后：</h5> <p>本地索引要加local关键字，index前面不加关键字就是全局索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">local</span> <span class="token keyword">index</span> USER_USER_ID_INDEX <span class="token keyword">on</span> <span class="token keyword">USER</span> <span class="token punctuation">(</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>再次执行查询&quot;user_id&quot;='371e963d-c-487065'的数据记录,时间缩减至了0.351 seconds，毫秒级别。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;user_id&quot;</span><span class="token operator">=</span><span class="token string">'371e963d-c-487065'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------+---------------------+--------------------+</span>
<span class="token operator">|</span>              session_id               <span class="token operator">|</span>      cookie_id      <span class="token operator">|</span>      user_id       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------+---------------------+--------------------+</span>
<span class="token operator">|</span> <span class="token number">99738</span>fd1<span class="token operator">-</span><span class="token number">2084</span><span class="token operator">-</span><span class="token number">44</span>e9<span class="token operator">-</span><span class="token number">90</span>b7<span class="token operator">-</span><span class="token number">3</span>cd43d36d0f0  <span class="token operator">|</span> <span class="token number">99738</span>fd1<span class="token operator">-</span><span class="token number">2084</span><span class="token operator">-</span><span class="token number">44</span>e9  <span class="token operator">|</span> <span class="token number">371</span>e963d<span class="token operator">-</span>c<span class="token operator">-</span><span class="token number">487065</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------+---------------------+--------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">0.351</span> seconds<span class="token punctuation">)</span>

<span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;user_id&quot;</span><span class="token operator">=</span><span class="token string">'371e963d-c-487065'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------------</span>
<span class="token operator">|</span>                                          <span class="token keyword">PLAN</span>                                      
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------------</span>
<span class="token operator">|</span> CLIENT <span class="token number">1</span><span class="token operator">-</span>CHUNK PARALLEL <span class="token number">1</span><span class="token operator">-</span>WAY ROUND ROBIN RANGE SCAN <span class="token keyword">OVER</span> <span class="token keyword">USER</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>'<span class="token number">371</span>e963d<span class="token operator">-</span>c<span class="token operator">-</span><span class="token number">48706</span>
<span class="token operator">|</span>     SERVER FILTER <span class="token keyword">BY</span> <span class="token keyword">FIRST</span> <span class="token keyword">KEY</span> ONLY                                                
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------------</span>
</code></pre></div><h5 id="注意事项-2"><a href="#注意事项-2" class="header-anchor">#</a> 注意事项</h5> <p>对于本地索引，查询的字段不包含在索引表中，也可以使用索引表。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sex&quot;</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;user_id&quot;</span><span class="token operator">=</span><span class="token string">'371e963d-c-487065'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+------+---------+</span>
<span class="token operator">|</span>      user_id       <span class="token operator">|</span> age  <span class="token operator">|</span>   sex   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+------+---------+</span>
<span class="token operator">|</span> <span class="token number">371</span>e963d<span class="token operator">-</span>c<span class="token operator">-</span><span class="token number">487065</span>  <span class="token operator">|</span> <span class="token number">47</span>   <span class="token operator">|</span> female  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+------+---------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">0.045</span> seconds<span class="token punctuation">)</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sex&quot;</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;user_id&quot;</span><span class="token operator">=</span><span class="token string">'371e963d-c-487065'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------------</span>
<span class="token operator">|</span>                                          <span class="token keyword">PLAN</span>                                      
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------------</span>
<span class="token operator">|</span> CLIENT <span class="token number">1</span><span class="token operator">-</span>CHUNK PARALLEL <span class="token number">1</span><span class="token operator">-</span>WAY ROUND ROBIN RANGE SCAN <span class="token keyword">OVER</span> <span class="token keyword">USER</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>'<span class="token number">371</span>e963d<span class="token operator">-</span>c<span class="token operator">-</span><span class="token number">48706</span>
<span class="token operator">|</span>     SERVER FILTER <span class="token keyword">BY</span> <span class="token keyword">FIRST</span> <span class="token keyword">KEY</span> ONLY                                                
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------------</span>
</code></pre></div><h4 id="如何确保查询使用二级索引"><a href="#如何确保查询使用二级索引" class="header-anchor">#</a> 如何确保查询使用二级索引</h4> <p>要想让一个查询使用index，有三种方式实现。</p> <h6 id="第一种方式-创建覆盖索引"><a href="#第一种方式-创建覆盖索引" class="header-anchor">#</a> 第一种方式：创建覆盖索引</h6> <p>如果在某次查询中，查询项或者查询条件中包含除被索引列之外的列（主键MY_PK除外）。默认情况下，该查询会触发full table scan（全表扫描），但是使用covered index覆盖索引则可以避免全表扫描。</p> <p>创建包含某个字段的覆盖索引,创建方式如下：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">index</span> USER_COOKIE_ID_AGE_INDEX <span class="token keyword">on</span> <span class="token keyword">USER</span> <span class="token punctuation">(</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;cookie_id&quot;</span><span class="token punctuation">)</span> include<span class="token punctuation">(</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">#查询索引表数据: 可以看到，比一般的索引表多出了一列，在这里是f:age</span>
<span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> USER_COOKIE_ID_AGE_INDEX <span class="token keyword">limit</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+---------------------------------------+--------+</span>
<span class="token operator">|</span>     f:cookie_id     <span class="token operator">|</span>              :session_id              <span class="token operator">|</span> f:age  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+---------------------------------------+--------+</span>
<span class="token operator">|</span> <span class="token number">000036</span>bd<span class="token operator">-</span><span class="token number">9</span>ede<span class="token operator">-</span><span class="token number">4</span>d2e  <span class="token operator">|</span> <span class="token number">000036</span>bd<span class="token operator">-</span><span class="token number">9</span>ede<span class="token operator">-</span><span class="token number">4</span>d2e<span class="token operator">-</span>aac4<span class="token operator">-</span><span class="token number">110</span>b1924c35d  <span class="token operator">|</span> <span class="token number">24</span>     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">00003</span>aa1<span class="token operator">-</span>aacd<span class="token operator">-</span><span class="token number">4</span>f48  <span class="token operator">|</span> <span class="token number">00003</span>aa1<span class="token operator">-</span>aacd<span class="token operator">-</span><span class="token number">4</span>f48<span class="token operator">-</span><span class="token number">8057</span><span class="token operator">-</span><span class="token number">148</span>d8012abcf  <span class="token operator">|</span> <span class="token number">13</span>     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">0000417</span>b<span class="token operator">-</span><span class="token number">4412</span><span class="token operator">-</span><span class="token number">445</span>e  <span class="token operator">|</span> <span class="token number">0000417</span>b<span class="token operator">-</span><span class="token number">4412</span><span class="token operator">-</span><span class="token number">445</span>e<span class="token operator">-</span><span class="token number">8431</span><span class="token operator">-</span><span class="token number">4</span>d9d7459ff40  <span class="token operator">|</span> <span class="token number">66</span>     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">0000</span>a391<span class="token operator">-</span><span class="token number">4</span>fd8<span class="token operator">-</span><span class="token number">44</span>bd  <span class="token operator">|</span> <span class="token number">0000</span>a391<span class="token operator">-</span><span class="token number">4</span>fd8<span class="token operator">-</span><span class="token number">44</span>bd<span class="token operator">-</span><span class="token number">9970</span><span class="token operator">-</span>da721fbe860d  <span class="token operator">|</span> <span class="token number">36</span>     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">0000</span>ce5e<span class="token operator">-</span><span class="token number">3121</span><span class="token operator">-</span><span class="token number">4</span>da9  <span class="token operator">|</span> <span class="token number">0000</span>ce5e<span class="token operator">-</span><span class="token number">3121</span><span class="token operator">-</span><span class="token number">4</span>da9<span class="token operator">-</span><span class="token number">8</span>ffb<span class="token operator">-</span><span class="token number">19</span>c9a3621548  <span class="token operator">|</span> <span class="token number">9</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+---------------------------------------+--------+</span>
</code></pre></div><p>执行语句，查询数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#查询的字段中包含索引的列，查询条件也包含索引的列时，查询会用到索引表</span>
<span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token string">&quot;age&quot;</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;cookie_id&quot;</span><span class="token operator">=</span><span class="token string">'99738fd1-2084-44e9'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token operator">|</span> age  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token operator">|</span> <span class="token number">47</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">0.058</span> seconds<span class="token punctuation">)</span>

<span class="token comment">## 查询的字段包含了不再索引表中的列，如下面中的sex，不会用索引表。</span>
<span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sex&quot;</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;cookie_id&quot;</span><span class="token operator">=</span><span class="token string">'99738fd1-2084-44e9'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+---------+</span>
<span class="token operator">|</span> age  <span class="token operator">|</span>   sex   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------+</span>
<span class="token operator">|</span> <span class="token number">47</span>   <span class="token operator">|</span> female  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">2.747</span> seconds<span class="token punctuation">)</span>
</code></pre></div><h6 id="第二种方式-在查询中使用index"><a href="#第二种方式-在查询中使用index" class="header-anchor">#</a> 第二种方式：在查询中使用index</h6> <p>在select和column_name之间加上/*+ Index(&lt;表名&gt; &lt;index表名&gt;)*/，通过这种方式强制使用索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token comment">/*+ index(user,USER_COOKIE_ID_AGE_INDEX) */</span> <span class="token string">&quot;age&quot;</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;cookie_id&quot;</span><span class="token operator">=</span><span class="token string">'99738fd1-2084-44e9'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token operator">|</span> age  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token operator">|</span> <span class="token number">47</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> selected <span class="token punctuation">(</span><span class="token number">0.041</span> seconds<span class="token punctuation">)</span>

<span class="token number">0</span>: jdbc:phoenix:node01:<span class="token number">2181</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token comment">/*+ index(user,USER_COOKIE_ID_AGE_INDEX) */</span> <span class="token string">&quot;age&quot;</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token string">&quot;cookie_id&quot;</span><span class="token operator">=</span><span class="token string">'99738fd1-2084-44e9'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------+</span>
<span class="token operator">|</span>                                                    <span class="token keyword">PLAN</span>                      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> CLIENT <span class="token number">1</span><span class="token operator">-</span>CHUNK PARALLEL <span class="token number">1</span><span class="token operator">-</span>WAY ROUND ROBIN RANGE SCAN <span class="token keyword">OVER</span> USER_COOKIE_ID_AGE <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------------------------+</span>
</code></pre></div><p>当用户明确知道表中数据较少且符合检索条件时才适用，此时的性能才是最佳的。</p> <h6 id="第三种方式-使用本地索引-创建local-indexing-索引"><a href="#第三种方式-使用本地索引-创建local-indexing-索引" class="header-anchor">#</a> 第三种方式：使用本地索引 (创建Local Indexing 索引)</h6> <ul><li>详细见上面</li></ul> <h4 id="索引重建"><a href="#索引重建" class="header-anchor">#</a> 索引重建</h4> <p>Phoenix的索引重建是把索引表清空后重新装配数据。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">index</span> USER_COOKIE_ID_INDEX <span class="token keyword">on</span> <span class="token keyword">user</span> rebuild<span class="token punctuation">;</span>
</code></pre></div><h4 id="删除索引"><a href="#删除索引" class="header-anchor">#</a> 删除索引</h4> <p>删除某个表的某张索引，语法: drop index 索引名称 on 表名</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">index</span> USER_COOKIE_ID_INDEX <span class="token keyword">on</span> <span class="token keyword">user</span><span class="token punctuation">;</span>
</code></pre></div><p>如果表中的一个索引列被删除，则索引也将被自动删除。</p> <p>如果删除的是覆盖索引上的列，则此列将从覆盖索引中被自动删除。</p> <h4 id="索引性能调优"><a href="#索引性能调优" class="header-anchor">#</a> 索引性能调优</h4> <ul><li>一般来说，索引已经很快了，不需要特别的优化。</li> <li>这里也提供了一些方法，让你在面对特定的环境和负载的时候可以进行一些调优。下面的这些需要在hbase-site.xml文件中设置，针对所有的服务器。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>1. index.builder.threads.max 
创建索引时，使用的最大线程数。 
默认值: 10。

2. index.builder.threads.keepalivetime 
创建索引的创建线程池中线程的存活时间，单位：秒。 
默认值: 60

3. index.writer.threads.max 
写索引表数据的写线程池的最大线程数。 
更新索引表可以用的最大线程数，也就是同时可以更新多少张索引表，数量最好和索引表的数量一致。 
默认值: 10

4. index.writer.threads.keepalivetime 
索引写线程池中，线程的存活时间，单位：秒。
默认值：60
 
5. hbase.htable.threads.max 
每一张索引表可用于写的线程数。 
默认值: 2,147,483,647

6. hbase.htable.threads.keepalivetime 
索引表线程池中线程的存活时间，单位：秒。 
默认值: 60

7. index.tablefactory.cache.size 
允许缓存的索引表的数量。 
增加此值，可以在写索引表时不用每次都去重复的创建htable，这个值越大，内存消耗越多。 
默认值: 10

8. org.apache.phoenix.regionserver.index.handler.count 
处理全局索引写请求时，可以使用的线程数。 
默认值: 30
</code></pre></div><h2 id="hbase协处理器"><a href="#hbase协处理器" class="header-anchor">#</a> HBase协处理器</h2> <h4 id="为什么要有协处理器"><a href="#为什么要有协处理器" class="header-anchor">#</a> 为什么要有协处理器？</h4> <p>官网文档(<a href="http://hbase.apache.org/book.html#cp" target="_blank" rel="noopener noreferrer">http://hbase.apache.org/book.html#cp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <p>Hbase 作为列族数据库最经常被人诟病的特性包括：</p> <ul><li><p>无法轻易建立“二级索引”</p></li> <li><p>难以执行求和、计数、排序等操作。比如，在旧版本的(&lt;0.92)Hbase 中，统计数据表的总行数，需要使用 Counter 方法，执行一次 MapReduce Job 才能得到。</p></li> <li><p>虽然 HBase 在数据存储层中集成了MapReduce，能够有效用于数据表的分布式计算。然而在很多情况下，做一些简单的相加或者聚合计算的时候， 如果直接将计算过程<strong>放置在server端</strong>，能够减少通讯开销，从而获得很好的性能提升。</p></li> <li><p>于是， HBase 在 0.92 之后引入了协处理器(coprocessors)，实现一 些激动人心的新特性：能够轻易建立二次索引、复杂过滤器(谓词下推)以及访问控制等。</p></li></ul> <h4 id="协处理器简单介绍"><a href="#协处理器简单介绍" class="header-anchor">#</a> 协处理器简单介绍</h4> <p>利用协处理器，用户可以编写运行在 HBase Server 端的代码。协处理器允许用户在region服务器上运行自己的代码，允许用户执行region级别的操作，并且可以使用与RDBMS中触发器(trigger)类似的功能。</p> <p>Endpoint 协处理器类似传统数据库中的存储过程，客户端可以调用这些 Endpoint 协处理器执行一段 Server 端代码，并将 Server 端代码的结果返回给客户端进一步处理，最常见的用法就是进行聚集操作。如果没有协处理器，当用户需要找出一张表中的最大数据，即 max 聚合操作，就必须进行全表扫描，在客户端代码内遍历扫描结果，并执行求最大值的操作。这样的方法无法利用底层集群的并发能力，而将所有计算都集中到 Client 端统一执行，势必效率低下。利用 Coprocessor，用户可以将求最大值的代码部署到 HBase Server 端，HBase 将利用底层 cluster 的多个节点并发执行求最大值的操作。即在每个 Region 范围内执行求最大值的代码，将每个 Region 的最大值在 Region Server 端计算出，仅仅将该 max 值返回给客户端。在客户端进一步将多个 Region 的最大值进一步处理而找到其中的最大值。这样整体的执行效率就会提高很多。</p> <p>另外一种协处理器叫做 Observer Coprocessor，这种协处理器类似于传统数据库中的触发器，当发生某些事件的时候这类协处理器会被 Server 端调用。Observer Coprocessor 就是一些散布在 HBase Server 端代码中的 hook 钩子，在固定的事件发生时被调用。比如：put 操作之前有钩子函数 prePut，该函数在 put 操作执行前会被 Region Server 调用；在 put 操作之后则有 postPut 钩子函数。</p> <h4 id="协处理器类型"><a href="#协处理器类型" class="header-anchor">#</a> 协处理器类型</h4> <p>协处理器框架提供了一些类，用户可以通过继承这些类来扩展自己的功能。主要分为两大类：observer和endpoint。</p> <h5 id="observer协处理器"><a href="#observer协处理器" class="header-anchor">#</a> observer协处理器</h5> <p>Observer 类似于传统数据库中的触发器trigger，当发生某些事件的时候这类协处理器会被Server端调用。Observer Coprocessor就是一些散布在HBase Server端代码中的 hook 钩子，在固定的事件发生时被调用。</p> <p>比如： put 操作之前有钩子函数 prePut，该函数在put操作执行前会被Region Server调用；在 put 操作之后则有 postPut 钩子函数。假设preput()是一个清空函数，那么经过preput后，在region上put的时候，就不会有数据被插入。那么postput()也可以在put之后执行某一些操作。</p> <img src="hbase.assets/image-20200306131541683.png" alt="image-20200306131541683" style="zoom:67%;"> <p>以 HBase0.92 版本为例，它提供了三种observer观察者接口：</p> <ul><li>RegionObserver：提供客户端的数据操纵事件钩子： Get、 Put、 Delete、 Scan 等。</li> <li>WALObserver：提供 WAL 相关操作钩子。</li> <li>MasterObserver：提供 DDL类型的操作钩子。如创建、删除、修改数据表等。</li> <li>到 0.96 版本又新增一个 RegionServerObserver</li></ul> <p><img src="/assets/img/Image201911151202.2f7f4489.png" alt=""></p> <p>下图是以 RegionObserver 为例子讲解 Observer 这种协处理器的原理：</p> <p><img src="/assets/img/1122015-20170511100919222-711579099.712b3334.png" alt="1122015-20170511100919222-711579099"></p> <h5 id="endpoint协处理器"><a href="#endpoint协处理器" class="header-anchor">#</a> endpoint协处理器</h5> <ul><li>Endpoint协处理器类似传统数据库中的存储过程，客户端可以调用这些 Endpoint 协处理器执行一段 Server 端代码，并将 Server 端代码的结果返回给客户端进一步处理</li> <li>最常见的用法就是进行聚集操作。
<ul><li>如果没有协处理器，当用户需要找出一张表中的最大数据，即max 聚合操作，就必须进行全表扫描，在客户端代码内遍历扫描结果，并执行求最大值的操作。这样的方法无法利用底层集群的并发能力，而将所有计算都集中到 Client 端统一执行，势必效率低下。</li> <li>利用 Coprocessor，用户可以将求最大值的代码部署到 HBase Server 端，HBase将利用底层cluster 的多个节点并发执行求最大值的操作。即在每个 Region范围内执行求最大值的代码，将每个 Region 的最大值在 Region Server 端计算出，仅仅将该max值返回给客户端。在客户端进一步将多个Region的最大值进一步处理而找到其中的最大值。这样整体的执行效率就会提高很多</li></ul></li></ul> <p>endpoint示意图：</p> <img src="hbase.assets/image-20200306033214108.png" alt="image-20200306033214108" style="zoom:67%;"> <h5 id="两种协处理器的总结"><a href="#两种协处理器的总结" class="header-anchor">#</a> 两种协处理器的总结</h5> <ul><li>Observer允许集群在正常的客户端操作过程中可以有不同的行为表现</li> <li>Endpoint允许扩展集群的能力，对客户端应用开放新的运算命令</li> <li>observer类似于 RDBMS 中的触发器，主要在服务端工作</li> <li>endpoint类似于 RDBMS 中的存储过程，主要在 client 端工作</li> <li>observer可以实现权限管理、优先级设置、监控、 ddl 控制、 二级索引等功能</li> <li>endpoint可以实现 min、 max、 avg、 sum、 distinct、 group by等功能</li></ul> <h4 id="协处理器加载方式"><a href="#协处理器加载方式" class="header-anchor">#</a> 协处理器加载方式</h4> <p>协处理器的加载方式有两种</p> <ul><li>静态加载方式（ Static Load）；静态加载的协处理器称之为 System Coprocessor</li> <li>动态加载方式 （ Dynamic Load）；动态加载的协处理器称 之为 Table Coprocessor</li></ul> <h5 id="静态加载-不常用"><a href="#静态加载-不常用" class="header-anchor">#</a> 静态加载（不常用）</h5> <p>静态加载是通过修改 hbase-site.xml 这个文件来实现， 如启动全局 aggregation，能过操纵所有的表数据。只需要在hbase-site.xml里面添加以下配置即可</p> <p>注意：修改完配置之后需要<strong>重启HBase集群</strong>,这就是静态加载不常用的原因，因为企业中一般不允许停掉集群。</p> <p>如下，静态加载RegionObserver和endpoint</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.coprocessor.region.classes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.hbase.coprocessor.AggregateImplementation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>为所有table加载了一个 cp class协处理器的类；此外可以用” ,”分割加载多个 class</li> <li>另外，属性hbase.coprocessor.wal.classes用于加载WALObservers</li> <li>属性hbase.coprocessor.master.classes用于加载MasterObservers</li></ul> <h5 id="动态加载"><a href="#动态加载" class="header-anchor">#</a> 动态加载</h5> <p>两种方式：①通过hbase shell；②通过编程</p> <p>若要实现启用表aggregation，只对特定的表生效。</p> <p>####### 动态加载方式一：通过 HBase Shell 来实现。</p> <p>disable 指定表。</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token operator">&gt;</span> disable <span class="token string">'mytable'</span>
</code></pre></div><p>添加 aggregation</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token operator">&gt;</span> alter <span class="token string">'mytable'</span><span class="token punctuation">,</span> <span class="token constant">METHOD</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'table_att'</span><span class="token punctuation">,</span> <span class="token string">'Coprocessor'</span><span class="token operator">=</span><span class="token operator">&gt;</span>'hdfs<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token operator">&lt;</span>namenode<span class="token operator">&gt;</span><span class="token punctuation">:</span><span class="token operator">&lt;</span>port<span class="token operator">&gt;</span><span class="token operator">/</span>
user<span class="token operator">/</span><span class="token operator">&lt;</span>hadoop<span class="token operator">-</span>user<span class="token operator">&gt;</span><span class="token operator">/</span>coprocessor<span class="token punctuation">.</span>jar<span class="token operator">|</span> org<span class="token punctuation">.</span>myname<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span><span class="token constant">Coprocessor</span><span class="token punctuation">.</span><span class="token constant">RegionObserverExample</span><span class="token operator">|</span><span class="token number">1073741823</span><span class="token operator">|</span>
arg1<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>arg2<span class="token operator">=</span><span class="token number">2</span>'

<span class="token comment">#table_att表示要修改table属性</span>
<span class="token comment">#'Coprocessor'表示属性的名称</span>
<span class="token comment">## hdfs://&lt;namenode&gt;:&lt;port&gt;/user/&lt;hadoop-user&gt;/coprocessor.jar表示协处理器的jar包在hdfs上的位置</span>
<span class="token comment">#org.myname.hbase.Coprocessor.RegionObserverExample表示协处理器的类</span>
<span class="token comment">#1073741823表示权值，因为协处理器可以有多个，那么这个值就是判断谁先执行谁后执行，是可选参数</span>
<span class="token comment">#arg1=1,arg2=2，表示要传入到类的参数，是可选参数</span>
<span class="token comment">#Coprocessor属性的值是通过 | 来进行分隔的。</span>
</code></pre></div><p>重启指定表</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token operator">&gt;</span> enable <span class="token string">'mytable'</span>
</code></pre></div><p>####### 动态加载方式二：通过编码</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://coprocessor_path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TableDescriptor</span> hTableDescriptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HTableDescriptor</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
hTableDescriptor<span class="token punctuation">.</span><span class="token function">addCoprocessor</span><span class="token punctuation">(</span><span class="token class-name">RegionObserverExample</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> <span class="token class-name">Coprocessor</span><span class="token punctuation">.</span>PRIORITY_USER<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">//协处理器名称：RegionObserverExample.class.getCanonicalName()</span>
<span class="token comment">//协处理器jar包在hdfs的位置</span>
<span class="token comment">//权值</span>
<span class="token comment">//参数：null</span>
</code></pre></div><h4 id="卸载协处理器"><a href="#卸载协处理器" class="header-anchor">#</a> 卸载协处理器</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">disable</span> <span class="token string">'test'</span>
<span class="token keyword">alter</span> <span class="token string">'test'</span><span class="token punctuation">,</span>METHOD<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'table_att_unset'</span><span class="token punctuation">,</span>NAME<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'coprocessor$1'</span>
<span class="token keyword">enable</span> <span class="token string">'test'</span>


<span class="token comment">#coprocessor$1是协处理器名称</span>
</code></pre></div><h4 id="observer协处理器实战"><a href="#observer协处理器实战" class="header-anchor">#</a> Observer协处理器实战</h4> <img src="hbase.assets/xdfsdfsdf.png" alt="xdfsdfsdf" style="zoom:70%;"> <h5 id="实战需求-4"><a href="#实战需求-4" class="header-anchor">#</a> 实战需求：</h5> <p>通过协处理器Observer实现每次向hbase当中一张表插入数据时，都将数据复制一份保存到另外一张表当中去；但是只取第一张表当中的部分列数据，保存到第二张表当中去。</p> <p>在下面实战中，是将第一张表的info列族的age列复制到第二个表。</p> <h5 id="第一步-创建两张表"><a href="#第一步-创建两张表" class="header-anchor">#</a> 第一步：创建两张表</h5> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">053</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> create <span class="token string">'proc1'</span><span class="token punctuation">,</span><span class="token string">'info'</span>
</code></pre></div><div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">054</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> create <span class="token string">'proc2'</span><span class="token punctuation">,</span><span class="token string">'info'</span>
</code></pre></div><h5 id="第二步-创建maven工程-2"><a href="#第二步-创建maven工程-2" class="header-anchor">#</a> 第二步：创建maven工程</h5> <p>创建maven工程所用的repositories、dependencies、plugins跟之前的一样</p> <div class="language-xml extra-class"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cloudera<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-mr1-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hbase-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hbase-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.14.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!--    &lt;verbal&gt;true&lt;/verbal&gt;--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-shade-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>shade<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filters</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifact</span><span class="token punctuation">&gt;</span></span>*:*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifact</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*.SF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*.DSA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*/RSA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filters</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="第三步-开发协处理器"><a href="#第三步-开发协处理器" class="header-anchor">#</a> 第三步：开发协处理器</h5> <p>协处理器的顶级接口是Coprocessor,被RegionServer等接口或类所继承，我们的实战要使用region级别的协处理器，因此我们选用实现了RegionServer接口的BaseRegionObserver类来开发协处理器，BaseRegionObserver类有很多方法，如preput(),postput(),preflush(),postflush()等等。</p> <p>我们的实战需求是在给一张表插入数据时，将特定部分的数据复制到另一张表，因此我们只需要继承BaseRegionObserver类然后重写preput()方法即可。</p> <p><img src="/assets/img/image-20200306165129234.57034a73.png" alt="image-20200306165129234"></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>coprocessor<span class="token punctuation">.</span></span><span class="token class-name">BaseRegionObserver</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>coprocessor<span class="token punctuation">.</span></span><span class="token class-name">ObserverContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>coprocessor<span class="token punctuation">.</span></span><span class="token class-name">RegionCoprocessorEnvironment</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>regionserver<span class="token punctuation">.</span>wal<span class="token punctuation">.</span></span><span class="token class-name">WALEdit</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCoprocessor</span> <span class="token keyword">extends</span> <span class="token class-name">BaseRegionObserver</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     *
     * @param e 协处理器环境对象
     * @param put  put操作时的数据
     * @param edit
     * @param durability
     * @throws IOException
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">prePut</span><span class="token punctuation">(</span><span class="token class-name">ObserverContext</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RegionCoprocessorEnvironment</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">,</span> <span class="token class-name">Put</span> put<span class="token punctuation">,</span> <span class="token class-name">WALEdit</span> edit<span class="token punctuation">,</span> <span class="token class-name">Durability</span> durability<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//连接HBase</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取Put对象中包含的info列族age列的数据</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cell</span><span class="token punctuation">&gt;</span></span> cells<span class="token operator">=</span>put<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cell</span> versionLastCell<span class="token operator">=</span>cells<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//进一步获取最新版本的数据</span>

        <span class="token comment">//获取要插入的另一个表proc2</span>
        <span class="token class-name">Table</span> t2<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;proc2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//往proc2中插入数据:</span>
        <span class="token class-name">Put</span> putProc2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span>put<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//从上面的put对象获取行键并创建另一个Put对象</span>
        putProc2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>versionLastCell<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//跟下面这行代码等价</span>
        <span class="token comment">//putProc2.addColumn(&quot;info&quot;.getBytes(),&quot;age&quot;.getBytes(), CellUtil.cloneValue(versionLastCell));</span>
        t2<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>putProc2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭资源</span>
        t2<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h5 id="第四步-上传jar包到hdfs"><a href="#第四步-上传jar包到hdfs" class="header-anchor">#</a> 第四步：上传jar包到HDFS</h5> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /tmp/
rz
hdfs dfs -mkdir /CoprocessorData
hdfs dfs -put /tmp/original-MyCoprocessor-1.0-SNAPSHOT.jar /CoprocessorData
</code></pre></div><h5 id="第五步-挂载协处理器jar包到proc1表"><a href="#第五步-挂载协处理器jar包到proc1表" class="header-anchor">#</a> 第五步：挂载协处理器jar包到proc1表</h5> <p>查看还没加载协处理器前的proc1表的属性：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">001</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> describe <span class="token string">'proc1'</span>
<span class="token constant">Table</span> proc1 is <span class="token constant">ENABLED</span>                                                          
proc1                                                                           
<span class="token constant">COLUMN</span> <span class="token constant">FAMILIES</span> <span class="token constant">DESCRIPTION</span>                                                     
<span class="token punctuation">{</span><span class="token constant">NAME</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token constant">BLOOMFILTER</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'ROW'</span><span class="token punctuation">,</span> <span class="token constant">VERSIONS</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token constant">IN_MEMORY</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'false'</span><span class="token punctuation">,</span> <span class="token constant">KE</span>
<span class="token constant">EP_DELETED_CELLS</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FALSE'</span><span class="token punctuation">,</span> <span class="token constant">DATA_BLOCK_ENCODING</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span><span class="token punctuation">,</span> <span class="token constant">TTL</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FOREVER'</span><span class="token punctuation">,</span> <span class="token constant">CO</span>
<span class="token constant">MPRESSION</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span><span class="token punctuation">,</span> <span class="token constant">MIN_VERSIONS</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token constant">BLOCKCACHE</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'true'</span><span class="token punctuation">,</span> <span class="token constant">BLOCKSIZE</span> <span class="token operator">=</span><span class="token operator">&gt;</span> '<span class="token number">65</span>
<span class="token number">536</span><span class="token string">', REPLICATION_SCOPE =&gt; '</span><span class="token number">0</span>'<span class="token punctuation">}</span>                                                 
</code></pre></div><p>加载协处理器到proc1表并查看属性,可以看到多了一个属性TABLE_ATTRIBUTES =&gt; {coprocessor$1</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:002:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> alter <span class="token string">'proc1'</span> ,METHOD<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'table_att'</span>,<span class="token string">'Coprocessor'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'hdfs://node01:8020/CoprocessorData/original-MyCoprocessor-1.0-SNAPSHOT.jar|com.jimmy.MyCoprocessor|1001|'</span>


hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:003:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> describe <span class="token string">'proc1'</span>
Table proc1 is ENABLED                                                          
proc1, <span class="token punctuation">{</span>TABLE_ATTRIBUTES <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>coprocessor<span class="token variable">$1</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'hdfs://node01:8020/CoprocessorDat
a/original-MyCoprocessor-1.0-SNAPSHOT.jar|com.jimmy.MyCoprocessor|1001|'</span><span class="token punctuation">}</span>       
COLUMN FAMILIES DESCRIPTION                                                     
<span class="token punctuation">{</span>NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'info'</span>, BLOOMFILTER <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'ROW'</span>, VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'1'</span>, IN_MEMORY <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'false'</span>, KE
EP_DELETED_CELLS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FALSE'</span>, DATA_BLOCK_ENCODING <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span>, TTL <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'FOREVER'</span>, CO
MPRESSION <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NONE'</span>, MIN_VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span>, BLOCKCACHE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'true'</span>, BLOCKSIZE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'65
536'</span>, REPLICATION_SCOPE <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'0'</span><span class="token punctuation">}</span> 
</code></pre></div><h5 id="第六步-向proc1表添加数据"><a href="#第六步-向proc1表添加数据" class="header-anchor">#</a> 第六步：向proc1表添加数据</h5> <p>第一种方式，通过hbase shell插入数据</p> <div class="language-sh extra-class"><pre class="language-sh"><code>put <span class="token string">'proc1'</span>, <span class="token string">'rk0001'</span>, <span class="token string">'info:name'</span>, <span class="token string">'zhangsan'</span>
put <span class="token string">'proc1'</span>, <span class="token string">'rk0001'</span>, <span class="token string">'info:gender'</span>, <span class="token string">'female'</span>
put <span class="token string">'proc1'</span>, <span class="token string">'rk0001'</span>, <span class="token string">'info:age'</span>, <span class="token number">20</span>
put <span class="token string">'proc1'</span>, <span class="token string">'rk0002'</span>, <span class="token string">'info:age'</span>, <span class="token number">22</span>
put <span class="token string">'proc1'</span>, <span class="token string">'rk0001'</span>, <span class="token string">'info:passwd'</span>, <span class="token string">'123456'</span>
</code></pre></div><p>第二种方式，通过javaAPI插入数据</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Put</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Table</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PutData</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Table</span> t1<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;proc1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Put</span> rk0001_put<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token string">&quot;rk0001&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rk0001_put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rk0001_put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;gender&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;female&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rk0001_put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rk0001_put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;passwd&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     	<span class="token class-name">Put</span> rk0002_put<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token string">&quot;rk0002&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rk0002_put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Put</span><span class="token punctuation">&gt;</span></span> puts<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        puts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rk0001_put<span class="token punctuation">)</span><span class="token punctuation">;</span>
        puts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rk0002_put<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>puts<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        t1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h5 id="第七步-查看proc1与proc2表的数据"><a href="#第七步-查看proc1与proc2表的数据" class="header-anchor">#</a> 第七步：查看proc1与proc2表的数据</h5> <p>可以看到，上面步骤往proc1表插入数据的同时，也往proc2表插入了数据，并且只插入info列族age列的数据。这就是我们定义的协处理器类的重写prePut()方法的作用。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:001:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'proc1'</span>
ROW                   COLUMN+CELL                                               
 rk0001               <span class="token assign-left variable">column</span><span class="token operator">=</span>info:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583487671939</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>        
 rk0001               <span class="token assign-left variable">column</span><span class="token operator">=</span>info:gender, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583487657073</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>female 
 rk0001               <span class="token assign-left variable">column</span><span class="token operator">=</span>info:name, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583487650422</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>zhangsan 
 rk0001               <span class="token assign-left variable">column</span><span class="token operator">=</span>info:passwd, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583487684867</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">123456</span> 
 rk0002               <span class="token assign-left variable">column</span><span class="token operator">=</span>info:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583487677828</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">22</span>        
<span class="token number">2</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.3000</span> seconds

hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:002:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'proc2'</span>
ROW                   COLUMN+CELL                                               
 rk0001               <span class="token assign-left variable">column</span><span class="token operator">=</span>info:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583487671883</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">20</span>        
 rk0002               <span class="token assign-left variable">column</span><span class="token operator">=</span>info:age, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583487677812</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">22</span>        
<span class="token number">2</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.0880</span> seconds
</code></pre></div><h5 id="第七步-卸载协处理器"><a href="#第七步-卸载协处理器" class="header-anchor">#</a> 第七步：卸载协处理器</h5> <p>如果需要卸载我们的协处理器，那么进入hbase的shell命令行，执行以下命令即可</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>disable <span class="token string">'proc1'</span>
alter <span class="token string">'proc1'</span><span class="token punctuation">,</span> <span class="token constant">METHOD</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'table_att_unset'</span><span class="token punctuation">,</span> <span class="token constant">NAME</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'coprocessor$1'</span>
enable <span class="token string">'proc1'</span>
</code></pre></div><h2 id="hbase的数据备份-了解"><a href="#hbase的数据备份-了解" class="header-anchor">#</a> HBase的数据备份（了解）</h2> <h4 id="基于hbase提供的类对表进行备份"><a href="#基于hbase提供的类对表进行备份" class="header-anchor">#</a> 基于HBase提供的类对表进行备份</h4> <p>####### 全量备份</p> <p>（1）从hbase表导出数据到HDFS备份文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>hadoop@node01 tmp<span class="token punctuation">]</span>$ hbase org.apache.hadoop.hbase.mapreduce.Export myuser /hbase_data/myuser_bak

<span class="token punctuation">[</span>hadoop@node01 tmp<span class="token punctuation">]</span>$ hdfs dfs -ls /hbase_data
drwxr-xr-x   - hadoop supergroup          <span class="token number">0</span> <span class="token number">2020</span>-03-06 <span class="token number">18</span>:17 /hbase_data/myuser_bak

<span class="token punctuation">[</span>hadoop@node01 tmp<span class="token punctuation">]</span>$ hdfs dfs -ls /hbase_data/myuser_bak
-rw-r--r--   <span class="token number">3</span> hadoop supergroup   <span class="token number">0</span> <span class="token number">2020</span>-03-06 <span class="token number">18</span>:17 /hbase_data/myuser_bak/_SUCCESS
-rw-r--r--   <span class="token number">3</span> hadoop supergroup   <span class="token number">1696</span> <span class="token number">2020</span>-03-06 <span class="token number">18</span>:17 /hbase_data/myuser_bak/part-m-00000
</code></pre></div><p>（2）从数据备份文件导入数据到hbase表</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment">## 创建一个表，并将myuser表的备份数据导入到该表，因为myuser表有两个列族，'f1','f2'，因此我们也要创建对应的列族</span>
hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">002</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> create <span class="token string">'bak_test'</span><span class="token punctuation">,</span><span class="token string">'f1'</span><span class="token punctuation">,</span><span class="token string">'f2'</span>

<span class="token comment">#导入备份数据到新表</span>
<span class="token punctuation">[</span>hadoop<span class="token variable">@node01</span> tmp<span class="token punctuation">]</span>$ hbase org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span><span class="token constant">Driver</span> import bak_test <span class="token operator">/</span>hbase_data<span class="token operator">/</span>myuser_bak<span class="token operator">/</span><span class="token operator">*</span> 


<span class="token comment">#从下面可以看到，’bak_test'表本来时空的，后来从备份文件导入了数据。</span>
hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">001</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> get <span class="token string">'bak_test'</span><span class="token punctuation">,</span><span class="token string">'0002'</span><span class="token punctuation">,</span><span class="token string">'f1'</span>
<span class="token constant">COLUMN</span>                <span class="token constant">CELL</span>                                                      
 f1<span class="token symbol">:age</span>               timestamp<span class="token operator">=</span><span class="token number">1582837532912</span><span class="token punctuation">,</span> value<span class="token operator">=</span>\x00\x00\x00\x1E           
 f1<span class="token symbol">:id</span>                timestamp<span class="token operator">=</span><span class="token number">1582837532912</span><span class="token punctuation">,</span> value<span class="token operator">=</span>\x00\x00\x00\x01           
 f1<span class="token symbol">:name</span>              timestamp<span class="token operator">=</span><span class="token number">1582837532912</span><span class="token punctuation">,</span> value<span class="token operator">=</span>\xE6\x9B\xB9\xE6\x93\x8D
</code></pre></div><p>####### 增量备份</p> <p>以上都是对数据进行了全量备份，后期也可以实现表的<strong>增量数据备份</strong>，增量备份跟全量备份操作差不多，只不过要在后面加上时间戳。</p> <p>例如：HBase数据导出到HDFS</p> <div class="language- extra-class"><pre class="language-text"><code>hbase org.apache.hadoop.hbase.mapreduce.Export test /hbase_data/test_bak_increment 开始时间戳  结束时间戳
</code></pre></div><h4 id="基于snapshot快照对表进行备份-常用"><a href="#基于snapshot快照对表进行备份-常用" class="header-anchor">#</a> 基于snapshot快照对表进行备份（常用）</h4> <p>通过snapshot快照的方式实现HBase数据的迁移和拷贝。这种方式比较常用，效率高，也是最为推荐的数据迁移方式。 Snapshot 相关操作（export 除外）的实现并不涉及到对 table 实际数据的拷贝，而是仅仅拷贝一些元数据。</p> <p>HBase的snapshot其实就是一组==metadata==信息的集合（文件列表），通过这些metadata信息的集合，就能将表的数据回滚到snapshot那个时刻的数据。</p> <ul><li>首先我们要了解一下所谓的HBase的LSM类型的系统结构，我们知道在HBase中，数据是先写入到Memstore中，当Memstore中的数据达到一定条件，就会flush到HDFS中，形成HFile，后面就不允许原地修改或者删除了。</li> <li>如果要更新或者删除的话，只能追加写入新文件。既然数据写入以后就不会在发生原地修改或者删除，这就是snapshot做文章的地方。做snapshot的时候，只需要给快照表对应的所有文件创建好指针（元数据集合），恢复的时候只需要根据这些指针找到对应的文件进行恢复就Ok。这是原理的最简单的描述，下图是描述快照时候的简单流程：</li></ul> <p><img src="data:image/png;base64,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" alt="snapshot"></p> <h4 id="快照实战"><a href="#快照实战" class="header-anchor">#</a> 快照实战</h4> <p>创建表的snapshot</p> <div class="language- extra-class"><pre class="language-text"><code>hbase(main):002:0&gt; snapshot 'myuser','myuser_snapshot1'
</code></pre></div><p>查看HBase存在的snapshot</p> <div class="language- extra-class"><pre class="language-text"><code>hbase(main):003:0&gt; list_snapshots
SNAPSHOT              TABLE + CREATION TIME                                     
myuser_snapshot1     myuser (Fri Mar 06 20:08:42 +0800 2020)  
</code></pre></div><p>查找以my开头的snapshot</p> <div class="language- extra-class"><pre class="language-text"><code>hbase(main):005:0&gt; list_snapshots 'my.*'
SNAPSHOT              TABLE + CREATION TIME                                     
 myuser_snapshot1     myuser (Fri Mar 06 20:08:42 +0800 2020)   
</code></pre></div><p>将myuser表恢复到snapshot状态</p> <p>ps:这里需要对表进行disable操作，先把表置为不可用状态，然后在进行进行restore_snapshot的操作</p> <div class="language- extra-class"><pre class="language-text"><code>disable 'myuser'
restore_snapshot 'myuser_snapshot1'
enable 'myuser'
</code></pre></div><p>删除snapshot</p> <div class="language- extra-class"><pre class="language-text"><code>delete_snapshot 'snapshotName'
</code></pre></div><p>迁移 snapshot</p> <div class="language- extra-class"><pre class="language-text"><code>hbase org.apache.hadoop.hbase.snapshot.ExportSnapshot \
-snapshot snapshotName  \
-copy-from hdfs://src-hbase-root-dir/hbase \
-copy-to hdfs://dst-hbase-root-dir/hbase \
-mappers 1 \
-bandwidth 1024

例如：
hbase org.apache.hadoop.hbase.snapshot.ExportSnapshot \
-snapshot test  \
-copy-from hdfs://node01:8020/hbase \
-copy-to hdfs://node01:8020/hbase1 \
-mappers 1 \
-bandwidth 1024
</code></pre></div><p>注意：这种方式用于将快照表迁移到==另外一个集群==的时候使用，使用MR进行数据的拷贝，速度很快，使用的时候记得设置好bandwidth参数，以免由于网络打满导致的线上业务故障。</p> <p>将snapshot使用bulkload的方式导入</p> <div class="language- extra-class"><pre class="language-text"><code>hbase org.apache.hadoop.hbase.mapreduce.LoadIncrementalHFiles \
hdfs://dst-hbase-root-dir/hbase/archive/datapath/tablename/filename \
tablename

例如：
创建一个新表
create 'newTest','f1','f2'
hbase org.apache.hadoop.hbase.mapreduce.LoadIncrementalHFiles hdfs://node01:8020/hbase1/archive/data/default/test/6325fabb429bf45c5dcbbe672225f1fb newTest
</code></pre></div><h2 id="hbase二级索引"><a href="#hbase二级索引" class="header-anchor">#</a> HBase二级索引</h2> <p><img src="/assets/img/hbase寻址.763987ee.png" alt="hbase寻址"></p> <ul><li>HBase表后期按照rowkey查询性能是最高的。rowkey就相当于hbase表的一级索引</li> <li>但是在实际的工作中，我们做的查询基本上都是按照一定的条件进行查找，无法事先知道满足这些条件的rowkey是什么</li> <li>正常是可以通过hbase过滤器去实现。但是效率非常低，这是由于查询的过程中需要在底层进行大量的文件扫描。</li> <li>HBase的二级索引
<ul><li>为了HBase的数据查询更高效、适应更多的场景，诸如使用==非rowkey字段检索==也能做到秒级响应，或者支持各个字段进行模糊查询和多字段组合查询等， 因此需要在HBase上面构建二级索引， 以满足现实中更复杂多样的业务需求。</li> <li>hbase的二级索引其本质就是==建立HBase表中列与行键之间的映射关系==。</li> <li>以空间换时间，提高查询的效率</li></ul></li></ul> <p><img src="/assets/img/二级索引思想-1583432325441.c1d5dbe3.png" alt=""></p> <ul><li>构建hbase二级索引方案
<ul><li>MapReduce方案</li> <li>Hbase Coprocessor(协处理器)方案</li> <li>Solr+hbase方案</li> <li>ES+hbase方案</li> <li>Phoenix+hbase方案(参见附件，phoenix安装部署使用文档)</li></ul></li></ul> <h2 id="hbase的namespace"><a href="#hbase的namespace" class="header-anchor">#</a> HBase的namespace</h2> <h3 id="namespace基本介绍"><a href="#namespace基本介绍" class="header-anchor">#</a> namespace基本介绍</h3> <p>在HBase中，namespace命名空间指对一组表的逻辑分组，类似RDBMS中的database，方便对表在业务上划分。</p> <p>Apache HBase从0.98.0, 0.95.2两个版本号开始支持namespace级别的授权操作，HBase<strong>全局管理员</strong>能够创建、改动和回收namespace的授权。</p> <p>如HBase的元数据存放的表属于hbase组，要查询该表，方式如下：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>scan <span class="token string">'hbase:meta'</span>
</code></pre></div><p>/hbase/data是hbase存储数据的核心目录。查看该目录可以发现两个默认预置的命名空间：default、hbase。在hbase中创建的表默认属于default这个命名空间逻辑组。hbase的元数据信息表meta属于‘hbase’这个命名空间逻辑组。</p> <p><img src="/assets/img/image-20200306214324739.9d13ec08.png" alt="image-20200306214324739"></p> <p><img src="/assets/img/image-20200306214814412.cf3cb00a.png" alt="image-20200306214814412"></p> <h3 id="namespace的作用"><a href="#namespace的作用" class="header-anchor">#</a> namespace的作用</h3> <ol><li>配额管理：限制一个namespace可以使用的资源，比如说可以包含多少个region和table等等。</li> <li>命名空间安全管理：提供了另一个层面的多租户安全管理</li> <li>Region服务器组：一个命名或一张表，可以被固定到一组RegionServers上（只能存放到某几个RegionServer)，从而保证了数据隔离性</li></ol> <h3 id="namespace的基本操作"><a href="#namespace的基本操作" class="header-anchor">#</a> namespace的基本操作</h3> <p>创建命名空间</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>create_namespace <span class="token string">'nametest'</span>
</code></pre></div><p>查看命名空间信息</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">007</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> describe_namespace <span class="token string">'nametest'</span>
<span class="token constant">DESCRIPTION</span>                                                                     
<span class="token punctuation">{</span><span class="token constant">NAME</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'nametest'</span><span class="token punctuation">}</span> 
</code></pre></div><p>列出所有命名空间</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">008</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> list_namespace
<span class="token constant">NAMESPACE</span>                                                                       
default                                                                         
hbase                                                                           
nametest 
</code></pre></div><p>在指定命名空间下创建表</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">009</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> create <span class="token string">'nametest:table1'</span><span class="token punctuation">,</span><span class="token string">'family1'</span>
</code></pre></div><p>列出命名空间下的所有表</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">010</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> list_namespace_tables <span class="token string">'nametest'</span>
<span class="token constant">TABLE</span>                                                                           
table1 
</code></pre></div><p>删除命名空间（命名空间必须是空的,因此首先要删除命名空间里的表）</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">002</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> disable <span class="token string">'nametest:table1'</span>
<span class="token number">0</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">2.6410</span> seconds

hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">003</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> drop <span class="token string">'nametest:table1'</span>
<span class="token number">0</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">1.3330</span> seconds

hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">004</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> drop_namespace <span class="token string">'nametest'</span>
<span class="token number">0</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.0410</span> seconds
</code></pre></div><h2 id="hbase的数据版本的确界以及ttl"><a href="#hbase的数据版本的确界以及ttl" class="header-anchor">#</a> HBase的数据版本的确界以及TTL</h2> <h3 id="数据的确界"><a href="#数据的确界" class="header-anchor">#</a> 数据的确界</h3> <ul><li><p>在HBase当中，我们可以为数据设置上界和下界，其实就是定义数据的历史版本保留多少个，通过自定义历史版本保存的数量，我们可以实现数据多个历史版本的数据查询</p></li> <li><p>版本的下界</p> <ul><li>默认的版本下界是0，即禁用。row版本使用的最小数目是与生存时间（TTL Time To Live）相结合的，并且我们根据实际需求可以有0或更多的版本，使用0，即只有1个版本的值写入cell。</li></ul></li> <li><p>版本的上界</p> <ul><li>之前默认的版本上界是3，也就是一个row保留3个版本（基于时间戳的插入）。</li> <li>该值不要设计的过大，一般的业务不会超过100。如果cell中存储的数据版本号超过了上界，再次插入数据时，最新的值会将最老的值覆盖。（现版本已默认为1）</li></ul></li></ul> <p>查看多个版本数据的语法：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>get <span class="token string">'tablename'</span>,<span class="token string">'rowkey'</span>,<span class="token punctuation">{</span>COLUMN<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'Familyname:colname'</span>,VERSIONS<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token number">5</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="数据的ttl"><a href="#数据的ttl" class="header-anchor">#</a> 数据的TTL</h3> <ul><li><p>在实际工作当中经常会遇到有些数据过了一段时间我们可能就不需要了，那么这时候我们可以使用定时任务去定时的删除这些数据</p></li> <li><p>或者我们也可以使用Hbase的TTL（Time  To  Live）功能，让我们的数据定期的会进行清除</p></li> <li><p>使用代码来设置数据的确界以及设置数据的TTL如下</p></li></ul> <h2 id="案例-数据版本-ttl"><a href="#案例-数据版本-ttl" class="header-anchor">#</a> 案例：数据版本&amp;TTL</h2> <h5 id="案例需求-3"><a href="#案例需求-3" class="header-anchor">#</a> 案例需求</h5> <p>创建一个叫versionTTL_test的表，设置TTL为10s，设置最小版本数为3，设置最大版本数为5，往同一个cell插入6个版本的数据，不同版本的数据分别为krystal0，krystal1，krystal2，krystal3，krystal4，krystal5。</p> <p>创建完表后，快速立马查看表的多个版本的数据。查看完后，隔10s后再次查看表的数据。比较两次查询的结果。</p> <h5 id="第一步-创建maven工程"><a href="#第一步-创建maven工程" class="header-anchor">#</a> 第一步：创建maven工程</h5> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cloudera<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-mr1-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hbase-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hbase-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.14.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!--    &lt;verbal&gt;true&lt;/verbal&gt;--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--将我们其他用到的一些jar包全部都打包进来  --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-shade-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>shade<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>minimizeJar</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>minimizeJar</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="第二步-代码开发"><a href="#第二步-代码开发" class="header-anchor">#</a> 第二步：代码开发</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>vt</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HBaseConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HColumnDescriptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">HTableDescriptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyVersionTTL</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">TableName</span> t_name<span class="token operator">=</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;versionTTL_test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Admin</span> am<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断表是否存在</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>am<span class="token punctuation">.</span><span class="token function">tableExists</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//获取描述表的对象</span>
            <span class="token class-name">HTableDescriptor</span> htds<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HTableDescriptor</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//获取描述列的对象</span>
            <span class="token class-name">HColumnDescriptor</span> f1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HColumnDescriptor</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//在描述列的对象上设置版本</span>
            f1<span class="token punctuation">.</span><span class="token function">setMinVersions</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            f1<span class="token punctuation">.</span><span class="token function">setMaxVersions</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//在描述列的对象上设置TTL</span>
            f1<span class="token punctuation">.</span><span class="token function">setTimeToLive</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//以秒为单位</span>
            <span class="token comment">//添加列族</span>
            htds<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//建表</span>
            am<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span>htds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//---------插入多个版本数据---------------</span>
        <span class="token comment">//获取表对象</span>
        <span class="token class-name">Table</span> t1<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">6</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Put</span> put_i<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token string">&quot;rk001&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            put_i<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;krystal&quot;</span><span class="token operator">+</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            t1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>put_i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//释放资源</span>
        t1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyVersionTTL</span><span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h5 id="第三步-查看表数据"><a href="#第三步-查看表数据" class="header-anchor">#</a> 第三步：查看表数据</h5> <p>运行完上面代码块后，立马执行查询语句，查询结果如下:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:032:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'versionTTL_test'</span>,<span class="token string">'rk001'</span>,<span class="token punctuation">{</span>COLUMN<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'f1:age'</span>,VERSIONS<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token number">5</span><span class="token punctuation">}</span>
COLUMN                          CELL                                   
 f1:age                         <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583525066857</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal5
 f1:age                         <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583525066854</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal4
 f1:age                         <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583525066850</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal3
 f1:age                         <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583525066846</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal2
 f1:age                         <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583525066833</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal1
</code></pre></div><p>运行完上面代码块后，隔10s后再次执行查询语句，查询结果如下:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:033:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> get <span class="token string">'versionTTL_test'</span>,<span class="token string">'rk001'</span>,<span class="token punctuation">{</span>COLUMN<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'f1:age'</span>,VERSIONS<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token number">5</span><span class="token punctuation">}</span>
COLUMN                          CELL                                   
 f1:age                         <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583525066857</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal5
 f1:age                         <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583525066854</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal4
 f1:age                         <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583525066850</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>krystal3
</code></pre></div><p>从两次不同时间的查询结果可以发现，第二次查询虽然指定了要查询最新5个版本的数据，也只查到了3条数据。这是因为设置了TTL为10s，10s后，插入的数据都失效了。</p> <p>那既然都失效了，为什么还能查到3个版本的数据，这是因为我们设置了最小版本数为3，因此，始终会有3个版本的数据被保留住。</p> <h5 id="拓展-整合第二第三步-插入-多版本查询"><a href="#拓展-整合第二第三步-插入-多版本查询" class="header-anchor">#</a> 拓展：整合第二第三步(插入+多版本查询)</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>vt</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyVersionTTL</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">TableName</span> t_name<span class="token operator">=</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;versionTTL_test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Admin</span> am<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断表是否存在</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>am<span class="token punctuation">.</span><span class="token function">tableExists</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//获取描述表的对象</span>
            <span class="token class-name">HTableDescriptor</span> htds<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HTableDescriptor</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//获取描述列的对象</span>
            <span class="token class-name">HColumnDescriptor</span> f1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HColumnDescriptor</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//在描述列的对象上设置版本</span>
            f1<span class="token punctuation">.</span><span class="token function">setMinVersions</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            f1<span class="token punctuation">.</span><span class="token function">setMaxVersions</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//在描述列的对象上设置TTL</span>
            f1<span class="token punctuation">.</span><span class="token function">setTimeToLive</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//以秒为单位</span>
            <span class="token comment">//添加列族</span>
            htds<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//建表</span>
            am<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span>htds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//---------插入多个版本数据1---------------</span>
        <span class="token comment">//获取表对象</span>
        <span class="token class-name">Table</span> t1<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span>t_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">6</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Put</span> put_i<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token string">&quot;rk001&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            put_i<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;krystal&quot;</span><span class="token operator">+</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            t1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>put_i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//多次put才是插入多个版本数据</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//----------查询多版本数据----------------</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">2</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Get</span> get1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Get</span><span class="token punctuation">(</span><span class="token string">&quot;rk001&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置查询所有版本的数据：</span>
            get1<span class="token punctuation">.</span><span class="token function">setMaxVersions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Result</span> rs<span class="token operator">=</span>t1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>get1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Cell</span><span class="token punctuation">[</span><span class="token punctuation">]</span>cells<span class="token operator">=</span>rs<span class="token punctuation">.</span><span class="token function">rawCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//这里记得使用rawCells()，否则查不了多版本数据</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cell</span> c<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;========================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">15000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//单位为毫秒，即15s</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//释放资源</span>
        t1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyVersionTTL</span><span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>运行输出结果如下：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>krystal5
krystal4
krystal3
krystal2
krystal1
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
krystal5
krystal4
krystal3
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</code></pre></div><h2 id="hbase微博实战案例"><a href="#hbase微博实战案例" class="header-anchor">#</a> HBase微博实战案例</h2> <h4 id="案例需求及分析"><a href="#案例需求及分析" class="header-anchor">#</a> 案例需求及分析</h4> <p>微博用户关系示意图：</p> <img src="hbase.assets/image-20200307045017299.png" alt="image-20200307045017299" style="zoom:67%;"> <p>微博用户的主要行为（案例需求）：</p> <ol><li>发微博</li> <li>关注别人</li> <li>取消关注</li> <li>获得（查看）关注的人的微博内容</li></ol> <p>根据用户的主要行为，得到要建立的表：</p> <ol><li>发微博---》建表1，存放用户发微博的内容</li> <li>关注别人&amp;取消关注---》建表2，存放用户间的关系（关注了什么人，粉丝有谁）</li> <li>获得（查看）关注的人的微博内容---》建表3，存放每个用户的关注的人发布的微博内容信息</li></ol> <p>表1设计：存放微博内容</p> <ol><li>表名:WEIBO_CONTENT</li> <li>rowkey: 用户的uid+时间戳(单单uid不行，因为一个用户可以发多条微博)</li> <li>列族：info</li> <li>列:info:title（存放标题）,info:content（存放内容）,info:pic（存放图片链接）</li> <li>version：一个版本即可</li></ol> <p><img src="/assets/img/image-20200307050820897.5ebd0d6b.png" alt="image-20200307050820897"></p> <p>表2设计：存放用户关系</p> <ol><li>表名：WEIBO_RELATIONS</li> <li>rowkey:用户的uid</li> <li>列族:follows(存放关注的用户的列)，fans(存放粉丝的列)</li> <li>列：因为关注的用户数量以及粉丝数量都是动态变化的，且列值要存储用户uid,因此我们干脆直接使用用户uid作为列名。每个rowkey对应的列的数量是根据关注的用户数量和粉丝数量动态变化的。</li> <li>version：两个列族都是1</li></ol> <p><img src="/assets/img/image-20200308010016908.8b885410.png" alt="image-20200308010016908"></p> <p>表3设计：获得关注的人发送的微博</p> <p>表名:WEIBO_RECEIVE_CONTENT</p> <p>rowkey:用户的uid</p> <p>列族:f1, 一个列族就可以，</p> <p>列:以用户的uid作为列名，用户发送的微博对应的rowkey（uid+时间戳）作为列值。每个rowkey对应的列的数量是根据关注的用户数量和粉丝数量动态变化的。</p> <p>version：设置为100个版本</p> <p><img src="/assets/img/image-20200308010215305.a84e7708.png" alt="image-20200308010215305"></p> <h4 id="第一步-创建maven工程-2"><a href="#第一步-创建maven工程-2" class="header-anchor">#</a> 第一步：创建maven工程</h4> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cloudera<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0-mr1-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hbase-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hbase-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0-cdh5.14.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.14.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!--    &lt;verbal&gt;true&lt;/verbal&gt;--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--将我们其他用到的一些jar包全部都打包进来  --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-shade-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>shade<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>minimizeJar</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>minimizeJar</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="第二步-拷贝配置文件到maven工程"><a href="#第二步-拷贝配置文件到maven工程" class="header-anchor">#</a> 第二步：拷贝配置文件到maven工程</h4> <p>将node01服务器的三个配置文件，分别是core-site.xml、hdfs-site.xml、hbase-site.xml这三个配置文件，拷贝到maven工程的resources资源目录下。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>hadoop@node01 ~<span class="token punctuation">]</span>$ sz /kkb/install/hbase-1.2.0-cdh5.14.2/conf/core-site.xml 
<span class="token punctuation">[</span>hadoop@node01 ~<span class="token punctuation">]</span>$ sz /kkb/install/hbase-1.2.0-cdh5.14.2/conf/hdfs-site.xml 
<span class="token punctuation">[</span>hadoop@node01 ~<span class="token punctuation">]</span>$ sz /kkb/install/hbase-1.2.0-cdh5.14.2/conf/hbase-site.xml 
</code></pre></div><p><img src="data:image/png;base64,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" alt="image-20200308021654302"></p> <h4 id="第三步-创建工具类"><a href="#第三步-创建工具类" class="header-anchor">#</a> 第三步：创建工具类</h4> <p>自己创建的MyHBaseUtils工具类包含的方法：</p> <ol><li>获取Connection对象</li> <li>创建命名空间</li> <li>创建微博内容表WEIBO_CONTENT</li> <li>创建微博用户关系表WEIBO_RELATIONS</li> <li>创建微博用户接收关注用户发送的微博表WEIBO_RECEIVE_CONTENT</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>weibo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyHBaseUtils</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义获取Connection对象的方法，提高代码复用率</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf<span class="token operator">=</span> <span class="token class-name">HBaseConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node01:2181,node02:2181,node03:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> conne<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//创建命名空间并定义表名</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createNameSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span><span class="token class-name">MyHBaseUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Admin</span> am<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建一个名为weibo的命名空间</span>
        <span class="token class-name">NamespaceDescriptor</span> nsds<span class="token operator">=</span><span class="token class-name">NamespaceDescriptor</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;weibo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;creator&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;jimmy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        am<span class="token punctuation">.</span><span class="token function">createNamespace</span><span class="token punctuation">(</span>nsds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        am<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//定义创建WEIBO_CONTENT表的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createTableContent</span><span class="token punctuation">(</span><span class="token class-name">TableName</span> tableName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span><span class="token class-name">MyHBaseUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Admin</span> am<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>am<span class="token punctuation">.</span><span class="token function">tableExists</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">HTableDescriptor</span> htds<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HTableDescriptor</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">HColumnDescriptor</span> colDes<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HColumnDescriptor</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            colDes<span class="token punctuation">.</span><span class="token function">setMinVersions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            colDes<span class="token punctuation">.</span><span class="token function">setMaxVersions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            colDes<span class="token punctuation">.</span><span class="token function">setBlockCacheEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启块缓存,保持着每个HFile数据块的startKey</span>
            <span class="token comment">//colDes.setBlocksize(64*1024); 设置块大小，加载到内存当中的数据块越小，随机查找性能更好,越大，连续读性能更好</span>
            htds<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span>colDes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            am<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span>htds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        am<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//定义创建WEIBO_RELATIONS表的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createTableRelations</span><span class="token punctuation">(</span><span class="token class-name">TableName</span> tableName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span><span class="token class-name">MyHBaseUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Admin</span> am<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>am<span class="token punctuation">.</span><span class="token function">tableExists</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">HTableDescriptor</span> htds<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HTableDescriptor</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">HColumnDescriptor</span> colDes1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HColumnDescriptor</span><span class="token punctuation">(</span><span class="token string">&quot;follows&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            colDes1<span class="token punctuation">.</span><span class="token function">setMinVersions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            colDes1<span class="token punctuation">.</span><span class="token function">setMaxVersions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            colDes1<span class="token punctuation">.</span><span class="token function">setBlockCacheEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">HColumnDescriptor</span> colDes2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HColumnDescriptor</span><span class="token punctuation">(</span><span class="token string">&quot;fans&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            colDes2<span class="token punctuation">.</span><span class="token function">setMinVersions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            colDes2<span class="token punctuation">.</span><span class="token function">setMaxVersions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            colDes2<span class="token punctuation">.</span><span class="token function">setBlockCacheEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            htds<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span>colDes1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            htds<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span>colDes2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            am<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span>htds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        am<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//定义创建WEIBO_RECEIVE_CONTENT表的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createTableReceive</span><span class="token punctuation">(</span><span class="token class-name">TableName</span> tableName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span><span class="token class-name">MyHBaseUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Admin</span> am<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>am<span class="token punctuation">.</span><span class="token function">tableExists</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">HTableDescriptor</span> htds<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HTableDescriptor</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">HColumnDescriptor</span> colDes<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HColumnDescriptor</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            colDes<span class="token punctuation">.</span><span class="token function">setMinVersions</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            colDes<span class="token punctuation">.</span><span class="token function">setMaxVersions</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            colDes<span class="token punctuation">.</span><span class="token function">setBlockCacheEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启块缓存,保持着每个HFile数据块的startKey</span>
            <span class="token comment">//colDes.setBlocksize(64*1024); 设置块大小，加载到内存当中的数据块越小，随机查找性能更好,越大，连续读性能更好</span>
            htds<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span>colDes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            am<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span>htds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        am<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="第四步-创建发送微博类"><a href="#第四步-创建发送微博类" class="header-anchor">#</a> 第四步：创建发送微博类</h4> <p>发送微博类包含一个方法：发送微博。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>weibo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">CellUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义发布微博的方法,发布微博要做3件事情</span>
    <span class="token comment">//1、将微博内容的数据添加到WEIBO_CONTENT表</span>
    <span class="token comment">//2、找出发送微博的人的粉丝（到WEIBO_RELATIONS表找）</span>
    <span class="token comment">//3、粉丝获得微博内容（添加数据到WEIBO_RECEIVE_CONTENT表）</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">PosthWeibo</span><span class="token punctuation">(</span><span class="token class-name">TableName</span> t_CONTENT<span class="token punctuation">,</span> <span class="token class-name">TableName</span> t_RELATIONS<span class="token punctuation">,</span> <span class="token class-name">TableName</span> t_RECEIVE<span class="token punctuation">,</span> <span class="token class-name">String</span> uid<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>title_content_pic<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//1、将微博内容的数据添加到WEIBO_CONTENT表</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span><span class="token class-name">MyHBaseUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Table</span> WEIBO_CONTENT<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span>t_CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> rowkeySTR<span class="token operator">=</span>uid<span class="token operator">+</span> <span class="token string">&quot;_&quot;</span><span class="token operator">+</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//构建rowkey</span>
        <span class="token class-name">Put</span> put1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span>rowkeySTR<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>title_content_pic<span class="token punctuation">.</span>length<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            WEIBO_CONTENT<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        put1<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>title_content_pic<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put1<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>title_content_pic<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        put1<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;pic&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>title_content_pic<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        WEIBO_CONTENT<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>put1<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">//2、找出发送微博的人的粉丝（到WEIBO_RELATIONS表找）</span>
        <span class="token class-name">Table</span> WEIBO_RELATIONS<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span>t_RELATIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Get</span> get1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Get</span><span class="token punctuation">(</span>uid<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        get1<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span><span class="token string">&quot;fans&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Result</span> rs<span class="token operator">=</span>WEIBO_RELATIONS<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>get1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            WEIBO_RELATIONS<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            WEIBO_CONTENT<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Cell</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cells<span class="token operator">=</span>rs<span class="token punctuation">.</span><span class="token function">rawCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> fansList<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Cell</span> c<span class="token operator">:</span>cells<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> a<span class="token operator">=</span> <span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fansList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token comment">//3、粉丝获得微博内容（添加数据到WEIBO_RECEIVE_CONTENT表）</span>
        <span class="token class-name">Table</span> WEIBO_RECEIVE<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span>t_RECEIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Put</span><span class="token punctuation">&gt;</span></span> puts<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> f<span class="token operator">:</span>fansList<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Put</span> put<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>uid<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rowkeySTR<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            puts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>put<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        WEIBO_RECEIVE<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>puts<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">//释放资源</span>
        WEIBO_CONTENT<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        WEIBO_RECEIVE<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        WEIBO_RELATIONS<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="第五步-创建关注取关类"><a href="#第五步-创建关注取关类" class="header-anchor">#</a> 第五步：创建关注取关类</h4> <p>该类主要包含两个方法：关注与取关。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>weibo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">PrefixFilter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Bytes</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FollowAndCancel</span><span class="token punctuation">{</span>
    <span class="token comment">//定义关注微博的方法，要做3件事情</span>
    <span class="token comment">//1、给对应用户添加关注的人，给被关注的人添加粉丝（往关系表两个列族分别插入列和数据）</span>
    <span class="token comment">//2、获取用户新关注的人发送的微博（去CONTENT表获取rowkey)</span>
    <span class="token comment">//3、将新关注的人发送的微博rowkey等数据添加到RECEIVE表</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">follow</span><span class="token punctuation">(</span><span class="token class-name">TableName</span> tNameRelations<span class="token punctuation">,</span><span class="token class-name">TableName</span> tNameContent<span class="token punctuation">,</span><span class="token class-name">TableName</span> tNameReceive<span class="token punctuation">,</span><span class="token class-name">String</span> uid<span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>users<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//1、给对应用户添加关注的人，给被关注的人添加粉丝（两个列族分别插入列和数据）</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span><span class="token class-name">MyHBaseUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Table</span> relations_t<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span>tNameRelations<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Put</span> putFollows<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span>uid<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Put</span><span class="token punctuation">&gt;</span></span> putFansList<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> u<span class="token operator">:</span>users<span class="token punctuation">)</span><span class="token punctuation">{</span>
            putFollows<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;follows&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>u<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>u<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Put</span> put<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;fans&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>uid<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>uid<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            putFansList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>put<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        relations_t<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>putFollows<span class="token punctuation">)</span><span class="token punctuation">;</span>
        relations_t<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>putFansList<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//2、获取用户新关注的人发送的微博（去CONTENT表获取rowkey)</span>
        <span class="token comment">//因为CONTENT表的rowkey构成是uid+时间戳,因此我们可以设置一个前缀过滤器</span>
        <span class="token class-name">Table</span> content_t<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span>tNameContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Scan</span> scan<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> rowkeyContentList<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token operator">:</span>users<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">PrefixFilter</span> preF<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PrefixFilter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token operator">+</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            scan<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>preF<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ResultScanner</span> rsScanner<span class="token operator">=</span>content_t<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>scan<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">==</span>rsScanner<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Result</span> rs<span class="token operator">:</span>rsScanner<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rowkeyContent<span class="token operator">=</span>rs<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                rowkeyContentList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rowkeyContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//3、将新关注的人发送的微博rowkey等数据添加到RECEIVE表</span>
        <span class="token class-name">Table</span> receive_t<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span>tNameReceive<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rowkeyContentList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Put</span> put1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span>uid<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b<span class="token operator">:</span>rowkeyContentList<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">String</span> rowkey<span class="token operator">=</span> <span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split<span class="token operator">=</span>rowkey<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                put1<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            receive_t<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>put1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//释放资源：</span>
        receive_t<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        content_t<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        relations_t<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//取消关注需要做3件事情：</span>
    <span class="token comment">//1、修改关系表(删除关注用户及删除粉丝）</span>
    <span class="token comment">//2、修改receive表（删除取消了关注的用户发送的微博）</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token class-name">TableName</span> tNameRelations<span class="token punctuation">,</span><span class="token class-name">TableName</span> tNameReceive<span class="token punctuation">,</span><span class="token class-name">String</span> uid<span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>users<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//1、修改关系表</span>
        <span class="token class-name">Connection</span> conne<span class="token operator">=</span><span class="token class-name">MyHBaseUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Table</span> relations_t<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span>tNameRelations<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Delete</span> del<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Delete</span><span class="token punctuation">(</span>uid<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//删除关注的用户</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> u<span class="token operator">:</span>users<span class="token punctuation">)</span><span class="token punctuation">{</span>
            del<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;follows&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>u<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        relations_t<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>del<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//删除粉丝</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> u<span class="token operator">:</span>users<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Delete</span> del2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Delete</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            del2<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;fans&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>uid<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            relations_t<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>del2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token comment">//2、修改receive表（删除取消了关注的用户发送的微博）</span>
        <span class="token class-name">Table</span> receive_t<span class="token operator">=</span>conne<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span>tNameReceive<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Delete</span> del3<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Delete</span><span class="token punctuation">(</span>uid<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token operator">:</span>users<span class="token punctuation">)</span><span class="token punctuation">{</span>
            del3<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&quot;f1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>s<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        receive_t<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>del3<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">//释放资源：</span>
        receive_t<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        relations_t<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conne<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="第六步-查看效果1-建表-关注"><a href="#第六步-查看效果1-建表-关注" class="header-anchor">#</a> 第六步：查看效果1(建表，关注)</h4> <p>首先执行下列代码，查看效果。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>weibo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">TableName</span> content<span class="token operator">=</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;weibo:WEIBO_CONTENT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">TableName</span> relations<span class="token operator">=</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;weibo:WEIBO_RELATIONS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">TableName</span> receive<span class="token operator">=</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;weibo:WEIBO_RECEIVE_CONTENT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建命名空间weibo</span>
        <span class="token class-name">MyHBaseUtils</span><span class="token punctuation">.</span><span class="token function">createNameSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建三个表</span>
        <span class="token class-name">MyHBaseUtils</span><span class="token punctuation">.</span><span class="token function">createTableContent</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyHBaseUtils</span><span class="token punctuation">.</span><span class="token function">createTableRelations</span><span class="token punctuation">(</span>relations<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyHBaseUtils</span><span class="token punctuation">.</span><span class="token function">createTableReceive</span><span class="token punctuation">(</span>receive<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关注别人</span>
        <span class="token comment">// 1关注2，5</span>
        <span class="token comment">// 4关注3</span>
        <span class="token class-name">FollowAndCancel</span><span class="token punctuation">.</span><span class="token function">follow</span><span class="token punctuation">(</span>relations<span class="token punctuation">,</span>content<span class="token punctuation">,</span>receive<span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FollowAndCancel</span><span class="token punctuation">.</span><span class="token function">follow</span><span class="token punctuation">(</span>relations<span class="token punctuation">,</span>content<span class="token punctuation">,</span>receive<span class="token punctuation">,</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-ruby extra-class"><pre class="language-ruby"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">001</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> list
<span class="token constant">TABLE</span>                      
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                     
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         
weibo<span class="token symbol">:WEIBO_CONTENT</span>        
weibo<span class="token symbol">:WEIBO_RECEIVE_CONTENT</span>
weibo<span class="token symbol">:WEIBO_RELATIONS</span>      
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:002:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'weibo:WEIBO_RELATIONS'</span>
ROW                                COLUMN+CELL                               
 <span class="token number">1</span>                                 <span class="token assign-left variable">column</span><span class="token operator">=</span>follows:2, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161481</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">2</span> 
 <span class="token number">1</span>                                 <span class="token assign-left variable">column</span><span class="token operator">=</span>follows:5, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161481</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">5</span> 
 <span class="token number">2</span>                                 <span class="token assign-left variable">column</span><span class="token operator">=</span>fans:1, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161506</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">1</span>    
 <span class="token number">3</span>                                 <span class="token assign-left variable">column</span><span class="token operator">=</span>fans:4, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161599</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">4</span>    
 <span class="token number">4</span>                                 <span class="token assign-left variable">column</span><span class="token operator">=</span>follows:3, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161589</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">3</span> 
 <span class="token number">5</span>                                 <span class="token assign-left variable">column</span><span class="token operator">=</span>fans:1, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161506</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">1</span>    
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:003:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'weibo:WEIBO_RECEIVE_CONTENT'</span>
ROW                                             COLUMN+CELL
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:004:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'weibo:WEIBO_RECEIVE_CONTENT'</span>
ROW                                             COLUMN+CELL
</code></pre></div><h4 id="第七步-查看效果2-发微博"><a href="#第七步-查看效果2-发微博" class="header-anchor">#</a> 第七步：查看效果2（发微博）</h4> <p>在查看效果1中的代码块运行的基础上，继续运行下列代码，然后继续查看效果。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>weibo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">TableName</span> content<span class="token operator">=</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;weibo:WEIBO_CONTENT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">TableName</span> relations<span class="token operator">=</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;weibo:WEIBO_RELATIONS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">TableName</span> receive<span class="token operator">=</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;weibo:WEIBO_RECEIVE_CONTENT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Post<span class="token punctuation">.</span>PosthWeibo</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span>relations<span class="token punctuation">,</span>receive<span class="token punctuation">,</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;湖人VS雄鹿&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;今天湖人赢了雄鹿&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http://zhiboba.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:006:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'weibo:WEIBO_CONTENT'</span>
ROW                     COLUMN+CELL                                                   
5_1583618326620     <span class="token assign-left variable">column</span><span class="token operator">=</span>info:content, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583618329612</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBB<span class="token punctuation">\</span>x8A<span class="token punctuation">\</span>xE5<span class="token punctuation">\</span>xA4<span class="token punctuation">\</span>xA9<span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>xB9<span class="token punctuation">\</span>x96<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xE8<span class="token punctuation">\</span>xB5<span class="token punctuation">\</span>xA2<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>x86<span class="token punctuation">\</span>xE9<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>x84<span class="token punctuation">\</span>xE9<span class="token punctuation">\</span>xB9<span class="token punctuation">\</span>xBF                                                                                                                                
5_1583618326620     <span class="token assign-left variable">column</span><span class="token operator">=</span>info:pic, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583618329612</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>http://zhiboba.com                                                                        
5_1583618326620     <span class="token assign-left variable">column</span><span class="token operator">=</span>info:title, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583618329612</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token punctuation">\</span>xE6<span class="token punctuation">\</span>xB9<span class="token punctuation">\</span>x96<span class="token punctuation">\</span>xE4<span class="token punctuation">\</span>xBA<span class="token punctuation">\</span>xBAVS<span class="token punctuation">\</span>xE9<span class="token punctuation">\</span>x9B<span class="token punctuation">\</span>x84<span class="token punctuation">\</span>xE9<span class="token punctuation">\</span>xB9<span class="token punctuation">\</span>xBF                              
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:005:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'weibo:WEIBO_RECEIVE_CONTENT'</span>
ROW                  COLUMN+CELL                           
<span class="token number">1</span>                    <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:5, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583618329639</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>5_1583618326620
</code></pre></div><h4 id="第八步-查看效果3-取关"><a href="#第八步-查看效果3-取关" class="header-anchor">#</a> 第八步：查看效果3（取关)</h4> <p>在查看效果2中的代码块运行的基础上，继续运行下列代码，然后继续查看效果。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jimmy<span class="token punctuation">.</span>weibo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hbase<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">TableName</span> content<span class="token operator">=</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;weibo:WEIBO_CONTENT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">TableName</span> relations<span class="token operator">=</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;weibo:WEIBO_RELATIONS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">TableName</span> receive<span class="token operator">=</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;weibo:WEIBO_RECEIVE_CONTENT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//uid为1的用户取关5用户</span>
        <span class="token class-name">FollowAndCancel</span><span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span>relations<span class="token punctuation">,</span>receive<span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#取关前:</span>
hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:005:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'weibo:WEIBO_RECEIVE_CONTENT'</span>
ROW                  COLUMN+CELL                           
<span class="token number">1</span>                    <span class="token assign-left variable">column</span><span class="token operator">=</span>f1:5, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583618329639</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span>5_1583618326620

<span class="token comment">#取关后:</span>
hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:007:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'weibo:WEIBO_RECEIVE_CONTENT'</span>
ROW                                             COLUMN+CELL
<span class="token number">0</span> row<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0.0210</span> seconds
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#取关前:</span>
hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:002:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'weibo:WEIBO_RELATIONS'</span>
ROW                                COLUMN+CELL                               
 <span class="token number">1</span>                                 <span class="token assign-left variable">column</span><span class="token operator">=</span>follows:2, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161481</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">2</span> 
 <span class="token number">1</span>                                 <span class="token assign-left variable">column</span><span class="token operator">=</span>follows:5, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161481</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">5</span> 
 <span class="token number">2</span>                                 <span class="token assign-left variable">column</span><span class="token operator">=</span>fans:1, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161506</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">1</span>    
 <span class="token number">3</span>                                 <span class="token assign-left variable">column</span><span class="token operator">=</span>fans:4, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161599</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">4</span>    
 <span class="token number">4</span>                                 <span class="token assign-left variable">column</span><span class="token operator">=</span>follows:3, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161589</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">3</span> 
 <span class="token number">5</span>                                 <span class="token assign-left variable">column</span><span class="token operator">=</span>fans:1, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161506</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">1</span>    


<span class="token comment">#取关后:</span>
hbase<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:009:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> scan <span class="token string">'weibo:WEIBO_RELATIONS'</span>
ROW                         COLUMN+CELL                                       
 <span class="token number">1</span>                          <span class="token assign-left variable">column</span><span class="token operator">=</span>follows:2, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161481</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">2</span>
 <span class="token number">2</span>                          <span class="token assign-left variable">column</span><span class="token operator">=</span>fans:1, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161506</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">1</span>   
 <span class="token number">3</span>                          <span class="token assign-left variable">column</span><span class="token operator">=</span>fans:4, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161599</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">4</span>   
 <span class="token number">4</span>                          <span class="token assign-left variable">column</span><span class="token operator">=</span>follows:3, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1583617161589</span>, <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">3</span>
</code></pre></div><h4 id="案例功能拓展-todo"><a href="#案例功能拓展-todo" class="header-anchor">#</a> 案例功能拓展（TODO）</h4> <ol><li>创建一个用来获取指定uid用户关注的所有用户发送的微博</li> <li>修改发送微博类（发送微博可以有标题，可以没有标题，可以有图片，也可以没有图片）。</li></ol> <h2 id="拓展-布隆过滤器"><a href="#拓展-布隆过滤器" class="header-anchor">#</a> 拓展：布隆过滤器</h2> <h4 id="缓存穿透"><a href="#缓存穿透" class="header-anchor">#</a> 缓存穿透</h4> <p>以Redis数据库为例，我们经常会把数据放进缓存中，有查询请求进来的时候，优先去缓存中查询，没有再到数据库查询。这样看起来很好，但是思考一个问题：如果有大量的请求进来，而且请求的数据内容都是不存在的，缓存中没有就会去数据库找，那么大量的请求就会导致数据库的压力快速上升，甚至导致奔溃。这就是缓存穿透。</p> <p>如果服务器的内存足够大，那么使用HashMap是一个不错的解决方案，理论上时间复杂度可以达到O(1)。但是如果数据的大小已经远远超出了服务器的内存，就无法再使用HashMap来解决。</p> <p>此时，布隆过滤器就出场了，它能够缓解这个问题（只能缓解）。布隆过滤器能够使得快速判断请求的数据内容存不存在，然后快速做出响应。</p> <h4 id="布隆过滤器"><a href="#布隆过滤器" class="header-anchor">#</a> 布隆过滤器</h4> <p>布隆过滤器是一个叫做“布隆”的人提出来的，本质是一个概率型数据结构，是一个很长的二进制向量，这个向量存放的要么是0，要么是1。</p> <p><img src="data:image/png;base64,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REREREREw4wLLyIiIiIiomHGhRcREREREdEw48KLiIiIiIhomCmZTAYAYJqmx6UQEREREREFTyaTgdI/MABZlqHrutf1EBERERERBU5aVaEkSkshyzJisZjX9RAREREREQVOorQUSjgcBgDIMn/uRUREREREVGihUGjkX65hmiZWr16NOXPmYPbs2fj73/8OIcRIl1FwQgicOHECs2fPxpw5c/Dggw/i5MmTXpflyvnz5/HQQw8hmUxiyZIl2Lp1ayB+A2jbNvbt24ePf/zjSCaTWLZsGdra2rwuqyBM08SaNWuyuXr55ZcDk6uTJ09mc/XAAw/g+PHjXpflyoULF/Dwww9nc7Vly5bA5Gr//v3ZXC1duhStra1el1UQ1+dq165dgczVqlWrfJ2rRx55BMlkEosXL8bmzZsDk6sDBw7gE5/4BJLJJD70oQ8FKldr167N5mrnzp2BzNXKlSvR3NzsdVmudHZ24tFHH0UymcSiRYvw5z//OVC5uv/++5FMJnHfffeNeK5GdOGlaRrWrVuHmpoa7Nu3D88//zw2bdqE119/fSTLKDgnbE899RS2bNmCvXv34r777sPWrVvR19fndXk5uXTpEjZs2IAlS5bg4MGD+NWvfoXGxkY0NTXBtm2vy8tLS0sLdu7cifXr16OhoQErV67EH/7wB/T09HhdWl40TcP69etRXV2Nffv2YdOmTXjxxRdx4MABr0vLixACp06dwlNPPYXNmzdj7969WLp0KbZt24be3l6vy8uJk6tFixahoaEBv/71r9HU1ITGxkbf56q1tRUvvfRSNlerVq0KTK6efPJJVFVVZXP1pz/9KTC5+s53vpPN1fLly7F161akUimvy8tJd3c3Nm7ciIULF6KhoQHPPfccDh06hIMHD/o+V21tbdixYweeeOIJNDQ04LOf/Sx+//vfByJX3/72tzFhwgTs27cPL7zwAjZv3oz9+/d7XVpehBBoaWnBd7/7XWzevBmvvfYaVqxYgW3btvmuzZxcLViwAK+//jo2bNiAw4cPo6Ghwfe5On36NHbs2IHHH38cDQ0N+NznPoff/e53uHLlyojVMKILrxMnTqC5uRn3338/IpEIpk+fjjlz5uDll1/29Upa0zS88soruPfeezF58mTEYjHcc8896OzsREdHh9fl3TYhBNrb2xEOhzF//nwAQHV1NSZOnIjGxkY4b8D0q8bGRowfPx7Tpk2DJEn4yEc+AlVV0dzc7Ou7bSdPnsSxY8fwqU99CpFIBNOmTQtUrpYsWYLa2lrEYjEsXLgQFy9e9F2uOjo6oCgK5s+fD0mSUFVVhUmTJgUmV+PGjcvm6qMf/Sg0TcOxY8d8natTp04Nmatdu3b5PlevvvoqFi1alM3VggULcOnSJbS3t3td3m1zchUKhQblqqamBo2NjdA0zesS83Lw4EGMGzcO06dPz+Yqk8kEJlef/vSnEYlEMHXq1EDl6p577kFtbS2i0ahvc3Xu3DlIkoQPfOADkGUZlZWVmDx5cmByNXbsWMyYMQOSJOFjH/vYiOdqRBdep0+fRn19PcrKygBc/a7jxIkTcfz4cVy+fHkkSykoTdPQ2dmJ6urq7GdFRUWwbRunTp3ysLLcmKaJM2fOoLi4ONtGiqJg7NixuHTpkq/ffGkYBtra2jB16lQUFRUBAOLxOOLxOM6dOwfLsjyu0L2b5aq5uRnd3d0eV+deJpO5IVfxeBy2bfvqa7yWZeHs2bMoKioaMld+XngZhoHW1tZA52rMmDEAgperqqqq7Gd+HK+cXMXj8UFtNHbsWHR3dwcuV7FYDEVFRejo6PB1rs6cOYO6urpBbVZdXR2YXFVWVmY/i8fjAOD7XDnjVXd3t68XXoZhoKWl5YZcFRcXj2iuRnThlU6nUVRUNOhFHjNmzEA6nfb1RXIoJSUlqKmpgaqqXpdy24QQUFUViqIgFAoBuHpRfMc73oFwOOzrR8yWZcGyLCiKAkmSAFw9tsrKSl8vKAFAVdUbcjV9+nSoqhrIXE2aNMlXF3/btpFOp4fMVSQSYa5GKVVVEY/H/ydyVVxcjJqaGl8dlxAC6XQaoVAokLkyTXNQrhRFQWVlpa/aaCg3y1U6nfbVdf12OOOVn9rs2lwpigLg6sv3nFz5+Wmrbds35CoUCqGqqgqZTCaYT7yG4hy8nw3VWJIkZf/xuyAcw80E9diC8JbSoSZOkiRBluVAtFsQjuFmgtD/hhKENrtZroJwbEAw2uhmgnpsQTiumy30g3BsQLCuEdcb6eMa0dExHo9D07RBC5WOjg7EYjFEIpGRLKWghmq0vr4+dHZ2IhqNelCRO5IkIRaLZe9iA1cXlb29vbAsy9eTKeeuqGma2f4nhEBXVxecP6ngV7FYDKqqDrrwByFXQ/U3P+bK+TuJlmVl2yjoubp48WIgcqVp2qBcnTt3LpC56u/v912unPHKtu0bxivTNH2fK0VRhsyVn/seAESj0Zvmyk/973pBypXzlf5rv3rn5MrPiy9Zlm/IFYBsrkbq2Eb0ylRfX4///Oc/2TcnWZaFixcv4s4778TYsWNHspSCikQiSCQSOH/+fPYzVVURCoUwY8YMDyvLjaIomDhxIlKpVPatcZZlIZVKZR8z+1U4HEZ5eTnOnDmT/fpnJpOBruuYNGlS9qsqflRfX4+jR48OarOuri68853vxLhx4zyuzr1wOHxDrjRNQygUwvTp0z2sLDfOb4N6e3sHXftSqRTuuOMOXw3K13Nydfr06cDlqq6uDkePHr1hvPJ7rpzxqrOzM/uZM175PVe2bQcmVxUVFTh9+jTS6TSAq7nKZDK+z1V9fT2OHTs2KFddXV248847A5crv45X1dXV6Ovry76N0bIs9Pb24o477kAsFvO4QvdulitN00Y0VyO68JoyZQpqa2uxbdu27I9Hjxw5gpUrV/r67mhRURGSySR27dqFjo4OaJqGPXv2YNq0aaitrfW6vJxMnjwZ/f392L17N4Crf9Oro6MD8+bN8/VABgDJZBItLS1obW2FEAI7duxARUUF3vWud/n6Lk59fT1qa2uxdevW7EtEDh8+jFWrVvk+V3PmzMHf/vY3dHR0IJPJYM+ePaivr0ddXZ3X5eVk8uTJGBgYwO7duyGEwIULF9De3h6IXM2dOxetra1oaWmBEALbt29HeXk53v3udwcuV0eOHMEDDzzg61zF4/EbcrV3717U1dX5LlfO76ivzdXZs2cxb948X08Qgau5amtruyFXM2fO9HWu6urqUFtbiy1btkDXdZw+fRpHjhzBgw8+GIhc/eMf/xiUq8mTJ6O+vt7r8nJSU1MDTdOwe/du2LaNCxcuoK2tLRC5mjdv3qBc/eUvf8GYMWMwa9asEcuVMiJ7eUsikcAPfvADrFu3DosXL0ZVVRXWr1/vq7sBQ3FeuzkwMICVK1dClmUsWrQIX/3qV1FcXOx1ebfNeR3vI488gtWrV+PnP/85xo8fj9WrV2PWrFm+/uoGAMyePRuXLl3CmjVr0Nvbiw9+8IP4xje+gdLSUq9Ly8v1uaqsrMS6det89bR1KNfm6jOf+QxCoRAWLlyIr33taygpKfG6vNsmSRIqKyuzufrFL36RzdVdd93l+1zdfffd6O7uxtq1a9Hb24slS5bgm9/8ZiBy9f3vfx/r16/P5uqJJ54IRK7e//73D8rVggUL8PWvf91Xbebk6uGHH8batWsH5eo973mP73P13ve+F93d3fjWt76FVCqFxYsX47HHHvNVGw0lkUjge9/7HtavX48lS5ZgwoQJgcnV+973vkG5mj9/vi9zNWHCBDz00EN4/PHH8ctf/hLjxo3DmjVrApmrRYsW4bHHHkMikRixGkZ04QUAFRUV+OlPfzrSux12iqJg+fLlWL58udel5EWSJNTV1eGPf/yj16UUXDgcxooVK7BixQqvSym48vJy/OQnP/G6jIILUq5qa2vx4osvel1KwYXD4UC00VDKy8vx7LPPel1GwSmKgmXLlmHZsmVel5IXJ1cvvPCC16UUXDgcDkQbDSXIuVq6dCmWLl3qdSl5cXK1adMmr0spuNHQRsq1P9wkIiIiIiKiwhJCQHH+boKf/2I4ERERERHRaKVpGhTnTXV+fksOERERERHRaBWJRKA4Cy6//2COiIiIiIhoNAqFQiP7OnkiIiIiIqL/RVx4ERERERERDTMuvIiIiIiIiIYZF15ERERERETDjAsvIiIiIiKiYcaFFxERERER0TDjwouIiIiIiGiYceFFREREREQ0zLjwIiIiIiIiGmZceBEREREREQ0zLryIiIiIiIiGGRdeREREREREw0zRdR0AYFmWx6UQEREREREFj67rUGzbBgA4/yYiIiIiIqLCsW0bSiwWAwCEw2GPyyEiIiIiIgqeWCzG33gRERERERENNy68iIiIiIiIhhkXXkRERERERMNMuf6D1tZWPPnkk17UMiyEEEilUtB1Hb/97W8xbtw4r0tybd++fTAMA//85z9x9uxZr8spqObmZgghsHv3bvT09HhdTsGcOXMGmqahra0tsLnasGEDtm/f7nVJru3fvz+bq/b2dq/LKSgnV3v27EEqlfK6nII5e/ZsIHMFYFCuduzY4XU5rh04cACmaeJf//oXzp0753U5BXX06FEAwJ49e9Db2+txNYXT3t4e2Fz19PRA0zRs3LgRL730ktfluObk6pVXXsH58+e9Lqeg3njjDQDAa6+9hv7+fo+rKZyuri5cvHgRNTU1AABJCCEAoKmpCT/72c9w4sQJmKbpaZGF5hxPKBSCJEkeV5OfodpGkiSEQiEPqikcy7IghAjEsVxLCJH9Uw2KcsN9Dl9jrkY/5sp/mKvRj7nyn6Dk6mbz8yD0xaDmCgBkWcbcuXPx7LPP/v8Tr5qaGqxcuRIXLlzIHrzzink3J8CyLNi27fptiZZlQZIkyHLu34Y0TROWZSESiQBA9glKcXFx9rObEULANE0oiuIqnE4o3Fy0nHMuy/JN933lypUbPguHwygpKUFG1yEBb3uMN9u32+N26nbbXrZtZ+/GK4qC0tLSnLZXVRXhcNjVObdtG7Ztu7oYO4PUrbbNZDJIp9MAgPLy8kH/zRng3OTLFgJ6JoNwOJzz9k7dsiy7ai8hBAzDwMDAAIDby9W1CpVtN/k0DGPIPj5Urq7vi05fGa5s30omk4EsyzlfT/v6+rLXpDFjxrjONgBXtdu2DcuyXI8DqqYhrCg3nPNb5erafQshXNWdb0acMdRNX7l8+TIMw8CYMWPgvHU4F6Zp5pXtfMYBJ9vONel2cuUwDANCCFfjl7O9LMvurqc5jgNOrhRFQXFxMSzLcj1n0DQNoVDIVUac9gqFQjm391DtdTu5cuQ7x9N1HZAkRFxs72bcdvpiUVERZFl23V75jAO2bWfHIDf91DRNpFKpIdv67eZOXs7xLMuCbhiIv831zMlVKBRCIpHIfp5Ptp15Vj7jgNvFumEYsGwbsWgUkUgEU6dOBXDNE6+hdugM9m4uhLquI5PJ5DyJduRzMVI1DZqqIpFI5NxQtm1DVVXEYjFXjaxpGmzbRlFRUc7b2rYNXdcRiURcde6eVAqyJA3qsLfLsiyoqpq9KOXK7cQQeKtzWparSQYAXOzqQmlJiatz7uw7Go26CqWqqojH464n0wAQjUZz3tayLFzp6UGitDTnfAohoGkaFEVx1V62bWNgYCCvbCtDTKZvx0A6DUPXUVZW5uqc9/f3Ix6Pux70DMNAPB7PeVvLsmAYhutsv3nlCsIubko4BgYGEI/HXU3OdF2HJEmuxgHDMJDJZFBSUpLztgDQdekSSktKXJ1z0zRhmqarbHs5DhiGgd6+PiRKS92Nf3nciMpnHHCuh4qiuOor/f39sCwLZWVlOW8LXJ20Rd+a4OTKMAyYpolYLJZzX7EsC5qmucoXAHRfvoxYNOoqI0IIpNNpRKPRnNvb6zleKpWCJMtIuNjeMIzstdhNttPptCfjgGma6O3tRUlJiatznk6nIcuyq7lSPv3UGQfczvE0TUNfXx/Gjx+f87ZAftnWdR22bbseB5xz5na+kdF1jK2oGPQ5X65BREREnlIUxdXCxe+iLp/w+Z2u616XMOJs24b51hMY+t/1f5HVTgiOVaTfAAAAAElFTkSuQmCC" alt="image-20200303163348963"></p> <p><strong>布隆过滤器的特点是高效地插入和查询，能够快速告诉你“某个数据一定不存在或者可能存在”。</strong></p> <p>当我们添加一个数据时候，如baidu。那我们要映射baidu这个值到布隆过滤器中，即使用多个不同的Hash哈希函数生成多个hash值（这里以3个为例子），并将每个生成的哈希值指向的bit位置的值改为1，假如“baidu”这个值得哈希函数返回了1、4、7。</p> <p><img src="/assets/img/image-20200303164853566.de35bb12.png" alt="image-20200303164853566"></p> <p>我们再存一个值“Tecent”，如果哈希函数返回3、4、8的话，图继续变为：</p> <p><img src="/assets/img/image-20200303165031784.11c916ef.png" alt="image-20200303165031784"></p> <p>因此，从上面可以知道，添加的数据根本没有在布隆过滤器存放完整的数据，只是运用一系列随机映射函数计算出位置，然后填充值1。而且我们看到，“baidu”和“Tecent”两个值得哈希函数都返回了4。</p> <p>现在呢，我们要查询“Alibaba”这个数据存不存在，就会运行同样得hash计算方式得到这个数据的信息存放在哪几个bit中，然后查看其中的bit值，如果全部3个bit中的值都为1，就代表Alibaba这个值可能存在，但是会返回存在，这时候就有可能出现了误判。如果有一个bit中的值不是1，就代表Alibaba这个值一定不存在,返回的也是不存在，这时候没有误判。</p> <p>为什么3个bit的值都是1的时候，只是代表数据可能存在？因为三个bit值都为1有可能是其它数据经过计算方式在同样的bit位置填充了1。这个很好理解：我们要判断一个对象是否相等，仅仅判断它们的哈希值是否相等是不行的。也就是说布隆过滤器只能判断数据是否一定不存在，而无法判断数据是否一定存在</p> <h4 id="布隆过滤器的优缺点"><a href="#布隆过滤器的优缺点" class="header-anchor">#</a> 布隆过滤器的优缺点</h4> <p>优点：存放的不是完整的数据，占用的内存很小，而且查询和插入数据的速度很快。</p> <p>缺点：随着数据的增加，误判率会增加。不能判断数据是否一定存在。布隆过滤器不支持删除（因为不同的数据可能往同一个bit位置写入1）。</p> <p>在实际开发中，要添加大量数据时，仅仅10几位的长度的布隆过滤器是不够用的。使用更长的二进制向量，以及使用更多的随机映射函数（哈希函数）都能够降低误判率。</p> <h4 id="布隆过滤器的使用场景"><a href="#布隆过滤器的使用场景" class="header-anchor">#</a> 布隆过滤器的使用场景</h4> <p>利用布隆过滤器减少磁盘 IO 或者网络请求，因为一旦一个值必定不存在的话，我们可以不用进行后续昂贵的查询请求。</p> <ul><li><strong>网页爬虫对URL的去重</strong>，避免爬取相同的URL地址。</li> <li><strong>垃圾邮件过滤</strong>，从数十亿个垃圾邮件列表中判断某邮箱是否是垃圾邮箱。</li> <li><strong>解决数据库缓存击穿</strong>，黑客攻击服务器时，会构建大量不存在于缓存中的key向服务器发起请求，在数据量足够大的时候，频繁的数据库查询会导致挂机。</li> <li><strong>秒杀系统</strong>，查看用户是否重复购买。</li> <li>hbase的rowkey的布隆过滤器</li></ul> <h2 id="拓展-跳跃表-todo"><a href="#拓展-跳跃表-todo" class="header-anchor">#</a> 拓展：跳跃表（TODO）</h2> <p>https://blog.csdn.net/qpzkobe/article/details/80056807</p> <p>https://www.cnblogs.com/Leo_wl/p/11557614.html</p> <p>https://www.sohu.com/a/293236470_298038</p> <h2 id="拓展-lsm-todo"><a href="#拓展-lsm-todo" class="header-anchor">#</a> 拓展：LSM(TODO)</h2></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MaLunan/press/edit/dev-mln/docs/hbase/hbase.md" target="_blank" rel="noopener noreferrer">在GitHub 上编辑此页！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">1/19/2021, 1:41:59 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fdd7a502.js" defer></script><script src="/assets/js/16.375b747e.js" defer></script><script src="/assets/js/13.426d0224.js" defer></script>
  </body>
</html>
